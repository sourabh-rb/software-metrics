<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ASMDeserializerFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.parser.deserializer</a> &gt; <span class="el_source">ASMDeserializerFactory.java</span></div><h1>ASMDeserializerFactory.java</h1><pre class="source lang-java linenums">package com.alibaba.fastjson.parser.deserializer;

import static com.alibaba.fastjson.util.ASMUtils.desc;
import static com.alibaba.fastjson.util.ASMUtils.type;

import java.lang.reflect.Constructor;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.LinkedHashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import java.util.TreeSet;
import java.util.concurrent.atomic.AtomicLong;

import com.alibaba.fastjson.asm.ClassWriter;
import com.alibaba.fastjson.asm.FieldWriter;
import com.alibaba.fastjson.asm.Label;
import com.alibaba.fastjson.asm.MethodVisitor;
import com.alibaba.fastjson.asm.MethodWriter;
import com.alibaba.fastjson.asm.Opcodes;
import com.alibaba.fastjson.parser.DefaultJSONParser;
import com.alibaba.fastjson.parser.DefaultJSONParser.ResolveTask;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONLexer;
import com.alibaba.fastjson.parser.JSONLexerBase;
import com.alibaba.fastjson.parser.JSONToken;
import com.alibaba.fastjson.parser.ParseContext;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.SymbolTable;
import com.alibaba.fastjson.util.ASMClassLoader;
import com.alibaba.fastjson.util.FieldInfo;
import com.alibaba.fastjson.util.JavaBeanInfo;
import com.alibaba.fastjson.util.TypeUtils;

public class ASMDeserializerFactory implements Opcodes {

    public final ASMClassLoader classLoader;
<span class="fc" id="L48">    protected final AtomicLong  seed              = new AtomicLong();</span>

<span class="fc" id="L50">    final static String         DefaultJSONParser = type(DefaultJSONParser.class);</span>
<span class="fc" id="L51">    final static String         JSONLexerBase     = type(JSONLexerBase.class);</span>

<span class="fc" id="L53">    public ASMDeserializerFactory(ClassLoader parentClassLoader){</span>
<span class="fc bfc" id="L54" title="All 2 branches covered.">        classLoader = parentClassLoader instanceof ASMClassLoader //</span>
            ? (ASMClassLoader) parentClassLoader //
            : new ASMClassLoader(parentClassLoader);
<span class="fc" id="L57">    }</span>
    
    public ObjectDeserializer createJavaBeanDeserializer(ParserConfig config, JavaBeanInfo beanInfo) throws Exception {
<span class="fc" id="L60">        Class&lt;?&gt; clazz = beanInfo.clazz;</span>
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (clazz.isPrimitive()) {</span>
<span class="fc" id="L62">            throw new IllegalArgumentException(&quot;not support type :&quot; + clazz.getName());</span>
        }

<span class="fc" id="L65">        String className = &quot;FastjsonASMDeserializer_&quot; + seed.incrementAndGet() + &quot;_&quot; + clazz.getSimpleName();</span>
        String classNameType;
        String classNameFull;

<span class="fc" id="L69">        Package pkg = ASMDeserializerFactory.class.getPackage();</span>
<span class="pc bpc" id="L70" title="1 of 2 branches missed.">        if (pkg != null) {</span>
<span class="fc" id="L71">            String packageName = pkg.getName();</span>
<span class="fc" id="L72">            classNameType = packageName.replace('.', '/') + &quot;/&quot; + className;</span>
<span class="fc" id="L73">            classNameFull = packageName + &quot;.&quot; + className;</span>
<span class="fc" id="L74">        } else {</span>
<span class="nc" id="L75">            classNameType = className;</span>
<span class="nc" id="L76">            classNameFull = className;</span>
        }

<span class="fc" id="L79">        ClassWriter cw = new ClassWriter();</span>
<span class="fc" id="L80">        cw.visit(V1_5, ACC_PUBLIC + ACC_SUPER, classNameType, type(JavaBeanDeserializer.class), null);</span>

<span class="fc" id="L82">        _init(cw, new Context(classNameType, config, beanInfo, 3));</span>
<span class="fc" id="L83">        _createInstance(cw, new Context(classNameType, config, beanInfo, 3));</span>
<span class="fc" id="L84">        _deserialze(cw, new Context(classNameType, config, beanInfo, 5));</span>

<span class="fc" id="L86">        _deserialzeArrayMapping(cw, new Context(classNameType, config, beanInfo, 4));</span>
<span class="fc" id="L87">        byte[] code = cw.toByteArray();</span>

<span class="fc" id="L89">        Class&lt;?&gt; deserClass = classLoader.defineClassPublic(classNameFull, code, 0, code.length);</span>
<span class="fc" id="L90">        Constructor&lt;?&gt; constructor = deserClass.getConstructor(ParserConfig.class, JavaBeanInfo.class);</span>
<span class="fc" id="L91">        Object instance = constructor.newInstance(config, beanInfo);</span>

<span class="fc" id="L93">        return (ObjectDeserializer) instance;</span>
    }

    private void _setFlag(MethodVisitor mw, Context context, int i) {
<span class="fc" id="L97">        String varName = &quot;_asm_flag_&quot; + (i / 32);</span>

<span class="fc" id="L99">        mw.visitVarInsn(ILOAD, context.var(varName));</span>
<span class="fc" id="L100">        mw.visitLdcInsn(1 &lt;&lt; i);</span>
<span class="fc" id="L101">        mw.visitInsn(IOR);</span>
<span class="fc" id="L102">        mw.visitVarInsn(ISTORE, context.var(varName));</span>
<span class="fc" id="L103">    }</span>

    private void _isFlag(MethodVisitor mw, Context context, int i, Label label) {
<span class="fc" id="L106">        mw.visitVarInsn(ILOAD, context.var(&quot;_asm_flag_&quot; + (i / 32)));</span>
<span class="fc" id="L107">        mw.visitLdcInsn(1 &lt;&lt; i);</span>
<span class="fc" id="L108">        mw.visitInsn(IAND);</span>

<span class="fc" id="L110">        mw.visitJumpInsn(IFEQ, label);</span>
<span class="fc" id="L111">    }</span>

    private void _deserialzeArrayMapping(ClassWriter cw, Context context) {
<span class="fc" id="L114">        MethodVisitor mw = new MethodWriter(cw, ACC_PUBLIC, &quot;deserialzeArrayMapping&quot;,</span>
                                            &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;,
                                            null, null);

<span class="fc" id="L118">        defineVarLexer(context, mw);</span>

<span class="fc" id="L120">        _createInstance(context, mw);</span>

<span class="fc" id="L122">        FieldInfo[] sortedFieldInfoList = context.beanInfo.sortedFields;</span>
<span class="fc" id="L123">        int fieldListSize = sortedFieldInfoList.length;</span>
<span class="fc bfc" id="L124" title="All 2 branches covered.">        for (int i = 0; i &lt; fieldListSize; ++i) {</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">            final boolean last = (i == fieldListSize - 1);</span>
<span class="fc bfc" id="L126" title="All 2 branches covered.">            final char seperator = last ? ']' : ',';</span>

<span class="fc" id="L128">            FieldInfo fieldInfo = sortedFieldInfoList[i];</span>
<span class="fc" id="L129">            Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>
<span class="fc" id="L130">            Type fieldType = fieldInfo.fieldType;</span>
<span class="fc bfc" id="L131" title="All 6 branches covered.">            if (fieldClass == byte.class //</span>
                || fieldClass == short.class //
                || fieldClass == int.class) {
<span class="fc" id="L134">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L135">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L136">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanInt&quot;, &quot;(C)I&quot;);</span>
<span class="fc" id="L137">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L138" title="All 2 branches covered.">            } else if (fieldClass == Byte.class) {</span>
<span class="fc" id="L139">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L140">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L141">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanInt&quot;, &quot;(C)I&quot;);</span>
<span class="fc" id="L142">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Byte&quot;, &quot;valueOf&quot;, &quot;(B)Ljava/lang/Byte;&quot;);</span>

<span class="fc" id="L144">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L145">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L146">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L147">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L148">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L149">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L150">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L151">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L152">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">            } else if (fieldClass == Short.class) {</span>
<span class="fc" id="L154">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L155">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L156">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanInt&quot;, &quot;(C)I&quot;);</span>
<span class="fc" id="L157">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Short&quot;, &quot;valueOf&quot;, &quot;(S)Ljava/lang/Short;&quot;);</span>

<span class="fc" id="L159">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L160">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L161">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L162">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L163">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L164">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L165">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L166">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L167">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">            } else if (fieldClass == Integer.class) {</span>
<span class="fc" id="L169">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L170">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L171">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanInt&quot;, &quot;(C)I&quot;);</span>
<span class="fc" id="L172">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Integer&quot;, &quot;valueOf&quot;, &quot;(I)Ljava/lang/Integer;&quot;);</span>

<span class="fc" id="L174">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L175">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L176">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L177">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L178">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L179">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L180">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L181">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L182">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L183" title="All 2 branches covered.">            } else if (fieldClass == long.class) {</span>
<span class="fc" id="L184">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L185">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L186">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanLong&quot;, &quot;(C)J&quot;);</span>
<span class="fc" id="L187">                mw.visitVarInsn(LSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>

<span class="fc bfc" id="L189" title="All 2 branches covered.">            } else if (fieldClass == Long.class) {</span>
<span class="fc" id="L190">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L191">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L192">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanLong&quot;, &quot;(C)J&quot;);</span>
<span class="fc" id="L193">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Long&quot;, &quot;valueOf&quot;, &quot;(J)Ljava/lang/Long;&quot;);</span>

<span class="fc" id="L195">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L196">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L197">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L198">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L199">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L200">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L201">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L202">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L203">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L204" title="All 2 branches covered.">            } else if (fieldClass == boolean.class) {</span>
<span class="fc" id="L205">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L206">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L207">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanBoolean&quot;, &quot;(C)Z&quot;);</span>
<span class="fc" id="L208">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L209" title="All 2 branches covered.">            } else if (fieldClass == float.class) {</span>
<span class="fc" id="L210">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L211">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L212">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFloat&quot;, &quot;(C)F&quot;);</span>
<span class="fc" id="L213">                mw.visitVarInsn(FSTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L215" title="All 2 branches covered.">            } else if (fieldClass == Float.class) {</span>
<span class="fc" id="L216">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L217">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L218">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFloat&quot;, &quot;(C)F&quot;);</span>
<span class="fc" id="L219">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Float&quot;, &quot;valueOf&quot;, &quot;(F)Ljava/lang/Float;&quot;);</span>

<span class="fc" id="L221">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L222">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L223">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L224">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L225">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L226">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L227">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L228">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L229">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L231" title="All 2 branches covered.">            } else if (fieldClass == double.class) {</span>
<span class="fc" id="L232">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L233">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L234">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanDouble&quot;, &quot;(C)D&quot;);</span>
<span class="fc" id="L235">                mw.visitVarInsn(DSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>

<span class="fc bfc" id="L237" title="All 2 branches covered.">            } else if (fieldClass == Double.class) {</span>
<span class="fc" id="L238">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L239">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L240">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanDouble&quot;, &quot;(C)D&quot;);</span>
<span class="fc" id="L241">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Double&quot;, &quot;valueOf&quot;, &quot;(D)Ljava/lang/Double;&quot;);</span>

<span class="fc" id="L243">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L244">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L245">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L246">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L247">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L248">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L249">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L250">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L251">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L253" title="All 2 branches covered.">            } else if (fieldClass == char.class) {</span>
<span class="fc" id="L254">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L255">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L256">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanString&quot;, &quot;(C)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L257">                mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L258">                mw.visitMethodInsn(INVOKEVIRTUAL, &quot;java/lang/String&quot;, &quot;charAt&quot;, &quot;(I)C&quot;);</span>
<span class="fc" id="L259">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">            } else if (fieldClass == String.class) {</span>
<span class="fc" id="L261">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L262">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L263">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanString&quot;, &quot;(C)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L264">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L266" title="All 2 branches covered.">            } else if (fieldClass == BigDecimal.class) {</span>
<span class="fc" id="L267">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L268">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L269">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanDecimal&quot;, &quot;(C)Ljava/math/BigDecimal;&quot;);</span>
<span class="fc" id="L270">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L272" title="All 2 branches covered.">            } else if (fieldClass == java.util.Date.class) {</span>
<span class="fc" id="L273">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L274">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L275">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanDate&quot;, &quot;(C)Ljava/util/Date;&quot;);</span>
<span class="fc" id="L276">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L278" title="All 2 branches covered.">            } else if (fieldClass == java.util.UUID.class) {</span>
<span class="fc" id="L279">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L280">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L281">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanUUID&quot;, &quot;(C)Ljava/util/UUID;&quot;);</span>
<span class="fc" id="L282">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L284" title="All 2 branches covered.">            } else if (fieldClass.isEnum()) {</span>
<span class="fc" id="L285">                Label enumNumIf_ = new Label();</span>
<span class="fc" id="L286">                Label enumNumErr_ = new Label();</span>
<span class="fc" id="L287">                Label enumStore_ = new Label();</span>
<span class="fc" id="L288">                Label enumQuote_ = new Label();</span>

<span class="fc" id="L290">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L291">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L292">                mw.visitInsn(DUP);</span>
<span class="fc" id="L293">                mw.visitVarInsn(ISTORE, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L294">                mw.visitLdcInsn((int) 'n');</span>
<span class="fc" id="L295">                mw.visitJumpInsn(IF_ICMPEQ, enumQuote_);</span>

<span class="fc" id="L297">                mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L298">                mw.visitLdcInsn((int) '\&quot;');</span>
<span class="fc" id="L299">                mw.visitJumpInsn(IF_ICMPNE, enumNumIf_);</span>

<span class="fc" id="L301">                mw.visitLabel(enumQuote_);</span>
<span class="fc" id="L302">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L303">                mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldClass)));</span>
<span class="fc" id="L304">                mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L305">                mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getSymbolTable&quot;, &quot;()&quot; + desc(SymbolTable.class));</span>
<span class="fc" id="L306">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L307">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanEnum&quot;,</span>
<span class="fc" id="L308">                                   &quot;(Ljava/lang/Class;&quot; + desc(SymbolTable.class) + &quot;C)Ljava/lang/Enum;&quot;);</span>
<span class="fc" id="L309">                mw.visitJumpInsn(GOTO, enumStore_);</span>

                // (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {
<span class="fc" id="L312">                mw.visitLabel(enumNumIf_);</span>
<span class="fc" id="L313">                mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L314">                mw.visitLdcInsn((int) '0');</span>
<span class="fc" id="L315">                mw.visitJumpInsn(IF_ICMPLT, enumNumErr_);</span>

<span class="fc" id="L317">                mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L318">                mw.visitLdcInsn((int) '9');</span>
<span class="fc" id="L319">                mw.visitJumpInsn(IF_ICMPGT, enumNumErr_);</span>

<span class="fc" id="L321">                _getFieldDeser(context, mw, fieldInfo);</span>
<span class="fc" id="L322">                mw.visitTypeInsn(CHECKCAST, type(EnumDeserializer.class)); // cast</span>
<span class="fc" id="L323">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L324">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L325">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanInt&quot;, &quot;(C)I&quot;);</span>
<span class="fc" id="L326">                mw.visitMethodInsn(INVOKEVIRTUAL, type(EnumDeserializer.class), &quot;valueOf&quot;, &quot;(I)Ljava/lang/Enum;&quot;);</span>
<span class="fc" id="L327">                mw.visitJumpInsn(GOTO, enumStore_);</span>

<span class="fc" id="L329">                mw.visitLabel(enumNumErr_);</span>
<span class="fc" id="L330">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L331">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L332">                mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L333">                mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;scanEnum&quot;,</span>
                                   &quot;(L&quot; + JSONLexerBase + &quot;;C)Ljava/lang/Enum;&quot;);

<span class="fc" id="L336">                mw.visitLabel(enumStore_);</span>
<span class="fc" id="L337">                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L338">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L339" title="All 2 branches covered.">            } else if (Collection.class.isAssignableFrom(fieldClass)) {</span>
                
<span class="fc" id="L341">                Class&lt;?&gt; itemClass = TypeUtils.getCollectionItemClass(fieldType);</span>
<span class="fc bfc" id="L342" title="All 2 branches covered.">                if (itemClass == String.class) {</span>
<span class="pc bpc" id="L343" title="2 of 6 branches missed.">                    if (fieldClass == List.class</span>
                            || fieldClass == Collections.class
                            || fieldClass == ArrayList.class
                    ) {
<span class="fc" id="L347">                        mw.visitTypeInsn(NEW, type(ArrayList.class));</span>
<span class="fc" id="L348">                        mw.visitInsn(DUP);</span>
<span class="fc" id="L349">                        mw.visitMethodInsn(INVOKESPECIAL, type(ArrayList.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
                    } else {
<span class="fc" id="L351">                        mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldClass)));</span>
<span class="fc" id="L352">                        mw.visitMethodInsn(INVOKESTATIC, type(TypeUtils.class), &quot;createCollection&quot;,</span>
                                           &quot;(Ljava/lang/Class;)Ljava/util/Collection;&quot;);
                    }
<span class="fc" id="L355">                    mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
                    
<span class="fc" id="L357">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L358">                    mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L359">                    mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="fc" id="L360">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanStringArray&quot;, &quot;(Ljava/util/Collection;C)V&quot;);</span>
                    
<span class="fc" id="L362">                    Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L363">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L364">                    mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L365">                    mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L366">                    mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L367">                    mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L368">                    mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
                    
<span class="fc" id="L370">                    mw.visitLabel(valueNullEnd_);</span>
                    
<span class="fc" id="L372">                } else {</span>
<span class="fc" id="L373">                    Label notError_ = new Label();</span>
<span class="fc" id="L374">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L375">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L376">                    mw.visitVarInsn(ISTORE, context.var(&quot;token&quot;));</span>

<span class="fc" id="L378">                    mw.visitVarInsn(ILOAD, context.var(&quot;token&quot;));</span>
<span class="fc bfc" id="L379" title="All 2 branches covered.">                    int token = i == 0 ? JSONToken.LBRACKET : JSONToken.COMMA;</span>
<span class="fc" id="L380">                    mw.visitLdcInsn(token);</span>
<span class="fc" id="L381">                    mw.visitJumpInsn(IF_ICMPEQ, notError_);</span>

<span class="fc" id="L383">                    mw.visitVarInsn(ALOAD, 1); // DefaultJSONParser</span>
<span class="fc" id="L384">                    mw.visitLdcInsn(token);</span>
<span class="fc" id="L385">                    mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;throwException&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L387">                    mw.visitLabel(notError_);</span>

<span class="fc" id="L389">                    Label quickElse_ = new Label(), quickEnd_ = new Label();</span>
<span class="fc" id="L390">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L391">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L392">                    mw.visitVarInsn(BIPUSH, '[');</span>
<span class="fc" id="L393">                    mw.visitJumpInsn(IF_ICMPNE, quickElse_);</span>

<span class="fc" id="L395">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L396">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L397">                    mw.visitInsn(POP);</span>
<span class="fc" id="L398">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L399">                    mw.visitLdcInsn(JSONToken.LBRACKET);</span>
<span class="fc" id="L400">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L401">                    mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L403">                    mw.visitLabel(quickElse_);</span>
<span class="fc" id="L404">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L405">                    mw.visitLdcInsn(JSONToken.LBRACKET);</span>
<span class="fc" id="L406">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L407">                    mw.visitLabel(quickEnd_);</span>

<span class="fc" id="L409">                    _newCollection(mw, fieldClass, i, false);</span>
<span class="fc" id="L410">                    mw.visitInsn(DUP);</span>
<span class="fc" id="L411">                    mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L412">                    _getCollectionFieldItemDeser(context, mw, fieldInfo, itemClass);</span>
<span class="fc" id="L413">                    mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L414">                    mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(itemClass)));</span>
<span class="fc" id="L415">                    mw.visitVarInsn(ALOAD, 3);</span>
<span class="fc" id="L416">                    mw.visitMethodInsn(INVOKESTATIC, type(JavaBeanDeserializer.class),</span>
                                       &quot;parseArray&quot;,
                                       &quot;(Ljava/util/Collection;&quot; //
<span class="fc" id="L419">                                                     + desc(ObjectDeserializer.class) //</span>
                                                     + &quot;L&quot; + DefaultJSONParser + &quot;;&quot; //
                                                     + &quot;Ljava/lang/reflect/Type;Ljava/lang/Object;)V&quot;);
                }
<span class="fc bfc" id="L423" title="All 2 branches covered.">            } else if (fieldClass.isArray()) {</span>
<span class="fc" id="L424">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L425">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONToken.LBRACKET);</span>
<span class="fc" id="L426">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L428">                mw.visitVarInsn(ALOAD, Context.parser);</span>
<span class="fc" id="L429">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L430">                mw.visitLdcInsn(i);</span>
<span class="fc" id="L431">                mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;getFieldType&quot;,</span>
                                   &quot;(I)Ljava/lang/reflect/Type;&quot;);
<span class="fc" id="L433">                mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;parseObject&quot;,</span>
                                   &quot;(Ljava/lang/reflect/Type;)Ljava/lang/Object;&quot;);

<span class="fc" id="L436">                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L437">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
            } else {
<span class="fc" id="L439">                Label objElseIf_ = new Label();</span>
<span class="fc" id="L440">                Label objEndIf_ = new Label();</span>

<span class="pc bpc" id="L442" title="1 of 2 branches missed.">                if (fieldClass == java.util.Date.class) {</span>
<span class="nc" id="L443">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="nc" id="L444">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="nc" id="L445">                    mw.visitLdcInsn((int) '1');</span>
<span class="nc" id="L446">                    mw.visitJumpInsn(IF_ICMPNE, objElseIf_);</span>

<span class="nc" id="L448">                    mw.visitTypeInsn(NEW, type(java.util.Date.class));</span>
<span class="nc" id="L449">                    mw.visitInsn(DUP);</span>

<span class="nc" id="L451">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="nc" id="L452">                    mw.visitVarInsn(BIPUSH, seperator);</span>
<span class="nc" id="L453">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanLong&quot;, &quot;(C)J&quot;);</span>

<span class="nc" id="L455">                    mw.visitMethodInsn(INVOKESPECIAL, type(java.util.Date.class), &quot;&lt;init&gt;&quot;, &quot;(J)V&quot;);</span>
<span class="nc" id="L456">                    mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="nc" id="L458">                    mw.visitJumpInsn(GOTO, objEndIf_);</span>
                }

<span class="fc" id="L461">                mw.visitLabel(objElseIf_);</span>

<span class="fc" id="L463">                _quickNextToken(context, mw, JSONToken.LBRACKET);</span>

<span class="fc" id="L465">                _deserObject(context, mw, fieldInfo, fieldClass, i);</span>

<span class="fc" id="L467">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L468">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L469">                mw.visitLdcInsn(JSONToken.RBRACKET);</span>
<span class="fc" id="L470">                mw.visitJumpInsn(IF_ICMPEQ, objEndIf_);</span>
//                mw.visitInsn(POP);
//                mw.visitInsn(POP);

<span class="fc" id="L474">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L475">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc bfc" id="L476" title="All 2 branches covered.">                if (!last) {</span>
<span class="fc" id="L477">                    mw.visitLdcInsn(JSONToken.COMMA);</span>
                } else {
<span class="fc" id="L479">                    mw.visitLdcInsn(JSONToken.RBRACKET);</span>
                }
<span class="fc" id="L481">                mw.visitMethodInsn(INVOKESPECIAL, //</span>
<span class="fc" id="L482">                                   type(JavaBeanDeserializer.class), //</span>
<span class="fc" id="L483">                                   &quot;check&quot;, &quot;(&quot; + desc(JSONLexer.class) + &quot;I)V&quot;);</span>

<span class="fc" id="L485">                mw.visitLabel(objEndIf_);</span>
<span class="fc" id="L486">                continue;</span>
            }
        }

<span class="fc" id="L490">        _batchSet(context, mw, false);</span>

<span class="fc" id="L492">        Label quickElse_ = new Label(), quickElseIf_ = new Label(), quickElseIfEOI_ = new Label(),</span>
<span class="fc" id="L493">                quickEnd_ = new Label();</span>
<span class="fc" id="L494">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L495">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L496">        mw.visitInsn(DUP);</span>
<span class="fc" id="L497">        mw.visitVarInsn(ISTORE, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L498">        mw.visitVarInsn(BIPUSH, ',');</span>
<span class="fc" id="L499">        mw.visitJumpInsn(IF_ICMPNE, quickElseIf_);</span>

<span class="fc" id="L501">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L502">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L503">        mw.visitInsn(POP);</span>
<span class="fc" id="L504">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L505">        mw.visitLdcInsn(JSONToken.COMMA);</span>
<span class="fc" id="L506">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L507">        mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L509">        mw.visitLabel(quickElseIf_);</span>
<span class="fc" id="L510">        mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L511">        mw.visitVarInsn(BIPUSH, ']');</span>
<span class="fc" id="L512">        mw.visitJumpInsn(IF_ICMPNE, quickElseIfEOI_);</span>

<span class="fc" id="L514">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L515">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L516">        mw.visitInsn(POP);</span>
<span class="fc" id="L517">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L518">        mw.visitLdcInsn(JSONToken.RBRACKET);</span>
<span class="fc" id="L519">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L520">        mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L522">        mw.visitLabel(quickElseIfEOI_);</span>
<span class="fc" id="L523">        mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L524">        mw.visitVarInsn(BIPUSH, (char) JSONLexer.EOI);</span>
<span class="fc" id="L525">        mw.visitJumpInsn(IF_ICMPNE, quickElse_);</span>

<span class="fc" id="L527">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L528">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L529">        mw.visitInsn(POP);</span>
<span class="fc" id="L530">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L531">        mw.visitLdcInsn(JSONToken.EOF);</span>
<span class="fc" id="L532">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L533">        mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L535">        mw.visitLabel(quickElse_);</span>
<span class="fc" id="L536">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L537">        mw.visitLdcInsn(JSONToken.COMMA);</span>
<span class="fc" id="L538">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L540">        mw.visitLabel(quickEnd_);</span>

<span class="fc" id="L542">        mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L543">        mw.visitInsn(ARETURN);</span>
<span class="fc" id="L544">        mw.visitMaxs(5, context.variantIndex);</span>
<span class="fc" id="L545">        mw.visitEnd();</span>
<span class="fc" id="L546">    }</span>

    private void _deserialze(ClassWriter cw, Context context) {
<span class="fc bfc" id="L549" title="All 2 branches covered.">        if (context.fieldInfoList.length == 0) {</span>
<span class="fc" id="L550">            return;</span>
        }

<span class="fc bfc" id="L553" title="All 2 branches covered.">        for (FieldInfo fieldInfo : context.fieldInfoList) {</span>
<span class="fc" id="L554">            Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>
<span class="fc" id="L555">            Type fieldType = fieldInfo.fieldType;</span>

<span class="fc bfc" id="L557" title="All 2 branches covered.">            if (fieldClass == char.class) {</span>
<span class="fc" id="L558">                return;</span>
            }

<span class="fc bfc" id="L561" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(fieldClass)) {</span>
<span class="fc bfc" id="L562" title="All 2 branches covered.">                if (fieldType instanceof ParameterizedType) {</span>
<span class="fc" id="L563">                    Type itemType = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L564" title="All 2 branches covered.">                    if (itemType instanceof Class) {</span>
<span class="fc" id="L565">                        continue;</span>
                    } else {
<span class="fc" id="L567">                        return;</span>
                    }
                } else {
<span class="fc" id="L570">                    return;</span>
                }
            }
        }

<span class="fc" id="L575">        JavaBeanInfo beanInfo = context.beanInfo;</span>
<span class="fc" id="L576">        context.fieldInfoList = beanInfo.sortedFields;</span>

<span class="fc" id="L578">        MethodVisitor mw = new MethodWriter(cw, ACC_PUBLIC, &quot;deserialze&quot;,</span>
                                            &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;I)Ljava/lang/Object;&quot;,
                                            null, null);

<span class="fc" id="L582">        Label reset_ = new Label();</span>
<span class="fc" id="L583">        Label super_ = new Label();</span>
<span class="fc" id="L584">        Label return_ = new Label();</span>
<span class="fc" id="L585">        Label end_ = new Label();</span>

<span class="fc" id="L587">        defineVarLexer(context, mw);</span>

        {
<span class="fc" id="L590">            Label next_ = new Label();</span>

            // isSupportArrayToBean

<span class="fc" id="L594">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L595">            mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L596">            mw.visitLdcInsn(JSONToken.LBRACKET);</span>
<span class="fc" id="L597">            mw.visitJumpInsn(IF_ICMPNE, next_);</span>

<span class="fc bfc" id="L599" title="All 2 branches covered.">            if ((beanInfo.parserFeatures &amp; Feature.SupportArrayToBean.mask) == 0) {</span>
<span class="fc" id="L600">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L601">                mw.visitVarInsn(ILOAD, 4);</span>
<span class="fc" id="L602">                mw.visitLdcInsn(Feature.SupportArrayToBean.mask);</span>
<span class="fc" id="L603">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;isEnabled&quot;, &quot;(II)Z&quot;);</span>
<span class="fc" id="L604">                mw.visitJumpInsn(IFEQ, next_);</span>
            }

<span class="fc" id="L607">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L608">            mw.visitVarInsn(ALOAD, Context.parser);</span>
<span class="fc" id="L609">            mw.visitVarInsn(ALOAD, 2);</span>
<span class="fc" id="L610">            mw.visitVarInsn(ALOAD, 3);</span>
<span class="fc" id="L611">            mw.visitInsn(ACONST_NULL); //mw.visitVarInsn(ALOAD, 5);</span>
<span class="fc" id="L612">            mw.visitMethodInsn(INVOKESPECIAL, //</span>
<span class="fc" id="L613">                               context.className, //</span>
                               &quot;deserialzeArrayMapping&quot;, //
                               &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;);
<span class="fc" id="L616">            mw.visitInsn(ARETURN);</span>

<span class="fc" id="L618">            mw.visitLabel(next_);</span>
            // deserialzeArrayMapping
        }

<span class="fc" id="L622">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L623">        mw.visitLdcInsn(Feature.SortFeidFastMatch.mask);</span>
<span class="fc" id="L624">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;isEnabled&quot;, &quot;(I)Z&quot;);</span>

<span class="fc" id="L626">        mw.visitJumpInsn(IFEQ, super_);</span>

<span class="fc" id="L628">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L629">        mw.visitLdcInsn(context.clazz.getName());</span>
<span class="fc" id="L630">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanType&quot;, &quot;(Ljava/lang/String;)I&quot;);</span>

<span class="fc" id="L632">        mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.NOT_MATCH);</span>
<span class="fc" id="L633">        mw.visitJumpInsn(IF_ICMPEQ, super_);</span>

<span class="fc" id="L635">        mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L636">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getContext&quot;, &quot;()&quot; + desc(ParseContext.class));</span>
<span class="fc" id="L637">        mw.visitVarInsn(ASTORE, context.var(&quot;mark_context&quot;));</span>

        // ParseContext context = parser.getContext();
<span class="fc" id="L640">        mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L641">        mw.visitVarInsn(ISTORE, context.var(&quot;matchedCount&quot;));</span>

<span class="fc" id="L643">        _createInstance(context, mw);</span>

        {
<span class="fc" id="L646">            mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L647">            mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getContext&quot;, &quot;()&quot; + desc(ParseContext.class));</span>
<span class="fc" id="L648">            mw.visitVarInsn(ASTORE, context.var(&quot;context&quot;));</span>

<span class="fc" id="L650">            mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L651">            mw.visitVarInsn(ALOAD, context.var(&quot;context&quot;));</span>
<span class="fc" id="L652">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L653">            mw.visitVarInsn(ALOAD, 3); // fieldName</span>
<span class="fc" id="L654">            mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;setContext&quot;, //</span>
<span class="fc" id="L655">                               &quot;(&quot; + desc(ParseContext.class) + &quot;Ljava/lang/Object;Ljava/lang/Object;)&quot;</span>
<span class="fc" id="L656">                                                                               + desc(ParseContext.class));</span>
<span class="fc" id="L657">            mw.visitVarInsn(ASTORE, context.var(&quot;childContext&quot;));</span>
        }

<span class="fc" id="L660">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L661">        mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L662">        mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.END);</span>
<span class="fc" id="L663">        mw.visitJumpInsn(IF_ICMPEQ, return_);</span>

<span class="fc" id="L665">        mw.visitInsn(ICONST_0); // UNKOWN</span>
<span class="fc" id="L666">        mw.visitIntInsn(ISTORE, context.var(&quot;matchStat&quot;));</span>

<span class="fc" id="L668">        int fieldListSize = context.fieldInfoList.length;</span>
<span class="fc bfc" id="L669" title="All 2 branches covered.">        for (int i = 0; i &lt; fieldListSize; i += 32) {</span>
<span class="fc" id="L670">            mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L671">            mw.visitVarInsn(ISTORE, context.var(&quot;_asm_flag_&quot; + (i / 32)));</span>
        }

<span class="fc" id="L674">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L675">        mw.visitLdcInsn(Feature.InitStringFieldAsEmpty.mask);</span>
<span class="fc" id="L676">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;isEnabled&quot;, &quot;(I)Z&quot;);</span>
<span class="fc" id="L677">        mw.visitIntInsn(ISTORE, context.var(&quot;initStringFieldAsEmpty&quot;));</span>

        // declare and init
<span class="fc bfc" id="L680" title="All 2 branches covered.">        for (int i = 0; i &lt; fieldListSize; ++i) {</span>
<span class="fc" id="L681">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>
<span class="fc" id="L682">            Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>

<span class="fc bfc" id="L684" title="All 8 branches covered.">            if (fieldClass == boolean.class //</span>
                || fieldClass == byte.class //
                || fieldClass == short.class //
                || fieldClass == int.class) {
<span class="fc" id="L688">                mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L689">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L690" title="All 2 branches covered.">            } else if (fieldClass == long.class) {</span>
<span class="fc" id="L691">                mw.visitInsn(LCONST_0);</span>
<span class="fc" id="L692">                mw.visitVarInsn(LSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>
<span class="fc bfc" id="L693" title="All 2 branches covered.">            } else if (fieldClass == float.class) {</span>
<span class="fc" id="L694">                mw.visitInsn(FCONST_0);</span>
<span class="fc" id="L695">                mw.visitVarInsn(FSTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L696" title="All 2 branches covered.">            } else if (fieldClass == double.class) {</span>
<span class="fc" id="L697">                mw.visitInsn(DCONST_0);</span>
<span class="fc" id="L698">                mw.visitVarInsn(DSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>
            } else {
<span class="fc bfc" id="L700" title="All 2 branches covered.">                if (fieldClass == String.class) {</span>
<span class="fc" id="L701">                    Label flagEnd_ = new Label();</span>
<span class="fc" id="L702">                    Label flagElse_ = new Label();</span>
<span class="fc" id="L703">                    mw.visitVarInsn(ILOAD, context.var(&quot;initStringFieldAsEmpty&quot;));</span>
<span class="fc" id="L704">                    mw.visitJumpInsn(IFEQ, flagElse_);</span>
<span class="fc" id="L705">                    _setFlag(mw, context, i);</span>
<span class="fc" id="L706">                    mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L707">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;stringDefaultValue&quot;, &quot;()Ljava/lang/String;&quot;);</span>
<span class="fc" id="L708">                    mw.visitJumpInsn(GOTO, flagEnd_);</span>

<span class="fc" id="L710">                    mw.visitLabel(flagElse_);</span>
<span class="fc" id="L711">                    mw.visitInsn(ACONST_NULL);</span>

<span class="fc" id="L713">                    mw.visitLabel(flagEnd_);</span>
<span class="fc" id="L714">                } else {</span>
<span class="fc" id="L715">                    mw.visitInsn(ACONST_NULL);</span>
                }

<span class="fc" id="L718">                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L719">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
            }
        }

<span class="fc bfc" id="L723" title="All 2 branches covered.">        for (int i = 0; i &lt; fieldListSize; ++i) {</span>
<span class="fc" id="L724">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>
<span class="fc" id="L725">            Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>
<span class="fc" id="L726">            Type fieldType = fieldInfo.fieldType;</span>

<span class="fc" id="L728">            Label notMatch_ = new Label();</span>

<span class="fc bfc" id="L730" title="All 2 branches covered.">            if (fieldClass == boolean.class) {</span>
<span class="fc" id="L731">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L732">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L733">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L734">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldBoolean&quot;, &quot;([C)Z&quot;);</span>
<span class="fc" id="L735">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L736" title="All 2 branches covered.">            } else if (fieldClass == byte.class) {</span>
<span class="fc" id="L737">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L738">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L739">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L740">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L741">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L743" title="All 2 branches covered.">            } else if (fieldClass == Byte.class) {</span>
<span class="fc" id="L744">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L745">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L746">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L747">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L748">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Byte&quot;, &quot;valueOf&quot;, &quot;(B)Ljava/lang/Byte;&quot;);</span>

<span class="fc" id="L750">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L751">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L752">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L753">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L754">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L755">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L756">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L757">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L758">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L760" title="All 2 branches covered.">            } else if (fieldClass == short.class) {</span>
<span class="fc" id="L761">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L762">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L763">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L764">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L765">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L767" title="All 2 branches covered.">            } else if (fieldClass == Short.class) {</span>
<span class="fc" id="L768">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L769">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L770">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L771">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L772">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Short&quot;, &quot;valueOf&quot;, &quot;(S)Ljava/lang/Short;&quot;);</span>

<span class="fc" id="L774">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L775">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L776">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L777">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L778">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L779">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L780">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L781">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L782">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L784" title="All 2 branches covered.">            } else if (fieldClass == int.class) {</span>
<span class="fc" id="L785">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L786">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L787">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L788">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L789">                mw.visitVarInsn(ISTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L791" title="All 2 branches covered.">            } else if (fieldClass == Integer.class) {</span>
<span class="fc" id="L792">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L793">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L794">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L795">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldInt&quot;, &quot;([C)I&quot;);</span>
<span class="fc" id="L796">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Integer&quot;, &quot;valueOf&quot;, &quot;(I)Ljava/lang/Integer;&quot;);</span>

<span class="fc" id="L798">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L799">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L800">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L801">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L802">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L803">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L804">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L805">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L806">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L808" title="All 2 branches covered.">            } else if (fieldClass == long.class) {</span>
<span class="fc" id="L809">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L810">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L811">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L812">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldLong&quot;, &quot;([C)J&quot;);</span>
<span class="fc" id="L813">                mw.visitVarInsn(LSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>

<span class="fc bfc" id="L815" title="All 2 branches covered.">            } else if (fieldClass == Long.class) {</span>
<span class="fc" id="L816">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L817">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L818">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L819">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldLong&quot;, &quot;([C)J&quot;);</span>
<span class="fc" id="L820">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Long&quot;, &quot;valueOf&quot;, &quot;(J)Ljava/lang/Long;&quot;);</span>

<span class="fc" id="L822">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L823">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L824">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L825">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L826">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L827">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L828">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L829">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L830">                mw.visitLabel(valueNullEnd_);</span>

<span class="fc bfc" id="L832" title="All 2 branches covered.">            } else if (fieldClass == float.class) {</span>
<span class="fc" id="L833">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L834">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L835">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L836">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldFloat&quot;, &quot;([C)F&quot;);</span>
<span class="fc" id="L837">                mw.visitVarInsn(FSTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L839" title="All 2 branches covered.">            } else if (fieldClass == Float.class) {</span>
<span class="fc" id="L840">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L841">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L842">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L843">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldFloat&quot;, &quot;([C)F&quot;);</span>
<span class="fc" id="L844">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Float&quot;, &quot;valueOf&quot;, &quot;(F)Ljava/lang/Float;&quot;);</span>

<span class="fc" id="L846">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L847">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L848">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L849">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L850">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L851">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L852">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L853">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L854">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L855" title="All 2 branches covered.">            } else if (fieldClass == double.class) {</span>
<span class="fc" id="L856">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L857">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L858">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L859">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldDouble&quot;, &quot;([C)D&quot;);</span>
<span class="fc" id="L860">                mw.visitVarInsn(DSTORE, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>

<span class="fc bfc" id="L862" title="All 2 branches covered.">            } else if (fieldClass == Double.class) {</span>
<span class="fc" id="L863">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L864">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L865">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L866">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldDouble&quot;, &quot;([C)D&quot;);</span>
<span class="fc" id="L867">                mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Double&quot;, &quot;valueOf&quot;, &quot;(D)Ljava/lang/Double;&quot;);</span>

<span class="fc" id="L869">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L870">                Label valueNullEnd_ = new Label();</span>
<span class="fc" id="L871">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L872">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L873">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.VALUE_NULL);</span>
<span class="fc" id="L874">                mw.visitJumpInsn(IF_ICMPNE, valueNullEnd_);</span>
<span class="fc" id="L875">                mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L876">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc" id="L878">                mw.visitLabel(valueNullEnd_);</span>
<span class="fc bfc" id="L879" title="All 2 branches covered.">            } else if (fieldClass == String.class) {</span>
<span class="fc" id="L880">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L881">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L882">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L883">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldString&quot;, &quot;([C)Ljava/lang/String;&quot;);</span>
<span class="fc" id="L884">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L886" title="All 2 branches covered.">            } else if (fieldClass == java.util.Date.class) {</span>
<span class="fc" id="L887">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L888">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L889">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L890">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldDate&quot;, &quot;([C)Ljava/util/Date;&quot;);</span>
<span class="fc" id="L891">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L893" title="All 2 branches covered.">            } else if (fieldClass == java.util.UUID.class) {</span>
<span class="fc" id="L894">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L895">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L896">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L897">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldUUID&quot;, &quot;([C)Ljava/util/UUID;&quot;);</span>
<span class="fc" id="L898">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc bfc" id="L900" title="All 2 branches covered.">            } else if (fieldClass == BigDecimal.class) {</span>
<span class="fc" id="L901">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L902">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L903">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L904">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldDecimal&quot;, &quot;([C)Ljava/math/BigDecimal;&quot;);</span>
<span class="fc" id="L905">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L906" title="All 2 branches covered.">            } else if (fieldClass == BigInteger.class) {</span>
<span class="fc" id="L907">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L908">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L909">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L910">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldBigInteger&quot;, &quot;([C)Ljava/math/BigInteger;&quot;);</span>
<span class="fc" id="L911">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L912" title="All 2 branches covered.">            } else if (fieldClass == int[].class) {</span>
<span class="fc" id="L913">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L914">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L915">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L916">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldIntArray&quot;, &quot;([C)[I&quot;);</span>
<span class="fc" id="L917">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L918" title="All 2 branches covered.">            } else if (fieldClass == float[].class) {</span>
<span class="fc" id="L919">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L920">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L921">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L922">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldFloatArray&quot;, &quot;([C)[F&quot;);</span>
<span class="fc" id="L923">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">            } else if (fieldClass == float[][].class) {</span>
<span class="fc" id="L925">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L926">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L927">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L928">                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldFloatArray2&quot;, &quot;([C)[[F&quot;);</span>
<span class="fc" id="L929">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc bfc" id="L930" title="All 2 branches covered.">            } else if (fieldClass.isEnum()) {</span>
<span class="fc" id="L931">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L932">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L933">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L934">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L935">                _getFieldDeser(context, mw, fieldInfo);</span>
<span class="fc" id="L936">                mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;scanEnum&quot;</span>
<span class="fc" id="L937">                        , &quot;(L&quot; + JSONLexerBase + &quot;;[C&quot; + desc(ObjectDeserializer.class) + &quot;)Ljava/lang/Enum;&quot;);</span>
<span class="fc" id="L938">                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L939">                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

//            } else if (fieldClass.isEnum()) {
//                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));
//                mw.visitVarInsn(ALOAD, 0);
//                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);
//                Label enumNull_ = new Label();
//                mw.visitInsn(ACONST_NULL);
//                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast
//                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));
//
//                mw.visitVarInsn(ALOAD, 1);
//
//                mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getSymbolTable&quot;, &quot;()&quot; + desc(SymbolTable.class));
//
//                mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldSymbol&quot;,
//                        &quot;([C&quot; + desc(SymbolTable.class) + &quot;)Ljava/lang/String;&quot;);
//                mw.visitInsn(DUP);
//                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm_enumName&quot;));
//
//                mw.visitJumpInsn(IFNULL, enumNull_);
//
//                mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm_enumName&quot;));
//                mw.visitMethodInsn(INVOKEVIRTUAL, type(String.class), &quot;length&quot;, &quot;()I&quot;);
//                mw.visitJumpInsn(IFEQ, enumNull_);
//
//                mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm_enumName&quot;));
//                mw.visitMethodInsn(INVOKESTATIC, type(fieldClass), &quot;valueOf&quot;,
//                        &quot;(Ljava/lang/String;)&quot; + desc(fieldClass));
//                mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));
//                mw.visitLabel(enumNull_);
<span class="fc bfc" id="L970" title="All 2 branches covered.">            } else if (Collection.class.isAssignableFrom(fieldClass)) {</span>
<span class="fc" id="L971">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L972">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L973">                mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>

<span class="fc" id="L975">                Class&lt;?&gt; itemClass = TypeUtils.getCollectionItemClass(fieldType);</span>

<span class="fc bfc" id="L977" title="All 2 branches covered.">                if (itemClass == String.class) {</span>
<span class="fc" id="L978">                    mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldClass))); // cast</span>
<span class="fc" id="L979">                    mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;scanFieldStringArray&quot;,</span>
<span class="fc" id="L980">                                       &quot;([CLjava/lang/Class;)&quot; + desc(Collection.class));</span>
<span class="fc" id="L981">                    mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
                } else {
<span class="fc" id="L983">                    _deserialze_list_obj(context, mw, reset_, fieldInfo, fieldClass, itemClass, i);</span>

<span class="fc bfc" id="L985" title="All 2 branches covered.">                    if (i == fieldListSize - 1) {</span>
<span class="fc" id="L986">                        _deserialize_endCheck(context, mw, reset_);</span>
                    }
                    continue;
                }
<span class="fc" id="L990">            } else {</span>
<span class="fc" id="L991">                _deserialze_obj(context, mw, reset_, fieldInfo, fieldClass, i);</span>

<span class="fc bfc" id="L993" title="All 2 branches covered.">                if (i == fieldListSize - 1) {</span>
<span class="fc" id="L994">                    _deserialize_endCheck(context, mw, reset_);</span>
                }

                continue;
            }

<span class="fc" id="L1000">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1001">            mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L1002">            Label flag_ = new Label();</span>
            // mw.visitInsn(DUP);
<span class="fc" id="L1004">            mw.visitJumpInsn(IFLE, flag_);</span>
<span class="fc" id="L1005">            _setFlag(mw, context, i);</span>
<span class="fc" id="L1006">            mw.visitLabel(flag_);</span>

<span class="fc" id="L1008">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1009">            mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L1010">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1011">            mw.visitVarInsn(ISTORE, context.var(&quot;matchStat&quot;));</span>

<span class="fc" id="L1013">            mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.NOT_MATCH);</span>
<span class="fc" id="L1014">            mw.visitJumpInsn(IF_ICMPEQ, reset_);</span>

<span class="fc" id="L1016">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1017">            mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L1018">            mw.visitJumpInsn(IFLE, notMatch_);</span>

            // increment matchedCount
<span class="fc" id="L1021">            mw.visitVarInsn(ILOAD, context.var(&quot;matchedCount&quot;));</span>
<span class="fc" id="L1022">            mw.visitInsn(ICONST_1);</span>
<span class="fc" id="L1023">            mw.visitInsn(IADD);</span>
<span class="fc" id="L1024">            mw.visitVarInsn(ISTORE, context.var(&quot;matchedCount&quot;));</span>

<span class="fc" id="L1026">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1027">            mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L1028">            mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.END);</span>
<span class="fc" id="L1029">            mw.visitJumpInsn(IF_ICMPEQ, end_);</span>

<span class="fc" id="L1031">            mw.visitLabel(notMatch_);</span>

<span class="fc bfc" id="L1033" title="All 2 branches covered.">            if (i == fieldListSize - 1) {</span>
<span class="fc" id="L1034">                mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1035">                mw.visitFieldInsn(GETFIELD, JSONLexerBase, &quot;matchStat&quot;, &quot;I&quot;);</span>
<span class="fc" id="L1036">                mw.visitLdcInsn(com.alibaba.fastjson.parser.JSONLexerBase.END);</span>
<span class="fc" id="L1037">                mw.visitJumpInsn(IF_ICMPNE, reset_);</span>
            }
        } // endFor

<span class="fc" id="L1041">        mw.visitLabel(end_);</span>

<span class="pc bpc" id="L1043" title="2 of 4 branches missed.">        if (!context.clazz.isInterface() &amp;&amp; !Modifier.isAbstract(context.clazz.getModifiers())) {</span>
<span class="fc" id="L1044">            _batchSet(context, mw);</span>
        }

<span class="fc" id="L1047">        mw.visitLabel(return_);</span>

<span class="fc" id="L1049">        _setContext(context, mw);</span>
<span class="fc" id="L1050">        mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>

<span class="fc" id="L1052">        Method buildMethod = context.beanInfo.buildMethod;</span>
<span class="fc bfc" id="L1053" title="All 2 branches covered.">        if (buildMethod != null) {</span>
<span class="fc" id="L1054">            mw.visitMethodInsn(INVOKEVIRTUAL, type(context.getInstClass()), buildMethod.getName(),</span>
<span class="fc" id="L1055">                               &quot;()&quot; + desc(buildMethod.getReturnType()));</span>
        }

<span class="fc" id="L1058">        mw.visitInsn(ARETURN);</span>

<span class="fc" id="L1060">        mw.visitLabel(reset_);</span>

<span class="fc" id="L1062">        _batchSet(context, mw);</span>
<span class="fc" id="L1063">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1064">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1065">        mw.visitVarInsn(ALOAD, 2);</span>
<span class="fc" id="L1066">        mw.visitVarInsn(ALOAD, 3);</span>
<span class="fc" id="L1067">        mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1068">        mw.visitVarInsn(ILOAD, 4);</span>


<span class="fc" id="L1071">        int flagSize = (fieldListSize / 32);</span>

<span class="pc bpc" id="L1073" title="1 of 4 branches missed.">        if (fieldListSize != 0 &amp;&amp; (fieldListSize % 32) != 0) {</span>
<span class="fc" id="L1074">            flagSize += 1;</span>
        }

<span class="fc bfc" id="L1077" title="All 2 branches covered.">        if (flagSize == 1) {</span>
<span class="fc" id="L1078">            mw.visitInsn(ICONST_1);</span>
        } else {
<span class="fc" id="L1080">            mw.visitIntInsn(BIPUSH, flagSize);</span>
        }
<span class="fc" id="L1082">        mw.visitIntInsn(NEWARRAY, T_INT);</span>
<span class="fc bfc" id="L1083" title="All 2 branches covered.">        for (int i = 0; i &lt; flagSize; ++i) {</span>
<span class="fc" id="L1084">            mw.visitInsn(DUP);</span>
<span class="fc bfc" id="L1085" title="All 2 branches covered.">            if (i == 0) {</span>
<span class="fc" id="L1086">                mw.visitInsn(ICONST_0);</span>
<span class="fc bfc" id="L1087" title="All 2 branches covered.">            } else if (i == 1) {</span>
<span class="fc" id="L1088">                mw.visitInsn(ICONST_1);</span>
            } else {
<span class="fc" id="L1090">                mw.visitIntInsn(BIPUSH, i);</span>
            }
<span class="fc" id="L1092">            mw.visitVarInsn(ILOAD, context.var(&quot;_asm_flag_&quot; + i));</span>
<span class="fc" id="L1093">            mw.visitInsn(IASTORE);</span>
        }

<span class="fc" id="L1096">        mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class),</span>
                           &quot;parseRest&quot;, &quot;(L&quot; + DefaultJSONParser
                                        + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;Ljava/lang/Object;I[I)Ljava/lang/Object;&quot;);
<span class="fc" id="L1099">        mw.visitTypeInsn(CHECKCAST, type(context.clazz)); // cast</span>
<span class="fc" id="L1100">        mw.visitInsn(ARETURN);</span>

<span class="fc" id="L1102">        mw.visitLabel(super_);</span>
<span class="fc" id="L1103">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1104">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1105">        mw.visitVarInsn(ALOAD, 2);</span>
<span class="fc" id="L1106">        mw.visitVarInsn(ALOAD, 3);</span>
<span class="fc" id="L1107">        mw.visitVarInsn(ILOAD, 4);</span>
<span class="fc" id="L1108">        mw.visitMethodInsn(INVOKESPECIAL, type(JavaBeanDeserializer.class), //</span>
                           &quot;deserialze&quot;, //
                           &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;I)Ljava/lang/Object;&quot;);
<span class="fc" id="L1111">        mw.visitInsn(ARETURN);</span>

<span class="fc" id="L1113">        mw.visitMaxs(10, context.variantIndex);</span>
<span class="fc" id="L1114">        mw.visitEnd();</span>

<span class="fc" id="L1116">    }</span>

    private void defineVarLexer(Context context, MethodVisitor mw) {
<span class="fc" id="L1119">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1120">        mw.visitFieldInsn(GETFIELD, DefaultJSONParser, &quot;lexer&quot;, desc(JSONLexer.class));</span>
<span class="fc" id="L1121">        mw.visitTypeInsn(CHECKCAST, JSONLexerBase); // cast</span>
<span class="fc" id="L1122">        mw.visitVarInsn(ASTORE, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1123">    }</span>

    private void _createInstance(Context context, MethodVisitor mw) {
<span class="fc" id="L1126">        JavaBeanInfo beanInfo = context.beanInfo;</span>
<span class="fc" id="L1127">        Constructor&lt;?&gt; defaultConstructor = beanInfo.defaultConstructor;</span>
<span class="fc bfc" id="L1128" title="All 2 branches covered.">        if (Modifier.isPublic(defaultConstructor.getModifiers())) {</span>
<span class="fc" id="L1129">            mw.visitTypeInsn(NEW, type(context.getInstClass()));</span>
<span class="fc" id="L1130">            mw.visitInsn(DUP);</span>

<span class="fc" id="L1132">            mw.visitMethodInsn(INVOKESPECIAL, type(defaultConstructor.getDeclaringClass()), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>

<span class="fc" id="L1134">            mw.visitVarInsn(ASTORE, context.var(&quot;instance&quot;));</span>
        } else {
<span class="fc" id="L1136">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1137">            mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1138">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1139">            mw.visitFieldInsn(GETFIELD, type(JavaBeanDeserializer.class), &quot;clazz&quot;, &quot;Ljava/lang/Class;&quot;);</span>
<span class="fc" id="L1140">            mw.visitMethodInsn(INVOKESPECIAL, type(JavaBeanDeserializer.class), &quot;createInstance&quot;,</span>
                               &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;)Ljava/lang/Object;&quot;);
<span class="fc" id="L1142">            mw.visitTypeInsn(CHECKCAST, type(context.getInstClass())); // cast</span>
<span class="fc" id="L1143">            mw.visitVarInsn(ASTORE, context.var(&quot;instance&quot;));</span>
        }
<span class="fc" id="L1145">    }</span>

    private void _batchSet(Context context, MethodVisitor mw) {
<span class="fc" id="L1148">        _batchSet(context, mw, true);</span>
<span class="fc" id="L1149">    }</span>

    private void _batchSet(Context context, MethodVisitor mw, boolean flag) {
<span class="fc bfc" id="L1152" title="All 2 branches covered.">        for (int i = 0, size = context.fieldInfoList.length; i &lt; size; ++i) {</span>
<span class="fc" id="L1153">            Label notSet_ = new Label();</span>

<span class="fc bfc" id="L1155" title="All 2 branches covered.">            if (flag) {</span>
<span class="fc" id="L1156">                _isFlag(mw, context, i, notSet_);</span>
            }

<span class="fc" id="L1159">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>
<span class="fc" id="L1160">            _loadAndSet(context, mw, fieldInfo);</span>

<span class="fc bfc" id="L1162" title="All 2 branches covered.">            if (flag) {</span>
<span class="fc" id="L1163">                mw.visitLabel(notSet_);</span>
            }
        }
<span class="fc" id="L1166">    }</span>

    private void _loadAndSet(Context context, MethodVisitor mw, FieldInfo fieldInfo) {
<span class="fc" id="L1169">        Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>
<span class="fc" id="L1170">        Type fieldType = fieldInfo.fieldType;</span>

<span class="fc bfc" id="L1172" title="All 2 branches covered.">        if (fieldClass == boolean.class) {</span>
<span class="fc" id="L1173">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1174">            mw.visitVarInsn(ILOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1175">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1176" title="All 8 branches covered.">        } else if (fieldClass == byte.class //</span>
                   || fieldClass == short.class //
                   || fieldClass == int.class //
                   || fieldClass == char.class) {
<span class="fc" id="L1180">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1181">            mw.visitVarInsn(ILOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1182">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1183" title="All 2 branches covered.">        } else if (fieldClass == long.class) {</span>
<span class="fc" id="L1184">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1185">            mw.visitVarInsn(LLOAD, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>
<span class="fc bfc" id="L1186" title="All 2 branches covered.">            if (fieldInfo.method != null) {</span>
<span class="fc" id="L1187">                mw.visitMethodInsn(INVOKEVIRTUAL, type(context.getInstClass()), fieldInfo.method.getName(),</span>
<span class="fc" id="L1188">                                   desc(fieldInfo.method));</span>
<span class="fc bfc" id="L1189" title="All 2 branches covered.">                if (!fieldInfo.method.getReturnType().equals(Void.TYPE)) {</span>
<span class="fc" id="L1190">                    mw.visitInsn(POP);</span>
                }
            } else {
<span class="fc" id="L1193">                mw.visitFieldInsn(PUTFIELD, type(fieldInfo.declaringClass), fieldInfo.field.getName(),</span>
<span class="fc" id="L1194">                                  desc(fieldInfo.fieldClass));</span>
            }
<span class="fc bfc" id="L1196" title="All 2 branches covered.">        } else if (fieldClass == float.class) {</span>
<span class="fc" id="L1197">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1198">            mw.visitVarInsn(FLOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1199">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1200" title="All 2 branches covered.">        } else if (fieldClass == double.class) {</span>
<span class="fc" id="L1201">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1202">            mw.visitVarInsn(DLOAD, context.var(fieldInfo.name + &quot;_asm&quot;, 2));</span>
<span class="fc" id="L1203">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1204" title="All 2 branches covered.">        } else if (fieldClass == String.class) {</span>
<span class="fc" id="L1205">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1206">            mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1207">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1208" title="All 2 branches covered.">        } else if (fieldClass.isEnum()) {</span>
<span class="fc" id="L1209">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1210">            mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1211">            _set(context, mw, fieldInfo);</span>
<span class="fc bfc" id="L1212" title="All 2 branches covered.">        } else if (Collection.class.isAssignableFrom(fieldClass)) {</span>
<span class="fc" id="L1213">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1214">            Type itemType = TypeUtils.getCollectionItemClass(fieldType);</span>
<span class="fc bfc" id="L1215" title="All 2 branches covered.">            if (itemType == String.class) {</span>
<span class="fc" id="L1216">                mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1217">                mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
            } else {
<span class="fc" id="L1219">                mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
            }
<span class="fc" id="L1221">            _set(context, mw, fieldInfo);</span>

<span class="fc" id="L1223">        } else {</span>
<span class="fc" id="L1224">            mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1225">            mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1226">            _set(context, mw, fieldInfo);</span>
        }
<span class="fc" id="L1228">    }</span>

    private void _set(Context context, MethodVisitor mw, FieldInfo fieldInfo) {
<span class="fc" id="L1231">        Method method = fieldInfo.method;</span>
<span class="fc bfc" id="L1232" title="All 2 branches covered.">        if (method != null) {</span>
<span class="fc" id="L1233">            Class&lt;?&gt; declaringClass = method.getDeclaringClass();</span>
<span class="pc bpc" id="L1234" title="1 of 2 branches missed.">            mw.visitMethodInsn(declaringClass.isInterface() ? INVOKEINTERFACE : INVOKEVIRTUAL, type(fieldInfo.declaringClass), method.getName(), desc(method));</span>

<span class="fc bfc" id="L1236" title="All 2 branches covered.">            if (!fieldInfo.method.getReturnType().equals(Void.TYPE)) {</span>
<span class="fc" id="L1237">                mw.visitInsn(POP);</span>
            }
<span class="fc" id="L1239">        } else {</span>
<span class="fc" id="L1240">            mw.visitFieldInsn(PUTFIELD, type(fieldInfo.declaringClass), fieldInfo.field.getName(),</span>
<span class="fc" id="L1241">                              desc(fieldInfo.fieldClass));</span>
        }
<span class="fc" id="L1243">    }</span>

    private void _setContext(Context context, MethodVisitor mw) {
<span class="fc" id="L1246">        mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L1247">        mw.visitVarInsn(ALOAD, context.var(&quot;context&quot;));</span>
<span class="fc" id="L1248">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;setContext&quot;, &quot;(&quot; + desc(ParseContext.class) + &quot;)V&quot;);</span>

<span class="fc" id="L1250">        Label endIf_ = new Label();</span>
<span class="fc" id="L1251">        mw.visitVarInsn(ALOAD, context.var(&quot;childContext&quot;));</span>
<span class="fc" id="L1252">        mw.visitJumpInsn(IFNULL, endIf_);</span>

<span class="fc" id="L1254">        mw.visitVarInsn(ALOAD, context.var(&quot;childContext&quot;));</span>
<span class="fc" id="L1255">        mw.visitVarInsn(ALOAD, context.var(&quot;instance&quot;));</span>
<span class="fc" id="L1256">        mw.visitFieldInsn(PUTFIELD, type(ParseContext.class), &quot;object&quot;, &quot;Ljava/lang/Object;&quot;);</span>

<span class="fc" id="L1258">        mw.visitLabel(endIf_);</span>
<span class="fc" id="L1259">    }</span>

    private void _deserialize_endCheck(Context context, MethodVisitor mw, Label reset_) {
<span class="fc" id="L1262">        mw.visitIntInsn(ILOAD, context.var(&quot;matchedCount&quot;));</span>
<span class="fc" id="L1263">        mw.visitJumpInsn(IFLE, reset_);</span>

<span class="fc" id="L1265">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1266">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1267">        mw.visitLdcInsn(JSONToken.RBRACE);</span>
<span class="fc" id="L1268">        mw.visitJumpInsn(IF_ICMPNE, reset_);</span>

        // mw.visitLabel(nextToken_);
<span class="fc" id="L1271">        _quickNextTokenComma(context, mw);</span>
<span class="fc" id="L1272">    }</span>

    private void _deserialze_list_obj(Context context, MethodVisitor mw, Label reset_, FieldInfo fieldInfo,
                                      Class&lt;?&gt; fieldClass, Class&lt;?&gt; itemType, int i) {
<span class="fc" id="L1276">        Label _end_if = new Label();</span>

<span class="fc" id="L1278">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;matchField&quot;, &quot;([C)Z&quot;);</span>
<span class="fc" id="L1279">        mw.visitJumpInsn(IFEQ, _end_if);</span>

<span class="fc" id="L1281">        _setFlag(mw, context, i);</span>

<span class="fc" id="L1283">        Label valueNotNull_ = new Label();</span>
<span class="fc" id="L1284">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1285">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1286">        mw.visitLdcInsn(JSONToken.NULL);</span>
<span class="fc" id="L1287">        mw.visitJumpInsn(IF_ICMPNE, valueNotNull_);</span>

<span class="fc" id="L1289">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1290">        mw.visitLdcInsn(JSONToken.COMMA);</span>
<span class="fc" id="L1291">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1292">        mw.visitJumpInsn(GOTO, _end_if);</span>
        // loop_end_

<span class="fc" id="L1295">        mw.visitLabel(valueNotNull_);</span>

<span class="fc" id="L1297">        Label storeCollection_ = new Label(), endSet_ = new Label(), lbacketNormal_ = new Label();</span>
<span class="fc" id="L1298">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1299">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1300">        mw.visitLdcInsn(JSONToken.SET);</span>
<span class="fc" id="L1301">        mw.visitJumpInsn(IF_ICMPNE, endSet_);</span>

<span class="fc" id="L1303">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1304">        mw.visitLdcInsn(JSONToken.LBRACKET);</span>
<span class="fc" id="L1305">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L1307">        _newCollection(mw, fieldClass, i, true);</span>

<span class="fc" id="L1309">        mw.visitJumpInsn(GOTO, storeCollection_);</span>

<span class="fc" id="L1311">        mw.visitLabel(endSet_);</span>

        // if (lexer.token() != JSONToken.LBRACKET) reset
<span class="fc" id="L1314">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1315">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1316">        mw.visitLdcInsn(JSONToken.LBRACKET);</span>
<span class="fc" id="L1317">        mw.visitJumpInsn(IF_ICMPEQ, lbacketNormal_);</span>

        // if (lexer.token() == JSONToken.LBRACE) reset
<span class="fc" id="L1320">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1321">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1322">        mw.visitLdcInsn(JSONToken.LBRACE);</span>
<span class="fc" id="L1323">        mw.visitJumpInsn(IF_ICMPNE, reset_);</span>

<span class="fc" id="L1325">        _newCollection(mw, fieldClass, i, false);</span>
<span class="fc" id="L1326">        mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc" id="L1328">        _getCollectionFieldItemDeser(context, mw, fieldInfo, itemType);</span>
<span class="fc" id="L1329">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1330">        mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(itemType)));</span>
<span class="fc" id="L1331">        mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L1332">        mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Integer&quot;, &quot;valueOf&quot;, &quot;(I)Ljava/lang/Integer;&quot;);</span>
<span class="fc" id="L1333">        mw.visitMethodInsn(INVOKEINTERFACE, type(ObjectDeserializer.class), &quot;deserialze&quot;,</span>
                &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;)Ljava/lang/Object;&quot;);
<span class="fc" id="L1335">        mw.visitVarInsn(ASTORE, context.var(&quot;list_item_value&quot;));</span>

<span class="fc" id="L1337">        mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1338">        mw.visitVarInsn(ALOAD, context.var(&quot;list_item_value&quot;));</span>
<span class="fc bfc" id="L1339" title="All 2 branches covered.">        if (fieldClass.isInterface()) {</span>
<span class="fc" id="L1340">            mw.visitMethodInsn(INVOKEINTERFACE, type(fieldClass), &quot;add&quot;, &quot;(Ljava/lang/Object;)Z&quot;);</span>
        } else {
<span class="fc" id="L1342">            mw.visitMethodInsn(INVOKEVIRTUAL, type(fieldClass), &quot;add&quot;, &quot;(Ljava/lang/Object;)Z&quot;);</span>
        }
<span class="fc" id="L1344">        mw.visitInsn(POP);</span>

<span class="fc" id="L1346">        mw.visitJumpInsn(GOTO, _end_if);</span>

<span class="fc" id="L1348">        mw.visitLabel(lbacketNormal_);</span>

<span class="fc" id="L1350">        _newCollection(mw, fieldClass, i, false);</span>

<span class="fc" id="L1352">        mw.visitLabel(storeCollection_);</span>
<span class="fc" id="L1353">        mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc" id="L1355">        boolean isPrimitive = ParserConfig.isPrimitive2(fieldInfo.fieldClass);</span>
<span class="fc" id="L1356">        _getCollectionFieldItemDeser(context, mw, fieldInfo, itemType);</span>
<span class="pc bpc" id="L1357" title="1 of 2 branches missed.">        if (isPrimitive) {</span>
<span class="nc" id="L1358">            mw.visitMethodInsn(INVOKEINTERFACE, type(ObjectDeserializer.class), &quot;getFastMatchToken&quot;, &quot;()I&quot;);</span>
<span class="nc" id="L1359">            mw.visitVarInsn(ISTORE, context.var(&quot;fastMatchToken&quot;));</span>

<span class="nc" id="L1361">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="nc" id="L1362">            mw.visitVarInsn(ILOAD, context.var(&quot;fastMatchToken&quot;));</span>
<span class="nc" id="L1363">            mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>
        } else {
<span class="fc" id="L1365">            mw.visitInsn(POP);</span>
<span class="fc" id="L1366">            mw.visitLdcInsn(JSONToken.LBRACE);</span>
<span class="fc" id="L1367">            mw.visitVarInsn(ISTORE, context.var(&quot;fastMatchToken&quot;));</span>

<span class="fc" id="L1369">            _quickNextToken(context, mw, JSONToken.LBRACE);</span>
        }

        { // setContext
<span class="fc" id="L1373">            mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1374">            mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getContext&quot;, &quot;()&quot; + desc(ParseContext.class));</span>
<span class="fc" id="L1375">            mw.visitVarInsn(ASTORE, context.var(&quot;listContext&quot;));</span>

<span class="fc" id="L1377">            mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L1378">            mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1379">            mw.visitLdcInsn(fieldInfo.name);</span>
<span class="fc" id="L1380">            mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;setContext&quot;,</span>
<span class="fc" id="L1381">                               &quot;(Ljava/lang/Object;Ljava/lang/Object;)&quot; + desc(ParseContext.class));</span>
<span class="fc" id="L1382">            mw.visitInsn(POP);</span>
        }

<span class="fc" id="L1385">        Label loop_ = new Label();</span>
<span class="fc" id="L1386">        Label loop_end_ = new Label();</span>

        // for (;;) {
<span class="fc" id="L1389">        mw.visitInsn(ICONST_0);</span>
<span class="fc" id="L1390">        mw.visitVarInsn(ISTORE, context.var(&quot;i&quot;));</span>
<span class="fc" id="L1391">        mw.visitLabel(loop_);</span>

<span class="fc" id="L1393">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1394">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1395">        mw.visitLdcInsn(JSONToken.RBRACKET);</span>

<span class="fc" id="L1397">        mw.visitJumpInsn(IF_ICMPEQ, loop_end_);</span>

        // Object value = itemDeserializer.deserialze(parser, null);
        // array.add(value);

<span class="fc" id="L1402">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1403">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_list_item_deser__&quot;,</span>
<span class="fc" id="L1404">                          desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1405">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1406">        mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(itemType)));</span>
<span class="fc" id="L1407">        mw.visitVarInsn(ILOAD, context.var(&quot;i&quot;));</span>
<span class="fc" id="L1408">        mw.visitMethodInsn(INVOKESTATIC, &quot;java/lang/Integer&quot;, &quot;valueOf&quot;, &quot;(I)Ljava/lang/Integer;&quot;);</span>
<span class="fc" id="L1409">        mw.visitMethodInsn(INVOKEINTERFACE, type(ObjectDeserializer.class), &quot;deserialze&quot;,</span>
                           &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;)Ljava/lang/Object;&quot;);
<span class="fc" id="L1411">        mw.visitVarInsn(ASTORE, context.var(&quot;list_item_value&quot;));</span>

<span class="fc" id="L1413">        mw.visitIincInsn(context.var(&quot;i&quot;), 1);</span>

<span class="fc" id="L1415">        mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1416">        mw.visitVarInsn(ALOAD, context.var(&quot;list_item_value&quot;));</span>
<span class="fc bfc" id="L1417" title="All 2 branches covered.">        if (fieldClass.isInterface()) {</span>
<span class="fc" id="L1418">            mw.visitMethodInsn(INVOKEINTERFACE, type(fieldClass), &quot;add&quot;, &quot;(Ljava/lang/Object;)Z&quot;);</span>
        } else {
<span class="fc" id="L1420">            mw.visitMethodInsn(INVOKEVIRTUAL, type(fieldClass), &quot;add&quot;, &quot;(Ljava/lang/Object;)Z&quot;);</span>
        }
<span class="fc" id="L1422">        mw.visitInsn(POP);</span>

<span class="fc" id="L1424">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1425">        mw.visitVarInsn(ALOAD, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
<span class="fc" id="L1426">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;checkListResolve&quot;, &quot;(Ljava/util/Collection;)V&quot;);</span>

<span class="fc" id="L1428">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1429">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1430">        mw.visitLdcInsn(JSONToken.COMMA);</span>
<span class="fc" id="L1431">        mw.visitJumpInsn(IF_ICMPNE, loop_);</span>

<span class="pc bpc" id="L1433" title="1 of 2 branches missed.">        if (isPrimitive) {</span>
<span class="nc" id="L1434">            mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="nc" id="L1435">            mw.visitVarInsn(ILOAD, context.var(&quot;fastMatchToken&quot;));</span>
<span class="nc" id="L1436">            mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>
        } else {
<span class="fc" id="L1438">            _quickNextToken(context, mw, JSONToken.LBRACE);</span>
        }
        
<span class="fc" id="L1441">        mw.visitJumpInsn(GOTO, loop_);</span>

<span class="fc" id="L1443">        mw.visitLabel(loop_end_);</span>

        // mw.visitVarInsn(ASTORE, context.var(&quot;context&quot;));
        // parser.setContext(context);
        { // setContext
<span class="fc" id="L1448">            mw.visitVarInsn(ALOAD, 1); // parser</span>
<span class="fc" id="L1449">            mw.visitVarInsn(ALOAD, context.var(&quot;listContext&quot;));</span>
<span class="fc" id="L1450">            mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;setContext&quot;, &quot;(&quot; + desc(ParseContext.class) + &quot;)V&quot;);</span>
        }

<span class="fc" id="L1453">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1454">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;token&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1455">        mw.visitLdcInsn(JSONToken.RBRACKET);</span>
<span class="fc" id="L1456">        mw.visitJumpInsn(IF_ICMPNE, reset_);</span>

<span class="fc" id="L1458">        _quickNextTokenComma(context, mw);</span>
        // lexer.nextToken(JSONToken.COMMA);

<span class="fc" id="L1461">        mw.visitLabel(_end_if);</span>
<span class="fc" id="L1462">    }</span>

    private void _quickNextToken(Context context, MethodVisitor mw, int token) {
<span class="fc" id="L1465">        Label quickElse_ = new Label(), quickEnd_ = new Label();</span>
<span class="fc" id="L1466">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1467">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="fc bfc" id="L1468" title="All 2 branches covered.">        if (token == JSONToken.LBRACE) {</span>
<span class="fc" id="L1469">            mw.visitVarInsn(BIPUSH, '{');</span>
<span class="pc bpc" id="L1470" title="1 of 2 branches missed.">        } else if (token == JSONToken.LBRACKET) {</span>
<span class="fc" id="L1471">            mw.visitVarInsn(BIPUSH, '[');</span>
        } else {
<span class="nc" id="L1473">            throw new IllegalStateException();</span>
        }

<span class="fc" id="L1476">        mw.visitJumpInsn(IF_ICMPNE, quickElse_);</span>

<span class="fc" id="L1478">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1479">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L1480">        mw.visitInsn(POP);</span>
<span class="fc" id="L1481">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1482">        mw.visitLdcInsn(token);</span>
<span class="fc" id="L1483">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1484">        mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L1486">        mw.visitLabel(quickElse_);</span>
<span class="fc" id="L1487">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1488">        mw.visitLdcInsn(token);</span>
<span class="fc" id="L1489">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L1491">        mw.visitLabel(quickEnd_);</span>
<span class="fc" id="L1492">    }</span>
    
    private void _quickNextTokenComma(Context context, MethodVisitor mw) {
<span class="fc" id="L1495">        Label quickElse_ = new Label(), quickElseIf0_ = new Label(), quickElseIf1_ = new Label(), quickElseIf2_ = new Label(), quickEnd_ = new Label();</span>
<span class="fc" id="L1496">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1497">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;getCurrent&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L1498">        mw.visitInsn(DUP);</span>
<span class="fc" id="L1499">        mw.visitVarInsn(ISTORE, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L1500">        mw.visitVarInsn(BIPUSH, ',');</span>
<span class="fc" id="L1501">        mw.visitJumpInsn(IF_ICMPNE, quickElseIf0_);</span>

<span class="fc" id="L1503">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1504">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L1505">        mw.visitInsn(POP);</span>
<span class="fc" id="L1506">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1507">        mw.visitLdcInsn(JSONToken.COMMA);</span>
<span class="fc" id="L1508">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1509">        mw.visitJumpInsn(GOTO, quickEnd_);</span>
        
<span class="fc" id="L1511">        mw.visitLabel(quickElseIf0_);</span>
<span class="fc" id="L1512">        mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L1513">        mw.visitVarInsn(BIPUSH, '}');</span>
<span class="fc" id="L1514">        mw.visitJumpInsn(IF_ICMPNE, quickElseIf1_);</span>

<span class="fc" id="L1516">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1517">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L1518">        mw.visitInsn(POP);</span>
<span class="fc" id="L1519">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1520">        mw.visitLdcInsn(JSONToken.RBRACE);</span>
<span class="fc" id="L1521">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1522">        mw.visitJumpInsn(GOTO, quickEnd_);</span>
        
<span class="fc" id="L1524">        mw.visitLabel(quickElseIf1_);</span>
<span class="fc" id="L1525">        mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L1526">        mw.visitVarInsn(BIPUSH, ']');</span>
<span class="fc" id="L1527">        mw.visitJumpInsn(IF_ICMPNE, quickElseIf2_);</span>

<span class="fc" id="L1529">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1530">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;next&quot;, &quot;()C&quot;);</span>
<span class="fc" id="L1531">        mw.visitInsn(POP);</span>
<span class="fc" id="L1532">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1533">        mw.visitLdcInsn(JSONToken.RBRACKET);</span>
<span class="fc" id="L1534">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1535">        mw.visitJumpInsn(GOTO, quickEnd_);</span>
        
<span class="fc" id="L1537">        mw.visitLabel(quickElseIf2_);</span>
<span class="fc" id="L1538">        mw.visitVarInsn(ILOAD, context.var(&quot;ch&quot;));</span>
<span class="fc" id="L1539">        mw.visitVarInsn(BIPUSH, JSONLexer.EOI);</span>
<span class="fc" id="L1540">        mw.visitJumpInsn(IF_ICMPNE, quickElse_);</span>

<span class="fc" id="L1542">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1543">        mw.visitLdcInsn(JSONToken.EOF);</span>
<span class="fc" id="L1544">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;setToken&quot;, &quot;(I)V&quot;);</span>
<span class="fc" id="L1545">        mw.visitJumpInsn(GOTO, quickEnd_);</span>

<span class="fc" id="L1547">        mw.visitLabel(quickElse_);</span>
<span class="fc" id="L1548">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1549">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;nextToken&quot;, &quot;()V&quot;);</span>

<span class="fc" id="L1551">        mw.visitLabel(quickEnd_);</span>
<span class="fc" id="L1552">    }</span>
    
    private void _getCollectionFieldItemDeser(Context context, MethodVisitor mw, FieldInfo fieldInfo,
                                              Class&lt;?&gt; itemType) {
<span class="fc" id="L1556">        Label notNull_ = new Label();</span>
<span class="fc" id="L1557">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1558">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_list_item_deser__&quot;,</span>
<span class="fc" id="L1559">                          desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1560">        mw.visitJumpInsn(IFNONNULL, notNull_);</span>

<span class="fc" id="L1562">        mw.visitVarInsn(ALOAD, 0);</span>

<span class="fc" id="L1564">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1565">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getConfig&quot;, &quot;()&quot; + desc(ParserConfig.class));</span>
<span class="fc" id="L1566">        mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(itemType)));</span>
<span class="fc" id="L1567">        mw.visitMethodInsn(INVOKEVIRTUAL, type(ParserConfig.class), &quot;getDeserializer&quot;,</span>
<span class="fc" id="L1568">                           &quot;(Ljava/lang/reflect/Type;)&quot; + desc(ObjectDeserializer.class));</span>

<span class="fc" id="L1570">        mw.visitFieldInsn(PUTFIELD, context.className, fieldInfo.name + &quot;_asm_list_item_deser__&quot;,</span>
<span class="fc" id="L1571">                          desc(ObjectDeserializer.class));</span>

<span class="fc" id="L1573">        mw.visitLabel(notNull_);</span>
<span class="fc" id="L1574">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1575">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_list_item_deser__&quot;,</span>
<span class="fc" id="L1576">                          desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1577">    }</span>

    private void _newCollection(MethodVisitor mw, Class&lt;?&gt; fieldClass, int i, boolean set) {
<span class="fc bfc" id="L1580" title="All 4 branches covered.">        if (fieldClass.isAssignableFrom(ArrayList.class) &amp;&amp; !set) {</span>
<span class="fc" id="L1581">            mw.visitTypeInsn(NEW, &quot;java/util/ArrayList&quot;);</span>
<span class="fc" id="L1582">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1583">            mw.visitMethodInsn(INVOKESPECIAL, &quot;java/util/ArrayList&quot;, &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc bfc" id="L1584" title="All 4 branches covered.">        } else if (fieldClass.isAssignableFrom(LinkedList.class) &amp;&amp; !set) {</span>
<span class="fc" id="L1585">            mw.visitTypeInsn(NEW, type(LinkedList.class));</span>
<span class="fc" id="L1586">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1587">            mw.visitMethodInsn(INVOKESPECIAL, type(LinkedList.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc bfc" id="L1588" title="All 2 branches covered.">        } else if (fieldClass.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L1589">            mw.visitTypeInsn(NEW, type(HashSet.class));</span>
<span class="fc" id="L1590">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1591">            mw.visitMethodInsn(INVOKESPECIAL, type(HashSet.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc bfc" id="L1592" title="All 2 branches covered.">        } else if (fieldClass.isAssignableFrom(TreeSet.class)) {</span>
<span class="fc" id="L1593">            mw.visitTypeInsn(NEW, type(TreeSet.class));</span>
<span class="fc" id="L1594">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1595">            mw.visitMethodInsn(INVOKESPECIAL, type(TreeSet.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc bfc" id="L1596" title="All 2 branches covered.">        } else if (fieldClass.isAssignableFrom(LinkedHashSet.class)) {</span>
<span class="fc" id="L1597">            mw.visitTypeInsn(NEW, type(LinkedHashSet.class));</span>
<span class="fc" id="L1598">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1599">            mw.visitMethodInsn(INVOKESPECIAL, type(LinkedHashSet.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
<span class="fc bfc" id="L1600" title="All 2 branches covered.">        } else if (set) {</span>
<span class="fc" id="L1601">            mw.visitTypeInsn(NEW, type(HashSet.class));</span>
<span class="fc" id="L1602">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1603">            mw.visitMethodInsn(INVOKESPECIAL, type(HashSet.class), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>
        } else {
<span class="fc" id="L1605">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1606">            mw.visitLdcInsn(i);</span>
<span class="fc" id="L1607">            mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;getFieldType&quot;,</span>
                               &quot;(I)Ljava/lang/reflect/Type;&quot;);
<span class="fc" id="L1609">            mw.visitMethodInsn(INVOKESTATIC, type(TypeUtils.class), &quot;createCollection&quot;,</span>
                               &quot;(Ljava/lang/reflect/Type;)Ljava/util/Collection;&quot;);
        }
<span class="fc" id="L1612">        mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L1613">    }</span>

    private void _deserialze_obj(Context context, MethodVisitor mw, Label reset_, FieldInfo fieldInfo,
                                 Class&lt;?&gt; fieldClass, int i) {
<span class="fc" id="L1617">        Label matched_ = new Label();</span>
<span class="fc" id="L1618">        Label _end_if = new Label();</span>

<span class="fc" id="L1620">        mw.visitVarInsn(ALOAD, context.var(&quot;lexer&quot;));</span>
<span class="fc" id="L1621">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1622">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L1623">        mw.visitMethodInsn(INVOKEVIRTUAL, JSONLexerBase, &quot;matchField&quot;, &quot;([C)Z&quot;);</span>
<span class="fc" id="L1624">        mw.visitJumpInsn(IFNE, matched_);</span>
<span class="fc" id="L1625">        mw.visitInsn(ACONST_NULL);</span>
<span class="fc" id="L1626">        mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>

<span class="fc" id="L1628">        mw.visitJumpInsn(GOTO, _end_if);</span>

<span class="fc" id="L1630">        mw.visitLabel(matched_);</span>

<span class="fc" id="L1632">        _setFlag(mw, context, i);</span>

        // increment matchedCount
<span class="fc" id="L1635">        mw.visitVarInsn(ILOAD, context.var(&quot;matchedCount&quot;));</span>
<span class="fc" id="L1636">        mw.visitInsn(ICONST_1);</span>
<span class="fc" id="L1637">        mw.visitInsn(IADD);</span>
<span class="fc" id="L1638">        mw.visitVarInsn(ISTORE, context.var(&quot;matchedCount&quot;));</span>

<span class="fc" id="L1640">        _deserObject(context, mw, fieldInfo, fieldClass, i);</span>

<span class="fc" id="L1642">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1643">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getResolveStatus&quot;, &quot;()I&quot;);</span>
<span class="fc" id="L1644">        mw.visitLdcInsn(com.alibaba.fastjson.parser.DefaultJSONParser.NeedToResolve);</span>
<span class="fc" id="L1645">        mw.visitJumpInsn(IF_ICMPNE, _end_if);</span>

<span class="fc" id="L1647">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1648">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getLastResolveTask&quot;, &quot;()&quot; + desc(ResolveTask.class));</span>
<span class="fc" id="L1649">        mw.visitVarInsn(ASTORE, context.var(&quot;resolveTask&quot;));</span>

<span class="fc" id="L1651">        mw.visitVarInsn(ALOAD, context.var(&quot;resolveTask&quot;));</span>
<span class="fc" id="L1652">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1653">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getContext&quot;, &quot;()&quot; + desc(ParseContext.class));</span>
<span class="fc" id="L1654">        mw.visitFieldInsn(PUTFIELD, type(ResolveTask.class), &quot;ownerContext&quot;, desc(ParseContext.class));</span>

<span class="fc" id="L1656">        mw.visitVarInsn(ALOAD, context.var(&quot;resolveTask&quot;));</span>
<span class="fc" id="L1657">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1658">        mw.visitLdcInsn(fieldInfo.name);</span>
<span class="fc" id="L1659">        mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;getFieldDeserializer&quot;,</span>
<span class="fc" id="L1660">                           &quot;(Ljava/lang/String;)&quot; + desc(FieldDeserializer.class));</span>
<span class="fc" id="L1661">        mw.visitFieldInsn(PUTFIELD, type(ResolveTask.class), &quot;fieldDeserializer&quot;, desc(FieldDeserializer.class));</span>

<span class="fc" id="L1663">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1664">        mw.visitLdcInsn(com.alibaba.fastjson.parser.DefaultJSONParser.NONE);</span>
<span class="fc" id="L1665">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;setResolveStatus&quot;, &quot;(I)V&quot;);</span>

<span class="fc" id="L1667">        mw.visitLabel(_end_if);</span>

<span class="fc" id="L1669">    }</span>

    private void _deserObject(Context context, MethodVisitor mw, FieldInfo fieldInfo, Class&lt;?&gt; fieldClass, int i) {
<span class="fc" id="L1672">        _getFieldDeser(context, mw, fieldInfo);</span>

<span class="fc" id="L1674">        Label instanceOfElse_ = new Label(), instanceOfEnd_ = new Label();</span>
<span class="fc bfc" id="L1675" title="All 2 branches covered.">        if ((fieldInfo.parserFeatures &amp; Feature.SupportArrayToBean.mask) != 0) {</span>
<span class="fc" id="L1676">            mw.visitInsn(DUP);</span>
<span class="fc" id="L1677">            mw.visitTypeInsn(INSTANCEOF, type(JavaBeanDeserializer.class));</span>
<span class="fc" id="L1678">            mw.visitJumpInsn(IFEQ, instanceOfElse_);</span>
            
<span class="fc" id="L1680">            mw.visitTypeInsn(CHECKCAST, type(JavaBeanDeserializer.class)); // cast</span>
<span class="fc" id="L1681">            mw.visitVarInsn(ALOAD, 1);</span>
<span class="pc bpc" id="L1682" title="1 of 2 branches missed.">            if (fieldInfo.fieldType instanceof Class) {</span>
<span class="fc" id="L1683">                mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldInfo.fieldClass)));</span>
            } else {
<span class="nc" id="L1685">                mw.visitVarInsn(ALOAD, 0);</span>
<span class="nc" id="L1686">                mw.visitLdcInsn(i);</span>
<span class="nc" id="L1687">                mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;getFieldType&quot;,</span>
                                   &quot;(I)Ljava/lang/reflect/Type;&quot;);
            }
<span class="fc" id="L1690">            mw.visitLdcInsn(fieldInfo.name);</span>
<span class="fc" id="L1691">            mw.visitLdcInsn(fieldInfo.parserFeatures);</span>
<span class="fc" id="L1692">            mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;deserialze&quot;,</span>
                               &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;I)Ljava/lang/Object;&quot;);
<span class="fc" id="L1694">            mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L1695">            mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
            
<span class="fc" id="L1697">            mw.visitJumpInsn(GOTO, instanceOfEnd_);</span>
            
<span class="fc" id="L1699">            mw.visitLabel(instanceOfElse_);</span>
        }

<span class="fc" id="L1702">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc bfc" id="L1703" title="All 2 branches covered.">        if (fieldInfo.fieldType instanceof Class) {</span>
<span class="fc" id="L1704">            mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldInfo.fieldClass)));</span>
        } else {
<span class="fc" id="L1706">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1707">            mw.visitLdcInsn(i);</span>
<span class="fc" id="L1708">            mw.visitMethodInsn(INVOKEVIRTUAL, type(JavaBeanDeserializer.class), &quot;getFieldType&quot;,</span>
                               &quot;(I)Ljava/lang/reflect/Type;&quot;);
        }
<span class="fc" id="L1711">        mw.visitLdcInsn(fieldInfo.name);</span>
<span class="fc" id="L1712">        mw.visitMethodInsn(INVOKEINTERFACE, type(ObjectDeserializer.class), &quot;deserialze&quot;,</span>
                           &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;Ljava/lang/Object;)Ljava/lang/Object;&quot;);
<span class="fc" id="L1714">        mw.visitTypeInsn(CHECKCAST, type(fieldClass)); // cast</span>
<span class="fc" id="L1715">        mw.visitVarInsn(ASTORE, context.var(fieldInfo.name + &quot;_asm&quot;));</span>
        
<span class="fc" id="L1717">        mw.visitLabel(instanceOfEnd_);</span>
<span class="fc" id="L1718">    }</span>

    private void _getFieldDeser(Context context, MethodVisitor mw, FieldInfo fieldInfo) {
<span class="fc" id="L1721">        Label notNull_ = new Label();</span>
<span class="fc" id="L1722">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1723">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_deser__&quot;, desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1724">        mw.visitJumpInsn(IFNONNULL, notNull_);</span>

<span class="fc" id="L1726">        mw.visitVarInsn(ALOAD, 0);</span>

<span class="fc" id="L1728">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1729">        mw.visitMethodInsn(INVOKEVIRTUAL, DefaultJSONParser, &quot;getConfig&quot;, &quot;()&quot; + desc(ParserConfig.class));</span>
<span class="fc" id="L1730">        mw.visitLdcInsn(com.alibaba.fastjson.asm.Type.getType(desc(fieldInfo.fieldClass)));</span>
<span class="fc" id="L1731">        mw.visitMethodInsn(INVOKEVIRTUAL, type(ParserConfig.class), &quot;getDeserializer&quot;,</span>
<span class="fc" id="L1732">                           &quot;(Ljava/lang/reflect/Type;)&quot; + desc(ObjectDeserializer.class));</span>

<span class="fc" id="L1734">        mw.visitFieldInsn(PUTFIELD, context.className, fieldInfo.name + &quot;_asm_deser__&quot;, desc(ObjectDeserializer.class));</span>

<span class="fc" id="L1736">        mw.visitLabel(notNull_);</span>

<span class="fc" id="L1738">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1739">        mw.visitFieldInsn(GETFIELD, context.className, fieldInfo.name + &quot;_asm_deser__&quot;, desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1740">    }</span>

    static class Context {

        static final int                   parser       = 1;
        static final int                   type         = 2;
        static final int                   fieldName    = 3;

<span class="fc" id="L1748">        private int                        variantIndex = -1;</span>
<span class="fc" id="L1749">        private final Map&lt;String, Integer&gt; variants     = new HashMap&lt;String, Integer&gt;();</span>

        private final Class&lt;?&gt;             clazz;
        private final JavaBeanInfo         beanInfo;
        private final String               className;
        private FieldInfo[]                fieldInfoList;

<span class="fc" id="L1756">        public Context(String className, ParserConfig config, JavaBeanInfo beanInfo, int initVariantIndex){</span>
<span class="fc" id="L1757">            this.className = className;</span>
<span class="fc" id="L1758">            this.clazz = beanInfo.clazz;</span>
<span class="fc" id="L1759">            this.variantIndex = initVariantIndex;</span>
<span class="fc" id="L1760">            this.beanInfo = beanInfo;</span>
<span class="fc" id="L1761">            fieldInfoList = beanInfo.fields;</span>
<span class="fc" id="L1762">        }</span>

        public Class&lt;?&gt; getInstClass() {
<span class="fc" id="L1765">            Class&lt;?&gt; instClass = beanInfo.builderClass;</span>
<span class="fc bfc" id="L1766" title="All 2 branches covered.">            if (instClass == null) {</span>
<span class="fc" id="L1767">                instClass = clazz;</span>
            }

<span class="fc" id="L1770">            return instClass;</span>
        }

        public int var(String name, int increment) {
<span class="fc" id="L1774">            Integer i = variants.get(name);</span>
<span class="fc bfc" id="L1775" title="All 2 branches covered.">            if (i == null) {</span>
<span class="fc" id="L1776">                variants.put(name, variantIndex);</span>
<span class="fc" id="L1777">                variantIndex += increment;</span>
            }
<span class="fc" id="L1779">            i = variants.get(name);</span>
<span class="fc" id="L1780">            return i.intValue();</span>
        }

        public int var(String name) {
<span class="fc" id="L1784">            Integer i = variants.get(name);</span>
<span class="fc bfc" id="L1785" title="All 2 branches covered.">            if (i == null) {</span>
<span class="fc" id="L1786">                variants.put(name, variantIndex++);</span>
            }
<span class="fc" id="L1788">            i = variants.get(name);</span>
<span class="fc" id="L1789">            return i.intValue();</span>
        }
    }

    private void _init(ClassWriter cw, Context context) {
<span class="fc bfc" id="L1794" title="All 2 branches covered.">        for (int i = 0, size = context.fieldInfoList.length; i &lt; size; ++i) {</span>
<span class="fc" id="L1795">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>

<span class="fc" id="L1797">            FieldWriter fw = new FieldWriter(cw, ACC_PUBLIC, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>
<span class="fc" id="L1798">            fw.visitEnd();</span>
        }

<span class="fc bfc" id="L1801" title="All 2 branches covered.">        for (int i = 0, size = context.fieldInfoList.length; i &lt; size; ++i) {</span>
<span class="fc" id="L1802">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>
<span class="fc" id="L1803">            Class&lt;?&gt; fieldClass = fieldInfo.fieldClass;</span>

<span class="fc bfc" id="L1805" title="All 2 branches covered.">            if (fieldClass.isPrimitive()) {</span>
<span class="fc" id="L1806">                continue;</span>
            }

<span class="fc bfc" id="L1809" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(fieldClass)) {</span>
<span class="fc" id="L1810">                FieldWriter fw = new FieldWriter(cw, ACC_PUBLIC, fieldInfo.name + &quot;_asm_list_item_deser__&quot;,</span>
<span class="fc" id="L1811">                                                 desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1812">                fw.visitEnd();</span>
<span class="fc" id="L1813">            } else {</span>
<span class="fc" id="L1814">                FieldWriter fw = new FieldWriter(cw, ACC_PUBLIC, fieldInfo.name + &quot;_asm_deser__&quot;,</span>
<span class="fc" id="L1815">                                                 desc(ObjectDeserializer.class));</span>
<span class="fc" id="L1816">                fw.visitEnd();</span>
            }
        }

<span class="fc" id="L1820">        MethodVisitor mw = new MethodWriter(cw, ACC_PUBLIC, &quot;&lt;init&gt;&quot;,</span>
<span class="fc" id="L1821">                                            &quot;(&quot; + desc(ParserConfig.class) + desc(JavaBeanInfo.class) + &quot;)V&quot;, null, null);</span>
<span class="fc" id="L1822">        mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1823">        mw.visitVarInsn(ALOAD, 1);</span>
<span class="fc" id="L1824">        mw.visitVarInsn(ALOAD, 2);</span>
<span class="fc" id="L1825">        mw.visitMethodInsn(INVOKESPECIAL, type(JavaBeanDeserializer.class), &quot;&lt;init&gt;&quot;,</span>
<span class="fc" id="L1826">                           &quot;(&quot; + desc(ParserConfig.class) + desc(JavaBeanInfo.class) + &quot;)V&quot;);</span>

        // init fieldNamePrefix
<span class="fc bfc" id="L1829" title="All 2 branches covered.">        for (int i = 0, size = context.fieldInfoList.length; i &lt; size; ++i) {</span>
<span class="fc" id="L1830">            FieldInfo fieldInfo = context.fieldInfoList[i];</span>

<span class="fc" id="L1832">            mw.visitVarInsn(ALOAD, 0);</span>
<span class="fc" id="L1833">            mw.visitLdcInsn(&quot;\&quot;&quot; + fieldInfo.name + &quot;\&quot;:&quot;); // public char[] toCharArray()</span>
<span class="fc" id="L1834">            mw.visitMethodInsn(INVOKEVIRTUAL, &quot;java/lang/String&quot;, &quot;toCharArray&quot;, &quot;()[C&quot;);</span>
<span class="fc" id="L1835">            mw.visitFieldInsn(PUTFIELD, context.className, fieldInfo.name + &quot;_asm_prefix__&quot;, &quot;[C&quot;);</span>

        }

<span class="fc" id="L1839">        mw.visitInsn(RETURN);</span>
<span class="fc" id="L1840">        mw.visitMaxs(4, 4);</span>
<span class="fc" id="L1841">        mw.visitEnd();</span>
<span class="fc" id="L1842">    }</span>

    private void _createInstance(ClassWriter cw, Context context) {
<span class="fc" id="L1845">        Constructor&lt;?&gt; defaultConstructor = context.beanInfo.defaultConstructor;</span>
<span class="fc bfc" id="L1846" title="All 2 branches covered.">        if (!Modifier.isPublic(defaultConstructor.getModifiers())) {</span>
<span class="fc" id="L1847">            return;</span>
        }
        
<span class="fc" id="L1850">        MethodVisitor mw = new MethodWriter(cw, ACC_PUBLIC, &quot;createInstance&quot;,</span>
                                            &quot;(L&quot; + DefaultJSONParser + &quot;;Ljava/lang/reflect/Type;)Ljava/lang/Object;&quot;,
                                            null, null);

<span class="fc" id="L1854">        mw.visitTypeInsn(NEW, type(context.getInstClass()));</span>
<span class="fc" id="L1855">        mw.visitInsn(DUP);</span>
<span class="fc" id="L1856">        mw.visitMethodInsn(INVOKESPECIAL, type(context.getInstClass()), &quot;&lt;init&gt;&quot;, &quot;()V&quot;);</span>

<span class="fc" id="L1858">        mw.visitInsn(ARETURN);</span>
<span class="fc" id="L1859">        mw.visitMaxs(3, 3);</span>
<span class="fc" id="L1860">        mw.visitEnd();</span>
<span class="fc" id="L1861">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>