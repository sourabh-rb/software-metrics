<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONScanner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.parser</a> &gt; <span class="el_source">JSONScanner.java</span></div><h1>JSONScanner.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.parser;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.util.ASMUtils;
import com.alibaba.fastjson.util.IOUtils;

import java.math.BigDecimal;
import java.util.*;

//这个类，为了性能优化做了很多特别处理，一切都是为了性能！！！

/**
 * @author wenshao[szujobs@hotmail.com]
 */
public final class JSONScanner extends JSONLexerBase {

    private final String text;
    private final int    len;

    public JSONScanner(String input){
<span class="fc" id="L37">        this(input, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L38">    }</span>

    public JSONScanner(String input, int features){
<span class="fc" id="L41">        super(features);</span>

<span class="fc" id="L43">        text = input;</span>
<span class="fc" id="L44">        len = text.length();</span>
<span class="fc" id="L45">        bp = -1;</span>

<span class="fc" id="L47">        next();</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">        if (ch == 65279) { // utf-8 bom</span>
<span class="fc" id="L49">            next();</span>
        }
<span class="fc" id="L51">    }</span>

    public final char charAt(int index) {
<span class="fc bfc" id="L54" title="All 2 branches covered.">        if (index &gt;= len) {</span>
<span class="fc" id="L55">            return EOI;</span>
        }

<span class="fc" id="L58">        return text.charAt(index);</span>
    }

    public final char next() {
<span class="fc" id="L62">        int index = ++bp;</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">        return ch = (index &gt;= this.len ? //</span>
                EOI //
<span class="fc" id="L65">                : text.charAt(index));</span>
    }

    public JSONScanner(char[] input, int inputLength){
<span class="fc" id="L69">        this(input, inputLength, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L70">    }</span>

    public JSONScanner(char[] input, int inputLength, int features){
<span class="fc" id="L73">        this(new String(input, 0, inputLength), features);</span>
<span class="fc" id="L74">    }</span>

    protected final void copyTo(int offset, int count, char[] dest) {
<span class="fc" id="L77">        text.getChars(offset, offset + count, dest, 0);</span>
<span class="fc" id="L78">    }</span>

    static boolean charArrayCompare(String src, int offset, char[] dest) {
<span class="fc" id="L81">        final int destLen = dest.length;</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (destLen + offset &gt; src.length()) {</span>
<span class="fc" id="L83">            return false;</span>
        }

<span class="fc bfc" id="L86" title="All 2 branches covered.">        for (int i = 0; i &lt; destLen; ++i) {</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            if (dest[i] != src.charAt(offset + i)) {</span>
<span class="fc" id="L88">                return false;</span>
            }
        }

<span class="fc" id="L92">        return true;</span>
    }

    public final boolean charArrayCompare(char[] chars) {
<span class="fc" id="L96">        return charArrayCompare(text, bp, chars);</span>
    }

    public final int indexOf(char ch, int startIndex) {
<span class="fc" id="L100">        return text.indexOf(ch, startIndex);</span>
    }

    public final String addSymbol(int offset, int len, int hash, final SymbolTable symbolTable) {
<span class="fc" id="L104">        return symbolTable.addSymbol(text, offset, len, hash);</span>
    }

    public byte[] bytesValue() {
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (token == JSONToken.HEX) {</span>
<span class="fc" id="L109">            int start = np + 1, len = sp;</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">            if (len % 2 != 0) {</span>
<span class="nc" id="L111">                throw new JSONException(&quot;illegal state. &quot; + len);</span>
            }

<span class="fc" id="L114">            byte[] bytes = new byte[len / 2];</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">            for (int i = 0; i &lt; bytes.length; ++i) {</span>
<span class="fc" id="L116">                char c0 = text.charAt(start + i * 2);</span>
<span class="fc" id="L117">                char c1 = text.charAt(start + i * 2 + 1);</span>

<span class="fc bfc" id="L119" title="All 2 branches covered.">                int b0 = c0 - (c0 &lt;= 57 ? 48 : 55);</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">                int b1 = c1 - (c1 &lt;= 57 ? 48 : 55);</span>
<span class="fc" id="L121">                bytes[i] = (byte) ((b0 &lt;&lt; 4) | b1);</span>
            }

<span class="fc" id="L124">            return bytes;</span>
        }

<span class="fc bfc" id="L127" title="All 2 branches covered.">        if (!hasSpecial) {</span>
<span class="fc" id="L128">            return IOUtils.decodeBase64(text, np + 1, sp);</span>
        } else {
<span class="fc" id="L130">            String escapedText = new String(sbuf, 0, sp);</span>
<span class="fc" id="L131">            return IOUtils.decodeBase64(escapedText);</span>
        }
    }

    /**
     * The value of a literal token, recorded as a string. For integers, leading 0x and 'l' suffixes are suppressed.
     */
    public final String stringVal() {
<span class="fc bfc" id="L139" title="All 2 branches covered.">        if (!hasSpecial) {</span>
<span class="fc" id="L140">            return this.subString(np + 1, sp);</span>
        } else {
<span class="fc" id="L142">            return new String(sbuf, 0, sp);</span>
        }
    }

    public final String subString(int offset, int count) {
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">        if (ASMUtils.IS_ANDROID) {</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            if (count &lt; sbuf.length) {</span>
<span class="nc" id="L149">                text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L150">                return new String(sbuf, 0, count);</span>
            } else {
<span class="nc" id="L152">                char[] chars = new char[count];</span>
<span class="nc" id="L153">                text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L154">                return new String(chars);</span>
            }
        } else {
<span class="fc" id="L157">            return text.substring(offset, offset + count);</span>
        }
    }

    public final char[] sub_chars(int offset, int count) {
<span class="pc bpc" id="L162" title="3 of 4 branches missed.">        if (ASMUtils.IS_ANDROID &amp;&amp; count &lt; sbuf.length) {</span>
<span class="nc" id="L163">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L164">            return sbuf;</span>
        } else {
<span class="fc" id="L166">            char[] chars = new char[count];</span>
<span class="fc" id="L167">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="fc" id="L168">            return chars;</span>
        }
    }

    public final String numberString() {
<span class="fc" id="L173">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L175">        int sp = this.sp;</span>
<span class="fc bfc" id="L176" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L177">            sp--;</span>
        }

<span class="fc" id="L180">        return this.subString(np, sp);</span>
    }

    public final BigDecimal decimalValue() {
<span class="fc" id="L184">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L186">        int sp = this.sp;</span>
<span class="fc bfc" id="L187" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L188">            sp--;</span>
        }

<span class="fc" id="L191">        int offset = np, count = sp;</span>
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (count &lt; sbuf.length) {</span>
<span class="fc" id="L193">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="fc" id="L194">            return new BigDecimal(sbuf, 0, count);</span>
        } else {
<span class="nc" id="L196">            char[] chars = new char[count];</span>
<span class="nc" id="L197">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L198">            return new BigDecimal(chars);</span>
        }
    }

    public boolean scanISO8601DateIfMatch() {
<span class="fc" id="L203">        return scanISO8601DateIfMatch(true);</span>
    }

    public boolean scanISO8601DateIfMatch(boolean strict) {
<span class="fc" id="L207">        int rest = len - bp;</span>
<span class="fc" id="L208">        return scanISO8601DateIfMatch(strict, rest);</span>
    }

    private boolean scanISO8601DateIfMatch(boolean strict, int rest) {
<span class="fc bfc" id="L212" title="All 2 branches covered.">        if (rest &lt; 8) {</span>
<span class="fc" id="L213">            return false;</span>
        }

<span class="fc" id="L216">        char c0 = charAt(bp);</span>
<span class="fc" id="L217">        char c1 = charAt(bp + 1);</span>
<span class="fc" id="L218">        char c2 = charAt(bp + 2);</span>
<span class="fc" id="L219">        char c3 = charAt(bp + 3);</span>
<span class="fc" id="L220">        char c4 = charAt(bp + 4);</span>
<span class="fc" id="L221">        char c5 = charAt(bp + 5);</span>
<span class="fc" id="L222">        char c6 = charAt(bp + 6);</span>
<span class="fc" id="L223">        char c7 = charAt(bp + 7);</span>

<span class="fc bfc" id="L225" title="All 4 branches covered.">        if ((!strict) &amp;&amp; rest &gt; 13) {</span>
<span class="fc" id="L226">            char c_r0 = charAt(bp + rest - 1);</span>
<span class="fc" id="L227">            char c_r1 = charAt(bp + rest - 2);</span>
<span class="pc bpc" id="L228" title="7 of 16 branches missed.">            if (c0 == '/' &amp;&amp; c1 == 'D' &amp;&amp; c2 == 'a' &amp;&amp; c3 == 't' &amp;&amp; c4 == 'e' &amp;&amp; c5 == '(' &amp;&amp; c_r0 == '/'</span>
                    &amp;&amp; c_r1 == ')') {
<span class="fc" id="L230">                int plusIndex = -1;</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">                for (int i = 6; i &lt; rest; ++i) {</span>
<span class="fc" id="L232">                    char c = charAt(bp + i);</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">                    if (c == '+') {</span>
<span class="fc" id="L234">                        plusIndex = i;</span>
<span class="fc bfc" id="L235" title="All 4 branches covered.">                    } else if (c &lt; '0' || c &gt; '9') {</span>
<span class="fc" id="L236">                        break;</span>
                    }
                }
<span class="fc bfc" id="L239" title="All 2 branches covered.">                if (plusIndex == -1) {</span>
<span class="fc" id="L240">                    return false;</span>
                }
<span class="fc" id="L242">                int offset = bp + 6;</span>
<span class="fc" id="L243">                String numberText = this.subString(offset, bp + plusIndex - offset);</span>
<span class="fc" id="L244">                long millis = Long.parseLong(numberText);</span>

<span class="fc" id="L246">                calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L247">                calendar.setTimeInMillis(millis);</span>

<span class="fc" id="L249">                token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L250">                return true;</span>
            }
        }

        char c10;
<span class="fc bfc" id="L255" title="All 6 branches covered.">        if (rest == 8</span>
                || rest == 14
<span class="fc bfc" id="L257" title="All 6 branches covered.">                || (rest == 16 &amp;&amp; ((c10 = charAt(bp + 10)) == 'T' || c10 == ' '))</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">                || (rest == 17 &amp;&amp; charAt(bp + 6) != '-')) {</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">            if (strict) {</span>
<span class="fc" id="L260">                return false;</span>
            }

            char y0, y1, y2, y3, M0, M1, d0, d1;



<span class="fc" id="L267">            char c8 = charAt(bp + 8);</span>

<span class="fc bfc" id="L269" title="All 4 branches covered.">            final boolean c_47 = c4 == '-' &amp;&amp; c7 == '-';</span>
<span class="fc bfc" id="L270" title="All 4 branches covered.">            final boolean sperate16 = c_47 &amp;&amp; rest == 16;</span>
<span class="fc bfc" id="L271" title="All 4 branches covered.">            final boolean sperate17 = c_47 &amp;&amp; rest == 17;</span>
<span class="fc bfc" id="L272" title="All 4 branches covered.">            if (sperate17 || sperate16) {</span>
<span class="fc" id="L273">                y0 = c0;</span>
<span class="fc" id="L274">                y1 = c1;</span>
<span class="fc" id="L275">                y2 = c2;</span>
<span class="fc" id="L276">                y3 = c3;</span>
<span class="fc" id="L277">                M0 = c5;</span>
<span class="fc" id="L278">                M1 = c6;</span>
<span class="fc" id="L279">                d0 = c8;</span>
<span class="fc" id="L280">                d1 = charAt(bp + 9);</span>
<span class="pc bpc" id="L281" title="1 of 4 branches missed.">            } else if (c4 == '-' &amp;&amp; c6 == '-') {</span>
<span class="fc" id="L282">                y0 = c0;</span>
<span class="fc" id="L283">                y1 = c1;</span>
<span class="fc" id="L284">                y2 = c2;</span>
<span class="fc" id="L285">                y3 = c3;</span>
<span class="fc" id="L286">                M0 = '0';</span>
<span class="fc" id="L287">                M1 = c5;</span>
<span class="fc" id="L288">                d0 = '0';</span>
<span class="fc" id="L289">                d1 = c7;</span>
            } else {
<span class="fc" id="L291">                y0 = c0;</span>
<span class="fc" id="L292">                y1 = c1;</span>
<span class="fc" id="L293">                y2 = c2;</span>
<span class="fc" id="L294">                y3 = c3;</span>
<span class="fc" id="L295">                M0 = c4;</span>
<span class="fc" id="L296">                M1 = c5;</span>
<span class="fc" id="L297">                d0 = c6;</span>
<span class="fc" id="L298">                d1 = c7;</span>
            }


<span class="fc bfc" id="L302" title="All 2 branches covered.">            if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L303">                return false;</span>
            }

<span class="fc" id="L306">            setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

            int hour, minute, seconds, millis;
<span class="fc bfc" id="L309" title="All 2 branches covered.">            if (rest != 8) {</span>
<span class="fc" id="L310">                char c9 = charAt(bp + 9);</span>
<span class="fc" id="L311">                c10 = charAt(bp + 10);</span>
<span class="fc" id="L312">                char c11 = charAt(bp + 11);</span>
<span class="fc" id="L313">                char c12 = charAt(bp + 12);</span>
<span class="fc" id="L314">                char c13 = charAt(bp + 13);</span>

                char h0, h1, m0, m1, s0, s1;

<span class="pc bpc" id="L318" title="5 of 16 branches missed.">                if ((sperate17 &amp;&amp; c10 == 'T' &amp;&amp; c13 == ':' &amp;&amp; charAt(bp + 16) == 'Z')</span>
                        || (sperate16 &amp;&amp; (c10 == ' ' || c10 == 'T') &amp;&amp; c13 == ':')) {
<span class="fc" id="L320">                    h0 = c11;</span>
<span class="fc" id="L321">                    h1 = c12;</span>
<span class="fc" id="L322">                    m0 = charAt(bp + 14);</span>
<span class="fc" id="L323">                    m1 = charAt(bp + 15);</span>
<span class="fc" id="L324">                    s0 = '0';</span>
<span class="fc" id="L325">                    s1 = '0';</span>
                } else {
<span class="fc" id="L327">                    h0 = c8;</span>
<span class="fc" id="L328">                    h1 = c9;</span>
<span class="fc" id="L329">                    m0 = c10;</span>
<span class="fc" id="L330">                    m1 = c11;</span>
<span class="fc" id="L331">                    s0 = c12;</span>
<span class="fc" id="L332">                    s1 = c13;</span>
                }

<span class="fc bfc" id="L335" title="All 2 branches covered.">                if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L336">                    return false;</span>
                }

<span class="fc bfc" id="L339" title="All 4 branches covered.">                if (rest == 17 &amp;&amp; !sperate17) {</span>
<span class="fc" id="L340">                    char S0 = charAt(bp + 14);</span>
<span class="fc" id="L341">                    char S1 = charAt(bp + 15);</span>
<span class="fc" id="L342">                    char S2 = charAt(bp + 16);</span>
<span class="fc bfc" id="L343" title="All 4 branches covered.">                    if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L344">                        return false;</span>
                    }
<span class="fc bfc" id="L346" title="All 4 branches covered.">                    if (S1 &lt; '0' || S1 &gt; '9') {</span>
<span class="fc" id="L347">                        return false;</span>
                    }
<span class="fc bfc" id="L349" title="All 4 branches covered.">                    if (S2 &lt; '0' || S2 &gt; '9') {</span>
<span class="fc" id="L350">                        return false;</span>
                    }

<span class="fc" id="L353">                    millis = (S0 - '0') * 100 + (S1 - '0') * 10 + (S2 - '0');</span>
<span class="fc" id="L354">                } else {</span>
<span class="fc" id="L355">                    millis = 0;</span>
                }

<span class="fc" id="L358">                hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L359">                minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L360">                seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L361">            } else {</span>
<span class="fc" id="L362">                hour = 0;</span>
<span class="fc" id="L363">                minute = 0;</span>
<span class="fc" id="L364">                seconds = 0;</span>
<span class="fc" id="L365">                millis = 0;</span>
            }

<span class="fc" id="L368">            calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L369">            calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L370">            calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L371">            calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L373">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L374">            return true;</span>
        }

<span class="pc bpc" id="L377" title="1 of 2 branches missed.">        if (rest &lt; 9) {</span>
<span class="nc" id="L378">            return false;</span>
        }

<span class="fc" id="L381">        char c8 = charAt(bp + 8);</span>
<span class="fc" id="L382">        char c9 = charAt(bp + 9);</span>

<span class="fc" id="L384">        int date_len = 10;</span>
        char y0, y1, y2, y3, M0, M1, d0, d1;
<span class="fc bfc" id="L386" title="All 8 branches covered.">        if ((c4 == '-' &amp;&amp; c7 == '-') // cn</span>
                ||  (c4 == '/' &amp;&amp; c7 == '/') // tw yyyy/mm/dd
        ) {
<span class="fc" id="L389">            y0 = c0;</span>
<span class="fc" id="L390">            y1 = c1;</span>
<span class="fc" id="L391">            y2 = c2;</span>
<span class="fc" id="L392">            y3 = c3;</span>
<span class="fc" id="L393">            M0 = c5;</span>
<span class="fc" id="L394">            M1 = c6;</span>
<span class="fc" id="L395">            d0 = c8;</span>
<span class="fc" id="L396">            d1 = c9;</span>
<span class="fc bfc" id="L397" title="All 4 branches covered.">        } else if ((c4 == '-' &amp;&amp; c6 == '-') // cn yyyy-m-dd</span>
        ) {
<span class="fc" id="L399">            y0 = c0;</span>
<span class="fc" id="L400">            y1 = c1;</span>
<span class="fc" id="L401">            y2 = c2;</span>
<span class="fc" id="L402">            y3 = c3;</span>
<span class="fc" id="L403">            M0 = '0';</span>
<span class="fc" id="L404">            M1 = c5;</span>

<span class="fc bfc" id="L406" title="All 2 branches covered.">            if (c8 == ' ') {</span>
<span class="fc" id="L407">                d0 = '0';</span>
<span class="fc" id="L408">                d1 = c7;</span>
<span class="fc" id="L409">                date_len = 8;</span>
            } else {
<span class="fc" id="L411">                d0 = c7;</span>
<span class="fc" id="L412">                d1 = c8;</span>
<span class="fc" id="L413">                date_len = 9;</span>
            }
<span class="pc bpc" id="L415" title="2 of 8 branches missed.">        } else if ((c2 == '.' &amp;&amp; c5 == '.') // de dd.mm.yyyy</span>
                || (c2 == '-' &amp;&amp; c5 == '-') // in dd-mm-yyyy
        ) {
<span class="fc" id="L418">            d0 = c0;</span>
<span class="fc" id="L419">            d1 = c1;</span>
<span class="fc" id="L420">            M0 = c3;</span>
<span class="fc" id="L421">            M1 = c4;</span>
<span class="fc" id="L422">            y0 = c6;</span>
<span class="fc" id="L423">            y1 = c7;</span>
<span class="fc" id="L424">            y2 = c8;</span>
<span class="fc" id="L425">            y3 = c9;</span>
<span class="fc bfc" id="L426" title="All 2 branches covered.">        } else if (c8 == 'T') {</span>
<span class="fc" id="L427">            y0 = c0;</span>
<span class="fc" id="L428">            y1 = c1;</span>
<span class="fc" id="L429">            y2 = c2;</span>
<span class="fc" id="L430">            y3 = c3;</span>
<span class="fc" id="L431">            M0 = c4;</span>
<span class="fc" id="L432">            M1 = c5;</span>
<span class="fc" id="L433">            d0 = c6;</span>
<span class="fc" id="L434">            d1 = c7;</span>
<span class="fc" id="L435">            date_len = 8;</span>
        } else {
<span class="fc bfc" id="L437" title="All 4 branches covered.">            if (c4 == '年' || c4 == '년') {</span>
<span class="fc" id="L438">                y0 = c0;</span>
<span class="fc" id="L439">                y1 = c1;</span>
<span class="fc" id="L440">                y2 = c2;</span>
<span class="fc" id="L441">                y3 = c3;</span>

<span class="fc bfc" id="L443" title="All 4 branches covered.">                if (c7 == '月' || c7 == '월') {</span>
<span class="fc" id="L444">                    M0 = c5;</span>
<span class="fc" id="L445">                    M1 = c6;</span>
<span class="fc bfc" id="L446" title="All 4 branches covered.">                    if (c9 == '日' || c9 == '일') {</span>
<span class="fc" id="L447">                        d0 = '0';</span>
<span class="fc" id="L448">                        d1 = c8;</span>
<span class="pc bpc" id="L449" title="1 of 4 branches missed.">                    } else if (charAt(bp + 10) == '日' || charAt(bp + 10) == '일'){</span>
<span class="fc" id="L450">                        d0 = c8;</span>
<span class="fc" id="L451">                        d1 = c9;</span>
<span class="fc" id="L452">                        date_len = 11;</span>
                    } else {
<span class="nc" id="L454">                        return false;</span>
                    }
<span class="pc bpc" id="L456" title="1 of 4 branches missed.">                } else if (c6 == '月' || c6 == '월') {</span>
<span class="fc" id="L457">                    M0 = '0';</span>
<span class="fc" id="L458">                    M1 = c5;</span>
<span class="fc bfc" id="L459" title="All 4 branches covered.">                    if (c8 == '日' || c8 == '일') {</span>
<span class="fc" id="L460">                        d0 = '0';</span>
<span class="fc" id="L461">                        d1 = c7;</span>
<span class="pc bpc" id="L462" title="1 of 4 branches missed.">                    } else if (c9 == '日' || c9 == '일'){</span>
<span class="fc" id="L463">                        d0 = c7;</span>
<span class="fc" id="L464">                        d1 = c8;</span>
                    } else {
<span class="nc" id="L466">                        return false;</span>
                    }
                } else {
<span class="nc" id="L469">                    return false;</span>
                }
            } else {
<span class="fc" id="L472">                return false;</span>
            }
        }

<span class="fc bfc" id="L476" title="All 2 branches covered.">        if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L477">            return false;</span>
        }

<span class="fc" id="L480">        setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

<span class="fc" id="L482">        char t = charAt(bp + date_len);</span>
<span class="pc bpc" id="L483" title="2 of 8 branches missed.">        if (t == 'T' &amp;&amp; rest == 16 &amp;&amp; date_len == 8 &amp;&amp; charAt(bp + 15) == 'Z') {</span>
<span class="fc" id="L484">            char h0 = charAt(bp + date_len + 1);</span>
<span class="fc" id="L485">            char h1 = charAt(bp + date_len + 2);</span>
<span class="fc" id="L486">            char m0 = charAt(bp + date_len + 3);</span>
<span class="fc" id="L487">            char m1 = charAt(bp + date_len + 4);</span>
<span class="fc" id="L488">            char s0 = charAt(bp + date_len + 5);</span>
<span class="fc" id="L489">            char s1 = charAt(bp + date_len + 6);</span>

<span class="pc bpc" id="L491" title="1 of 2 branches missed.">            if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="nc" id="L492">                return false;</span>
            }

<span class="fc" id="L495">            setTime(h0, h1, m0, m1, s0, s1);</span>
<span class="fc" id="L496">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="pc bpc" id="L498" title="1 of 2 branches missed.">            if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L499">                String[] timeZoneIDs = TimeZone.getAvailableIDs(0);</span>
<span class="pc bpc" id="L500" title="1 of 2 branches missed.">                if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L501">                    TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L502">                    calendar.setTimeZone(timeZone);</span>
                }
            }

<span class="fc" id="L506">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L507">            return true;</span>
<span class="fc bfc" id="L508" title="All 6 branches covered.">        } else if (t == 'T' || (t == ' ' &amp;&amp; !strict)) {</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">            if (rest &lt; date_len + 9) { // &quot;0000-00-00T00:00:00&quot;.length()</span>
<span class="fc" id="L510">                return false;</span>
            }
<span class="pc bpc" id="L512" title="2 of 8 branches missed.">        } else if (t == '&quot;' || t == EOI || t == '日' || t == '일') {</span>
<span class="fc" id="L513">            calendar.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="fc" id="L514">            calendar.set(Calendar.MINUTE, 0);</span>
<span class="fc" id="L515">            calendar.set(Calendar.SECOND, 0);</span>
<span class="fc" id="L516">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="fc" id="L518">            ch = charAt(bp += date_len);</span>

<span class="fc" id="L520">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L521">            return true;</span>
<span class="pc bpc" id="L522" title="1 of 4 branches missed.">        } else if (t == '+' || t == '-') {</span>
<span class="fc bfc" id="L523" title="All 2 branches covered.">            if (len == date_len + 6) {</span>
<span class="pc bpc" id="L524" title="1 of 2 branches missed.">                if (charAt(bp + date_len + 3) != ':' //</span>
<span class="pc bpc" id="L525" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 4) != '0' //</span>
<span class="pc bpc" id="L526" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 5) != '0') {</span>
<span class="nc" id="L527">                    return false;</span>
                }

<span class="fc" id="L530">                setTime('0', '0', '0', '0', '0', '0');</span>
<span class="fc" id="L531">                calendar.set(Calendar.MILLISECOND, 0);</span>
<span class="fc" id="L532">                setTimeZone(t, charAt(bp + date_len + 1), charAt(bp + date_len + 2));</span>
<span class="fc" id="L533">                return true;</span>
            }
<span class="fc" id="L535">            return false;</span>
        } else {
<span class="fc" id="L537">            return false;</span>
        }

<span class="fc bfc" id="L540" title="All 2 branches covered.">        if (charAt(bp + date_len + 3) != ':') {</span>
<span class="fc" id="L541">            return false;</span>
        }
<span class="fc bfc" id="L543" title="All 2 branches covered.">        if (charAt(bp + date_len + 6) != ':') {</span>
<span class="fc" id="L544">            return false;</span>
        }

<span class="fc" id="L547">        char h0 = charAt(bp + date_len + 1);</span>
<span class="fc" id="L548">        char h1 = charAt(bp + date_len + 2);</span>
<span class="fc" id="L549">        char m0 = charAt(bp + date_len + 4);</span>
<span class="fc" id="L550">        char m1 = charAt(bp + date_len + 5);</span>
<span class="fc" id="L551">        char s0 = charAt(bp + date_len + 7);</span>
<span class="fc" id="L552">        char s1 = charAt(bp + date_len + 8);</span>

<span class="fc bfc" id="L554" title="All 2 branches covered.">        if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L555">            return false;</span>
        }

<span class="fc" id="L558">        setTime(h0, h1, m0, m1, s0, s1);</span>

<span class="fc" id="L560">        char dot = charAt(bp + date_len + 9);</span>
<span class="fc" id="L561">        int millisLen = -1; // 有可能没有毫秒区域，没有毫秒区域的时候下一个字符位置有可能是'Z'、'+'、'-'</span>
<span class="fc" id="L562">        int millis = 0;</span>
<span class="fc bfc" id="L563" title="All 2 branches covered.">        if (dot == '.') { // 0000-00-00T00:00:00.000</span>
<span class="fc bfc" id="L564" title="All 2 branches covered.">            if (rest &lt; date_len + 11) {</span>
<span class="fc" id="L565">                return false;</span>
            }

<span class="fc" id="L568">            char S0 = charAt(bp + date_len + 10);</span>
<span class="fc bfc" id="L569" title="All 4 branches covered.">            if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L570">                return false;</span>
            }
<span class="fc" id="L572">            millis = S0 - '0';</span>
<span class="fc" id="L573">            millisLen = 1;</span>

<span class="fc bfc" id="L575" title="All 2 branches covered.">            if (rest &gt; date_len + 11) {</span>
<span class="fc" id="L576">                char S1 = charAt(bp + date_len + 11);</span>
<span class="fc bfc" id="L577" title="All 4 branches covered.">                if (S1 &gt;= '0' &amp;&amp; S1 &lt;= '9') {</span>
<span class="fc" id="L578">                    millis = millis * 10 + (S1 - '0');</span>
<span class="fc" id="L579">                    millisLen = 2;</span>
                }
            }

<span class="fc bfc" id="L583" title="All 2 branches covered.">            if (millisLen == 2) {</span>
<span class="fc" id="L584">                char S2 = charAt(bp + date_len + 12);</span>
<span class="fc bfc" id="L585" title="All 4 branches covered.">                if (S2 &gt;= '0' &amp;&amp; S2 &lt;= '9') {</span>
<span class="fc" id="L586">                    millis = millis * 10 + (S2 - '0');</span>
<span class="fc" id="L587">                    millisLen = 3;</span>
                }
            }
        }
<span class="fc" id="L591">        calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L593">        int timzeZoneLength = 0;</span>
<span class="fc" id="L594">        char timeZoneFlag = charAt(bp + date_len + 10 + millisLen);</span>

<span class="fc bfc" id="L596" title="All 2 branches covered.">        if (timeZoneFlag == ' ') {</span>
<span class="fc" id="L597">            millisLen++;</span>
<span class="fc" id="L598">            timeZoneFlag = charAt(bp + date_len + 10 + millisLen);</span>
        }

<span class="fc bfc" id="L601" title="All 4 branches covered.">        if (timeZoneFlag == '+' || timeZoneFlag == '-') {</span>
<span class="fc" id="L602">            char t0 = charAt(bp + date_len + 10 + millisLen + 1);</span>
<span class="pc bpc" id="L603" title="2 of 4 branches missed.">            if (t0 &lt; '0' || t0 &gt; '1') {</span>
<span class="nc" id="L604">                return false;</span>
            }

<span class="fc" id="L607">            char t1 = charAt(bp + date_len + 10 + millisLen + 2);</span>
<span class="pc bpc" id="L608" title="2 of 4 branches missed.">            if (t1 &lt; '0' || t1 &gt; '9') {</span>
<span class="nc" id="L609">                return false;</span>
            }

<span class="fc" id="L612">            char t2 = charAt(bp + date_len + 10 + millisLen + 3);</span>
<span class="fc" id="L613">            char t3 = '0', t4 = '0';</span>
<span class="fc bfc" id="L614" title="All 2 branches covered.">            if (t2 == ':') { // ThreeLetterISO8601TimeZone</span>
<span class="fc" id="L615">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="fc bfc" id="L616" title="All 4 branches covered.">                if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="fc" id="L617">                    return false;</span>
                }

<span class="fc" id="L620">                t4 = charAt(bp + date_len + 10 + millisLen + 5);</span>
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">                if (t4 != '0') {</span>
<span class="nc" id="L622">                    return false;</span>
                }
<span class="fc" id="L624">                timzeZoneLength = 6;</span>
<span class="fc bfc" id="L625" title="All 2 branches covered.">            } else if (t2 == '0') { // TwoLetterISO8601TimeZone</span>
<span class="fc" id="L626">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="pc bpc" id="L627" title="3 of 4 branches missed.">                if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="nc" id="L628">                    return false;</span>
                }
<span class="fc" id="L630">                timzeZoneLength = 5;</span>
<span class="pc bpc" id="L631" title="1 of 4 branches missed.">            } else if (t2 == '3' &amp;&amp; charAt(bp + date_len + 10 + millisLen + 4) == '0') {</span>
<span class="fc" id="L632">                t3 = '3';</span>
<span class="fc" id="L633">                t4 = '0';</span>
<span class="fc" id="L634">                timzeZoneLength = 5;</span>
<span class="pc bpc" id="L635" title="1 of 4 branches missed.">            } else if (t2 == '4' &amp;&amp; charAt(bp + date_len + 10 + millisLen + 4) == '5') {</span>
<span class="fc" id="L636">                t3 = '4';</span>
<span class="fc" id="L637">                t4 = '5';</span>
<span class="fc" id="L638">                timzeZoneLength = 5;</span>
            } else {
<span class="fc" id="L640">                timzeZoneLength = 3;</span>
            }

<span class="fc" id="L643">            setTimeZone(timeZoneFlag, t0, t1, t3, t4);</span>

<span class="fc bfc" id="L645" title="All 2 branches covered.">        } else if (timeZoneFlag == 'Z') {// UTC</span>
<span class="fc" id="L646">            timzeZoneLength = 1;</span>
<span class="pc bpc" id="L647" title="1 of 2 branches missed.">            if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L648">                String[] timeZoneIDs = TimeZone.getAvailableIDs(0);</span>
<span class="pc bpc" id="L649" title="1 of 2 branches missed.">                if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L650">                    TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L651">                    calendar.setTimeZone(timeZone);</span>
                }
            }
        }

<span class="fc" id="L656">        char end = charAt(bp + (date_len + 10 + millisLen + timzeZoneLength));</span>
<span class="fc bfc" id="L657" title="All 4 branches covered.">        if (end != EOI &amp;&amp; end != '&quot;') {</span>
<span class="fc" id="L658">            return false;</span>
        }
<span class="fc" id="L660">        ch = charAt(bp += (date_len + 10 + millisLen + timzeZoneLength));</span>

<span class="fc" id="L662">        token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L663">        return true;</span>
    }

    protected void setTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc" id="L667">        int hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L668">        int minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L669">        int seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L670">        calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L671">        calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L672">        calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L673">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1) {
<span class="fc" id="L676">        setTimeZone(timeZoneFlag, t0, t1, '0', '0');</span>
<span class="fc" id="L677">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1, char t3, char t4) {
<span class="fc" id="L680">        int timeZoneOffset = ((t0 - '0') * 10 + (t1 - '0')) * 3600 * 1000;</span>

<span class="fc" id="L682">        timeZoneOffset += ((t3 - '0') * 10 + (t4 - '0')) * 60 * 1000;</span>

<span class="fc bfc" id="L684" title="All 2 branches covered.">        if (timeZoneFlag == '-') {</span>
<span class="fc" id="L685">            timeZoneOffset = -timeZoneOffset;</span>
        }

<span class="fc bfc" id="L688" title="All 2 branches covered.">        if (calendar.getTimeZone().getRawOffset() != timeZoneOffset) {</span>
<span class="fc" id="L689">            String[] timeZoneIDs = TimeZone.getAvailableIDs(timeZoneOffset);</span>
<span class="fc bfc" id="L690" title="All 2 branches covered.">            if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L691">                TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L692">                calendar.setTimeZone(timeZone);</span>
            }
        }
<span class="fc" id="L695">    }</span>

    private boolean checkTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc bfc" id="L698" title="All 2 branches covered.">        if (h0 == '0') {</span>
<span class="fc bfc" id="L699" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L700">                return false;</span>
            }
<span class="fc bfc" id="L702" title="All 2 branches covered.">        } else if (h0 == '1') {</span>
<span class="fc bfc" id="L703" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L704">                return false;</span>
            }
<span class="fc bfc" id="L706" title="All 2 branches covered.">        } else if (h0 == '2') {</span>
<span class="fc bfc" id="L707" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '4') {</span>
<span class="fc" id="L708">                return false;</span>
            }
        } else {
<span class="fc" id="L711">            return false;</span>
        }

<span class="fc bfc" id="L714" title="All 4 branches covered.">        if (m0 &gt;= '0' &amp;&amp; m0 &lt;= '5') {</span>
<span class="fc bfc" id="L715" title="All 4 branches covered.">            if (m1 &lt; '0' || m1 &gt; '9') {</span>
<span class="fc" id="L716">                return false;</span>
            }
<span class="fc bfc" id="L718" title="All 2 branches covered.">        } else if (m0 == '6') {</span>
<span class="fc bfc" id="L719" title="All 2 branches covered.">            if (m1 != '0') {</span>
<span class="fc" id="L720">                return false;</span>
            }
        } else {
<span class="fc" id="L723">            return false;</span>
        }

<span class="fc bfc" id="L726" title="All 4 branches covered.">        if (s0 &gt;= '0' &amp;&amp; s0 &lt;= '5') {</span>
<span class="fc bfc" id="L727" title="All 4 branches covered.">            if (s1 &lt; '0' || s1 &gt; '9') {</span>
<span class="fc" id="L728">                return false;</span>
            }
<span class="fc bfc" id="L730" title="All 2 branches covered.">        } else if (s0 == '6') {</span>
<span class="fc bfc" id="L731" title="All 2 branches covered.">            if (s1 != '0') {</span>
<span class="fc" id="L732">                return false;</span>
            }
        } else {
<span class="fc" id="L735">            return false;</span>
        }

<span class="fc" id="L738">        return true;</span>
    }

    private void setCalendar(char y0, char y1, char y2, char y3, char M0, char M1, char d0, char d1) {
<span class="fc" id="L742">        calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L743">        int year = (y0 - '0') * 1000 + (y1 - '0') * 100 + (y2 - '0') * 10 + (y3 - '0');</span>
<span class="fc" id="L744">        int month = (M0 - '0') * 10 + (M1 - '0') - 1;</span>
<span class="fc" id="L745">        int day = (d0 - '0') * 10 + (d1 - '0');</span>
//        calendar.set(year, month, day);
<span class="fc" id="L747">        calendar.set(Calendar.YEAR, year);</span>
<span class="fc" id="L748">        calendar.set(Calendar.MONTH, month);</span>
<span class="fc" id="L749">        calendar.set(Calendar.DAY_OF_MONTH, day);</span>
<span class="fc" id="L750">    }</span>

    static boolean checkDate(char y0, char y1, char y2, char y3, char M0, char M1, int d0, int d1) {
<span class="pc bpc" id="L753" title="1 of 4 branches missed.">        if (y0 &lt; '0' || y0 &gt; '9') {</span>
<span class="fc" id="L754">            return false;</span>
        }
<span class="fc bfc" id="L756" title="All 4 branches covered.">        if (y1 &lt; '0' || y1 &gt; '9') {</span>
<span class="fc" id="L757">            return false;</span>
        }
<span class="fc bfc" id="L759" title="All 4 branches covered.">        if (y2 &lt; '0' || y2 &gt; '9') {</span>
<span class="fc" id="L760">            return false;</span>
        }
<span class="fc bfc" id="L762" title="All 4 branches covered.">        if (y3 &lt; '0' || y3 &gt; '9') {</span>
<span class="fc" id="L763">            return false;</span>
        }

<span class="fc bfc" id="L766" title="All 2 branches covered.">        if (M0 == '0') {</span>
<span class="fc bfc" id="L767" title="All 4 branches covered.">            if (M1 &lt; '1' || M1 &gt; '9') {</span>
<span class="fc" id="L768">                return false;</span>
            }
<span class="fc bfc" id="L770" title="All 2 branches covered.">        } else if (M0 == '1') {</span>
<span class="fc bfc" id="L771" title="All 6 branches covered.">            if (M1 != '0' &amp;&amp; M1 != '1' &amp;&amp; M1 != '2') {</span>
<span class="fc" id="L772">                return false;</span>
            }
        } else {
<span class="fc" id="L775">            return false;</span>
        }

<span class="fc bfc" id="L778" title="All 2 branches covered.">        if (d0 == '0') {</span>
<span class="fc bfc" id="L779" title="All 4 branches covered.">            if (d1 &lt; '1' || d1 &gt; '9') {</span>
<span class="fc" id="L780">                return false;</span>
            }
<span class="fc bfc" id="L782" title="All 4 branches covered.">        } else if (d0 == '1' || d0 == '2') {</span>
<span class="fc bfc" id="L783" title="All 4 branches covered.">            if (d1 &lt; '0' || d1 &gt; '9') {</span>
<span class="fc" id="L784">                return false;</span>
            }
<span class="fc bfc" id="L786" title="All 2 branches covered.">        } else if (d0 == '3') {</span>
<span class="fc bfc" id="L787" title="All 4 branches covered.">            if (d1 != '0' &amp;&amp; d1 != '1') {</span>
<span class="fc" id="L788">                return false;</span>
            }
        } else {
<span class="fc" id="L791">            return false;</span>
        }

<span class="fc" id="L794">        return true;</span>
    }

    @Override
    public boolean isEOF() {
<span class="pc bpc" id="L799" title="1 of 6 branches missed.">        return bp == len || (ch == EOI &amp;&amp; bp + 1 &gt;= len);</span>
    }

    public int scanFieldInt(char[] fieldName) {
<span class="fc" id="L803">        matchStat = UNKNOWN;</span>
<span class="fc" id="L804">        int startPos = this.bp;</span>
<span class="fc" id="L805">        char startChar = this.ch;</span>

<span class="fc bfc" id="L807" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L808">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L809">            return 0;</span>
        }

<span class="fc" id="L812">        int index = bp + fieldName.length;</span>

<span class="fc" id="L814">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L816" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>

<span class="fc bfc" id="L818" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L819">            ch = charAt(index++);</span>
        }

<span class="fc bfc" id="L822" title="All 2 branches covered.">        final boolean negative = ch == '-';</span>
<span class="fc bfc" id="L823" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L824">            ch = charAt(index++);</span>
        }

        int value;
<span class="fc bfc" id="L828" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L829">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L831">                ch = charAt(index++);</span>
<span class="fc bfc" id="L832" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L833">                    int value_10 = value * 10;</span>
<span class="fc bfc" id="L834" title="All 2 branches covered.">                    if (value_10 &lt; value) {</span>
<span class="fc" id="L835">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L836">                        return 0;</span>
                    }

<span class="fc" id="L839">                    value = value_10 + (ch - '0');</span>
<span class="fc bfc" id="L840" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L841">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L842">                    return 0;</span>
                } else {
                    break;
                }
            }

<span class="fc bfc" id="L848" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L849">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L850">                return 0;</span>
            }

<span class="fc bfc" id="L853" title="All 2 branches covered.">            if (quote) {</span>
<span class="pc bpc" id="L854" title="1 of 2 branches missed.">                if (ch != '&quot;') {</span>
<span class="nc" id="L855">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L856">                    return 0;</span>
                } else {
<span class="fc" id="L858">                    ch = charAt(index++);</span>
                }
            }

            for (;;) {
<span class="fc bfc" id="L863" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L864">                    bp = index - 1;</span>
<span class="fc" id="L865">                    break;</span>
<span class="fc bfc" id="L866" title="All 2 branches covered.">                } else if(isWhitespace(ch)) {</span>
<span class="fc" id="L867">                    ch = charAt(index++);</span>
<span class="fc" id="L868">                    continue;</span>
                } else {
<span class="fc" id="L870">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L871">                    return 0;</span>
                }
            }
        } else {
<span class="fc" id="L875">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L876">            return 0;</span>
        }

<span class="fc bfc" id="L879" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L880">            this.ch = charAt(++bp);</span>
<span class="fc" id="L881">            matchStat = VALUE;</span>
<span class="fc" id="L882">            token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L883" title="1 of 2 branches missed.">            return negative ? -value : value;</span>
        }

<span class="pc bpc" id="L886" title="1 of 2 branches missed.">        if (ch == '}') {</span>
<span class="fc" id="L887">            bp = index - 1;</span>
<span class="fc" id="L888">            ch = charAt(++bp);</span>
            for (; ; ) {
<span class="fc bfc" id="L890" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L891">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L892">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L893">                    break;</span>
<span class="fc bfc" id="L894" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L895">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L896">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L897">                    break;</span>
<span class="fc bfc" id="L898" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L899">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L900">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L901">                    break;</span>
<span class="fc bfc" id="L902" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L903">                    token = JSONToken.EOF;</span>
<span class="fc" id="L904">                    break;</span>
<span class="fc bfc" id="L905" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L906">                    ch = charAt(++bp);</span>
<span class="fc" id="L907">                    continue;</span>
                } else {
<span class="fc" id="L909">                    this.bp = startPos;</span>
<span class="fc" id="L910">                    this.ch = startChar;</span>
<span class="fc" id="L911">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L912">                    return 0;</span>
                }
            }
<span class="fc" id="L915">            matchStat = END;</span>
        }

<span class="pc bpc" id="L918" title="1 of 2 branches missed.">        return negative ? -value : value;</span>
    }

    public String scanFieldString(char[] fieldName) {
<span class="fc" id="L922">        matchStat = UNKNOWN;</span>
<span class="fc" id="L923">        int startPos = this.bp;</span>
<span class="fc" id="L924">        char startChar = this.ch;</span>

        for (;;) {
<span class="fc bfc" id="L927" title="All 2 branches covered.">            if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc bfc" id="L928" title="All 2 branches covered.">                if (isWhitespace(ch)) {</span>
<span class="fc" id="L929">                    next();</span>
<span class="fc" id="L930">                    continue;</span>
                }
<span class="fc" id="L932">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L933">                return stringDefaultValue();</span>
            } else {
                break;
            }
        }

<span class="fc" id="L939">        int index = bp + fieldName.length;</span>

<span class="fc" id="L941">        char ch = charAt(index++);</span>
<span class="fc bfc" id="L942" title="All 2 branches covered.">        if (ch != '&quot;') {</span>
<span class="fc" id="L943">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L945">            return stringDefaultValue();</span>
        }

        final String strVal;
        {
<span class="fc" id="L950">            int startIndex = index;</span>
<span class="fc" id="L951">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L952" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L953">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L956">            String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L957" title="All 2 branches covered.">            if (stringVal.indexOf('\\') != -1) {</span>
                for (;;) {
<span class="fc" id="L959">                    int slashCount = 0;</span>
<span class="pc bpc" id="L960" title="1 of 2 branches missed.">                    for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L961" title="All 2 branches covered.">                        if (charAt(i) == '\\') {</span>
<span class="fc" id="L962">                            slashCount++;</span>
                        } else {
                            break;
                        }
                    }
<span class="fc bfc" id="L967" title="All 2 branches covered.">                    if (slashCount % 2 == 0) {</span>
<span class="fc" id="L968">                        break;</span>
                    }
<span class="fc" id="L970">                    endIndex = indexOf('&quot;', endIndex + 1);</span>
<span class="fc" id="L971">                }</span>

<span class="fc" id="L973">                int chars_len = endIndex - (bp + fieldName.length + 1);</span>
<span class="fc" id="L974">                char[] chars = sub_chars(bp + fieldName.length + 1, chars_len);</span>

<span class="fc" id="L976">                stringVal = readString(chars, chars_len);</span>
            }

<span class="fc" id="L979">            ch = charAt(endIndex + 1);</span>

            for (;;) {
<span class="fc bfc" id="L982" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L983">                    bp = endIndex + 1;</span>
<span class="fc" id="L984">                    this.ch = ch;</span>
<span class="fc" id="L985">                    strVal = stringVal;</span>
<span class="fc" id="L986">                    break;</span>
<span class="fc bfc" id="L987" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L988">                    endIndex++;</span>
<span class="fc" id="L989">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="fc" id="L991">                    matchStat = NOT_MATCH;</span>

<span class="fc" id="L993">                    return stringDefaultValue();</span>
                }
            }
        }

<span class="fc bfc" id="L998" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L999">            this.ch = charAt(++bp);</span>
<span class="fc" id="L1000">            matchStat = VALUE;</span>
<span class="fc" id="L1001">            return strVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L1004">            ch = charAt(++bp);</span>
<span class="fc bfc" id="L1005" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1006">                token = JSONToken.COMMA;</span>
<span class="fc" id="L1007">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1008" title="All 2 branches covered.">            } else if (ch == ']') {</span>
<span class="fc" id="L1009">                token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1010">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1011" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1012">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L1013">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1014" title="All 2 branches covered.">            } else if (ch == EOI) {</span>
<span class="fc" id="L1015">                token = JSONToken.EOF;</span>
            } else {
<span class="fc" id="L1017">                this.bp = startPos;</span>
<span class="fc" id="L1018">                this.ch = startChar;</span>
<span class="fc" id="L1019">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1020">                return stringDefaultValue();</span>
            }
<span class="fc" id="L1022">            matchStat = END;</span>
        }
<span class="fc" id="L1024">        return strVal;</span>
    }

    public java.util.Date scanFieldDate(char[] fieldName) {
<span class="fc" id="L1028">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1029">        int startPos = this.bp;</span>
<span class="fc" id="L1030">        char startChar = this.ch;</span>

<span class="fc bfc" id="L1032" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1033">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1034">            return null;</span>
        }

<span class="fc" id="L1037">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1039">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L1042" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L1043">            int startIndex = index;</span>
<span class="fc" id="L1044">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1045" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L1046">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L1049">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L1050">            bp = index;</span>
<span class="fc bfc" id="L1051" title="All 2 branches covered.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L1052">                dateVal = calendar.getTime();</span>
            } else {
<span class="fc" id="L1054">                bp = startPos;</span>
<span class="fc" id="L1055">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1056">                return null;</span>
            }
<span class="fc" id="L1058">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L1059">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L1062" title="1 of 4 branches missed.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1063">                    bp = endIndex + 1;</span>
<span class="fc" id="L1064">                    this.ch = ch;</span>
<span class="fc" id="L1065">                    break;</span>
<span class="nc bnc" id="L1066" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1067">                    endIndex++;</span>
<span class="nc" id="L1068">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="nc" id="L1070">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L1072">                    return null;</span>
                }
            }
<span class="pc bpc" id="L1075" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L1076">            long millis = 0;</span>

<span class="fc" id="L1078">            boolean negative = false;</span>
<span class="pc bpc" id="L1079" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L1080">                ch = charAt(index++);</span>
<span class="nc" id="L1081">                negative = true;</span>
            }

<span class="pc bpc" id="L1084" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1085">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L1087">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1088" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1089">                        millis = millis * 10 + (ch - '0');</span>
                    } else {
<span class="fc bfc" id="L1091" title="All 4 branches covered.">                        if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1092">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L1099" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L1100">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1101">                return null;</span>
            }

<span class="pc bpc" id="L1104" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L1105">                millis = -millis;</span>
            }

<span class="fc" id="L1108">            dateVal = new java.util.Date(millis);</span>
<span class="fc" id="L1109">        } else {</span>
<span class="fc" id="L1110">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L1112">            return null;</span>
        }

<span class="fc bfc" id="L1115" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1116">            this.ch = charAt(++bp);</span>
<span class="fc" id="L1117">            matchStat = VALUE;</span>
<span class="fc" id="L1118">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1119">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L1122">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L1123" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L1124">                token = JSONToken.COMMA;</span>
<span class="nc" id="L1125">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L1126" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L1127">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L1128">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1129" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1130">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L1131">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1132" title="All 2 branches covered.">            } else if (ch == EOI) {</span>
<span class="fc" id="L1133">                token = JSONToken.EOF;</span>
            } else {
<span class="fc" id="L1135">                this.bp = startPos;</span>
<span class="fc" id="L1136">                this.ch = startChar;</span>
<span class="fc" id="L1137">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1138">                return null;</span>
            }
<span class="fc" id="L1140">            matchStat = END;</span>
        }
<span class="fc" id="L1142">        return dateVal;</span>
    }

    public long scanFieldSymbol(char[] fieldName) {
<span class="fc" id="L1146">        matchStat = UNKNOWN;</span>

<span class="pc bpc" id="L1148" title="1 of 2 branches missed.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="nc" id="L1149">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L1150">            return 0;</span>
        }

<span class="fc" id="L1153">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1155">        char ch = charAt(index++);</span>
<span class="pc bpc" id="L1156" title="1 of 2 branches missed.">        if (ch != '&quot;') {</span>
<span class="nc" id="L1157">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1158">            return 0;</span>
        }

<span class="fc" id="L1161">        long hash = 0xcbf29ce484222325L;</span>
        for (;;) {
<span class="fc" id="L1163">            ch = charAt(index++);</span>
<span class="fc bfc" id="L1164" title="All 2 branches covered.">            if (ch == '\&quot;') {</span>
<span class="fc" id="L1165">                bp = index;</span>
<span class="fc" id="L1166">                this.ch = ch = charAt(bp);</span>
<span class="fc" id="L1167">                break;</span>
<span class="pc bpc" id="L1168" title="1 of 2 branches missed.">            } else if (index &gt; len) {</span>
<span class="nc" id="L1169">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1170">                return 0;</span>
            }

<span class="fc" id="L1173">            hash ^= ch;</span>
<span class="fc" id="L1174">            hash *= 0x100000001b3L;</span>
        }

        for (;;) {
<span class="pc bpc" id="L1178" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L1179">                this.ch = charAt(++bp);</span>
<span class="nc" id="L1180">                matchStat = VALUE;</span>
<span class="nc" id="L1181">                return hash;</span>
<span class="fc bfc" id="L1182" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1183">                next();</span>
<span class="fc" id="L1184">                skipWhitespace();</span>
<span class="fc" id="L1185">                ch = getCurrent();</span>
<span class="fc bfc" id="L1186" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1187">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1188">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1189" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1190">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1191">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1192" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1193">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1194">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1195" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1196">                    token = JSONToken.EOF;</span>
                } else {
<span class="fc" id="L1198">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1199">                    return 0;</span>
                }
<span class="fc" id="L1201">                matchStat = END;</span>
<span class="fc" id="L1202">                break;</span>
<span class="pc bpc" id="L1203" title="1 of 2 branches missed.">            } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1204">                ch = charAt(++bp);</span>
<span class="nc" id="L1205">                continue;</span>
            } else {
<span class="fc" id="L1207">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1208">                return 0;</span>
            }
        }

<span class="fc" id="L1212">        return hash;</span>
    }

    public Collection&lt;String&gt; newCollectionByType(Class&lt;?&gt; type){
<span class="fc bfc" id="L1216" title="All 2 branches covered.">        if (type.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L1217">            HashSet&lt;String&gt; list = new HashSet&lt;String&gt;();</span>
<span class="fc" id="L1218">            return list;</span>
<span class="fc bfc" id="L1219" title="All 2 branches covered.">        } else if (type.isAssignableFrom(ArrayList.class)) {</span>
<span class="fc" id="L1220">            ArrayList&lt;String&gt; list2 = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L1221">            return list2;</span>
        } else {
            try {
<span class="fc" id="L1224">                Collection&lt;String&gt; list = (Collection&lt;String&gt;) type.newInstance();</span>
<span class="fc" id="L1225">                return list;</span>
<span class="fc" id="L1226">            } catch (Exception e) {</span>
<span class="fc" id="L1227">                throw new JSONException(e.getMessage(), e);</span>
            }
        }
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;String&gt; scanFieldStringArray(char[] fieldName, Class&lt;?&gt; type) {
<span class="fc" id="L1234">        matchStat = UNKNOWN;</span>

<span class="pc bpc" id="L1236" title="1 of 4 branches missed.">        while (ch == '\n' || ch == ' ') {</span>
<span class="fc" id="L1237">            int index = ++bp;</span>
<span class="pc bpc" id="L1238" title="1 of 2 branches missed.">            ch = (index &gt;= this.len ? //</span>
                    EOI //
<span class="fc" id="L1240">                    : text.charAt(index));</span>
<span class="fc" id="L1241">        }</span>

<span class="fc bfc" id="L1243" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1244">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1245">            return null;</span>
        }

<span class="fc" id="L1248">        Collection&lt;String&gt; list = newCollectionByType(type);</span>

//        if (type.isAssignableFrom(HashSet.class)) {
//            list = new HashSet&lt;String&gt;();
//        } else if (type.isAssignableFrom(ArrayList.class)) {
//            list = new ArrayList&lt;String&gt;();
//        } else {
//            try {
//                list = (Collection&lt;String&gt;) type.newInstance();
//            } catch (Exception e) {
//                throw new JSONException(e.getMessage(), e);
//            }
//        }

<span class="fc" id="L1262">        int startPos = this.bp;</span>
<span class="fc" id="L1263">        char startChar = this.ch;</span>

<span class="fc" id="L1265">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1267">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1269" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L1270">            ch = charAt(index++);</span>

            for (;;) {
<span class="fc bfc" id="L1273" title="All 2 branches covered.">                if (ch == '&quot;') {</span>
<span class="fc" id="L1274">                    int startIndex = index;</span>
<span class="fc" id="L1275">                    int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1276" title="All 2 branches covered.">                    if (endIndex == -1) {</span>
<span class="fc" id="L1277">                        throw new JSONException(&quot;unclosed str&quot;);</span>
                    }

<span class="fc" id="L1280">                    String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L1281" title="All 2 branches covered.">                    if (stringVal.indexOf('\\') != -1) {</span>
                        for (;;) {
<span class="fc" id="L1283">                            int slashCount = 0;</span>
<span class="pc bpc" id="L1284" title="1 of 2 branches missed.">                            for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L1285" title="All 2 branches covered.">                                if (charAt(i) == '\\') {</span>
<span class="fc" id="L1286">                                    slashCount++;</span>
                                } else {
                                    break;
                                }
                            }
<span class="fc bfc" id="L1291" title="All 2 branches covered.">                            if (slashCount % 2 == 0) {</span>
<span class="fc" id="L1292">                                break;</span>
                            }
<span class="fc" id="L1294">                            endIndex = indexOf('&quot;', endIndex + 1);</span>
<span class="fc" id="L1295">                        }</span>

<span class="fc" id="L1297">                        int chars_len = endIndex - startIndex;</span>
<span class="fc" id="L1298">                        char[] chars = sub_chars(startIndex, chars_len);</span>

<span class="fc" id="L1300">                        stringVal = readString(chars, chars_len);</span>
                    }

<span class="fc" id="L1303">                    index = endIndex + 1;</span>
<span class="fc" id="L1304">                    ch = charAt(index++);</span>

<span class="fc" id="L1306">                    list.add(stringVal);</span>
<span class="fc bfc" id="L1307" title="All 4 branches covered.">                } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1308">                    index += 3;</span>
<span class="fc" id="L1309">                    ch = charAt(index++);</span>
<span class="fc" id="L1310">                    list.add(null);</span>
<span class="fc bfc" id="L1311" title="All 4 branches covered.">                } else if (ch == ']' &amp;&amp; list.size() == 0) {</span>
<span class="fc" id="L1312">                    ch = charAt(index++);</span>
<span class="fc" id="L1313">                    break;</span>
                } else {
<span class="fc" id="L1315">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1316">                    return null;</span>
                }

<span class="fc bfc" id="L1319" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1320">                    ch = charAt(index++);</span>
<span class="fc" id="L1321">                    continue;</span>
                }

<span class="fc bfc" id="L1324" title="All 2 branches covered.">                if (ch == ']') {</span>
<span class="fc" id="L1325">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1326" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1327">                        ch = charAt(index++);</span>
                    }
                    break;
                }

<span class="fc" id="L1332">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1333">                return null;</span>
            }
<span class="fc bfc" id="L1335" title="All 2 branches covered.">        } else if (text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1336">            index += 3;</span>
<span class="fc" id="L1337">            ch = charAt(index++);</span>
<span class="fc" id="L1338">            list = null;</span>
        } else {
<span class="fc" id="L1340">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1341">            return null;</span>
        }

<span class="fc" id="L1344">        bp = index;</span>
<span class="fc bfc" id="L1345" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1346">            this.ch = charAt(bp);</span>
<span class="fc" id="L1347">            matchStat = VALUE;</span>
<span class="fc" id="L1348">            return list;</span>
<span class="fc bfc" id="L1349" title="All 2 branches covered.">        } else if (ch == '}') {</span>
<span class="fc" id="L1350">            ch = charAt(bp);</span>
            for (;;) {
<span class="fc bfc" id="L1352" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1353">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1354">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1355">                    break;</span>
<span class="fc bfc" id="L1356" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1357">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1358">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1359">                    break;</span>
<span class="fc bfc" id="L1360" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1361">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1362">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1363">                    break;</span>
<span class="fc bfc" id="L1364" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1365">                    token = JSONToken.EOF;</span>
<span class="fc" id="L1366">                    this.ch = ch;</span>
<span class="fc" id="L1367">                    break;</span>
                } else {
<span class="fc" id="L1369">                    boolean space = false;</span>
<span class="fc bfc" id="L1370" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1371">                        ch = charAt(index++);</span>
<span class="fc" id="L1372">                        bp = index;</span>
<span class="fc" id="L1373">                        space = true;</span>
                    }
<span class="fc bfc" id="L1375" title="All 2 branches covered.">                    if (space) {</span>
<span class="fc" id="L1376">                        continue;</span>
                    }

<span class="fc" id="L1379">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1380">                    return null;</span>
                }
            }

<span class="fc" id="L1384">            matchStat = END;</span>
        } else {
<span class="fc" id="L1386">            this.ch = startChar;</span>
<span class="fc" id="L1387">            bp = startPos;</span>
<span class="fc" id="L1388">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1389">            return null;</span>
        }

<span class="fc" id="L1392">        return list;</span>
    }

    public long scanFieldLong(char[] fieldName) {
<span class="fc" id="L1396">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1397">        int startPos = this.bp;</span>
<span class="fc" id="L1398">        char startChar = this.ch;</span>

<span class="fc bfc" id="L1400" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1401">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1402">            return 0;</span>
        }

<span class="fc" id="L1405">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1407">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1409" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1410" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1411">            ch = charAt(index++);</span>
        }

<span class="fc" id="L1414">        boolean negative = false;</span>
<span class="fc bfc" id="L1415" title="All 2 branches covered.">        if (ch == '-') {</span>
<span class="fc" id="L1416">            ch = charAt(index++);</span>
<span class="fc" id="L1417">            negative = true;</span>
        }

        long value;
<span class="fc bfc" id="L1421" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1422">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L1424">                ch = charAt(index++);</span>
<span class="fc bfc" id="L1425" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1426">                    value = value * 10 + (ch - '0');</span>
<span class="fc bfc" id="L1427" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L1428">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1429">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1431" title="All 2 branches covered.">                    if (quote) {</span>
<span class="fc bfc" id="L1432" title="All 2 branches covered.">                        if (ch != '&quot;') {</span>
<span class="fc" id="L1433">                            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1434">                            return 0;</span>
                        } else {
<span class="fc" id="L1436">                            ch = charAt(index++);</span>
                        }
                    }

<span class="fc bfc" id="L1440" title="All 4 branches covered.">                    if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1441">                        bp = index - 1;</span>
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1447" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1448" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1449">                this.bp = startPos;</span>
<span class="fc" id="L1450">                this.ch = startChar;</span>
<span class="fc" id="L1451">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1452">                return 0;</span>
            }
<span class="fc" id="L1454">        } else {</span>
<span class="fc" id="L1455">            this.bp = startPos;</span>
<span class="fc" id="L1456">            this.ch = startChar;</span>
<span class="fc" id="L1457">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1458">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1462" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1463">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1464">                matchStat = VALUE;</span>
<span class="fc" id="L1465">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1466" title="All 2 branches covered.">                return negative ? -value : value;</span>
<span class="fc bfc" id="L1467" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1468">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1470" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1471">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1472">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1473">                        break;</span>
<span class="fc bfc" id="L1474" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1475">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1476">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1477">                        break;</span>
<span class="fc bfc" id="L1478" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1479">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1480">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1481">                        break;</span>
<span class="fc bfc" id="L1482" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1483">                        token = JSONToken.EOF;</span>
<span class="fc" id="L1484">                        break;</span>
<span class="fc bfc" id="L1485" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1486">                        ch = charAt(++bp);</span>
                    } else {
<span class="fc" id="L1488">                        this.bp = startPos;</span>
<span class="fc" id="L1489">                        this.ch = startChar;</span>
<span class="fc" id="L1490">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1491">                        return 0;</span>
                    }
                }
<span class="fc" id="L1494">                matchStat = END;</span>
<span class="fc" id="L1495">                break;</span>
<span class="fc bfc" id="L1496" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1497">                bp = index;</span>
<span class="fc" id="L1498">                ch = charAt(index++);</span>
<span class="fc" id="L1499">                continue;</span>
            } else {
<span class="fc" id="L1501">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1502">                return 0;</span>
            }
        }

<span class="fc bfc" id="L1506" title="All 2 branches covered.">        return negative ? -value : value;</span>
    }

    public boolean scanFieldBoolean(char[] fieldName) {
<span class="fc" id="L1510">        matchStat = UNKNOWN;</span>

<span class="fc bfc" id="L1512" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1513">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1514">            return false;</span>
        }

<span class="fc" id="L1517">        int startPos = bp;</span>
<span class="fc" id="L1518">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1520">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1522" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1523" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1524">            ch = charAt(index++);</span>
        }

        boolean value;
<span class="fc bfc" id="L1528" title="All 2 branches covered.">        if (ch == 't') {</span>
<span class="fc bfc" id="L1529" title="All 2 branches covered.">            if (charAt(index++) != 'r') {</span>
<span class="fc" id="L1530">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1531">                return false;</span>
            }
<span class="fc bfc" id="L1533" title="All 2 branches covered.">            if (charAt(index++) != 'u') {</span>
<span class="fc" id="L1534">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1535">                return false;</span>
            }
<span class="fc bfc" id="L1537" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1538">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1539">                return false;</span>
            }

<span class="pc bpc" id="L1542" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1543">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1544">                return false;</span>
            }

<span class="fc" id="L1547">            bp = index;</span>
<span class="fc" id="L1548">            ch = charAt(bp);</span>
<span class="fc" id="L1549">            value = true;</span>
<span class="fc bfc" id="L1550" title="All 2 branches covered.">        } else if (ch == 'f') {</span>
<span class="fc bfc" id="L1551" title="All 2 branches covered.">            if (charAt(index++) != 'a') {</span>
<span class="fc" id="L1552">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1553">                return false;</span>
            }
<span class="fc bfc" id="L1555" title="All 2 branches covered.">            if (charAt(index++) != 'l') {</span>
<span class="fc" id="L1556">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1557">                return false;</span>
            }
<span class="fc bfc" id="L1559" title="All 2 branches covered.">            if (charAt(index++) != 's') {</span>
<span class="fc" id="L1560">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1561">                return false;</span>
            }
<span class="fc bfc" id="L1563" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1564">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1565">                return false;</span>
            }

<span class="pc bpc" id="L1568" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1569">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1570">                return false;</span>
            }

<span class="fc" id="L1573">            bp = index;</span>
<span class="fc" id="L1574">            ch = charAt(bp);</span>
<span class="fc" id="L1575">            value = false;</span>
<span class="fc bfc" id="L1576" title="All 2 branches covered.">        } else if (ch == '1') {</span>
<span class="pc bpc" id="L1577" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1578">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1579">                return false;</span>
            }

<span class="fc" id="L1582">            bp = index;</span>
<span class="fc" id="L1583">            ch = charAt(bp);</span>
<span class="fc" id="L1584">            value = true;</span>
<span class="fc bfc" id="L1585" title="All 2 branches covered.">        } else if (ch == '0') {</span>
<span class="pc bpc" id="L1586" title="3 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1587">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1588">                return false;</span>
            }

<span class="fc" id="L1591">            bp = index;</span>
<span class="fc" id="L1592">            ch = charAt(bp);</span>
<span class="fc" id="L1593">            value = false;</span>
        } else {
<span class="fc" id="L1595">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1596">            return false;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1600" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1601">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1602">                matchStat = VALUE;</span>
<span class="fc" id="L1603">                token = JSONToken.COMMA;</span>
<span class="fc" id="L1604">                break;</span>
<span class="fc bfc" id="L1605" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1606">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1608" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1609">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1610">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1611" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1612">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1613">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1614" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1615">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1616">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1617" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1618">                        token = JSONToken.EOF;</span>
<span class="fc bfc" id="L1619" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1620">                        ch = charAt(++bp);</span>
<span class="fc" id="L1621">                        continue;</span>
                    } else {
<span class="fc" id="L1623">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1624">                        return false;</span>
                    }
                    break;
                }
<span class="fc" id="L1628">                matchStat = END;</span>
<span class="fc" id="L1629">                break;</span>
<span class="fc bfc" id="L1630" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1631">                ch = charAt(++bp);</span>
            } else {
<span class="fc" id="L1633">                bp = startPos;</span>
<span class="fc" id="L1634">                ch = charAt(bp);</span>
<span class="fc" id="L1635">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1636">                return false;</span>
            }
        }

<span class="fc" id="L1640">        return value;</span>
    }

    public final int scanInt(char expectNext) {
<span class="fc" id="L1644">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1646">        final int mark = bp;</span>
<span class="fc" id="L1647">        int offset = bp;</span>
<span class="fc" id="L1648">        char chLocal = charAt(offset++);</span>

<span class="fc bfc" id="L1650" title="All 2 branches covered.">        while (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1651">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1654" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1656" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1657">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1660" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1661" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1662">            chLocal = charAt(offset++);</span>
        }

        int value;
<span class="fc bfc" id="L1666" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1667">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1669">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1670" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1671">                    int value_10 = value * 10;</span>
<span class="fc bfc" id="L1672" title="All 2 branches covered.">                    if (value_10 &lt; value) {</span>
<span class="fc" id="L1673">                        throw new JSONException(&quot;parseInt error : &quot;</span>
<span class="fc" id="L1674">                                + subString(mark, offset - 1));</span>
                    }
<span class="fc" id="L1676">                    value = value_10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1677" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1678">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1679">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1681" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1682" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1683">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1684">                            return 0;</span>
                        } else {
<span class="fc" id="L1686">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }
<span class="fc bfc" id="L1692" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L1693">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1694">                return 0;</span>
            }
<span class="fc bfc" id="L1696" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1697" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1698" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1699" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1700">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1701">            value = 0;</span>
<span class="fc" id="L1702">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1704" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1705">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1709" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1710">                    bp = offset;</span>
<span class="fc" id="L1711">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1712">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1713">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1714">                    return value;</span>
<span class="fc bfc" id="L1715" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1716">                    bp = offset;</span>
<span class="fc" id="L1717">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1718">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1719">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1720">                    return value;</span>
<span class="pc bpc" id="L1721" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1722">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1723">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1727">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1728">            return 0;</span>
        } else {
<span class="fc" id="L1730">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1731">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1735" title="All 2 branches covered.">            if (chLocal == expectNext) {</span>
<span class="fc" id="L1736">                bp = offset;</span>
<span class="fc" id="L1737">                this.ch = charAt(bp);</span>
<span class="fc" id="L1738">                matchStat = VALUE;</span>
<span class="fc" id="L1739">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1740" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1742" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1743">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1744">                    continue;</span>
                }
<span class="fc" id="L1746">                matchStat = NOT_MATCH;</span>
<span class="fc bfc" id="L1747" title="All 2 branches covered.">                return negative ? -value : value;</span>
            }
        }
    }

    public  double scanDouble(char seperator) {
<span class="fc" id="L1753">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1755">        int offset = bp;</span>
<span class="fc" id="L1756">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1757" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>
<span class="fc bfc" id="L1758" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1759">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1762" title="All 2 branches covered.">        boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1763" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1764">            chLocal = charAt(offset++);</span>
        }

        double value;
<span class="pc bpc" id="L1768" title="1 of 4 branches missed.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1769">            long intVal = chLocal - '0';</span>
            for (; ; ) {
<span class="fc" id="L1771">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1772" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1773">                    intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1774">                    continue;</span>
                } else {
                    break;
                }
            }

<span class="fc" id="L1780">            long power = 1;</span>
<span class="fc bfc" id="L1781" title="All 2 branches covered.">            boolean small = (chLocal == '.');</span>
<span class="fc bfc" id="L1782" title="All 2 branches covered.">            if (small) {</span>
<span class="fc" id="L1783">                chLocal = charAt(offset++);</span>
<span class="pc bpc" id="L1784" title="1 of 4 branches missed.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1785">                    intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1786">                    power = 10;</span>
                    for (; ; ) {
<span class="fc" id="L1788">                        chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1789" title="All 4 branches covered.">                        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1790">                            intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1791">                            power *= 10;</span>
<span class="fc" id="L1792">                            continue;</span>
                        } else {
                            break;
                        }
                    }
                } else {
<span class="fc" id="L1798">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1799">                    return 0;</span>
                }
            }

<span class="pc bpc" id="L1803" title="1 of 4 branches missed.">            boolean exp = chLocal == 'e' || chLocal == 'E';</span>
<span class="fc bfc" id="L1804" title="All 2 branches covered.">            if (exp) {</span>
<span class="fc" id="L1805">                chLocal = charAt(offset++);</span>
<span class="pc bpc" id="L1806" title="2 of 4 branches missed.">                if (chLocal == '+' || chLocal == '-') {</span>
<span class="fc" id="L1807">                    chLocal = charAt(offset++);</span>
                }
                for (; ; ) {
<span class="pc bpc" id="L1810" title="1 of 4 branches missed.">                    if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1811">                        chLocal = charAt(offset++);</span>
                    } else {
                        break;
                    }
                }
            }

            int start, count;
<span class="fc bfc" id="L1819" title="All 2 branches covered.">            if (quote) {</span>
<span class="pc bpc" id="L1820" title="1 of 2 branches missed.">                if (chLocal != '&quot;') {</span>
<span class="nc" id="L1821">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L1822">                    return 0;</span>
                } else {
<span class="fc" id="L1824">                    chLocal = charAt(offset++);</span>
                }
<span class="fc" id="L1826">                start = bp + 1;</span>
<span class="fc" id="L1827">                count = offset - start - 2;</span>
            } else {
<span class="fc" id="L1829">                start = bp;</span>
<span class="fc" id="L1830">                count = offset - start - 1;</span>
            }

<span class="fc bfc" id="L1833" title="All 4 branches covered.">            if (!exp &amp;&amp; count &lt; 18) {</span>
<span class="fc" id="L1834">                value = ((double) intVal) / power;</span>
<span class="fc bfc" id="L1835" title="All 2 branches covered.">                if (negative) {</span>
<span class="fc" id="L1836">                    value = -value;</span>
                }
            } else {
<span class="fc" id="L1839">                String text = this.subString(start, count);</span>
<span class="fc" id="L1840">                value = Double.parseDouble(text);</span>
            }
<span class="fc bfc" id="L1842" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1843" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1844" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1845" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1846">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1847">            value = 0;</span>
<span class="fc" id="L1848">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1850" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1851">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1855" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1856">                    bp = offset;</span>
<span class="fc" id="L1857">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1858">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1859">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1860">                    return value;</span>
<span class="fc bfc" id="L1861" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1862">                    bp = offset;</span>
<span class="fc" id="L1863">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1864">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1865">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1866">                    return value;</span>
<span class="pc bpc" id="L1867" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1868">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1869">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1873">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1874">            return 0;</span>
        } else {
<span class="fc" id="L1876">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1877">            return 0;</span>
        }

<span class="fc bfc" id="L1880" title="All 2 branches covered.">        if (chLocal == seperator) {</span>
<span class="fc" id="L1881">            bp = offset;</span>
<span class="fc" id="L1882">            this.ch = this.charAt(bp);</span>
<span class="fc" id="L1883">            matchStat = VALUE;</span>
<span class="fc" id="L1884">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1885">            return value;</span>
        } else {
<span class="fc" id="L1887">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1888">            return value;</span>
        }
    }

    public long scanLong(char seperator) {
<span class="fc" id="L1893">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1895">        int offset = bp;</span>
<span class="fc" id="L1896">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1897" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1899" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1900">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1903" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1904" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1905">            chLocal = charAt(offset++);</span>
        }

        long value;
<span class="fc bfc" id="L1909" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1910">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1912">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1913" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1914">                    value = value * 10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1915" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1916">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1917">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1919" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1920" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1921">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1922">                            return 0;</span>
                        } else {
<span class="fc" id="L1924">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1931" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1932" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1933">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1934">                return 0;</span>
            }
<span class="fc bfc" id="L1936" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1937" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1938" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1939" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1940">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1941">            value = 0;</span>
<span class="fc" id="L1942">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1944" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1945">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1949" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1950">                    bp = offset;</span>
<span class="fc" id="L1951">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1952">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1953">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1954">                    return value;</span>
<span class="fc bfc" id="L1955" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1956">                    bp = offset;</span>
<span class="fc" id="L1957">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1958">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1959">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1960">                    return value;</span>
<span class="pc bpc" id="L1961" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1962">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1963">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1967">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1968">            return 0;</span>
        } else {
<span class="fc" id="L1970">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1971">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1975" title="All 2 branches covered.">            if (chLocal == seperator) {</span>
<span class="fc" id="L1976">                bp = offset;</span>
<span class="fc" id="L1977">                this.ch = charAt(bp);</span>
<span class="fc" id="L1978">                matchStat = VALUE;</span>
<span class="fc" id="L1979">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1980" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1982" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1983">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1984">                    continue;</span>
                }

<span class="fc" id="L1987">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1988">                return value;</span>
            }
        }
    }

    public java.util.Date scanDate(char seperator) {
<span class="fc" id="L1994">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1995">        int startPos = this.bp;</span>
<span class="fc" id="L1996">        char startChar = this.ch;</span>

<span class="fc" id="L1998">        int index = bp;</span>

<span class="fc" id="L2000">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L2003" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L2004">            int startIndex = index;</span>
<span class="fc" id="L2005">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="pc bpc" id="L2006" title="1 of 2 branches missed.">            if (endIndex == -1) {</span>
<span class="nc" id="L2007">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L2010">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L2011">            bp = index;</span>
<span class="pc bpc" id="L2012" title="1 of 2 branches missed.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L2013">                dateVal = calendar.getTime();</span>
            } else {
<span class="nc" id="L2015">                bp = startPos;</span>
<span class="nc" id="L2016">                this.ch = startChar;</span>
<span class="nc" id="L2017">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2018">                return null;</span>
            }
<span class="fc" id="L2020">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L2021">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L2024" title="1 of 4 branches missed.">                if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L2025">                    bp = endIndex + 1;</span>
<span class="fc" id="L2026">                    this.ch = ch;</span>
<span class="fc" id="L2027">                    break;</span>
<span class="nc bnc" id="L2028" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L2029">                    endIndex++;</span>
<span class="nc" id="L2030">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="nc" id="L2032">                    this.bp = startPos;</span>
<span class="nc" id="L2033">                    this.ch = startChar;</span>
<span class="nc" id="L2034">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L2036">                    return null;</span>
                }
            }
<span class="pc bpc" id="L2039" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L2040">            long millis = 0;</span>

<span class="fc" id="L2042">            boolean negative = false;</span>
<span class="pc bpc" id="L2043" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L2044">                ch = charAt(index++);</span>
<span class="nc" id="L2045">                negative = true;</span>
            }

<span class="pc bpc" id="L2048" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2049">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L2051">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L2052" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2053">                        millis = millis * 10 + (ch - '0');</span>
                    } else {
<span class="pc bpc" id="L2055" title="1 of 4 branches missed.">                        if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L2056">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L2063" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L2064">                this.bp = startPos;</span>
<span class="nc" id="L2065">                this.ch = startChar;</span>
<span class="nc" id="L2066">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2067">                return null;</span>
            }

<span class="pc bpc" id="L2070" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L2071">                millis = -millis;</span>
            }

<span class="fc" id="L2074">            dateVal = new java.util.Date(millis);</span>
<span class="pc bpc" id="L2075" title="1 of 2 branches missed.">        } else if (ch == 'n'</span>
<span class="pc bpc" id="L2076" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'u'</span>
<span class="pc bpc" id="L2077" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l'</span>
<span class="pc bpc" id="L2078" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l') {</span>
<span class="fc" id="L2079">            dateVal = null;</span>
<span class="fc" id="L2080">            ch = charAt(index);</span>
<span class="fc" id="L2081">            bp = index;</span>
        } else {
<span class="nc" id="L2083">            this.bp = startPos;</span>
<span class="nc" id="L2084">            this.ch = startChar;</span>
<span class="nc" id="L2085">            matchStat = NOT_MATCH;</span>

<span class="nc" id="L2087">            return null;</span>
        }

<span class="fc bfc" id="L2090" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L2091">            this.ch = charAt(++bp);</span>
<span class="fc" id="L2092">            matchStat = VALUE;</span>
<span class="fc" id="L2093">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L2096">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L2097" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L2098">                token = JSONToken.COMMA;</span>
<span class="nc" id="L2099">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2100" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L2101">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L2102">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2103" title="1 of 2 branches missed.">            } else if (ch == '}') {</span>
<span class="nc" id="L2104">                token = JSONToken.RBRACE;</span>
<span class="nc" id="L2105">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2106" title="1 of 2 branches missed.">            } else if (ch == EOI) {</span>
<span class="fc" id="L2107">                this.ch = EOI;</span>
<span class="fc" id="L2108">                token = JSONToken.EOF;</span>
            } else {
<span class="nc" id="L2110">                this.bp = startPos;</span>
<span class="nc" id="L2111">                this.ch = startChar;</span>
<span class="nc" id="L2112">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2113">                return null;</span>
            }
<span class="fc" id="L2115">            matchStat = END;</span>
        }
<span class="fc" id="L2117">        return dateVal;</span>
    }

    protected final void arrayCopy(int srcPos, char[] dest, int destPos, int length) {
<span class="fc" id="L2121">        text.getChars(srcPos, srcPos + length, dest, destPos);</span>
<span class="fc" id="L2122">    }</span>

    public String info() {
<span class="fc" id="L2125">        StringBuilder buf = new StringBuilder();</span>

//        buf.append(&quot;pos &quot;).append(bp);
//        return &quot;pos &quot; + bp //
//                + &quot;, json : &quot; //
//                + (text.length() &lt; 65536 //
//                ? text //
//                : text.substring(0, 65536));

<span class="fc" id="L2134">        int line = 1;</span>
<span class="fc" id="L2135">        int column = 1;</span>
<span class="fc bfc" id="L2136" title="All 2 branches covered.">        for (int i = 0; i &lt; bp; ++i, column++) {</span>
<span class="fc" id="L2137">            char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2138" title="1 of 2 branches missed.">            if (ch == '\n') {</span>
<span class="nc" id="L2139">                column = 1;</span>
<span class="nc" id="L2140">                line++;</span>
            }
        }

<span class="fc" id="L2144">        buf.append(&quot;pos &quot;).append(bp)</span>
<span class="fc" id="L2145">                .append(&quot;, line &quot;).append(line)</span>
<span class="fc" id="L2146">                .append(&quot;, column &quot;).append(column);</span>

<span class="pc bpc" id="L2148" title="1 of 2 branches missed.">        if (text.length() &lt; 65535) {</span>
<span class="fc" id="L2149">            buf.append(text);</span>
        } else {
<span class="nc" id="L2151">            buf.append(text.substring(0, 65535));</span>
        }

<span class="fc" id="L2154">        return buf.toString();</span>
    }

    // for hsf support
    public String[] scanFieldStringArray(char[] fieldName, int argTypesCount, SymbolTable typeSymbolTable) {
<span class="fc" id="L2159">        int startPos = bp;</span>
<span class="fc" id="L2160">        char starChar = ch;</span>

<span class="fc bfc" id="L2162" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2163">            next();</span>
        }

        int offset;
        char ch;
<span class="fc bfc" id="L2168" title="All 2 branches covered.">        if (fieldName != null) {</span>
<span class="fc" id="L2169">            matchStat = UNKNOWN;</span>
<span class="fc bfc" id="L2170" title="All 2 branches covered.">            if (!charArrayCompare(fieldName)) {</span>
<span class="fc" id="L2171">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L2172">                return null;</span>
            }

<span class="fc" id="L2175">            offset = bp + fieldName.length;</span>
<span class="fc" id="L2176">            ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2177" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2178">                ch = text.charAt(offset++);</span>
            }

<span class="pc bpc" id="L2181" title="1 of 2 branches missed.">            if (ch == ':') {</span>
<span class="fc" id="L2182">                ch = text.charAt(offset++);</span>
            } else {
<span class="nc" id="L2184">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2185">                return null;</span>
            }

<span class="fc bfc" id="L2188" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2189">                ch = text.charAt(offset++);</span>
            }
        } else {
<span class="fc" id="L2192">            offset = bp + 1;</span>
<span class="fc" id="L2193">            ch = this.ch;</span>
        }

<span class="fc bfc" id="L2196" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L2197">            bp = offset;</span>
<span class="fc" id="L2198">            this.ch = text.charAt(bp);</span>
<span class="pc bpc" id="L2199" title="2 of 4 branches missed.">        } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, bp + 1)) {</span>
<span class="fc" id="L2200">            bp += 4;</span>
<span class="fc" id="L2201">            this.ch = text.charAt(bp);</span>
<span class="fc" id="L2202">            return null;</span>
        } else {
<span class="nc" id="L2204">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2205">            return null;</span>
        }

<span class="pc bpc" id="L2208" title="1 of 2 branches missed.">        String[] types = argTypesCount &gt;= 0 ? new String[argTypesCount] : new String[4];</span>
<span class="fc" id="L2209">        int typeIndex = 0;</span>
        for (;;) {
<span class="fc bfc" id="L2211" title="All 2 branches covered.">            while (isWhitespace(this.ch)) {</span>
<span class="fc" id="L2212">                next();</span>
            }

<span class="fc bfc" id="L2215" title="All 2 branches covered.">            if (this.ch != '\&quot;') {</span>
<span class="fc" id="L2216">                this.bp = startPos;</span>
<span class="fc" id="L2217">                this.ch = starChar;</span>
<span class="fc" id="L2218">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L2219">                return null;</span>
            }

<span class="fc" id="L2222">            String type = scanSymbol(typeSymbolTable, '&quot;');</span>
<span class="pc bpc" id="L2223" title="1 of 2 branches missed.">            if (typeIndex == types.length) {</span>
<span class="nc" id="L2224">                int newCapacity = types.length + (types.length &gt;&gt; 1) + 1;</span>
<span class="nc" id="L2225">                String[] array = new String[newCapacity];</span>
<span class="nc" id="L2226">                System.arraycopy(types, 0, array, 0, types.length);</span>
<span class="nc" id="L2227">                types = array;</span>
            }
<span class="fc" id="L2229">            types[typeIndex++] = type;</span>
<span class="pc bpc" id="L2230" title="1 of 2 branches missed.">            while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2231">                next();</span>
            }
<span class="fc bfc" id="L2233" title="All 2 branches covered.">            if (this.ch == ',') {</span>
<span class="fc" id="L2234">                next();</span>
<span class="fc" id="L2235">                continue;</span>
            }
            break;
        }
<span class="pc bpc" id="L2239" title="1 of 2 branches missed.">        if (types.length != typeIndex) {</span>
<span class="fc" id="L2240">            String[] array = new String[typeIndex];</span>
<span class="fc" id="L2241">            System.arraycopy(types, 0, array, 0, typeIndex);</span>
<span class="fc" id="L2242">            types = array;</span>
        }

<span class="pc bpc" id="L2245" title="1 of 2 branches missed.">        while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2246">            next();</span>
        }

<span class="pc bpc" id="L2249" title="1 of 2 branches missed.">        if (this.ch == ']') {</span>
<span class="fc" id="L2250">            next();</span>
        } else {
<span class="nc" id="L2252">            this.bp = startPos;</span>
<span class="nc" id="L2253">            this.ch = starChar;</span>
<span class="nc" id="L2254">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2255">            return null;</span>
        }

<span class="fc" id="L2258">        return types;</span>
    }

    public boolean matchField2(char[] fieldName) {
<span class="fc bfc" id="L2262" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2263">            next();</span>
        }

<span class="pc bpc" id="L2266" title="1 of 2 branches missed.">        if (!charArrayCompare(fieldName)) {</span>
<span class="nc" id="L2267">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2268">            return false;</span>
        }

<span class="fc" id="L2271">        int offset = bp + fieldName.length;</span>
<span class="fc" id="L2272">        char ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2273" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2274">            ch = text.charAt(offset++);</span>
        }

<span class="pc bpc" id="L2277" title="1 of 2 branches missed.">        if (ch == ':') {</span>
<span class="fc" id="L2278">            this.bp = offset;</span>
<span class="fc" id="L2279">            this.ch = charAt(bp);</span>
<span class="fc" id="L2280">            return true;</span>
        } else {
<span class="nc" id="L2282">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2283">            return false;</span>
        }
    }

    public final void skipObject() {
<span class="nc" id="L2288">        skipObject(false);</span>
<span class="nc" id="L2289">    }</span>

    public final void skipObject(boolean valid) {
<span class="fc" id="L2292">        boolean quote = false;</span>
<span class="fc" id="L2293">        int braceCnt = 0;</span>
<span class="fc" id="L2294">        int i = bp;</span>
<span class="fc bfc" id="L2295" title="All 2 branches covered.">        for (; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2296">            final char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2297" title="1 of 2 branches missed.">            if (ch == '\\') {</span>
<span class="nc bnc" id="L2298" title="All 2 branches missed.">                if (i &lt; len - 1) {</span>
<span class="nc" id="L2299">                    ++i;</span>
<span class="nc" id="L2300">                    continue;</span>
                } else {
<span class="nc" id="L2302">                    this.ch = ch;</span>
<span class="nc" id="L2303">                    this.bp = i;</span>
<span class="nc" id="L2304">                    throw new JSONException(&quot;illegal str, &quot; + info());</span>
                }
<span class="fc bfc" id="L2306" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc bfc" id="L2307" title="All 2 branches covered.">                quote = !quote;</span>
<span class="fc bfc" id="L2308" title="All 2 branches covered.">            } else if (ch == '{') {</span>
<span class="pc bpc" id="L2309" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2310">                    continue;</span>
                }
<span class="fc" id="L2312">                braceCnt++;</span>
<span class="fc bfc" id="L2313" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc bfc" id="L2314" title="All 2 branches covered.">                if (quote) {</span>
<span class="fc" id="L2315">                    continue;</span>
                } else {
<span class="fc" id="L2317">                    braceCnt--;</span>
                }
<span class="fc bfc" id="L2319" title="All 2 branches covered.">                if (braceCnt == -1) {</span>
<span class="fc" id="L2320">                    this.bp = i + 1;</span>
<span class="fc bfc" id="L2321" title="All 2 branches covered.">                    if (this.bp == text.length()) {</span>
<span class="fc" id="L2322">                        this.ch = EOI;</span>
<span class="fc" id="L2323">                        this.token = JSONToken.EOF;</span>
<span class="fc" id="L2324">                        return;</span>
                    }
<span class="fc" id="L2326">                    this.ch = text.charAt(this.bp);</span>
<span class="fc bfc" id="L2327" title="All 2 branches covered.">                    if (this.ch == ',') {</span>
<span class="fc" id="L2328">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L2329">                        int index = ++bp;</span>
<span class="pc bpc" id="L2330" title="1 of 2 branches missed.">                        this.ch = (index &gt;= text.length() //</span>
                                ? EOI //
<span class="fc" id="L2332">                                : text.charAt(index));</span>
<span class="fc" id="L2333">                        return;</span>
<span class="fc bfc" id="L2334" title="All 2 branches covered.">                    } else if (this.ch == '}') {</span>
<span class="fc" id="L2335">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L2336">                        next();</span>
<span class="fc" id="L2337">                        return;</span>
<span class="fc bfc" id="L2338" title="All 2 branches covered.">                    } else if (this.ch == ']') {</span>
<span class="fc" id="L2339">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L2340">                        next();</span>
<span class="fc" id="L2341">                        return;</span>
                    } else {
<span class="fc" id="L2343">                        nextToken(JSONToken.COMMA);</span>
                    }
<span class="fc" id="L2345">                    return;</span>
                }
            }
        }

<span class="fc bfc" id="L2350" title="All 2 branches covered.">        if (i == text.length()) {</span>
<span class="fc" id="L2351">            throw new JSONException(&quot;illegal str, &quot; + info());</span>
        }
<span class="fc" id="L2353">    }</span>

    public final void skipArray() {
<span class="nc" id="L2356">        skipArray(false);</span>
<span class="nc" id="L2357">    }</span>

    public final void skipArray(boolean valid) {
<span class="fc" id="L2360">        boolean quote = false;</span>
<span class="fc" id="L2361">        int bracketCnt = 0;</span>
<span class="fc" id="L2362">        int i = bp;</span>
<span class="fc bfc" id="L2363" title="All 2 branches covered.">        for (; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2364">            char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2365" title="1 of 2 branches missed.">            if (ch == '\\') {</span>
<span class="nc bnc" id="L2366" title="All 2 branches missed.">                if (i &lt; len - 1) {</span>
<span class="nc" id="L2367">                    ++i;</span>
<span class="nc" id="L2368">                    continue;</span>
                } else {
<span class="nc" id="L2370">                    this.ch = ch;</span>
<span class="nc" id="L2371">                    this.bp = i;</span>
<span class="nc" id="L2372">                    throw new JSONException(&quot;illegal str, &quot; + info());</span>
                }
<span class="fc bfc" id="L2374" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc bfc" id="L2375" title="All 2 branches covered.">                quote = !quote;</span>
<span class="fc bfc" id="L2376" title="All 2 branches covered.">            } else if (ch == '[') {</span>
<span class="pc bpc" id="L2377" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2378">                    continue;</span>
                }
<span class="fc" id="L2380">                bracketCnt++;</span>
<span class="fc bfc" id="L2381" title="All 4 branches covered.">            } else if (ch == '{' &amp;&amp; valid) {</span>
                {
<span class="fc" id="L2383">                    int index = ++bp;</span>
<span class="fc bfc" id="L2384" title="All 2 branches covered.">                    this.ch = (index &gt;= text.length() //</span>
                            ? EOI //
<span class="fc" id="L2386">                            : text.charAt(index));</span>
                }

<span class="fc" id="L2389">                skipObject(valid);</span>
<span class="fc bfc" id="L2390" title="All 2 branches covered.">            } else if (ch == ']') {</span>
<span class="pc bpc" id="L2391" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2392">                    continue;</span>
                } else {
<span class="fc" id="L2394">                    bracketCnt--;</span>
                }
<span class="fc bfc" id="L2396" title="All 2 branches covered.">                if (bracketCnt == -1) {</span>
<span class="fc" id="L2397">                    this.bp = i + 1;</span>
<span class="fc bfc" id="L2398" title="All 2 branches covered.">                    if (this.bp == text.length()) {</span>
<span class="fc" id="L2399">                        this.ch = EOI;</span>
<span class="fc" id="L2400">                        token = JSONToken.EOF;</span>
<span class="fc" id="L2401">                        return;</span>
                    }
<span class="fc" id="L2403">                    this.ch = text.charAt(this.bp);</span>
<span class="fc" id="L2404">                    nextToken(JSONToken.COMMA);</span>
<span class="fc" id="L2405">                    return;</span>
                }
            }
        }

<span class="pc bpc" id="L2410" title="1 of 2 branches missed.">        if (i == text.length()) {</span>
<span class="fc" id="L2411">            throw new JSONException(&quot;illegal str, &quot; + info());</span>
        }
<span class="nc" id="L2413">    }</span>

    public final void skipString() {
<span class="pc bpc" id="L2416" title="1 of 2 branches missed.">        if (ch == '&quot;') {</span>
<span class="pc bpc" id="L2417" title="1 of 2 branches missed.">            for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2418">                char c = text.charAt(i);</span>
<span class="fc bfc" id="L2419" title="All 2 branches covered.">                if (c == '\\') {</span>
<span class="pc bpc" id="L2420" title="1 of 2 branches missed.">                    if (i &lt; len - 1) {</span>
<span class="fc" id="L2421">                        ++i;</span>
<span class="fc" id="L2422">                        continue;</span>
                    }
<span class="fc bfc" id="L2424" title="All 2 branches covered.">                } else if (c == '&quot;') {</span>
<span class="fc" id="L2425">                    this.ch = text.charAt(bp = i + 1);</span>
<span class="fc" id="L2426">                    return;</span>
                }
            }
<span class="nc" id="L2429">            throw new JSONException(&quot;unclosed str&quot;);</span>
        } else {
<span class="nc" id="L2431">            throw new UnsupportedOperationException();</span>
        }
    }

    public boolean seekArrayToItem(int index) {
<span class="pc bpc" id="L2436" title="1 of 2 branches missed.">        if (index &lt; 0) {</span>
<span class="nc" id="L2437">            throw new IllegalArgumentException(&quot;index must &gt; 0, but &quot; + index);</span>
        }

<span class="fc bfc" id="L2440" title="All 2 branches covered.">        if (token == JSONToken.EOF) {</span>
<span class="fc" id="L2441">            return false;</span>
        }

<span class="pc bpc" id="L2444" title="1 of 2 branches missed.">        if (token != JSONToken.LBRACKET) {</span>
<span class="nc" id="L2445">            throw new UnsupportedOperationException();</span>
        }
//        nextToken();

<span class="fc bfc" id="L2449" title="All 2 branches covered.">        for (int i = 0; i &lt; index; ++i) {</span>
<span class="fc" id="L2450">            skipWhitespace();</span>
<span class="pc bpc" id="L2451" title="1 of 4 branches missed.">            if (ch == '&quot;' || ch == '\'') {</span>
<span class="fc" id="L2452">                skipString();</span>
<span class="pc bpc" id="L2453" title="1 of 2 branches missed.">                if (ch == ',') {</span>
<span class="fc" id="L2454">                    next();</span>
<span class="fc" id="L2455">                    continue;</span>
<span class="nc bnc" id="L2456" title="All 2 branches missed.">                } else if (ch == ']') {</span>
<span class="nc" id="L2457">                    next();</span>
<span class="nc" id="L2458">                    nextToken(JSONToken.COMMA);</span>
<span class="nc" id="L2459">                    return false;</span>
                } else {
<span class="nc" id="L2461">                    throw new JSONException(&quot;illegal json.&quot;);</span>
                }
<span class="fc bfc" id="L2463" title="All 2 branches covered.">            } else if (ch == '{') {</span>
<span class="fc" id="L2464">                next();</span>
<span class="fc" id="L2465">                token = JSONToken.LBRACE;</span>
<span class="fc" id="L2466">                skipObject(false);</span>
<span class="fc bfc" id="L2467" title="All 2 branches covered.">            } else if (ch == '[') {</span>
<span class="fc" id="L2468">                next();</span>
<span class="fc" id="L2469">                token = JSONToken.LBRACKET;</span>
<span class="fc" id="L2470">                skipArray(false);</span>
            } else {
<span class="fc" id="L2472">                boolean match = false;</span>
<span class="pc bpc" id="L2473" title="1 of 2 branches missed.">                for (int j = bp + 1; j &lt; text.length(); ++j) {</span>
<span class="fc" id="L2474">                    char c = text.charAt(j);</span>
<span class="fc bfc" id="L2475" title="All 2 branches covered.">                    if (c == ',') {</span>
<span class="fc" id="L2476">                        match = true;</span>
<span class="fc" id="L2477">                        bp = j + 1;</span>
<span class="fc" id="L2478">                        ch = charAt(bp);</span>
<span class="fc" id="L2479">                        break;</span>
<span class="fc bfc" id="L2480" title="All 2 branches covered.">                    } else if (c == ']') {</span>
<span class="fc" id="L2481">                        bp = j + 1;</span>
<span class="fc" id="L2482">                        ch = charAt(bp);</span>
<span class="fc" id="L2483">                        nextToken();</span>
<span class="fc" id="L2484">                        return false;</span>
                    }
                }

<span class="pc bpc" id="L2488" title="1 of 2 branches missed.">                if (!match) {</span>
<span class="nc" id="L2489">                    throw new JSONException(&quot;illegal json.&quot;);</span>
                }

                continue;
            }

<span class="pc bpc" id="L2495" title="1 of 2 branches missed.">            if (token == JSONToken.COMMA) {</span>
<span class="fc" id="L2496">                continue;</span>
<span class="nc bnc" id="L2497" title="All 2 branches missed.">            } else if (token == JSONToken.RBRACKET) {</span>
<span class="nc" id="L2498">                return false;</span>
            } else {
<span class="nc" id="L2500">                throw new UnsupportedOperationException();</span>
            }

        }

<span class="fc" id="L2505">        nextToken();</span>
<span class="fc" id="L2506">        return true;</span>
    }

    public int seekObjectToField(long fieldNameHash, boolean deepScan) {
<span class="fc bfc" id="L2510" title="All 2 branches covered.">        if (token == JSONToken.EOF) {</span>
<span class="fc" id="L2511">            return JSONLexer.NOT_MATCH;</span>
        }

<span class="pc bpc" id="L2514" title="1 of 4 branches missed.">        if (token == JSONToken.RBRACE || token == JSONToken.RBRACKET) {</span>
<span class="fc" id="L2515">            nextToken();</span>
<span class="fc" id="L2516">            return JSONLexer.NOT_MATCH;</span>
        }

<span class="pc bpc" id="L2519" title="1 of 4 branches missed.">        if (token != JSONToken.LBRACE &amp;&amp; token != JSONToken.COMMA) {</span>
<span class="nc" id="L2520">            throw new UnsupportedOperationException(JSONToken.name(token));</span>
        }

        for (;;) {
<span class="fc bfc" id="L2524" title="All 2 branches covered.">            if (ch == '}') {</span>
<span class="fc" id="L2525">                next();</span>
<span class="fc" id="L2526">                nextToken();</span>
<span class="fc" id="L2527">                return JSONLexer.NOT_MATCH;</span>
            }
<span class="pc bpc" id="L2529" title="1 of 2 branches missed.">            if (ch == EOI) {</span>
<span class="nc" id="L2530">                return JSONLexer.NOT_MATCH;</span>
            }

<span class="fc bfc" id="L2533" title="All 2 branches covered.">            if (ch != '&quot;') {</span>
<span class="fc" id="L2534">                skipWhitespace();</span>
            }

            long hash;
<span class="pc bpc" id="L2538" title="1 of 2 branches missed.">            if (ch == '&quot;') {</span>
<span class="fc" id="L2539">                hash = 0xcbf29ce484222325L;</span>

<span class="pc bpc" id="L2541" title="1 of 2 branches missed.">                for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2542">                    char c = text.charAt(i);</span>
<span class="pc bpc" id="L2543" title="1 of 2 branches missed.">                    if (c == '\\') {</span>
<span class="nc" id="L2544">                        ++i;</span>
<span class="nc bnc" id="L2545" title="All 2 branches missed.">                        if (i == text.length()) {</span>
<span class="nc" id="L2546">                            throw new JSONException(&quot;unclosed str, &quot; + info());</span>
                        }
<span class="nc" id="L2548">                        c = text.charAt(i);</span>
                    }

<span class="fc bfc" id="L2551" title="All 2 branches covered.">                    if (c == '&quot;') {</span>
<span class="fc" id="L2552">                        bp = i + 1;</span>
<span class="pc bpc" id="L2553" title="1 of 2 branches missed.">                        ch = (bp &gt;= text.length() //</span>
                                ? EOI //
<span class="fc" id="L2555">                                : text.charAt(bp));</span>
<span class="fc" id="L2556">                        break;</span>
                    }

<span class="fc" id="L2559">                    hash ^= c;</span>
<span class="fc" id="L2560">                    hash *= 0x100000001b3L;</span>
                }
            } else {
<span class="nc" id="L2563">                throw new UnsupportedOperationException();</span>
            }

<span class="fc bfc" id="L2566" title="All 2 branches covered.">            if (hash == fieldNameHash) {</span>
<span class="fc bfc" id="L2567" title="All 2 branches covered.">                if (ch != ':') {</span>
<span class="fc" id="L2568">                    skipWhitespace();</span>
                }
<span class="pc bpc" id="L2570" title="1 of 2 branches missed.">                if (ch == ':') {</span>
                    {
<span class="fc" id="L2572">                        int index = ++bp;</span>
<span class="pc bpc" id="L2573" title="1 of 2 branches missed.">                        ch = (index &gt;= text.length() //</span>
                                ? EOI //
<span class="fc" id="L2575">                                : text.charAt(index));</span>
                    }
<span class="pc bpc" id="L2577" title="1 of 2 branches missed.">                    if (ch == ',') {</span>
                        {
<span class="nc" id="L2579">                            int index = ++bp;</span>
<span class="nc bnc" id="L2580" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2582">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2584">                        token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L2585" title="1 of 2 branches missed.">                    } else if (ch == ']') {</span>
                        {
<span class="nc" id="L2587">                            int index = ++bp;</span>
<span class="nc bnc" id="L2588" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2590">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2592">                        token = JSONToken.RBRACKET;</span>
<span class="pc bpc" id="L2593" title="1 of 2 branches missed.">                    } else if (ch == '}') {</span>
                        {
<span class="nc" id="L2595">                            int index = ++bp;</span>
<span class="nc bnc" id="L2596" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2598">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2600">                        token = JSONToken.RBRACE;</span>
<span class="fc bfc" id="L2601" title="All 4 branches covered.">                    } else if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2602">                        sp = 0;</span>
<span class="fc" id="L2603">                        pos = bp;</span>
<span class="fc" id="L2604">                        scanNumber();</span>
                    } else {
<span class="fc" id="L2606">                        nextToken(JSONToken.LITERAL_INT);</span>
                    }
                }
<span class="fc" id="L2609">                return VALUE;</span>
            }

<span class="fc bfc" id="L2612" title="All 2 branches covered.">            if (ch != ':') {</span>
<span class="fc" id="L2613">                skipWhitespace();</span>
            }

<span class="pc bpc" id="L2616" title="1 of 2 branches missed.">            if (ch == ':') {</span>
<span class="fc" id="L2617">                int index = ++bp;</span>
<span class="pc bpc" id="L2618" title="1 of 2 branches missed.">                ch = (index &gt;= text.length() //</span>
                        ? EOI //
<span class="fc" id="L2620">                        : text.charAt(index));</span>
<span class="fc" id="L2621">            } else {</span>
<span class="nc" id="L2622">                throw new JSONException(&quot;illegal json, &quot; + info());</span>
            }

<span class="pc bpc" id="L2625" title="15 of 32 branches missed.">            if (ch != '&quot;'</span>
                    &amp;&amp; ch != '\''
                    &amp;&amp; ch != '{'
                    &amp;&amp; ch != '['
                    &amp;&amp; ch != '0'
                    &amp;&amp; ch != '1'
                    &amp;&amp; ch != '2'
                    &amp;&amp; ch != '3'
                    &amp;&amp; ch != '4'
                    &amp;&amp; ch != '5'
                    &amp;&amp; ch != '6'
                    &amp;&amp; ch != '7'
                    &amp;&amp; ch != '8'
                    &amp;&amp; ch != '9'
                    &amp;&amp; ch != '+'
                    &amp;&amp; ch != '-') {
<span class="fc" id="L2641">                skipWhitespace();</span>
            }

            // skip fieldValues
<span class="pc bpc" id="L2645" title="2 of 8 branches missed.">            if (ch == '-' || ch == '+' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L2646">                next();</span>
<span class="pc bpc" id="L2647" title="1 of 4 branches missed.">                while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2648">                    next();</span>
                }

                // scale
<span class="fc bfc" id="L2652" title="All 2 branches covered.">                if (ch == '.') {</span>
<span class="fc" id="L2653">                    next();</span>
<span class="pc bpc" id="L2654" title="1 of 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2655">                        next();</span>
                    }
                }

                // exp
<span class="pc bpc" id="L2660" title="2 of 4 branches missed.">                if (ch == 'E' || ch == 'e') {</span>
<span class="nc" id="L2661">                    next();</span>
<span class="nc bnc" id="L2662" title="All 4 branches missed.">                    if (ch == '-' || ch == '+') {</span>
<span class="nc" id="L2663">                        next();</span>
                    }
<span class="nc bnc" id="L2665" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2666">                        next();</span>
                    }
                }

<span class="fc bfc" id="L2670" title="All 2 branches covered.">                if (ch != ',') {</span>
<span class="fc" id="L2671">                    skipWhitespace();</span>
                }
<span class="fc bfc" id="L2673" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2674">                    next();</span>
                }
<span class="fc bfc" id="L2676" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc" id="L2677">                skipString();</span>

<span class="pc bpc" id="L2679" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2680">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2683" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2684">                    next();</span>
                }
<span class="fc bfc" id="L2686" title="All 2 branches covered.">            } else if (ch == 't') {</span>
<span class="fc" id="L2687">                next();</span>
<span class="pc bpc" id="L2688" title="1 of 2 branches missed.">                if (ch == 'r') {</span>
<span class="fc" id="L2689">                    next();</span>
<span class="pc bpc" id="L2690" title="1 of 2 branches missed.">                    if (ch == 'u') {</span>
<span class="fc" id="L2691">                        next();</span>
<span class="pc bpc" id="L2692" title="1 of 2 branches missed.">                        if (ch == 'e') {</span>
<span class="fc" id="L2693">                            next();</span>
                        }
                    }
                }

<span class="pc bpc" id="L2698" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2699">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2702" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2703">                    next();</span>
                }
<span class="fc bfc" id="L2705" title="All 2 branches covered.">            } else if (ch == 'n') {</span>
<span class="fc" id="L2706">                next();</span>
<span class="pc bpc" id="L2707" title="1 of 2 branches missed.">                if (ch == 'u') {</span>
<span class="fc" id="L2708">                    next();</span>
<span class="pc bpc" id="L2709" title="1 of 2 branches missed.">                    if (ch == 'l') {</span>
<span class="fc" id="L2710">                        next();</span>
<span class="pc bpc" id="L2711" title="1 of 2 branches missed.">                        if (ch == 'l') {</span>
<span class="fc" id="L2712">                            next();</span>
                        }
                    }
                }

<span class="pc bpc" id="L2717" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2718">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2721" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2722">                    next();</span>
                }
<span class="fc bfc" id="L2724" title="All 2 branches covered.">            } else if (ch == 'f') {</span>
<span class="fc" id="L2725">                next();</span>
<span class="pc bpc" id="L2726" title="1 of 2 branches missed.">                if (ch == 'a') {</span>
<span class="fc" id="L2727">                    next();</span>
<span class="pc bpc" id="L2728" title="1 of 2 branches missed.">                    if (ch == 'l') {</span>
<span class="fc" id="L2729">                        next();</span>
<span class="pc bpc" id="L2730" title="1 of 2 branches missed.">                        if (ch == 's') {</span>
<span class="fc" id="L2731">                            next();</span>
<span class="pc bpc" id="L2732" title="1 of 2 branches missed.">                            if (ch == 'e') {</span>
<span class="fc" id="L2733">                                next();</span>
                            }
                        }
                    }
                }

<span class="pc bpc" id="L2739" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2740">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2743" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2744">                    next();</span>
                }
<span class="fc bfc" id="L2746" title="All 2 branches covered.">            } else if (ch == '{') {</span>
                {
<span class="fc" id="L2748">                    int index = ++bp;</span>
<span class="pc bpc" id="L2749" title="1 of 2 branches missed.">                    ch = (index &gt;= text.length() //</span>
                            ? EOI //
<span class="fc" id="L2751">                            : text.charAt(index));</span>
                }
<span class="fc bfc" id="L2753" title="All 2 branches covered.">                if (deepScan) {</span>
<span class="fc" id="L2754">                    token = JSONToken.LBRACE;</span>
<span class="fc" id="L2755">                    return OBJECT;</span>
                }

<span class="fc" id="L2758">                skipObject(false);</span>
<span class="fc bfc" id="L2759" title="All 2 branches covered.">                if (token == JSONToken.RBRACE) {</span>
<span class="fc" id="L2760">                    return JSONLexer.NOT_MATCH;</span>
                }
<span class="pc bpc" id="L2762" title="1 of 2 branches missed.">            } else if (ch == '[') {</span>
<span class="fc" id="L2763">                next();</span>
<span class="fc bfc" id="L2764" title="All 2 branches covered.">                if (deepScan) {</span>
<span class="fc" id="L2765">                    token = JSONToken.LBRACKET;</span>
<span class="fc" id="L2766">                    return ARRAY;</span>
                }
<span class="fc" id="L2768">                skipArray(false);</span>
<span class="pc bpc" id="L2769" title="1 of 2 branches missed.">                if (token == JSONToken.RBRACE) {</span>
<span class="nc" id="L2770">                    return JSONLexer.NOT_MATCH;</span>
                }
            } else {
<span class="nc" id="L2773">                throw new UnsupportedOperationException();</span>
            }
<span class="fc" id="L2775">        }</span>
    }

    public int seekObjectToField(long[] fieldNameHash) {
<span class="pc bpc" id="L2779" title="1 of 4 branches missed.">        if (token != JSONToken.LBRACE &amp;&amp; token != JSONToken.COMMA) {</span>
<span class="nc" id="L2780">            throw new UnsupportedOperationException();</span>
        }

        for (;;) {
<span class="pc bpc" id="L2784" title="1 of 2 branches missed.">            if (ch == '}') {</span>
<span class="nc" id="L2785">                next();</span>
<span class="nc" id="L2786">                nextToken();</span>
<span class="nc" id="L2787">                this.matchStat = JSONLexer.NOT_MATCH;</span>
<span class="nc" id="L2788">                return -1;</span>
            }
<span class="pc bpc" id="L2790" title="1 of 2 branches missed.">            if (ch == EOI) {</span>
<span class="nc" id="L2791">                this.matchStat = JSONLexer.NOT_MATCH;</span>
<span class="nc" id="L2792">                return -1;</span>
            }

<span class="pc bpc" id="L2795" title="1 of 2 branches missed.">            if (ch != '&quot;') {</span>
<span class="fc" id="L2796">                skipWhitespace();</span>
            }

            long hash;
<span class="pc bpc" id="L2800" title="1 of 2 branches missed.">            if (ch == '&quot;') {</span>
<span class="fc" id="L2801">                hash = 0xcbf29ce484222325L;</span>

<span class="pc bpc" id="L2803" title="1 of 2 branches missed.">                for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2804">                    char c = text.charAt(i);</span>
<span class="pc bpc" id="L2805" title="1 of 2 branches missed.">                    if (c == '\\') {</span>
<span class="nc" id="L2806">                        ++i;</span>
<span class="nc bnc" id="L2807" title="All 2 branches missed.">                        if (i == text.length()) {</span>
<span class="nc" id="L2808">                            throw new JSONException(&quot;unclosed str, &quot; + info());</span>
                        }
<span class="nc" id="L2810">                        c = text.charAt(i);</span>
                    }

<span class="fc bfc" id="L2813" title="All 2 branches covered.">                    if (c == '&quot;') {</span>
<span class="fc" id="L2814">                        bp = i + 1;</span>
<span class="pc bpc" id="L2815" title="1 of 2 branches missed.">                        ch = (bp &gt;= text.length() //</span>
                                ? EOI //
<span class="fc" id="L2817">                                : text.charAt(bp));</span>
<span class="fc" id="L2818">                        break;</span>
                    }

<span class="fc" id="L2821">                    hash ^= c;</span>
<span class="fc" id="L2822">                    hash *= 0x100000001b3L;</span>
                }
            } else {
<span class="nc" id="L2825">                throw new UnsupportedOperationException();</span>
            }

<span class="fc" id="L2828">            int matchIndex = -1;</span>
<span class="pc bpc" id="L2829" title="1 of 2 branches missed.">            for (int i = 0; i &lt; fieldNameHash.length; i++) {</span>
<span class="fc bfc" id="L2830" title="All 2 branches covered.">                if (hash == fieldNameHash[i]) {</span>
<span class="fc" id="L2831">                    matchIndex = i;</span>
<span class="fc" id="L2832">                    break;</span>
                }
            }

<span class="pc bpc" id="L2836" title="1 of 2 branches missed.">            if (matchIndex != -1) {</span>
<span class="pc bpc" id="L2837" title="1 of 2 branches missed.">                if (ch != ':') {</span>
<span class="fc" id="L2838">                    skipWhitespace();</span>
                }
<span class="pc bpc" id="L2840" title="1 of 2 branches missed.">                if (ch == ':') {</span>
                    {
<span class="fc" id="L2842">                        int index = ++bp;</span>
<span class="pc bpc" id="L2843" title="1 of 2 branches missed.">                        ch = (index &gt;= text.length() //</span>
                                ? EOI //
<span class="fc" id="L2845">                                : text.charAt(index));</span>
                    }
<span class="pc bpc" id="L2847" title="1 of 2 branches missed.">                    if (ch == ',') {</span>
                        {
<span class="nc" id="L2849">                            int index = ++bp;</span>
<span class="nc bnc" id="L2850" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2852">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2854">                        token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L2855" title="1 of 2 branches missed.">                    } else if (ch == ']') {</span>
                        {
<span class="nc" id="L2857">                            int index = ++bp;</span>
<span class="nc bnc" id="L2858" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2860">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2862">                        token = JSONToken.RBRACKET;</span>
<span class="pc bpc" id="L2863" title="1 of 2 branches missed.">                    } else if (ch == '}') {</span>
                        {
<span class="nc" id="L2865">                            int index = ++bp;</span>
<span class="nc bnc" id="L2866" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
                                    ? EOI //
<span class="nc" id="L2868">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2870">                        token = JSONToken.RBRACE;</span>
<span class="pc bpc" id="L2871" title="3 of 4 branches missed.">                    } else if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2872">                        sp = 0;</span>
<span class="nc" id="L2873">                        pos = bp;</span>
<span class="nc" id="L2874">                        scanNumber();</span>
                    } else {
<span class="fc" id="L2876">                        nextToken(JSONToken.LITERAL_INT);</span>
                    }
                }

<span class="fc" id="L2880">                matchStat = VALUE;</span>
<span class="fc" id="L2881">                return matchIndex;</span>
            }

<span class="nc bnc" id="L2884" title="All 2 branches missed.">            if (ch != ':') {</span>
<span class="nc" id="L2885">                skipWhitespace();</span>
            }

<span class="nc bnc" id="L2888" title="All 2 branches missed.">            if (ch == ':') {</span>
<span class="nc" id="L2889">                int index = ++bp;</span>
<span class="nc bnc" id="L2890" title="All 2 branches missed.">                ch = (index &gt;= text.length() //</span>
                        ? EOI //
<span class="nc" id="L2892">                        : text.charAt(index));</span>
<span class="nc" id="L2893">            } else {</span>
<span class="nc" id="L2894">                throw new JSONException(&quot;illegal json, &quot; + info());</span>
            }

<span class="nc bnc" id="L2897" title="All 32 branches missed.">            if (ch != '&quot;'</span>
                    &amp;&amp; ch != '\''
                    &amp;&amp; ch != '{'
                    &amp;&amp; ch != '['
                    &amp;&amp; ch != '0'
                    &amp;&amp; ch != '1'
                    &amp;&amp; ch != '2'
                    &amp;&amp; ch != '3'
                    &amp;&amp; ch != '4'
                    &amp;&amp; ch != '5'
                    &amp;&amp; ch != '6'
                    &amp;&amp; ch != '7'
                    &amp;&amp; ch != '8'
                    &amp;&amp; ch != '9'
                    &amp;&amp; ch != '+'
                    &amp;&amp; ch != '-') {
<span class="nc" id="L2913">                skipWhitespace();</span>
            }

            // skip fieldValues
<span class="nc bnc" id="L2917" title="All 8 branches missed.">            if (ch == '-' || ch == '+' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="nc" id="L2918">                next();</span>
<span class="nc bnc" id="L2919" title="All 4 branches missed.">                while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2920">                    next();</span>
                }

                // scale
<span class="nc bnc" id="L2924" title="All 2 branches missed.">                if (ch == '.') {</span>
<span class="nc" id="L2925">                    next();</span>
<span class="nc bnc" id="L2926" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2927">                        next();</span>
                    }
                }

                // exp
<span class="nc bnc" id="L2932" title="All 4 branches missed.">                if (ch == 'E' || ch == 'e') {</span>
<span class="nc" id="L2933">                    next();</span>
<span class="nc bnc" id="L2934" title="All 4 branches missed.">                    if (ch == '-' || ch == '+') {</span>
<span class="nc" id="L2935">                        next();</span>
                    }
<span class="nc bnc" id="L2937" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2938">                        next();</span>
                    }
                }

<span class="nc bnc" id="L2942" title="All 2 branches missed.">                if (ch != ',') {</span>
<span class="nc" id="L2943">                    skipWhitespace();</span>
                }
<span class="nc bnc" id="L2945" title="All 2 branches missed.">                if (ch == ',') {</span>
<span class="nc" id="L2946">                    next();</span>
                }
<span class="nc bnc" id="L2948" title="All 2 branches missed.">            } else if (ch == '&quot;') {</span>
<span class="nc" id="L2949">                skipString();</span>

<span class="nc bnc" id="L2951" title="All 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="nc" id="L2952">                    skipWhitespace();</span>
                }

<span class="nc bnc" id="L2955" title="All 2 branches missed.">                if (ch == ',') {</span>
<span class="nc" id="L2956">                    next();</span>
                }
<span class="nc bnc" id="L2958" title="All 2 branches missed.">            } else if (ch == '{') {</span>
                {
<span class="nc" id="L2960">                    int index = ++bp;</span>
<span class="nc bnc" id="L2961" title="All 2 branches missed.">                    ch = (index &gt;= text.length() //</span>
                            ? EOI //
<span class="nc" id="L2963">                            : text.charAt(index));</span>
                }

<span class="nc" id="L2966">                skipObject(false);</span>
<span class="nc bnc" id="L2967" title="All 2 branches missed.">            } else if (ch == '[') {</span>
<span class="nc" id="L2968">                next();</span>

<span class="nc" id="L2970">                skipArray(false);</span>
            } else {
<span class="nc" id="L2972">                throw new UnsupportedOperationException();</span>
            }
<span class="nc" id="L2974">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>