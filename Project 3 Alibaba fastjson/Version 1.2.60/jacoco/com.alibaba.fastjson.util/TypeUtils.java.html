<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.util</a> &gt; <span class="el_source">TypeUtils.java</span></div><h1>TypeUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.util;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.PropertyNamingStrategy;
import com.alibaba.fastjson.annotation.JSONField;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.parser.DefaultJSONParser;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONScanner;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.deserializer.EnumDeserializer;
import com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer;
import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;
import com.alibaba.fastjson.serializer.CalendarCodec;
import com.alibaba.fastjson.serializer.SerializeBeanInfo;
import com.alibaba.fastjson.serializer.SerializerFeature;

import java.lang.annotation.Annotation;
import java.lang.reflect.AccessibleObject;
import java.lang.reflect.Array;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.GenericArrayType;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Proxy;
import java.lang.reflect.Type;
import java.lang.reflect.TypeVariable;
import java.lang.reflect.WildcardType;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.security.AccessControlException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

/**
 * @author wenshao[szujobs@hotmail.com]
 */
<span class="fc" id="L60">public class TypeUtils{</span>

<span class="fc" id="L62">    public static boolean compatibleWithJavaBean = false;</span>
    /** 根据field name的大小写输出输入数据 */
<span class="fc" id="L64">    public static boolean compatibleWithFieldName = false;</span>
<span class="fc" id="L65">    private static boolean setAccessibleEnable = true;</span>
<span class="fc" id="L66">    private static boolean oracleTimestampMethodInited = false;</span>
    private static Method oracleTimestampMethod;
<span class="fc" id="L68">    private static boolean oracleDateMethodInited = false;</span>
    private static Method oracleDateMethod;
<span class="fc" id="L70">    private static boolean optionalClassInited = false;</span>
    private static Class&lt;?&gt; optionalClass;
<span class="fc" id="L72">    private static boolean transientClassInited = false;</span>
    private static Class&lt;? extends Annotation&gt; transientClass;

<span class="fc" id="L75">    private static Class&lt;? extends Annotation&gt; class_OneToMany = null;</span>
<span class="fc" id="L76">    private static boolean class_OneToMany_error = false;</span>
<span class="fc" id="L77">    private static Class&lt;? extends Annotation&gt; class_ManyToMany = null;</span>
<span class="fc" id="L78">    private static boolean class_ManyToMany_error = false;</span>

<span class="fc" id="L80">    private static Method method_HibernateIsInitialized = null;</span>
<span class="fc" id="L81">    private static boolean method_HibernateIsInitialized_error = false;</span>
    private static volatile Class kotlin_metadata;
    private static volatile boolean kotlin_metadata_error;
    private static volatile boolean kotlin_class_klass_error;
    private static volatile Constructor kotlin_kclass_constructor;
    private static volatile Method kotlin_kclass_getConstructors;
    private static volatile Method kotlin_kfunction_getParameters;
    private static volatile Method kotlin_kparameter_getName;
    private static volatile boolean kotlin_error;
    private static volatile Map&lt;Class,String[]&gt; kotlinIgnores;
    private static volatile boolean kotlinIgnores_error;
<span class="fc" id="L92">    private static ConcurrentMap&lt;String,Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String,Class&lt;?&gt;&gt;(256, 0.75f, 1);</span>
    private static Class&lt;?&gt; pathClass;
<span class="fc" id="L94">    private static boolean pathClass_error = false;</span>

<span class="fc" id="L96">    private static Class&lt;? extends Annotation&gt; class_JacksonCreator = null;</span>
<span class="fc" id="L97">    private static boolean class_JacksonCreator_error = false;</span>

<span class="fc" id="L99">    private static volatile Class class_Clob = null;</span>
<span class="fc" id="L100">    private static volatile boolean class_Clob_error = false;</span>

<span class="fc" id="L102">    private static volatile Class class_XmlAccessType = null;</span>
<span class="fc" id="L103">    private static volatile Class class_XmlAccessorType = null;</span>
<span class="fc" id="L104">    private static volatile boolean classXmlAccessorType_error = false;</span>
<span class="fc" id="L105">    private static volatile Method method_XmlAccessorType_value = null;</span>
<span class="fc" id="L106">    private static volatile Field field_XmlAccessType_FIELD = null;</span>
<span class="fc" id="L107">    private static volatile Object field_XmlAccessType_FIELD_VALUE = null;</span>

    static{
        try{
<span class="fc" id="L111">            TypeUtils.compatibleWithJavaBean = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHJAVABEAN));</span>
<span class="fc" id="L112">            TypeUtils.compatibleWithFieldName = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHFIELDNAME));</span>
<span class="nc" id="L113">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L115">        }</span>
    }

    static{
<span class="fc" id="L119">        addBaseClassMappings();</span>
<span class="fc" id="L120">    }</span>


    public static boolean isXmlField(Class clazz) {
<span class="pc bpc" id="L124" title="1 of 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L126">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="nc" id="L127">            } catch(Throwable ex){</span>
<span class="nc" id="L128">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L129">            }</span>
        }

<span class="pc bpc" id="L132" title="1 of 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L133">            return false;</span>
        }

<span class="fc" id="L136">        Annotation annotation = TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L138">            return false;</span>
        }

<span class="pc bpc" id="L141" title="1 of 4 branches missed.">        if (method_XmlAccessorType_value == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L143">                method_XmlAccessorType_value = class_XmlAccessorType.getMethod(&quot;value&quot;);</span>
<span class="nc" id="L144">            } catch(Throwable ex){</span>
<span class="nc" id="L145">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L146">            }</span>
        }

<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        if (method_XmlAccessorType_value == null) {</span>
<span class="nc" id="L150">            return false;</span>
        }

<span class="fc" id="L153">        Object value = null;</span>
<span class="pc bpc" id="L154" title="1 of 2 branches missed.">        if (!classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L156">                value = method_XmlAccessorType_value.invoke(annotation);</span>
<span class="nc" id="L157">            } catch (Throwable ex) {</span>
<span class="nc" id="L158">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L159">            }</span>
        }
<span class="pc bpc" id="L161" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L162">            return false;</span>
        }

<span class="pc bpc" id="L165" title="1 of 4 branches missed.">        if (class_XmlAccessType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L167">                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);</span>
<span class="fc" id="L168">                field_XmlAccessType_FIELD = class_XmlAccessType.getField(&quot;FIELD&quot;);</span>
<span class="fc" id="L169">                field_XmlAccessType_FIELD_VALUE = field_XmlAccessType_FIELD.get(null);</span>
<span class="nc" id="L170">            } catch(Throwable ex){</span>
<span class="nc" id="L171">                classXmlAccessorType_error = true;</span>
<span class="fc" id="L172">            }</span>
        }

<span class="pc bpc" id="L175" title="1 of 2 branches missed.">        return value == field_XmlAccessType_FIELD_VALUE;</span>
    }

    public static Annotation getXmlAccessorType(Class clazz) {
<span class="nc bnc" id="L179" title="All 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>

            try{
<span class="nc" id="L182">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="nc" id="L183">            } catch(Throwable ex){</span>
<span class="nc" id="L184">                classXmlAccessorType_error = true;</span>
<span class="nc" id="L185">            }</span>
        }

<span class="nc bnc" id="L188" title="All 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L189">            return null;</span>
        }

<span class="nc" id="L192">        return  TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
    }

//
//    public static boolean isXmlAccessType(Class clazz) {
//        if (class_XmlAccessType == null &amp;&amp; !class_XmlAccessType_error) {
//
//            try{
//                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);
//            } catch(Throwable ex){
//                class_XmlAccessType_error = true;
//            }
//        }
//
//        if (class_XmlAccessType == null) {
//            return false;
//        }
//
//        return  class_XmlAccessType.isAssignableFrom(clazz);
//    }

    public static boolean isClob(Class clazz) {
<span class="pc bpc" id="L214" title="1 of 4 branches missed.">        if (class_Clob == null &amp;&amp; !class_Clob_error) {</span>

            try{
<span class="fc" id="L217">                class_Clob = Class.forName(&quot;java.sql.Clob&quot;);</span>
<span class="nc" id="L218">            } catch(Throwable ex){</span>
<span class="nc" id="L219">                class_Clob_error = true;</span>
<span class="fc" id="L220">            }</span>
        }

<span class="pc bpc" id="L223" title="1 of 2 branches missed.">        if (class_Clob == null) {</span>
<span class="nc" id="L224">            return false;</span>
        }

<span class="fc" id="L227">        return  class_Clob.isAssignableFrom(clazz);</span>
    }

    public static String castToString(Object value){
<span class="fc bfc" id="L231" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L232">            return null;</span>
        }
<span class="fc" id="L234">        return value.toString();</span>
    }

    public static Byte castToByte(Object value){
<span class="fc bfc" id="L238" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L239">            return null;</span>
        }

<span class="pc bpc" id="L242" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L243">            return byteValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L246" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L247">            return ((Number) value).byteValue();</span>
        }

<span class="fc bfc" id="L250" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L251">            String strVal = (String) value;</span>
<span class="fc bfc" id="L252" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L253" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L254" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L255">                return null;</span>
            }
<span class="fc" id="L257">            return Byte.parseByte(strVal);</span>
        }
<span class="fc" id="L259">        throw new JSONException(&quot;can not cast to byte, value : &quot; + value);</span>
    }

    public static Character castToChar(Object value){
<span class="fc bfc" id="L263" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L264">            return null;</span>
        }
<span class="fc bfc" id="L266" title="All 2 branches covered.">        if(value instanceof Character){</span>
<span class="fc" id="L267">            return (Character) value;</span>
        }
<span class="fc bfc" id="L269" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L270">            String strVal = (String) value;</span>
<span class="fc bfc" id="L271" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L272">                return null;</span>
            }
<span class="fc bfc" id="L274" title="All 2 branches covered.">            if(strVal.length() != 1){</span>
<span class="fc" id="L275">                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
            }
<span class="fc" id="L277">            return strVal.charAt(0);</span>
        }
<span class="fc" id="L279">        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
    }

    public static Short castToShort(Object value){
<span class="fc bfc" id="L283" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L284">            return null;</span>
        }

<span class="pc bpc" id="L287" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L288">            return shortValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L291" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L292">            return ((Number) value).shortValue();</span>
        }

<span class="fc bfc" id="L295" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L296">            String strVal = (String) value;</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L298" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L300">                return null;</span>
            }
<span class="fc" id="L302">            return Short.parseShort(strVal);</span>
        }

<span class="fc" id="L305">        throw new JSONException(&quot;can not cast to short, value : &quot; + value);</span>
    }

    public static BigDecimal castToBigDecimal(Object value){
<span class="fc bfc" id="L309" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L310">            return null;</span>
        }
<span class="fc bfc" id="L312" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L313">            return (BigDecimal) value;</span>
        }
<span class="fc bfc" id="L315" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L316">            return new BigDecimal((BigInteger) value);</span>
        }
<span class="fc" id="L318">        String strVal = value.toString();</span>
<span class="fc bfc" id="L319" title="All 2 branches covered.">        if(strVal.length() == 0){</span>
<span class="fc" id="L320">            return null;</span>
        }
<span class="fc bfc" id="L322" title="All 4 branches covered.">        if(value instanceof Map &amp;&amp; ((Map) value).size() == 0){</span>
<span class="fc" id="L323">            return null;</span>
        }
<span class="fc" id="L325">        return new BigDecimal(strVal);</span>
    }

    public static BigInteger castToBigInteger(Object value){
<span class="fc bfc" id="L329" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L330">            return null;</span>
        }
<span class="fc bfc" id="L332" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L333">            return (BigInteger) value;</span>
        }
<span class="fc bfc" id="L335" title="All 4 branches covered.">        if(value instanceof Float || value instanceof Double){</span>
<span class="fc" id="L336">            return BigInteger.valueOf(((Number) value).longValue());</span>
        }
<span class="fc bfc" id="L338" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L339">            BigDecimal decimal = (BigDecimal) value;</span>
<span class="fc" id="L340">            int scale = decimal.scale();</span>
<span class="pc bpc" id="L341" title="1 of 4 branches missed.">            if (scale &gt; -1000 &amp;&amp; scale &lt; 1000) {</span>
<span class="fc" id="L342">                return ((BigDecimal) value).toBigInteger();</span>
            }
        }
<span class="fc" id="L345">        String strVal = value.toString();</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">        if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">                || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L348" title="1 of 2 branches missed.">                || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L349">            return null;</span>
        }
<span class="fc" id="L351">        return new BigInteger(strVal);</span>
    }

    public static Float castToFloat(Object value){
<span class="fc bfc" id="L355" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L356">            return null;</span>
        }
<span class="fc bfc" id="L358" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L359">            return ((Number) value).floatValue();</span>
        }
<span class="fc bfc" id="L361" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L362">            String strVal = value.toString();</span>
<span class="fc bfc" id="L363" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L364" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L366">                return null;</span>
            }
<span class="pc bpc" id="L368" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L369">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L371">            return Float.parseFloat(strVal);</span>
        }
<span class="fc" id="L373">        throw new JSONException(&quot;can not cast to float, value : &quot; + value);</span>
    }

    public static Double castToDouble(Object value){
<span class="fc bfc" id="L377" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L378">            return null;</span>
        }
<span class="fc bfc" id="L380" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L381">            return ((Number) value).doubleValue();</span>
        }
<span class="fc bfc" id="L383" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L384">            String strVal = value.toString();</span>
<span class="fc bfc" id="L385" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L386" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L387" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L388">                return null;</span>
            }
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L391">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L393">            return Double.parseDouble(strVal);</span>
        }
<span class="fc" id="L395">        throw new JSONException(&quot;can not cast to double, value : &quot; + value);</span>
    }

    public static Date castToDate(Object value){
<span class="fc" id="L399">        return castToDate(value, null);</span>
    }

    public static Date castToDate(Object value, String format){
<span class="fc bfc" id="L403" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L404">            return null;</span>
        }

<span class="fc bfc" id="L407" title="All 2 branches covered.">        if(value instanceof Date){ // 使用频率最高的，应优先处理</span>
<span class="fc" id="L408">            return (Date) value;</span>
        }

<span class="fc bfc" id="L411" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L412">            return ((Calendar) value).getTime();</span>
        }

<span class="fc" id="L415">        long longValue = -1;</span>

<span class="fc bfc" id="L417" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L418">            longValue = longValue((BigDecimal) value);</span>
<span class="nc" id="L419">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L422" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L423">            longValue = ((Number) value).longValue();</span>
<span class="fc bfc" id="L424" title="All 2 branches covered.">            if (&quot;unixtime&quot;.equals(format)) {</span>
<span class="fc" id="L425">                longValue *= 1000;</span>
            }
<span class="fc" id="L427">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L430" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L431">            String strVal = (String) value;</span>
<span class="fc" id="L432">            JSONScanner dateLexer = new JSONScanner(strVal);</span>
            try{
<span class="fc bfc" id="L434" title="All 2 branches covered.">                if(dateLexer.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L435">                    Calendar calendar = dateLexer.getCalendar();</span>
<span class="fc" id="L436">                    return calendar.getTime();</span>
                }
            } finally{
<span class="fc" id="L439">                dateLexer.close();</span>
            }

<span class="pc bpc" id="L442" title="1 of 4 branches missed.">            if (strVal.startsWith(&quot;/Date(&quot;) &amp;&amp; strVal.endsWith(&quot;)/&quot;)) {</span>
<span class="fc" id="L443">                strVal = strVal.substring(6, strVal.length() - 2);</span>
            }

<span class="fc bfc" id="L446" title="All 4 branches covered.">            if (strVal.indexOf('-') &gt; 0 || strVal.indexOf('+') &gt; 0) {</span>
<span class="fc bfc" id="L447" title="All 2 branches covered.">                if (format == null) {</span>
<span class="fc bfc" id="L448" title="All 2 branches covered.">                    if (strVal.length() == JSON.DEFFAULT_DATE_FORMAT.length()</span>
<span class="pc bpc" id="L449" title="1 of 4 branches missed.">                            || (strVal.length() == 22 &amp;&amp; JSON.DEFFAULT_DATE_FORMAT.equals(&quot;yyyyMMddHHmmssSSSZ&quot;))) {</span>
<span class="fc" id="L450">                        format = JSON.DEFFAULT_DATE_FORMAT;</span>
<span class="fc bfc" id="L451" title="All 2 branches covered.">                    } else if (strVal.length() == 10) {</span>
<span class="fc" id="L452">                        format = &quot;yyyy-MM-dd&quot;;</span>
<span class="pc bpc" id="L453" title="1 of 2 branches missed.">                    } else if (strVal.length() == &quot;yyyy-MM-dd HH:mm:ss&quot;.length()) {</span>
<span class="nc" id="L454">                        format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
<span class="pc bpc" id="L455" title="1 of 2 branches missed.">                    } else if (strVal.length() == 29</span>
<span class="nc bnc" id="L456" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(26) == ':'</span>
<span class="nc bnc" id="L457" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(28) == '0') {</span>
<span class="nc" id="L458">                        format = &quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;;</span>
<span class="pc bpc" id="L459" title="2 of 4 branches missed.">                    } else if (strVal.length() == 23 &amp;&amp; strVal.charAt(19) == ',') {</span>
<span class="fc" id="L460">                        format = &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;;</span>
                    } else {
<span class="nc" id="L462">                        format = &quot;yyyy-MM-dd HH:mm:ss.SSS&quot;;</span>
                    }
                }

<span class="fc" id="L466">                SimpleDateFormat dateFormat = new SimpleDateFormat(format, JSON.defaultLocale);</span>
<span class="fc" id="L467">                dateFormat.setTimeZone(JSON.defaultTimeZone);</span>
                try{
<span class="fc" id="L469">                    return dateFormat.parse(strVal);</span>
<span class="fc" id="L470">                } catch(ParseException e){</span>
<span class="fc" id="L471">                    throw new JSONException(&quot;can not cast to Date, value : &quot; + strVal);</span>
                }
            }
<span class="fc bfc" id="L474" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L475">                return null;</span>
            }
<span class="fc" id="L477">            longValue = Long.parseLong(strVal);</span>
        }

<span class="fc bfc" id="L480" title="All 2 branches covered.">        if (longValue == -1) {</span>
<span class="fc" id="L481">            Class&lt;?&gt; clazz = value.getClass();</span>
<span class="fc bfc" id="L482" title="All 2 branches covered.">            if(&quot;oracle.sql.TIMESTAMP&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L483" title="2 of 4 branches missed.">                if(oracleTimestampMethod == null &amp;&amp; !oracleTimestampMethodInited){</span>
                    try{
<span class="fc" id="L485">                        oracleTimestampMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L486">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L489">                        oracleTimestampMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L494">                    result = oracleTimestampMethod.invoke(value);</span>
<span class="nc" id="L495">                } catch(Exception e){</span>
<span class="nc" id="L496">                    throw new JSONException(&quot;can not cast oracle.sql.TIMESTAMP to Date&quot;, e);</span>
<span class="fc" id="L497">                }</span>
<span class="fc" id="L498">                return (Date) result;</span>
            }
<span class="fc bfc" id="L500" title="All 2 branches covered.">            if(&quot;oracle.sql.DATE&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L501" title="2 of 4 branches missed.">                if(oracleDateMethod == null &amp;&amp; !oracleDateMethodInited){</span>
                    try{
<span class="fc" id="L503">                        oracleDateMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L504">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L507">                        oracleDateMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L512">                    result = oracleDateMethod.invoke(value);</span>
<span class="nc" id="L513">                } catch(Exception e){</span>
<span class="nc" id="L514">                    throw new JSONException(&quot;can not cast oracle.sql.DATE to Date&quot;, e);</span>
<span class="fc" id="L515">                }</span>
<span class="fc" id="L516">                return (Date) result;</span>
            }

<span class="fc" id="L519">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value);</span>
        }

<span class="fc" id="L522">        return new Date(longValue);</span>
    }

    public static java.sql.Date castToSqlDate(Object value){
<span class="fc bfc" id="L526" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L527">            return null;</span>
        }
<span class="fc bfc" id="L529" title="All 2 branches covered.">        if(value instanceof java.sql.Date){</span>
<span class="fc" id="L530">            return (java.sql.Date) value;</span>
        }
<span class="fc bfc" id="L532" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L533">            return new java.sql.Date(((java.util.Date) value).getTime());</span>
        }
<span class="fc bfc" id="L535" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L536">            return new java.sql.Date(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L539">        long longValue = 0;</span>
<span class="fc bfc" id="L540" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L541">            longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L542" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L543">            longValue = ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L546" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L547">            String strVal = (String) value;</span>
<span class="fc bfc" id="L548" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L549" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L550" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L551">                return null;</span>
            }
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="fc" id="L554">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="nc" id="L556">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L557" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L558">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L560">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L564" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L565">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L567">        return new java.sql.Date(longValue);</span>
    }

    public static long longExtractValue(Number number) {
<span class="fc bfc" id="L571" title="All 2 branches covered.">        if (number instanceof BigDecimal) {</span>
<span class="fc" id="L572">            return ((BigDecimal) number).longValueExact();</span>
        }

<span class="fc" id="L575">        return number.longValue();</span>
    }

    public static java.sql.Time castToSqlTime(Object value){
<span class="pc bpc" id="L579" title="1 of 2 branches missed.">        if(value == null){</span>
<span class="nc" id="L580">            return null;</span>
        }
<span class="pc bpc" id="L582" title="1 of 2 branches missed.">        if(value instanceof java.sql.Time){</span>
<span class="nc" id="L583">            return (java.sql.Time) value;</span>
        }
<span class="pc bpc" id="L585" title="1 of 2 branches missed.">        if(value instanceof java.util.Date){</span>
<span class="nc" id="L586">            return new java.sql.Time(((java.util.Date) value).getTime());</span>
        }
<span class="pc bpc" id="L588" title="1 of 2 branches missed.">        if(value instanceof Calendar){</span>
<span class="nc" id="L589">            return new java.sql.Time(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L592">        long longValue = 0;</span>
<span class="fc bfc" id="L593" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L594">            longValue = longValue((BigDecimal) value);</span>
<span class="pc bpc" id="L595" title="1 of 2 branches missed.">        } else if(value instanceof Number){</span>
<span class="fc" id="L596">            longValue = ((Number) value).longValue();</span>
        }

<span class="pc bpc" id="L599" title="1 of 2 branches missed.">        if(value instanceof String){</span>
<span class="nc" id="L600">            String strVal = (String) value;</span>
<span class="nc bnc" id="L601" title="All 2 branches missed.">            if(strVal.length() == 0 //</span>
<span class="nc bnc" id="L602" title="All 2 branches missed.">                    || &quot;null&quot;.equalsIgnoreCase(strVal)){</span>
<span class="nc" id="L603">                return null;</span>
            }
<span class="nc bnc" id="L605" title="All 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="nc" id="L606">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="nc" id="L608">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L609" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L610">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L612">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="pc bpc" id="L616" title="1 of 2 branches missed.">        if(longValue &lt;= 0){</span>
<span class="nc" id="L617">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L619">        return new java.sql.Time(longValue);</span>
    }

    public static java.sql.Timestamp castToTimestamp(Object value){
<span class="fc bfc" id="L623" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L624">            return null;</span>
        }
<span class="fc bfc" id="L626" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L627">            return new java.sql.Timestamp(((Calendar) value).getTimeInMillis());</span>
        }
<span class="fc bfc" id="L629" title="All 2 branches covered.">        if(value instanceof java.sql.Timestamp){</span>
<span class="fc" id="L630">            return (java.sql.Timestamp) value;</span>
        }
<span class="fc bfc" id="L632" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L633">            return new java.sql.Timestamp(((java.util.Date) value).getTime());</span>
        }
<span class="fc" id="L635">        long longValue = 0;</span>
<span class="fc bfc" id="L636" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L637">            longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L638" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L639">            longValue = ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L641" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L642">            String strVal = (String) value;</span>
<span class="fc bfc" id="L643" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L644" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L645" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L646">                return null;</span>
            }
<span class="fc bfc" id="L648" title="All 2 branches covered.">            if(strVal.endsWith(&quot;.000000000&quot;)){</span>
<span class="fc" id="L649">                strVal = strVal.substring(0, strVal.length() - 10);</span>
<span class="fc bfc" id="L650" title="All 2 branches covered.">            } else if(strVal.endsWith(&quot;.000000&quot;)){</span>
<span class="fc" id="L651">                strVal = strVal.substring(0, strVal.length() - 7);</span>
            }
<span class="fc bfc" id="L653" title="All 2 branches covered.">            if(isNumber(strVal)){</span>
<span class="fc" id="L654">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="fc" id="L656">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="pc bpc" id="L657" title="1 of 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L658">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L660">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L664" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L665">            throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + value);</span>
        }
<span class="fc" id="L667">        return new java.sql.Timestamp(longValue);</span>
    }

    public static boolean isNumber(String str){
<span class="fc bfc" id="L671" title="All 2 branches covered.">        for(int i = 0; i &lt; str.length(); ++i){</span>
<span class="fc" id="L672">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L673" title="1 of 4 branches missed.">            if(ch == '+' || ch == '-'){</span>
<span class="fc bfc" id="L674" title="All 2 branches covered.">                if(i != 0){</span>
<span class="fc" id="L675">                    return false;</span>
                } 
<span class="fc bfc" id="L677" title="All 4 branches covered.">            } else if(ch &lt; '0' || ch &gt; '9'){</span>
<span class="fc" id="L678">                return false;</span>
            }
        }
<span class="fc" id="L681">        return true;</span>
    }

    public static Long castToLong(Object value){
<span class="fc bfc" id="L685" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L686">            return null;</span>
        }

<span class="pc bpc" id="L689" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L690">            return longValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L693" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L694">            return ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L697" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L698">            String strVal = (String) value;</span>
<span class="fc bfc" id="L699" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L700" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L701" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L702">                return null;</span>
            }
<span class="pc bpc" id="L704" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L705">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            try{
<span class="fc" id="L708">                return Long.parseLong(strVal);</span>
<span class="fc" id="L709">            } catch(NumberFormatException ex){</span>
                //
            }
<span class="fc" id="L712">            JSONScanner dateParser = new JSONScanner(strVal);</span>
<span class="fc" id="L713">            Calendar calendar = null;</span>
<span class="fc bfc" id="L714" title="All 2 branches covered.">            if(dateParser.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L715">                calendar = dateParser.getCalendar();</span>
            }
<span class="fc" id="L717">            dateParser.close();</span>
<span class="fc bfc" id="L718" title="All 2 branches covered.">            if(calendar != null){</span>
<span class="fc" id="L719">                return calendar.getTimeInMillis();</span>
            }
        }

<span class="fc bfc" id="L723" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L724">            Map map = (Map) value;</span>
<span class="fc bfc" id="L725" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L726" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L727" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L728">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L729">                iter.next();</span>
<span class="fc" id="L730">                Object value2 = iter.next();</span>
<span class="fc" id="L731">                return castToLong(value2);</span>
            }
        }
        
<span class="fc" id="L735">        throw new JSONException(&quot;can not cast to long, value : &quot; + value);</span>
    }

    public static byte byteValue(BigDecimal decimal) {
<span class="pc bpc" id="L739" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L740">            return 0;</span>
        }

<span class="fc" id="L743">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L744" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L745">            return decimal.byteValue();</span>
        }

<span class="nc" id="L748">        return decimal.byteValueExact();</span>
    }

    public static short shortValue(BigDecimal decimal) {
<span class="pc bpc" id="L752" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L753">            return 0;</span>
        }

<span class="fc" id="L756">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L757" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L758">            return decimal.shortValue();</span>
        }

<span class="nc" id="L761">        return decimal.shortValueExact();</span>
    }

    public static int intValue(BigDecimal decimal) {
<span class="pc bpc" id="L765" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L766">            return 0;</span>
        }

<span class="fc" id="L769">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L770" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L771">            return decimal.intValue();</span>
        }

<span class="nc" id="L774">        return decimal.intValueExact();</span>
    }

    public static long longValue(BigDecimal decimal) {
<span class="pc bpc" id="L778" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L779">            return 0;</span>
        }

<span class="fc" id="L782">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L783" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L784">            return decimal.longValue();</span>
        }

<span class="nc" id="L787">        return decimal.longValueExact();</span>
    }

    public static Integer castToInt(Object value){
<span class="fc bfc" id="L791" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L792">            return null;</span>
        }

<span class="fc bfc" id="L795" title="All 2 branches covered.">        if(value instanceof Integer){</span>
<span class="fc" id="L796">            return (Integer) value;</span>
        }

<span class="fc bfc" id="L799" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L800">            return intValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L803" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L804">            return ((Number) value).intValue();</span>
        }

<span class="fc bfc" id="L807" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L808">            String strVal = (String) value;</span>
<span class="fc bfc" id="L809" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L810" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L811" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L812">                return null;</span>
            }
<span class="pc bpc" id="L814" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L815">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L817">            return Integer.parseInt(strVal);</span>
        }

<span class="fc bfc" id="L820" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="pc bpc" id="L821" title="1 of 2 branches missed.">            return ((Boolean) value).booleanValue() ? 1 : 0;</span>
        }
<span class="fc bfc" id="L823" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L824">            Map map = (Map) value;</span>
<span class="fc bfc" id="L825" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L826" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L827" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L828">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L829">                iter.next();</span>
<span class="fc" id="L830">                Object value2 = iter.next();</span>
<span class="fc" id="L831">                return castToInt(value2);</span>
            }
        }
<span class="fc" id="L834">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static byte[] castToBytes(Object value){
<span class="fc bfc" id="L838" title="All 2 branches covered.">        if(value instanceof byte[]){</span>
<span class="fc" id="L839">            return (byte[]) value;</span>
        }
<span class="fc bfc" id="L841" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L842">            return IOUtils.decodeBase64((String) value);</span>
        }
<span class="fc" id="L844">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static Boolean castToBoolean(Object value){
<span class="fc bfc" id="L848" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L849">            return null;</span>
        }
<span class="fc bfc" id="L851" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="fc" id="L852">            return (Boolean) value;</span>
        }

<span class="fc bfc" id="L855" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc bnc" id="L856" title="All 2 branches missed.">            return intValue((BigDecimal) value) == 1;</span>
        }

<span class="fc bfc" id="L859" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc bfc" id="L860" title="All 2 branches covered.">            return ((Number) value).intValue() == 1;</span>
        }

<span class="fc bfc" id="L863" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L864">            String strVal = (String) value;</span>
<span class="fc bfc" id="L865" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L866" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L867" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L868">                return null;</span>
            }
<span class="fc bfc" id="L870" title="All 2 branches covered.">            if(&quot;true&quot;.equalsIgnoreCase(strVal) //</span>
<span class="pc bpc" id="L871" title="1 of 2 branches missed.">                    || &quot;1&quot;.equals(strVal)){</span>
<span class="fc" id="L872">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L874" title="All 2 branches covered.">            if(&quot;false&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L875" title="All 2 branches covered.">                    || &quot;0&quot;.equals(strVal)){</span>
<span class="fc" id="L876">                return Boolean.FALSE;</span>
            }
<span class="fc bfc" id="L878" title="All 2 branches covered.">            if(&quot;Y&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L879" title="All 2 branches covered.">                    || &quot;T&quot;.equals(strVal)){</span>
<span class="fc" id="L880">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L882" title="All 2 branches covered.">            if(&quot;F&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L883" title="All 2 branches covered.">                    || &quot;N&quot;.equals(strVal)){</span>
<span class="fc" id="L884">                return Boolean.FALSE;</span>
            }
        }
<span class="fc" id="L887">        throw new JSONException(&quot;can not cast to boolean, value : &quot; + value);</span>
    }

    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz){
<span class="fc" id="L891">        return cast(obj, clazz, ParserConfig.getGlobalInstance());</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T cast(Object obj, Class&lt;T&gt; clazz, ParserConfig config){
<span class="fc bfc" id="L896" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc bfc" id="L897" title="All 2 branches covered.">            if(clazz == int.class){</span>
<span class="fc" id="L898">                return (T) Integer.valueOf(0);</span>
<span class="fc bfc" id="L899" title="All 2 branches covered.">            } else if(clazz == long.class){</span>
<span class="fc" id="L900">                return (T) Long.valueOf(0);</span>
<span class="fc bfc" id="L901" title="All 2 branches covered.">            } else if(clazz == short.class){</span>
<span class="fc" id="L902">                return (T) Short.valueOf((short) 0);</span>
<span class="fc bfc" id="L903" title="All 2 branches covered.">            } else if(clazz == byte.class){</span>
<span class="fc" id="L904">                return (T) Byte.valueOf((byte) 0);</span>
<span class="fc bfc" id="L905" title="All 2 branches covered.">            } else if(clazz == float.class){</span>
<span class="fc" id="L906">                return (T) Float.valueOf(0);</span>
<span class="fc bfc" id="L907" title="All 2 branches covered.">            } else if(clazz == double.class){</span>
<span class="fc" id="L908">                return (T) Double.valueOf(0);</span>
<span class="fc bfc" id="L909" title="All 2 branches covered.">            } else if(clazz == boolean.class){</span>
<span class="fc" id="L910">                return (T) Boolean.FALSE;</span>
            }
<span class="fc" id="L912">            return null;</span>
        }

<span class="fc bfc" id="L915" title="All 2 branches covered.">        if(clazz == null){</span>
<span class="fc" id="L916">            throw new IllegalArgumentException(&quot;clazz is null&quot;);</span>
        }

<span class="fc bfc" id="L919" title="All 2 branches covered.">        if(clazz == obj.getClass()){</span>
<span class="fc" id="L920">            return (T) obj;</span>
        }

<span class="fc bfc" id="L923" title="All 2 branches covered.">        if(obj instanceof Map){</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">            if(clazz == Map.class){</span>
<span class="fc" id="L925">                return (T) obj;</span>
            }

<span class="fc" id="L928">            Map map = (Map) obj;</span>
<span class="fc bfc" id="L929" title="All 4 branches covered.">            if(clazz == Object.class &amp;&amp; !map.containsKey(JSON.DEFAULT_TYPE_KEY)){</span>
<span class="fc" id="L930">                return (T) obj;</span>
            }
<span class="fc" id="L932">            return castToJavaBean((Map&lt;String,Object&gt;) obj, clazz, config);</span>
        }

<span class="fc bfc" id="L935" title="All 2 branches covered.">        if(clazz.isArray()){</span>
<span class="fc bfc" id="L936" title="All 2 branches covered.">            if(obj instanceof Collection){</span>
<span class="fc" id="L937">                Collection collection = (Collection) obj;</span>
<span class="fc" id="L938">                int index = 0;</span>
<span class="fc" id="L939">                Object array = Array.newInstance(clazz.getComponentType(), collection.size());</span>
<span class="fc bfc" id="L940" title="All 2 branches covered.">                for(Object item : collection){</span>
<span class="fc" id="L941">                    Object value = cast(item, clazz.getComponentType(), config);</span>
<span class="fc" id="L942">                    Array.set(array, index, value);</span>
<span class="fc" id="L943">                    index++;</span>
<span class="fc" id="L944">                }</span>
<span class="fc" id="L945">                return (T) array;</span>
            }
<span class="fc bfc" id="L947" title="All 2 branches covered.">            if(clazz == byte[].class){</span>
<span class="fc" id="L948">                return (T) castToBytes(obj);</span>
            }
        }

<span class="fc bfc" id="L952" title="All 2 branches covered.">        if(clazz.isAssignableFrom(obj.getClass())){</span>
<span class="fc" id="L953">            return (T) obj;</span>
        }

<span class="fc bfc" id="L956" title="All 4 branches covered.">        if(clazz == boolean.class || clazz == Boolean.class){</span>
<span class="fc" id="L957">            return (T) castToBoolean(obj);</span>
        }

<span class="fc bfc" id="L960" title="All 4 branches covered.">        if(clazz == byte.class || clazz == Byte.class){</span>
<span class="fc" id="L961">            return (T) castToByte(obj);</span>
        }

<span class="fc bfc" id="L964" title="All 4 branches covered.">        if(clazz == char.class || clazz == Character.class){</span>
<span class="fc" id="L965">            return (T) castToChar(obj);</span>
        }

<span class="fc bfc" id="L968" title="All 4 branches covered.">        if(clazz == short.class || clazz == Short.class){</span>
<span class="fc" id="L969">            return (T) castToShort(obj);</span>
        }

<span class="fc bfc" id="L972" title="All 4 branches covered.">        if(clazz == int.class || clazz == Integer.class){</span>
<span class="fc" id="L973">            return (T) castToInt(obj);</span>
        }

<span class="fc bfc" id="L976" title="All 4 branches covered.">        if(clazz == long.class || clazz == Long.class){</span>
<span class="fc" id="L977">            return (T) castToLong(obj);</span>
        }

<span class="fc bfc" id="L980" title="All 4 branches covered.">        if(clazz == float.class || clazz == Float.class){</span>
<span class="fc" id="L981">            return (T) castToFloat(obj);</span>
        }

<span class="fc bfc" id="L984" title="All 4 branches covered.">        if(clazz == double.class || clazz == Double.class){</span>
<span class="fc" id="L985">            return (T) castToDouble(obj);</span>
        }

<span class="fc bfc" id="L988" title="All 2 branches covered.">        if(clazz == String.class){</span>
<span class="fc" id="L989">            return (T) castToString(obj);</span>
        }

<span class="fc bfc" id="L992" title="All 2 branches covered.">        if(clazz == BigDecimal.class){</span>
<span class="fc" id="L993">            return (T) castToBigDecimal(obj);</span>
        }

<span class="fc bfc" id="L996" title="All 2 branches covered.">        if(clazz == BigInteger.class){</span>
<span class="fc" id="L997">            return (T) castToBigInteger(obj);</span>
        }

<span class="fc bfc" id="L1000" title="All 2 branches covered.">        if(clazz == Date.class){</span>
<span class="fc" id="L1001">            return (T) castToDate(obj);</span>
        }

<span class="fc bfc" id="L1004" title="All 2 branches covered.">        if(clazz == java.sql.Date.class){</span>
<span class="fc" id="L1005">            return (T) castToSqlDate(obj);</span>
        }

<span class="fc bfc" id="L1008" title="All 2 branches covered.">        if(clazz == java.sql.Time.class){</span>
<span class="fc" id="L1009">            return (T) castToSqlTime(obj);</span>
        }

<span class="fc bfc" id="L1012" title="All 2 branches covered.">        if(clazz == java.sql.Timestamp.class){</span>
<span class="fc" id="L1013">            return (T) castToTimestamp(obj);</span>
        }

<span class="fc bfc" id="L1016" title="All 2 branches covered.">        if(clazz.isEnum()){</span>
<span class="fc" id="L1017">            return castToEnum(obj, clazz, config);</span>
        }

<span class="fc bfc" id="L1020" title="All 2 branches covered.">        if(Calendar.class.isAssignableFrom(clazz)){</span>
<span class="fc" id="L1021">            Date date = castToDate(obj);</span>
            Calendar calendar;
<span class="fc bfc" id="L1023" title="All 2 branches covered.">            if(clazz == Calendar.class){</span>
<span class="fc" id="L1024">                calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
            } else{
                try{
<span class="fc" id="L1027">                    calendar = (Calendar) clazz.newInstance();</span>
<span class="fc" id="L1028">                } catch(Exception e){</span>
<span class="fc" id="L1029">                    throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), e);</span>
<span class="fc" id="L1030">                }</span>
            }
<span class="fc" id="L1032">            calendar.setTime(date);</span>
<span class="fc" id="L1033">            return (T) calendar;</span>
        }

<span class="fc" id="L1036">        String className = clazz.getName();</span>
<span class="fc bfc" id="L1037" title="All 2 branches covered.">        if(className.equals(&quot;javax.xml.datatype.XMLGregorianCalendar&quot;)){</span>
<span class="fc" id="L1038">            Date date = castToDate(obj);</span>
<span class="fc" id="L1039">            Calendar calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L1040">            calendar.setTime(date);</span>
<span class="fc" id="L1041">            return (T) CalendarCodec.instance.createXMLGregorianCalendar(calendar);</span>
        }

<span class="fc bfc" id="L1044" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L1045">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1046" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L1047" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1048" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L1049">                return null;</span>
            }

<span class="fc bfc" id="L1052" title="All 2 branches covered.">            if(clazz == java.util.Currency.class){</span>
<span class="fc" id="L1053">                return (T) java.util.Currency.getInstance(strVal);</span>
            }

<span class="fc bfc" id="L1056" title="All 2 branches covered.">            if(clazz == java.util.Locale.class){</span>
<span class="fc" id="L1057">                return (T) toLocale(strVal);</span>
            }

<span class="fc bfc" id="L1060" title="All 2 branches covered.">            if (className.startsWith(&quot;java.time.&quot;)) {</span>
<span class="fc" id="L1061">                String json = JSON.toJSONString(strVal);</span>
<span class="fc" id="L1062">                return JSON.parseObject(json, clazz);</span>
            }
        }

<span class="fc" id="L1066">        final ObjectDeserializer objectDeserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1067" title="All 2 branches covered.">        if (objectDeserializer != null) {</span>
<span class="fc" id="L1068">            String str = JSON.toJSONString(obj);</span>
<span class="nc" id="L1069">            return JSON.parseObject(str, clazz);</span>
        }
<span class="fc" id="L1071">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    public static Locale toLocale(String strVal){
<span class="fc" id="L1075">        String[] items = strVal.split(&quot;_&quot;);</span>
<span class="fc bfc" id="L1076" title="All 2 branches covered.">        if(items.length == 1){</span>
<span class="fc" id="L1077">            return new Locale(items[0]);</span>
        }
<span class="fc bfc" id="L1079" title="All 2 branches covered.">        if(items.length == 2){</span>
<span class="fc" id="L1080">            return new Locale(items[0], items[1]);</span>
        }
<span class="fc" id="L1082">        return new Locale(items[0], items[1], items[2]);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T castToEnum(Object obj, Class&lt;T&gt; clazz, ParserConfig mapping){
        try{
<span class="fc bfc" id="L1088" title="All 2 branches covered.">            if(obj instanceof String){</span>
<span class="fc" id="L1089">                String name = (String) obj;</span>
<span class="fc bfc" id="L1090" title="All 2 branches covered.">                if(name.length() == 0){</span>
<span class="fc" id="L1091">                    return null;</span>
                }

<span class="fc bfc" id="L1094" title="All 2 branches covered.">                if (mapping == null) {</span>
<span class="fc" id="L1095">                    mapping = ParserConfig.getGlobalInstance();</span>
                }

<span class="fc" id="L1098">                ObjectDeserializer deserializer = mapping.getDeserializer(clazz);</span>
<span class="pc bpc" id="L1099" title="1 of 2 branches missed.">                if (deserializer instanceof EnumDeserializer) {</span>
<span class="fc" id="L1100">                    EnumDeserializer enumDeserializer = (EnumDeserializer) deserializer;</span>
<span class="fc" id="L1101">                    return (T) enumDeserializer.getEnumByHashCode(TypeUtils.fnv1a_64(name));</span>
                }

<span class="nc" id="L1104">                return (T) Enum.valueOf((Class&lt;? extends Enum&gt;) clazz, name);</span>
            }

<span class="fc bfc" id="L1107" title="All 2 branches covered.">            if(obj instanceof BigDecimal){</span>
<span class="nc" id="L1108">                int ordinal = intValue((BigDecimal) obj);</span>
<span class="nc" id="L1109">                Object[] values = clazz.getEnumConstants();</span>
<span class="nc bnc" id="L1110" title="All 2 branches missed.">                if(ordinal &lt; values.length){</span>
<span class="nc" id="L1111">                    return (T) values[ordinal];</span>
                }
            }

<span class="fc bfc" id="L1115" title="All 2 branches covered.">            if(obj instanceof Number){</span>
<span class="fc" id="L1116">                int ordinal = ((Number) obj).intValue();</span>
<span class="fc" id="L1117">                Object[] values = clazz.getEnumConstants();</span>
<span class="fc bfc" id="L1118" title="All 2 branches covered.">                if(ordinal &lt; values.length){</span>
<span class="fc" id="L1119">                    return (T) values[ordinal];</span>
                }
            }
<span class="fc" id="L1122">        } catch(Exception ex){</span>
<span class="fc" id="L1123">            throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), ex);</span>
<span class="fc" id="L1124">        }</span>
<span class="fc" id="L1125">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping){
<span class="fc bfc" id="L1130" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc" id="L1131">            return null;</span>
        }
<span class="fc bfc" id="L1133" title="All 2 branches covered.">        if(type instanceof Class){</span>
<span class="fc" id="L1134">            return cast(obj, (Class&lt;T&gt;) type, mapping);</span>
        }
<span class="fc bfc" id="L1136" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1137">            return (T) cast(obj, (ParameterizedType) type, mapping);</span>
        }
<span class="pc bpc" id="L1139" title="1 of 2 branches missed.">        if(obj instanceof String){</span>
<span class="fc" id="L1140">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1141" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L1142" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1143" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L1144">                return null;</span>
            }
        }
<span class="fc bfc" id="L1147" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L1148">            return (T) obj;</span>
        }
<span class="fc" id="L1150">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping){
<span class="fc" id="L1155">        Type rawTye = type.getRawType();</span>

<span class="fc bfc" id="L1157" title="All 4 branches covered.">        if(rawTye == List.class || rawTye == ArrayList.class){</span>
<span class="fc" id="L1158">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1159" title="All 2 branches covered.">            if(obj instanceof List){</span>
<span class="fc" id="L1160">                List listObj = (List) obj;</span>
<span class="fc" id="L1161">                List arrayList = new ArrayList(listObj.size());</span>

<span class="fc bfc" id="L1163" title="All 2 branches covered.">                for (int i = 0; i &lt; listObj.size(); i++) {</span>
<span class="fc" id="L1164">                    Object item = listObj.get(i);</span>

                    Object itemValue;
<span class="pc bpc" id="L1167" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1168" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1169">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
                        } else {
<span class="fc" id="L1171">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
                    } else {
<span class="nc" id="L1174">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1177">                    arrayList.add(itemValue);</span>
                }
<span class="fc" id="L1179">                return (T) arrayList;</span>
            }
        }

<span class="fc bfc" id="L1183" title="All 12 branches covered.">        if(rawTye == Set.class || rawTye == HashSet.class //</span>
                || rawTye == TreeSet.class //
                || rawTye == Collection.class //
                || rawTye == List.class //
                || rawTye == ArrayList.class){
<span class="fc" id="L1188">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1189" title="All 2 branches covered.">            if(obj instanceof Iterable){</span>
                Collection collection;
<span class="fc bfc" id="L1191" title="All 4 branches covered.">                if(rawTye == Set.class || rawTye == HashSet.class){</span>
<span class="fc" id="L1192">                    collection = new HashSet();</span>
<span class="fc bfc" id="L1193" title="All 2 branches covered.">                } else if(rawTye == TreeSet.class){</span>
<span class="fc" id="L1194">                    collection = new TreeSet();</span>
                } else{
<span class="fc" id="L1196">                    collection = new ArrayList();</span>
                }
<span class="fc bfc" id="L1198" title="All 2 branches covered.">                for(Iterator it = ((Iterable) obj).iterator(); it.hasNext(); ){</span>
<span class="fc" id="L1199">                    Object item = it.next();</span>

                    Object itemValue;
<span class="pc bpc" id="L1202" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1203" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1204">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
                        } else {
<span class="fc" id="L1206">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
                    } else {
<span class="nc" id="L1209">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1212">                    collection.add(itemValue);</span>
<span class="fc" id="L1213">                }</span>
<span class="fc" id="L1214">                return (T) collection;</span>
            }
        }

<span class="fc bfc" id="L1218" title="All 4 branches covered.">        if(rawTye == Map.class || rawTye == HashMap.class){</span>
<span class="fc" id="L1219">            Type keyType = type.getActualTypeArguments()[0];</span>
<span class="fc" id="L1220">            Type valueType = type.getActualTypeArguments()[1];</span>
<span class="fc bfc" id="L1221" title="All 2 branches covered.">            if(obj instanceof Map){</span>
<span class="fc" id="L1222">                Map map = new HashMap();</span>
<span class="fc bfc" id="L1223" title="All 2 branches covered.">                for(Map.Entry entry : ((Map&lt;?,?&gt;) obj).entrySet()){</span>
<span class="fc" id="L1224">                    Object key = cast(entry.getKey(), keyType, mapping);</span>
<span class="fc" id="L1225">                    Object value = cast(entry.getValue(), valueType, mapping);</span>
<span class="fc" id="L1226">                    map.put(key, value);</span>
<span class="fc" id="L1227">                }</span>
<span class="fc" id="L1228">                return (T) map;</span>
            }
        }
<span class="fc bfc" id="L1231" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L1232">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1233" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L1234">                return null;</span>
            }
        }
<span class="fc bfc" id="L1237" title="All 2 branches covered.">        if(type.getActualTypeArguments().length == 1){</span>
<span class="fc" id="L1238">            Type argType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1239" title="All 2 branches covered.">            if(argType instanceof WildcardType){</span>
<span class="fc" id="L1240">                return (T) cast(obj, rawTye, mapping);</span>
            }
        }

<span class="pc bpc" id="L1244" title="2 of 6 branches missed.">        if (rawTye == Map.Entry.class &amp;&amp; obj instanceof Map &amp;&amp; ((Map) obj).size() == 1) {</span>
<span class="fc" id="L1245">            Map.Entry entry = (Map.Entry) ((Map) obj).entrySet().iterator().next();</span>
<span class="fc" id="L1246">            return (T) entry;</span>
        }

<span class="pc bpc" id="L1249" title="1 of 2 branches missed.">        if (rawTye instanceof Class) {</span>
<span class="fc bfc" id="L1250" title="All 2 branches covered.">            if (mapping == null) {</span>
<span class="fc" id="L1251">                mapping = ParserConfig.global;</span>
            }
<span class="fc" id="L1253">            ObjectDeserializer deserializer = mapping.getDeserializer(rawTye);</span>
<span class="pc bpc" id="L1254" title="1 of 2 branches missed.">            if (deserializer != null) {</span>
<span class="fc" id="L1255">                String str = JSON.toJSONString(obj);</span>
<span class="fc" id="L1256">                DefaultJSONParser parser = new DefaultJSONParser(str, mapping);</span>
<span class="fc" id="L1257">                return (T) deserializer.deserialze(parser, type, null);</span>
            }
        }

<span class="nc" id="L1261">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;})
    public static &lt;T&gt; T castToJavaBean(Map&lt;String,Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config){
        try{
<span class="fc bfc" id="L1267" title="All 2 branches covered.">            if(clazz == StackTraceElement.class){</span>
<span class="fc" id="L1268">                String declaringClass = (String) map.get(&quot;className&quot;);</span>
<span class="fc" id="L1269">                String methodName = (String) map.get(&quot;methodName&quot;);</span>
<span class="fc" id="L1270">                String fileName = (String) map.get(&quot;fileName&quot;);</span>
                int lineNumber;
                {
<span class="fc" id="L1273">                    Number value = (Number) map.get(&quot;lineNumber&quot;);</span>
<span class="fc bfc" id="L1274" title="All 2 branches covered.">                    if(value == null) {</span>
<span class="fc" id="L1275">                        lineNumber = 0;</span>
<span class="fc bfc" id="L1276" title="All 2 branches covered.">                    } else if (value instanceof BigDecimal) {</span>
<span class="nc" id="L1277">                        lineNumber = ((BigDecimal) value).intValueExact();</span>
                    } else{
<span class="fc" id="L1279">                        lineNumber = value.intValue();</span>
                    }
                }
<span class="fc" id="L1282">                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</span>
            }

            {
<span class="fc" id="L1286">                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</span>
<span class="fc bfc" id="L1287" title="All 2 branches covered.">                if(iClassObject instanceof String){</span>
<span class="fc" id="L1288">                    String className = (String) iClassObject;</span>
                    Class&lt;?&gt; loadClazz;
<span class="fc bfc" id="L1290" title="All 2 branches covered.">                    if(config == null){</span>
<span class="fc" id="L1291">                        config = ParserConfig.global;</span>
                    }
<span class="fc" id="L1293">                    loadClazz = config.checkAutoType(className, null);</span>
<span class="pc bpc" id="L1294" title="1 of 2 branches missed.">                    if(loadClazz == null){</span>
<span class="nc" id="L1295">                        throw new ClassNotFoundException(className + &quot; not found&quot;);</span>
                    }
<span class="fc bfc" id="L1297" title="All 2 branches covered.">                    if(!loadClazz.equals(clazz)){</span>
<span class="fc" id="L1298">                        return (T) castToJavaBean(map, loadClazz, config);</span>
                    }
                }
            }

<span class="fc bfc" id="L1303" title="All 2 branches covered.">            if(clazz.isInterface()){</span>
                JSONObject object;
<span class="fc bfc" id="L1305" title="All 2 branches covered.">                if(map instanceof JSONObject){</span>
<span class="fc" id="L1306">                    object = (JSONObject) map;</span>
                } else{
<span class="fc" id="L1308">                    object = new JSONObject(map);</span>
                }
<span class="fc bfc" id="L1310" title="All 2 branches covered.">                if(config == null){</span>
<span class="fc" id="L1311">                    config = ParserConfig.getGlobalInstance();</span>
                }
<span class="fc" id="L1313">                ObjectDeserializer deserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1314" title="All 2 branches covered.">                if(deserializer != null){</span>
<span class="fc" id="L1315">                    String json = JSON.toJSONString(object);</span>
<span class="fc" id="L1316">                    return JSON.parseObject(json, clazz);</span>
                }
<span class="fc" id="L1318">                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span>
                        new Class&lt;?&gt;[]{clazz}, object);
            }

<span class="fc bfc" id="L1322" title="All 2 branches covered.">            if(clazz == Locale.class){</span>
<span class="fc" id="L1323">                Object arg0 = map.get(&quot;language&quot;);</span>
<span class="fc" id="L1324">                Object arg1 = map.get(&quot;country&quot;);</span>
<span class="pc bpc" id="L1325" title="1 of 2 branches missed.">                if(arg0 instanceof String){</span>
<span class="fc" id="L1326">                    String language = (String) arg0;</span>
<span class="pc bpc" id="L1327" title="1 of 2 branches missed.">                    if(arg1 instanceof String){</span>
<span class="fc" id="L1328">                        String country = (String) arg1;</span>
<span class="fc" id="L1329">                        return (T) new Locale(language, country);</span>
<span class="nc bnc" id="L1330" title="All 2 branches missed.">                    } else if(arg1 == null){</span>
<span class="nc" id="L1331">                        return (T) new Locale(language);</span>
                    }
                }
            }

<span class="pc bpc" id="L1336" title="1 of 4 branches missed.">            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1337">                return (T) map.toString();</span>
            }

<span class="pc bpc" id="L1340" title="1 of 4 branches missed.">            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1341">                JSONObject jsonObject = (JSONObject) map;</span>
<span class="fc" id="L1342">                Map innerMap = jsonObject.getInnerMap();</span>
<span class="pc bpc" id="L1343" title="1 of 2 branches missed.">                if (innerMap instanceof LinkedHashMap) {</span>
<span class="fc" id="L1344">                    return (T) innerMap;</span>
                } else {
<span class="nc" id="L1346">                    LinkedHashMap linkedHashMap = new LinkedHashMap();</span>
<span class="nc" id="L1347">                    linkedHashMap.putAll(innerMap);</span>
                }
            }

<span class="fc bfc" id="L1351" title="All 2 branches covered.">            if (config == null) {</span>
<span class="fc" id="L1352">                config = ParserConfig.getGlobalInstance();</span>
            }

<span class="fc" id="L1355">            JavaBeanDeserializer javaBeanDeser = null;</span>
<span class="fc" id="L1356">            ObjectDeserializer deserializer = config.getDeserializer(clazz);</span>
<span class="fc bfc" id="L1357" title="All 2 branches covered.">            if (deserializer instanceof JavaBeanDeserializer) {</span>
<span class="fc" id="L1358">                javaBeanDeser = (JavaBeanDeserializer) deserializer;</span>
            }

<span class="fc bfc" id="L1361" title="All 2 branches covered.">            if(javaBeanDeser == null){</span>
<span class="fc" id="L1362">                throw new JSONException(&quot;can not get javaBeanDeserializer. &quot; + clazz.getName());</span>
            }
<span class="fc" id="L1364">            return (T) javaBeanDeser.createInstance(map, config);</span>
<span class="fc" id="L1365">        } catch(Exception e){</span>
<span class="fc" id="L1366">            throw new JSONException(e.getMessage(), e);</span>
        }
    }

    private static void addBaseClassMappings(){
<span class="fc" id="L1371">        mappings.put(&quot;byte&quot;, byte.class);</span>
<span class="fc" id="L1372">        mappings.put(&quot;short&quot;, short.class);</span>
<span class="fc" id="L1373">        mappings.put(&quot;int&quot;, int.class);</span>
<span class="fc" id="L1374">        mappings.put(&quot;long&quot;, long.class);</span>
<span class="fc" id="L1375">        mappings.put(&quot;float&quot;, float.class);</span>
<span class="fc" id="L1376">        mappings.put(&quot;double&quot;, double.class);</span>
<span class="fc" id="L1377">        mappings.put(&quot;boolean&quot;, boolean.class);</span>
<span class="fc" id="L1378">        mappings.put(&quot;char&quot;, char.class);</span>
<span class="fc" id="L1379">        mappings.put(&quot;[byte&quot;, byte[].class);</span>
<span class="fc" id="L1380">        mappings.put(&quot;[short&quot;, short[].class);</span>
<span class="fc" id="L1381">        mappings.put(&quot;[int&quot;, int[].class);</span>
<span class="fc" id="L1382">        mappings.put(&quot;[long&quot;, long[].class);</span>
<span class="fc" id="L1383">        mappings.put(&quot;[float&quot;, float[].class);</span>
<span class="fc" id="L1384">        mappings.put(&quot;[double&quot;, double[].class);</span>
<span class="fc" id="L1385">        mappings.put(&quot;[boolean&quot;, boolean[].class);</span>
<span class="fc" id="L1386">        mappings.put(&quot;[char&quot;, char[].class);</span>
<span class="fc" id="L1387">        mappings.put(&quot;[B&quot;, byte[].class);</span>
<span class="fc" id="L1388">        mappings.put(&quot;[S&quot;, short[].class);</span>
<span class="fc" id="L1389">        mappings.put(&quot;[I&quot;, int[].class);</span>
<span class="fc" id="L1390">        mappings.put(&quot;[J&quot;, long[].class);</span>
<span class="fc" id="L1391">        mappings.put(&quot;[F&quot;, float[].class);</span>
<span class="fc" id="L1392">        mappings.put(&quot;[D&quot;, double[].class);</span>
<span class="fc" id="L1393">        mappings.put(&quot;[C&quot;, char[].class);</span>
<span class="fc" id="L1394">        mappings.put(&quot;[Z&quot;, boolean[].class);</span>
<span class="fc" id="L1395">        Class&lt;?&gt;[] classes = new Class[]{</span>
                Object.class,
                java.lang.Cloneable.class,
<span class="fc" id="L1398">                loadClass(&quot;java.lang.AutoCloseable&quot;),</span>
                java.lang.Exception.class,
                java.lang.RuntimeException.class,
                java.lang.IllegalAccessError.class,
                java.lang.IllegalAccessException.class,
                java.lang.IllegalArgumentException.class,
                java.lang.IllegalMonitorStateException.class,
                java.lang.IllegalStateException.class,
                java.lang.IllegalThreadStateException.class,
                java.lang.IndexOutOfBoundsException.class,
                java.lang.InstantiationError.class,
                java.lang.InstantiationException.class,
                java.lang.InternalError.class,
                java.lang.InterruptedException.class,
                java.lang.LinkageError.class,
                java.lang.NegativeArraySizeException.class,
                java.lang.NoClassDefFoundError.class,
                java.lang.NoSuchFieldError.class,
                java.lang.NoSuchFieldException.class,
                java.lang.NoSuchMethodError.class,
                java.lang.NoSuchMethodException.class,
                java.lang.NullPointerException.class,
                java.lang.NumberFormatException.class,
                java.lang.OutOfMemoryError.class,
                java.lang.SecurityException.class,
                java.lang.StackOverflowError.class,
                java.lang.StringIndexOutOfBoundsException.class,
                java.lang.TypeNotPresentException.class,
                java.lang.VerifyError.class,
                java.lang.StackTraceElement.class,
                java.util.HashMap.class,
                java.util.Hashtable.class,
                java.util.TreeMap.class,
                java.util.IdentityHashMap.class,
                java.util.WeakHashMap.class,
                java.util.LinkedHashMap.class,
                java.util.HashSet.class,
                java.util.LinkedHashSet.class,
                java.util.TreeSet.class,
                java.util.ArrayList.class,
                java.util.concurrent.TimeUnit.class,
                java.util.concurrent.ConcurrentHashMap.class,
<span class="fc" id="L1440">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListMap&quot;),</span>
<span class="fc" id="L1441">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListSet&quot;),</span>
                java.util.concurrent.atomic.AtomicInteger.class,
                java.util.concurrent.atomic.AtomicLong.class,
<span class="fc" id="L1444">                java.util.Collections.EMPTY_MAP.getClass(),</span>
                java.lang.Boolean.class,
                java.lang.Character.class,
                java.lang.Byte.class,
                java.lang.Short.class,
                java.lang.Integer.class,
                java.lang.Long.class,
                java.lang.Float.class,
                java.lang.Double.class,
                java.lang.Number.class,
                java.lang.String.class,
                java.math.BigDecimal.class,
                java.math.BigInteger.class,
                java.util.BitSet.class,
                java.util.Calendar.class,
                java.util.Date.class,
                java.util.Locale.class,
                java.util.UUID.class,
                java.sql.Time.class,
                java.sql.Date.class,
                java.sql.Timestamp.class,
                java.text.SimpleDateFormat.class,
                com.alibaba.fastjson.JSONObject.class,
                com.alibaba.fastjson.JSONPObject.class,
                com.alibaba.fastjson.JSONArray.class,
        };
<span class="fc bfc" id="L1470" title="All 2 branches covered.">        for(Class clazz : classes){</span>
<span class="pc bpc" id="L1471" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1472">                continue;</span>
            }
<span class="fc" id="L1474">            mappings.put(clazz.getName(), clazz);</span>
        }

<span class="fc" id="L1477">        String[] w = new String[]{</span>
                &quot;java.util.Collections$UnmodifiableMap&quot;
        };
<span class="fc bfc" id="L1480" title="All 2 branches covered.">        for(String className : w){</span>
<span class="fc" id="L1481">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1482" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1483">                break;</span>
            }
<span class="fc" id="L1485">            mappings.put(clazz.getName(), clazz);</span>
        }

<span class="fc" id="L1488">        String[] awt = new String[]{</span>
                &quot;java.awt.Rectangle&quot;,
                &quot;java.awt.Point&quot;,
                &quot;java.awt.Font&quot;,
                &quot;java.awt.Color&quot;};
<span class="fc bfc" id="L1493" title="All 2 branches covered.">        for(String className : awt){</span>
<span class="fc" id="L1494">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1495" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1496">                break;</span>
            }
<span class="fc" id="L1498">            mappings.put(clazz.getName(), clazz);</span>
        }

<span class="fc" id="L1501">        String[] spring = new String[]{</span>
                &quot;org.springframework.util.LinkedMultiValueMap&quot;,
                &quot;org.springframework.util.LinkedCaseInsensitiveMap&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocation&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocationResult&quot;,
                &quot;org.springframework.security.web.savedrequest.DefaultSavedRequest&quot;,
                &quot;org.springframework.security.web.savedrequest.SavedCookie&quot;,
                &quot;org.springframework.security.web.csrf.DefaultCsrfToken&quot;,
                &quot;org.springframework.security.web.authentication.WebAuthenticationDetails&quot;,
                &quot;org.springframework.security.core.context.SecurityContextImpl&quot;,
                &quot;org.springframework.security.authentication.UsernamePasswordAuthenticationToken&quot;,
                &quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,
                &quot;org.springframework.security.core.userdetails.User&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultExpiringOAuth2RefreshToken&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultOAuth2AccessToken&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultOAuth2RefreshToken&quot;,
                &quot;org.springframework.cache.support.NullValue&quot;,
        };
<span class="fc bfc" id="L1519" title="All 2 branches covered.">        for(String className : spring){</span>
<span class="fc" id="L1520">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1521" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1522">                continue;</span>
            }
<span class="fc" id="L1524">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1526">    }</span>

    public static void clearClassMapping(){
<span class="fc" id="L1529">        mappings.clear();</span>
<span class="fc" id="L1530">        addBaseClassMappings();</span>
<span class="fc" id="L1531">    }</span>

    public static void addMapping(String className, Class&lt;?&gt; clazz) {
<span class="fc" id="L1534">        mappings.put(className, clazz);</span>
<span class="fc" id="L1535">    }</span>

    public static Class&lt;?&gt; loadClass(String className){
<span class="fc" id="L1538">        return loadClass(className, null);</span>
    }

    public static boolean isPath(Class&lt;?&gt; clazz){
<span class="pc bpc" id="L1542" title="1 of 4 branches missed.">        if(pathClass == null &amp;&amp; !pathClass_error){</span>
            try{
<span class="fc" id="L1544">                pathClass = Class.forName(&quot;java.nio.file.Path&quot;);</span>
<span class="nc" id="L1545">            } catch(Throwable ex){</span>
<span class="nc" id="L1546">                pathClass_error = true;</span>
<span class="fc" id="L1547">            }</span>
        }
<span class="pc bpc" id="L1549" title="1 of 2 branches missed.">        if(pathClass != null){</span>
<span class="fc" id="L1550">            return pathClass.isAssignableFrom(clazz);</span>
        }
<span class="nc" id="L1552">        return false;</span>
    }

    public static Class&lt;?&gt; getClassFromMapping(String className){
<span class="fc" id="L1556">        return mappings.get(className);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader) {
<span class="fc" id="L1560">        return loadClass(className, classLoader, false);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, boolean cache) {
<span class="pc bpc" id="L1564" title="1 of 6 branches missed.">        if(className == null || className.length() == 0 || className.length() &gt; 128){</span>
<span class="fc" id="L1565">            return null;</span>
        }

<span class="fc" id="L1568">        Class&lt;?&gt; clazz = mappings.get(className);</span>
<span class="fc bfc" id="L1569" title="All 2 branches covered.">        if(clazz != null){</span>
<span class="fc" id="L1570">            return clazz;</span>
        }

<span class="fc bfc" id="L1573" title="All 2 branches covered.">        if(className.charAt(0) == '['){</span>
<span class="fc" id="L1574">            Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);</span>
<span class="fc" id="L1575">            return Array.newInstance(componentType, 0).getClass();</span>
        }

<span class="pc bpc" id="L1578" title="1 of 4 branches missed.">        if(className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)){</span>
<span class="fc" id="L1579">            String newClassName = className.substring(1, className.length() - 1);</span>
<span class="fc" id="L1580">            return loadClass(newClassName, classLoader);</span>
        }

        try{
<span class="fc bfc" id="L1584" title="All 2 branches covered.">            if(classLoader != null){</span>
<span class="fc" id="L1585">                clazz = classLoader.loadClass(className);</span>
<span class="pc bpc" id="L1586" title="1 of 2 branches missed.">                if (cache) {</span>
<span class="nc" id="L1587">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1589">                return clazz;</span>
            }
<span class="fc" id="L1591">        } catch(Throwable e){</span>
<span class="fc" id="L1592">            e.printStackTrace();</span>
            // skip
<span class="fc" id="L1594">        }</span>
        try{
<span class="fc" id="L1596">            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="pc bpc" id="L1597" title="1 of 4 branches missed.">            if(contextClassLoader != null &amp;&amp; contextClassLoader != classLoader){</span>
<span class="fc" id="L1598">                clazz = contextClassLoader.loadClass(className);</span>
<span class="fc bfc" id="L1599" title="All 2 branches covered.">                if (cache) {</span>
<span class="fc" id="L1600">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1602">                return clazz;</span>
            }
<span class="fc" id="L1604">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L1606">        }</span>
        try{
<span class="fc" id="L1608">            clazz = Class.forName(className);</span>
<span class="pc bpc" id="L1609" title="1 of 2 branches missed.">            if (cache) {</span>
<span class="nc" id="L1610">                mappings.put(className, clazz);</span>
            }
<span class="fc" id="L1612">            return clazz;</span>
<span class="fc" id="L1613">        } catch(Throwable e){</span>
            // skip
        }
<span class="fc" id="L1616">        return clazz;</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1622">        return buildBeanInfo(beanType, aliasMap, propertyNamingStrategy, false);</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy //
            , boolean fieldBased //
    ){
<span class="fc" id="L1630">        JSONType jsonType = TypeUtils.getAnnotation(beanType,JSONType.class);</span>
<span class="fc" id="L1631">        String[] orders = null;</span>
        final int features;
<span class="fc" id="L1633">        String typeName = null, typeKey = null;</span>
<span class="fc bfc" id="L1634" title="All 2 branches covered.">        if(jsonType != null){</span>
<span class="fc" id="L1635">            orders = jsonType.orders();</span>

<span class="fc" id="L1637">            typeName = jsonType.typeName();</span>
<span class="fc bfc" id="L1638" title="All 2 branches covered.">            if(typeName.length() == 0){</span>
<span class="fc" id="L1639">                typeName = null;</span>
            }

<span class="fc" id="L1642">            PropertyNamingStrategy jsonTypeNaming = jsonType.naming();</span>
<span class="fc bfc" id="L1643" title="All 2 branches covered.">            if (jsonTypeNaming != PropertyNamingStrategy.CamelCase) {</span>
<span class="fc" id="L1644">                propertyNamingStrategy = jsonTypeNaming;</span>
            }

<span class="fc" id="L1647">            features = SerializerFeature.of(jsonType.serialzeFeatures());</span>
<span class="fc" id="L1648">            for(Class&lt;?&gt; supperClass = beanType.getSuperclass()</span>
<span class="pc bpc" id="L1649" title="1 of 4 branches missed.">                ; supperClass != null &amp;&amp; supperClass != Object.class</span>
<span class="fc" id="L1650">                    ; supperClass = supperClass.getSuperclass()){</span>
<span class="fc" id="L1651">                JSONType superJsonType = TypeUtils.getAnnotation(supperClass,JSONType.class);</span>
<span class="fc bfc" id="L1652" title="All 2 branches covered.">                if(superJsonType == null){</span>
<span class="fc" id="L1653">                    break;</span>
                }
<span class="fc" id="L1655">                typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1656" title="1 of 2 branches missed.">                if(typeKey.length() != 0){</span>
<span class="nc" id="L1657">                    break;</span>
                }
            }

<span class="fc bfc" id="L1661" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : beanType.getInterfaces()){</span>
<span class="fc" id="L1662">                JSONType superJsonType = TypeUtils.getAnnotation(interfaceClass,JSONType.class);</span>
<span class="fc bfc" id="L1663" title="All 2 branches covered.">                if(superJsonType != null){</span>
<span class="fc" id="L1664">                    typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1665" title="1 of 2 branches missed.">                    if(typeKey.length() != 0){</span>
<span class="fc" id="L1666">                        break;</span>
                    }
                }
            }

<span class="fc bfc" id="L1671" title="All 4 branches covered.">            if(typeKey != null &amp;&amp; typeKey.length() == 0){</span>
<span class="fc" id="L1672">                typeKey = null;</span>
            }
<span class="fc" id="L1674">        } else{</span>
<span class="fc" id="L1675">            features = 0;</span>
        }
        // fieldName,field ，先生成fieldName的快照，减少之后的findField的轮询
<span class="fc" id="L1678">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1679">        ParserConfig.parserAllFieldToCache(beanType, fieldCacheMap);</span>
<span class="fc bfc" id="L1680" title="All 2 branches covered.">        List&lt;FieldInfo&gt; fieldInfoList = fieldBased</span>
<span class="fc" id="L1681">                ? computeGettersWithFieldBase(beanType, aliasMap, false, propertyNamingStrategy) //</span>
<span class="fc" id="L1682">                : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</span>
<span class="fc" id="L1683">        FieldInfo[] fields = new FieldInfo[fieldInfoList.size()];</span>
<span class="fc" id="L1684">        fieldInfoList.toArray(fields);</span>
        FieldInfo[] sortedFields;
        List&lt;FieldInfo&gt; sortedFieldList;
<span class="fc bfc" id="L1687" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length != 0){</span>
<span class="pc bpc" id="L1688" title="1 of 2 branches missed.">            sortedFieldList = fieldBased</span>
<span class="pc" id="L1689">                    ? computeGettersWithFieldBase(beanType, aliasMap, true, propertyNamingStrategy) //</span>
<span class="fc" id="L1690">                    : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, true, propertyNamingStrategy);</span>
        } else{
<span class="fc" id="L1692">            sortedFieldList = new ArrayList&lt;FieldInfo&gt;(fieldInfoList);</span>
<span class="fc" id="L1693">            Collections.sort(sortedFieldList);</span>
        }
<span class="fc" id="L1695">        sortedFields = new FieldInfo[sortedFieldList.size()];</span>
<span class="fc" id="L1696">        sortedFieldList.toArray(sortedFields);</span>
<span class="fc bfc" id="L1697" title="All 2 branches covered.">        if(Arrays.equals(sortedFields, fields)){</span>
<span class="fc" id="L1698">            sortedFields = fields;</span>
        }
<span class="fc" id="L1700">        return new SerializeBeanInfo(beanType, jsonType, typeName, typeKey, features, fields, sortedFields);</span>
    }

    public static List&lt;FieldInfo&gt; computeGettersWithFieldBase(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            boolean sorted, //
            PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1708">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc bfc" id="L1709" title="All 2 branches covered.">        for(Class&lt;?&gt; currentClass = clazz; currentClass != null; currentClass = currentClass.getSuperclass()){</span>
<span class="fc" id="L1710">            Field[] fields = currentClass.getDeclaredFields();</span>
<span class="fc" id="L1711">            computeFields(currentClass, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
        }
<span class="fc" id="L1713">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap){
<span class="fc" id="L1717">        return computeGetters(clazz, aliasMap, true);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap, boolean sorted){
<span class="fc" id="L1721">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc" id="L1722">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1723">        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</span>
<span class="fc" id="L1724">        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
                                                 JSONType jsonType, //
                                                 Map&lt;String,String&gt; aliasMap, //
                                                 Map&lt;String,Field&gt; fieldCacheMap, //
                                                 boolean sorted, //
                                                 PropertyNamingStrategy propertyNamingStrategy //
    ){
<span class="fc" id="L1734">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc" id="L1735">        boolean kotlin = TypeUtils.isKotlin(clazz);</span>
        // for kotlin
<span class="fc" id="L1737">        Constructor[] constructors = null;</span>
<span class="fc" id="L1738">        Annotation[][] paramAnnotationArrays = null;</span>
<span class="fc" id="L1739">        String[] paramNames = null;</span>
<span class="fc" id="L1740">        short[] paramNameMapping = null;</span>
<span class="fc" id="L1741">        Method[] methods = clazz.getMethods();</span>
<span class="fc bfc" id="L1742" title="All 2 branches covered.">        for(Method method : methods){</span>
<span class="fc" id="L1743">            String methodName = method.getName();</span>
<span class="fc" id="L1744">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1745">            String label = null;</span>
<span class="fc bfc" id="L1746" title="All 2 branches covered.">            if(Modifier.isStatic(method.getModifiers())){</span>
<span class="fc" id="L1747">                continue;</span>
            }
<span class="fc bfc" id="L1749" title="All 2 branches covered.">            if(method.getReturnType().equals(Void.TYPE)){</span>
<span class="fc" id="L1750">                continue;</span>
            }
<span class="fc bfc" id="L1752" title="All 2 branches covered.">            if(method.getParameterTypes().length != 0){</span>
<span class="fc" id="L1753">                continue;</span>
            }
<span class="fc bfc" id="L1755" title="All 2 branches covered.">            if(method.getReturnType() == ClassLoader.class){</span>
<span class="fc" id="L1756">                continue;</span>
            }

<span class="fc bfc" id="L1759" title="All 2 branches covered.">            if(methodName.equals(&quot;getMetaClass&quot;)</span>
<span class="pc bpc" id="L1760" title="1 of 2 branches missed.">                    &amp;&amp; method.getReturnType().getName().equals(&quot;groovy.lang.MetaClass&quot;)){</span>
<span class="fc" id="L1761">                continue;</span>
            }
<span class="fc bfc" id="L1763" title="All 2 branches covered.">            if(methodName.equals(&quot;getSuppressed&quot;)</span>
<span class="pc bpc" id="L1764" title="1 of 2 branches missed.">                    &amp;&amp; method.getDeclaringClass() == Throwable.class){</span>
<span class="fc" id="L1765">                continue;</span>
            }

<span class="fc bfc" id="L1768" title="All 4 branches covered.">            if(kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)){</span>
<span class="fc" id="L1769">                continue;</span>
            }
            /**
             *  如果在属性或者方法上存在JSONField注解，并且定制了name属性，不以类上的propertyNamingStrategy设置为准，以此字段的JSONField的name定制为准。
             */
<span class="fc" id="L1774">            Boolean fieldAnnotationAndNameExists = false;</span>
<span class="fc" id="L1775">            JSONField annotation = TypeUtils.getAnnotation(method, JSONField.class);</span>
<span class="fc bfc" id="L1776" title="All 2 branches covered.">            if(annotation == null){</span>
<span class="fc" id="L1777">                annotation = getSuperMethodAnnotation(clazz, method);</span>
            }
<span class="fc bfc" id="L1779" title="All 4 branches covered.">            if(annotation == null &amp;&amp; kotlin){</span>
<span class="fc bfc" id="L1780" title="All 2 branches covered.">                if(constructors == null){</span>
<span class="fc" id="L1781">                    constructors = clazz.getDeclaredConstructors();</span>
<span class="fc" id="L1782">                    Constructor creatorConstructor = TypeUtils.getKoltinConstructor(constructors);</span>
<span class="pc bpc" id="L1783" title="1 of 2 branches missed.">                    if(creatorConstructor != null){</span>
<span class="fc" id="L1784">                        paramAnnotationArrays = TypeUtils.getParameterAnnotations(creatorConstructor);</span>
<span class="fc" id="L1785">                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</span>
<span class="pc bpc" id="L1786" title="1 of 2 branches missed.">                        if(paramNames != null){</span>
<span class="fc" id="L1787">                            String[] paramNames_sorted = new String[paramNames.length];</span>
<span class="fc" id="L1788">                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</span>

<span class="fc" id="L1790">                            Arrays.sort(paramNames_sorted);</span>
<span class="fc" id="L1791">                            paramNameMapping = new short[paramNames.length];</span>
<span class="fc bfc" id="L1792" title="All 2 branches covered.">                            for(short p = 0; p &lt; paramNames.length; p++){</span>
<span class="fc" id="L1793">                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</span>
<span class="fc" id="L1794">                                paramNameMapping[index] = p;</span>
                            }
<span class="fc" id="L1796">                            paramNames = paramNames_sorted;</span>
                        }
                    }
                }
<span class="pc bpc" id="L1800" title="2 of 6 branches missed.">                if(paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc" id="L1801">                    String propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1802">                    int p = Arrays.binarySearch(paramNames, propertyName);</span>
<span class="fc bfc" id="L1803" title="All 2 branches covered.">                    if (p &lt; 0) {</span>
<span class="fc bfc" id="L1804" title="All 2 branches covered.">                        for (int i = 0; i &lt; paramNames.length; i++) {</span>
<span class="fc bfc" id="L1805" title="All 2 branches covered.">                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</span>
<span class="fc" id="L1806">                                p = i;</span>
<span class="fc" id="L1807">                                break;</span>
                            }
                        }
                    }
<span class="fc bfc" id="L1811" title="All 2 branches covered.">                    if(p &gt;= 0){</span>
<span class="fc" id="L1812">                        short index = paramNameMapping[p];</span>
<span class="fc" id="L1813">                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</span>
<span class="pc bpc" id="L1814" title="1 of 2 branches missed.">                        if(paramAnnotations != null){</span>
<span class="pc bfc" id="L1815" title="All 2 branches covered.">                            for(Annotation paramAnnotation : paramAnnotations){</span>
<span class="pc bpc" id="L1816" title="1 of 2 branches missed.">                                if(paramAnnotation instanceof JSONField){</span>
<span class="fc" id="L1817">                                    annotation = (JSONField) paramAnnotation;</span>
<span class="fc" id="L1818">                                    break;</span>
                                }
                            }
                        }
<span class="fc bfc" id="L1822" title="All 2 branches covered.">                        if(annotation == null){</span>
<span class="fc" id="L1823">                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1824" title="All 2 branches covered.">                            if(field != null){</span>
<span class="fc" id="L1825">                                annotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
                            }
                        }
                    }
                }
            }
<span class="fc bfc" id="L1831" title="All 2 branches covered.">            if(annotation != null){</span>
<span class="fc bfc" id="L1832" title="All 2 branches covered.">                if(!annotation.serialize()){</span>
<span class="fc" id="L1833">                    continue;</span>
                }
<span class="fc" id="L1835">                ordinal = annotation.ordinal();</span>
<span class="fc" id="L1836">                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span>
<span class="fc" id="L1837">                parserFeatures = Feature.of(annotation.parseFeatures());</span>
<span class="fc bfc" id="L1838" title="All 2 branches covered.">                if(annotation.name().length() != 0){</span>
<span class="fc" id="L1839">                    String propertyName = annotation.name();</span>
<span class="fc bfc" id="L1840" title="All 2 branches covered.">                    if(aliasMap != null){</span>
<span class="fc" id="L1841">                        propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1842" title="1 of 2 branches missed.">                        if(propertyName == null){</span>
<span class="fc" id="L1843">                            continue;</span>
                        }
                    }
<span class="fc" id="L1846">                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</span>
                            serialzeFeatures, parserFeatures, annotation, null, label);
<span class="fc" id="L1848">                    fieldInfoMap.put(propertyName, fieldInfo);</span>
<span class="fc" id="L1849">                    continue;</span>
                }
<span class="fc bfc" id="L1851" title="All 2 branches covered.">                if(annotation.label().length() != 0){</span>
<span class="fc" id="L1852">                    label = annotation.label();</span>
                }
            }
<span class="fc bfc" id="L1855" title="All 2 branches covered.">            if(methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc bfc" id="L1856" title="All 2 branches covered.">                if(methodName.length() &lt; 4){</span>
<span class="fc" id="L1857">                    continue;</span>
                }
<span class="fc bfc" id="L1859" title="All 2 branches covered.">                if(methodName.equals(&quot;getClass&quot;)){</span>
<span class="fc" id="L1860">                    continue;</span>
                }
<span class="fc bfc" id="L1862" title="All 4 branches covered.">                if(methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()){</span>
<span class="fc" id="L1863">                    continue;</span>
                }
<span class="fc" id="L1865">                char c3 = methodName.charAt(3);</span>
                String propertyName;
<span class="fc bfc" id="L1867" title="All 4 branches covered.">                if(Character.isUpperCase(c3) //</span>
                        || c3 &gt; 512 // for unicode method name
                        ){
<span class="fc bfc" id="L1870" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1871">                        propertyName = decapitalize(methodName.substring(3));</span>
                    } else{
<span class="fc" id="L1873">                        propertyName = Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</span>
                    }
<span class="fc" id="L1875">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</span>
<span class="fc bfc" id="L1876" title="All 2 branches covered.">                } else if(c3 == '_'){</span>
<span class="fc" id="L1877">                    propertyName = methodName.substring(4);</span>
<span class="fc bfc" id="L1878" title="All 2 branches covered.">                } else if(c3 == 'f'){</span>
<span class="fc" id="L1879">                    propertyName = methodName.substring(3);</span>
<span class="pc bpc" id="L1880" title="1 of 4 branches missed.">                } else if(methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))){</span>
<span class="fc" id="L1881">                    propertyName = decapitalize(methodName.substring(3));</span>
                } else{
                    continue;
                }
<span class="fc" id="L1885">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1886" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1887">                    continue;</span>
                }
                //假如bean的field很多的情况一下，轮询时将大大降低效率
<span class="fc" id="L1890">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1891" title="All 4 branches covered.">                if(field == null &amp;&amp; propertyName.length() &gt; 1){</span>
<span class="fc" id="L1892">                    char ch = propertyName.charAt(1);</span>
<span class="fc bfc" id="L1893" title="All 4 branches covered.">                    if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L1894">                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1895">                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</span>
                    }
                }
<span class="fc" id="L1898">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1899" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1900">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L1901" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1902" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1903">                            continue;</span>
                        }
<span class="fc" id="L1905">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1906">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1907">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1908" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1909">                            fieldAnnotationAndNameExists = true;</span>
<span class="fc" id="L1910">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1911" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1912">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1913" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1914">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1918" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1919">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1923" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1924">                    propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L1925" title="All 2 branches covered.">                    if(propertyName == null){</span>
<span class="fc" id="L1926">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L1929" title="All 4 branches covered.">                if(propertyNamingStrategy != null &amp;&amp; !fieldAnnotationAndNameExists){</span>
<span class="fc" id="L1930">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
<span class="fc" id="L1932">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L1934">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
<span class="fc bfc" id="L1936" title="All 2 branches covered.">            if(methodName.startsWith(&quot;is&quot;)){</span>
<span class="fc bfc" id="L1937" title="All 2 branches covered.">                if(methodName.length() &lt; 3){</span>
<span class="fc" id="L1938">                    continue;</span>
                }
<span class="fc bfc" id="L1940" title="All 2 branches covered.">                if(method.getReturnType() != Boolean.TYPE</span>
<span class="fc bfc" id="L1941" title="All 2 branches covered.">                        &amp;&amp; method.getReturnType() != Boolean.class){</span>
<span class="fc" id="L1942">                    continue;</span>
                }
<span class="fc" id="L1944">                char c2 = methodName.charAt(2);</span>
                String propertyName;
<span class="fc bfc" id="L1946" title="All 2 branches covered.">                if(Character.isUpperCase(c2)){</span>
<span class="fc bfc" id="L1947" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1948">                        propertyName = decapitalize(methodName.substring(2));</span>
                    } else{
<span class="fc" id="L1950">                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</span>
                    }
<span class="fc" id="L1952">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</span>
<span class="fc bfc" id="L1953" title="All 2 branches covered.">                } else if(c2 == '_'){</span>
<span class="fc" id="L1954">                    propertyName = methodName.substring(3);</span>
<span class="fc bfc" id="L1955" title="All 2 branches covered.">                } else if(c2 == 'f'){</span>
<span class="fc" id="L1956">                    propertyName = methodName.substring(2);</span>
                } else{
                    continue;
                }
<span class="fc" id="L1960">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1961" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1962">                    continue;</span>
                }
<span class="fc" id="L1964">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1965" title="All 2 branches covered.">                if(field == null){</span>
<span class="fc" id="L1966">                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</span>
                }
<span class="fc" id="L1968">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1969" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1970">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L1971" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1972" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1973">                            continue;</span>
                        }
<span class="fc" id="L1975">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1976">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1977">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1978" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1979">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1980" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1981">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1982" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1983">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1987" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1988">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1992" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1993">                    propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1994" title="1 of 2 branches missed.">                    if(propertyName == null){</span>
<span class="fc" id="L1995">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L1998" title="All 2 branches covered.">                if(propertyNamingStrategy != null){</span>
<span class="fc" id="L1999">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
                //优先选择get
<span class="fc bfc" id="L2002" title="All 2 branches covered.">                if(fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L2003">                    continue;</span>
                }
<span class="fc" id="L2005">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L2007">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2010">        Field[] fields = clazz.getFields();</span>
<span class="fc" id="L2011">        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
<span class="fc" id="L2012">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String,FieldInfo&gt; fieldInfoMap){
<span class="fc" id="L2016">        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</span>
<span class="fc" id="L2017">        String[] orders = null;</span>
<span class="fc" id="L2018">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2019" title="All 2 branches covered.">        if(annotation != null){</span>
<span class="fc" id="L2020">            orders = annotation.orders();</span>
        }
<span class="fc bfc" id="L2022" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length &gt; 0){</span>
<span class="fc" id="L2023">            LinkedHashMap&lt;String,FieldInfo&gt; map = new LinkedHashMap&lt;String,FieldInfo&gt;(fieldInfoList.size());</span>
<span class="fc bfc" id="L2024" title="All 2 branches covered.">            for(FieldInfo field : fieldInfoMap.values()){</span>
<span class="fc" id="L2025">                map.put(field.name, field);</span>
<span class="fc" id="L2026">            }</span>
<span class="fc" id="L2027">            int i = 0;</span>
<span class="fc bfc" id="L2028" title="All 2 branches covered.">            for(String item : orders){</span>
<span class="fc" id="L2029">                FieldInfo field = map.get(item);</span>
<span class="fc bfc" id="L2030" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L2031">                    fieldInfoList.add(field);</span>
<span class="fc" id="L2032">                    map.remove(item);</span>
                }
            }
<span class="fc bfc" id="L2035" title="All 2 branches covered.">            for(FieldInfo field : map.values()){</span>
<span class="fc" id="L2036">                fieldInfoList.add(field);</span>
<span class="fc" id="L2037">            }</span>
<span class="fc" id="L2038">        } else{</span>
<span class="fc bfc" id="L2039" title="All 2 branches covered.">            for(FieldInfo fieldInfo : fieldInfoMap.values()){</span>
<span class="fc" id="L2040">                fieldInfoList.add(fieldInfo);</span>
<span class="fc" id="L2041">            }</span>
<span class="fc bfc" id="L2042" title="All 2 branches covered.">            if(sorted){</span>
<span class="fc" id="L2043">                Collections.sort(fieldInfoList);</span>
            }
        }
<span class="fc" id="L2046">        return fieldInfoList;</span>
    }

    private static void computeFields(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            PropertyNamingStrategy propertyNamingStrategy, //
            Map&lt;String,FieldInfo&gt; fieldInfoMap, //
            Field[] fields){
<span class="fc bfc" id="L2055" title="All 2 branches covered.">        for(Field field : fields){</span>
<span class="fc bfc" id="L2056" title="All 2 branches covered.">            if(Modifier.isStatic(field.getModifiers())){</span>
<span class="fc" id="L2057">                continue;</span>
            }
<span class="fc" id="L2059">            JSONField fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc" id="L2060">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L2061">            String propertyName = field.getName();</span>
<span class="fc" id="L2062">            String label = null;</span>
<span class="fc bfc" id="L2063" title="All 2 branches covered.">            if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L2064" title="All 2 branches covered.">                if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L2065">                    continue;</span>
                }
<span class="fc" id="L2067">                ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2068">                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2069">                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2070" title="All 2 branches covered.">                if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L2071">                    propertyName = fieldAnnotation.name();</span>
                }
<span class="pc bpc" id="L2073" title="1 of 2 branches missed.">                if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L2074">                    label = fieldAnnotation.label();</span>
                }
            }
<span class="fc bfc" id="L2077" title="All 2 branches covered.">            if(aliasMap != null){</span>
<span class="fc" id="L2078">                propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L2079" title="All 2 branches covered.">                if(propertyName == null){</span>
<span class="fc" id="L2080">                    continue;</span>
                }
            }
<span class="fc bfc" id="L2083" title="All 2 branches covered.">            if(propertyNamingStrategy != null){</span>
<span class="fc" id="L2084">                propertyName = propertyNamingStrategy.translate(propertyName);</span>
            }
<span class="fc bfc" id="L2086" title="All 2 branches covered.">            if(!fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L2087">                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        null, fieldAnnotation, label);
<span class="fc" id="L2089">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2092">    }</span>

    private static String getPropertyNameByCompatibleFieldName(Map&lt;String,Field&gt; fieldCacheMap, String methodName,
                                                               String propertyName, int fromIdx){
<span class="pc bpc" id="L2096" title="1 of 2 branches missed.">        if(compatibleWithFieldName){</span>
<span class="nc bnc" id="L2097" title="All 2 branches missed.">            if(!fieldCacheMap.containsKey(propertyName)){</span>
<span class="nc" id="L2098">                String tempPropertyName = methodName.substring(fromIdx);</span>
<span class="nc bnc" id="L2099" title="All 2 branches missed.">                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</span>
            }
        }
<span class="fc" id="L2102">        return propertyName;</span>
    }

    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method){
<span class="fc" id="L2106">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="fc bfc" id="L2107" title="All 2 branches covered.">        if(interfaces.length &gt; 0){</span>
<span class="fc" id="L2108">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2109" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : interfaces){</span>
<span class="fc bfc" id="L2110" title="All 2 branches covered.">                for(Method interfaceMethod : interfaceClass.getMethods()){</span>
<span class="fc" id="L2111">                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2112" title="All 2 branches covered.">                    if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L2113">                        continue;</span>
                    }
<span class="fc bfc" id="L2115" title="All 2 branches covered.">                    if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L2116">                        continue;</span>
                    }
<span class="fc" id="L2118">                    boolean match = true;</span>
<span class="fc bfc" id="L2119" title="All 2 branches covered.">                    for(int i = 0; i &lt; types.length; ++i){</span>
<span class="fc bfc" id="L2120" title="All 2 branches covered.">                        if(!interfaceTypes[i].equals(types[i])){</span>
<span class="fc" id="L2121">                            match = false;</span>
<span class="fc" id="L2122">                            break;</span>
                        }
                    }
<span class="fc bfc" id="L2125" title="All 2 branches covered.">                    if(!match){</span>
<span class="fc" id="L2126">                        continue;</span>
                    }
<span class="fc" id="L2128">                    JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2129" title="All 2 branches covered.">                    if(annotation != null){</span>
<span class="fc" id="L2130">                        return annotation;</span>
                    }
                }
            }
        }
<span class="fc" id="L2135">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2136" title="All 2 branches covered.">        if(superClass == null){</span>
<span class="fc" id="L2137">            return null;</span>
        }
<span class="fc bfc" id="L2139" title="All 2 branches covered.">        if(Modifier.isAbstract(superClass.getModifiers())){</span>
<span class="fc" id="L2140">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2141" title="All 2 branches covered.">            for(Method interfaceMethod : superClass.getMethods()){</span>
<span class="fc" id="L2142">                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2143" title="All 2 branches covered.">                if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L2144">                    continue;</span>
                }
<span class="fc bfc" id="L2146" title="All 2 branches covered.">                if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L2147">                    continue;</span>
                }
<span class="fc" id="L2149">                boolean match = true;</span>
<span class="fc bfc" id="L2150" title="All 2 branches covered.">                for(int i = 0; i &lt; types.length; ++i){</span>
<span class="pc bpc" id="L2151" title="1 of 2 branches missed.">                    if(!interfaceTypes[i].equals(types[i])){</span>
<span class="nc" id="L2152">                        match = false;</span>
<span class="nc" id="L2153">                        break;</span>
                    }
                }
<span class="pc bpc" id="L2156" title="1 of 2 branches missed.">                if(!match){</span>
<span class="nc" id="L2157">                    continue;</span>
                }
<span class="fc" id="L2159">                JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2160" title="All 2 branches covered.">                if(annotation != null){</span>
<span class="fc" id="L2161">                    return annotation;</span>
                }
            }
        }
<span class="fc" id="L2165">        return null;</span>
    }

    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName){
<span class="fc" id="L2169">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2170" title="All 2 branches covered.">        if(jsonType != null){</span>
            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<span class="fc" id="L2174">            String[] fields = jsonType.includes();</span>
<span class="fc bfc" id="L2175" title="All 2 branches covered.">            if(fields.length &gt; 0){</span>
<span class="fc bfc" id="L2176" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L2177" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L2178">                        return false;</span>
                    }
                }
<span class="fc" id="L2181">                return true;</span>
            } else{
<span class="fc" id="L2183">                fields = jsonType.ignores();</span>
<span class="fc bfc" id="L2184" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L2185" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L2186">                        return true;</span>
                    }
                }
            }
        }
<span class="fc bfc" id="L2191" title="All 4 branches covered.">        if(clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null){</span>
<span class="fc" id="L2192">            return isJSONTypeIgnore(clazz.getSuperclass(), propertyName);</span>
        }
<span class="fc" id="L2194">        return false;</span>
    }

    public static boolean isGenericParamType(Type type){
<span class="fc bfc" id="L2198" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2199">            return true;</span>
        }
<span class="fc bfc" id="L2201" title="All 2 branches covered.">        if(type instanceof Class) {</span>
<span class="fc" id="L2202">            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</span>
<span class="fc bfc" id="L2203" title="All 4 branches covered.">            return superType != Object.class &amp;&amp; isGenericParamType(superType);</span>
        }
<span class="fc" id="L2205">        return false;</span>
    }

    public static Type getGenericParamType(Type type){
<span class="fc bfc" id="L2209" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2210">            return type;</span>
        }
<span class="pc bpc" id="L2212" title="1 of 2 branches missed.">        if(type instanceof Class){</span>
<span class="fc" id="L2213">            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</span>
        }
<span class="nc" id="L2215">        return type;</span>
    }

    public static Type unwrapOptional(Type type){
<span class="fc bfc" id="L2219" title="All 2 branches covered.">        if(!optionalClassInited){</span>
            try{
<span class="fc" id="L2221">                optionalClass = Class.forName(&quot;java.util.Optional&quot;);</span>
<span class="nc" id="L2222">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2225">                optionalClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2228" title="1 of 2 branches missed.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2229">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>
<span class="pc bpc" id="L2230" title="1 of 2 branches missed.">            if(parameterizedType.getRawType() == optionalClass){</span>
<span class="fc" id="L2231">                return parameterizedType.getActualTypeArguments()[0];</span>
            }
        }
<span class="nc" id="L2234">        return type;</span>
    }

    public static Class&lt;?&gt; getClass(Type type){
<span class="fc bfc" id="L2238" title="All 2 branches covered.">        if(type.getClass() == Class.class){</span>
<span class="fc" id="L2239">            return (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2242" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2243">            return getClass(((ParameterizedType) type).getRawType());</span>
        }

<span class="fc bfc" id="L2246" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L2247">            Type boundType = ((TypeVariable&lt;?&gt;) type).getBounds()[0];</span>
<span class="pc bpc" id="L2248" title="1 of 2 branches missed.">            if (boundType instanceof Class) {</span>
<span class="fc" id="L2249">                return (Class) boundType;</span>
            }
<span class="nc" id="L2251">            return getClass(boundType);</span>
        }

<span class="pc bpc" id="L2254" title="1 of 2 branches missed.">        if(type instanceof WildcardType){</span>
<span class="fc" id="L2255">            Type[] upperBounds = ((WildcardType) type).getUpperBounds();</span>
<span class="pc bpc" id="L2256" title="1 of 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="fc" id="L2257">                return getClass(upperBounds[0]);</span>
            }
        }

<span class="nc" id="L2261">        return Object.class;</span>
    }

    public static Field getField(Class&lt;?&gt; clazz, String fieldName, Field[] declaredFields){
<span class="fc bfc" id="L2265" title="All 2 branches covered.">        for(Field field : declaredFields){</span>
<span class="fc" id="L2266">            String itemName = field.getName();</span>
<span class="fc bfc" id="L2267" title="All 2 branches covered.">            if(fieldName.equals(itemName)){</span>
<span class="fc" id="L2268">                return field;</span>
            }

            char c0, c1;
<span class="fc bfc" id="L2272" title="All 2 branches covered.">            if (fieldName.length() &gt; 2</span>
<span class="fc bfc" id="L2273" title="All 4 branches covered.">                    &amp;&amp; (c0 = fieldName.charAt(0)) &gt;= 'a' &amp;&amp; c0 &lt;= 'z'</span>
<span class="fc bfc" id="L2274" title="All 4 branches covered.">                    &amp;&amp; (c1 = fieldName.charAt(1)) &gt;= 'A' &amp;&amp; c1 &lt;= 'Z'</span>
<span class="fc bfc" id="L2275" title="All 2 branches covered.">                    &amp;&amp; fieldName.equalsIgnoreCase(itemName)) {</span>
<span class="fc" id="L2276">                return field;</span>
            }
        }
<span class="fc" id="L2279">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2280" title="All 4 branches covered.">        if(superClass != null &amp;&amp; superClass != Object.class){</span>
<span class="fc" id="L2281">            return getField(superClass, fieldName, superClass.getDeclaredFields());</span>
        }
<span class="fc" id="L2283">        return null;</span>
    }

    /**
     * @deprecated
     */
    public static int getSerializeFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2290">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2291" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2292">            return 0;</span>
        }
<span class="fc" id="L2294">        return SerializerFeature.of(annotation.serialzeFeatures());</span>
    }

    public static int getParserFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2298">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2299" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2300">            return 0;</span>
        }
<span class="fc" id="L2302">        return Feature.of(annotation.parseFeatures());</span>
    }

    public static String decapitalize(String name){
<span class="pc bpc" id="L2306" title="2 of 4 branches missed.">        if(name == null || name.length() == 0){</span>
<span class="nc" id="L2307">            return name;</span>
        }
<span class="fc bfc" id="L2309" title="All 6 branches covered.">        if(name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))){</span>
<span class="fc" id="L2310">            return name;</span>
        }
<span class="fc" id="L2312">        char[] chars = name.toCharArray();</span>
<span class="fc" id="L2313">        chars[0] = Character.toLowerCase(chars[0]);</span>
<span class="fc" id="L2314">        return new String(chars);</span>
    }

    static void setAccessible(AccessibleObject obj){
<span class="pc bpc" id="L2318" title="1 of 2 branches missed.">        if(!setAccessibleEnable){</span>
<span class="nc" id="L2319">            return;</span>
        }
<span class="fc bfc" id="L2321" title="All 2 branches covered.">        if(obj.isAccessible()){</span>
<span class="fc" id="L2322">            return;</span>
        }
        try{
<span class="fc" id="L2325">            obj.setAccessible(true);</span>
<span class="nc" id="L2326">        } catch(AccessControlException error){</span>
<span class="nc" id="L2327">            setAccessibleEnable = false;</span>
<span class="fc" id="L2328">        }</span>
<span class="fc" id="L2329">    }</span>

    public static Type getCollectionItemType(Type fieldType) {
<span class="fc bfc" id="L2332" title="All 2 branches covered.">        if (fieldType instanceof ParameterizedType) {</span>
<span class="fc" id="L2333">            return getCollectionItemType((ParameterizedType) fieldType);</span>
        }
<span class="fc bfc" id="L2335" title="All 2 branches covered.">        if (fieldType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2336">            return getCollectionItemType((Class&lt;?&gt;) fieldType);</span>
        }
<span class="fc" id="L2338">        return Object.class;</span>
    }

    private static Type getCollectionItemType(Class&lt;?&gt; clazz) {
<span class="fc bfc" id="L2342" title="All 2 branches covered.">        return clazz.getName().startsWith(&quot;java.&quot;)</span>
                ? Object.class
<span class="fc" id="L2344">                : getCollectionItemType(getCollectionSuperType(clazz));</span>
    }

    private static Type getCollectionItemType(ParameterizedType parameterizedType) {
<span class="fc" id="L2348">        Type rawType = parameterizedType.getRawType();</span>
<span class="fc" id="L2349">        Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span>
<span class="fc bfc" id="L2350" title="All 2 branches covered.">        if (rawType == Collection.class) {</span>
<span class="fc" id="L2351">            return getWildcardTypeUpperBounds(actualTypeArguments[0]);</span>
        }
<span class="fc" id="L2353">        Class&lt;?&gt; rawClass = (Class&lt;?&gt;) rawType;</span>
<span class="fc" id="L2354">        Map&lt;TypeVariable, Type&gt; actualTypeMap = createActualTypeMap(rawClass.getTypeParameters(), actualTypeArguments);</span>
<span class="fc" id="L2355">        Type superType = getCollectionSuperType(rawClass);</span>
<span class="pc bpc" id="L2356" title="1 of 2 branches missed.">        if (superType instanceof ParameterizedType) {</span>
<span class="fc" id="L2357">            Class&lt;?&gt; superClass = getRawClass(superType);</span>
<span class="fc" id="L2358">            Type[] superClassTypeParameters = ((ParameterizedType) superType).getActualTypeArguments();</span>
<span class="pc bpc" id="L2359" title="1 of 2 branches missed.">            return superClassTypeParameters.length &gt; 0</span>
<span class="pc" id="L2360">                    ? getCollectionItemType(makeParameterizedType(superClass, superClassTypeParameters, actualTypeMap))</span>
<span class="nc" id="L2361">                    : getCollectionItemType(superClass);</span>
        }
<span class="nc" id="L2363">        return getCollectionItemType((Class&lt;?&gt;) superType);</span>
    }

    private static Type getCollectionSuperType(Class&lt;?&gt; clazz) {
<span class="fc" id="L2367">        Type assignable = null;</span>
<span class="fc bfc" id="L2368" title="All 2 branches covered.">        for (Type type : clazz.getGenericInterfaces()) {</span>
<span class="fc" id="L2369">            Class&lt;?&gt; rawClass = getRawClass(type);</span>
<span class="fc bfc" id="L2370" title="All 2 branches covered.">            if (rawClass == Collection.class) {</span>
<span class="fc" id="L2371">                return type;</span>
            }
<span class="fc bfc" id="L2373" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(rawClass)) {</span>
<span class="fc" id="L2374">                assignable = type;</span>
            }
        }
<span class="fc bfc" id="L2377" title="All 2 branches covered.">        return assignable == null ? clazz.getGenericSuperclass() : assignable;</span>
    }

    private static Map&lt;TypeVariable, Type&gt; createActualTypeMap(TypeVariable[] typeParameters, Type[] actualTypeArguments) {
<span class="fc" id="L2381">        int length = typeParameters.length;</span>
<span class="fc" id="L2382">        Map&lt;TypeVariable, Type&gt; actualTypeMap = new HashMap&lt;TypeVariable, Type&gt;(length);</span>
<span class="fc bfc" id="L2383" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2384">            actualTypeMap.put(typeParameters[i], actualTypeArguments[i]);</span>
        }
<span class="fc" id="L2386">        return actualTypeMap;</span>
    }

    private static ParameterizedType makeParameterizedType(Class&lt;?&gt; rawClass, Type[] typeParameters, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc" id="L2390">        int length = typeParameters.length;</span>
<span class="fc" id="L2391">        Type[] actualTypeArguments = new Type[length];</span>
<span class="fc bfc" id="L2392" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2393">            actualTypeArguments[i] = getActualType(typeParameters[i], actualTypeMap);</span>
        }
<span class="fc" id="L2395">        return new ParameterizedTypeImpl(actualTypeArguments, null, rawClass);</span>
    }

    private static Type getActualType(Type typeParameter, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc bfc" id="L2399" title="All 2 branches covered.">        if (typeParameter instanceof TypeVariable) {</span>
<span class="fc" id="L2400">            return actualTypeMap.get(typeParameter);</span>
<span class="fc bfc" id="L2401" title="All 2 branches covered.">        } else if (typeParameter instanceof ParameterizedType) {</span>
<span class="fc" id="L2402">            return makeParameterizedType(getRawClass(typeParameter), ((ParameterizedType) typeParameter).getActualTypeArguments(), actualTypeMap);</span>
<span class="fc bfc" id="L2403" title="All 2 branches covered.">        } else if (typeParameter instanceof GenericArrayType) {</span>
<span class="fc" id="L2404">            return new GenericArrayTypeImpl(getActualType(((GenericArrayType) typeParameter).getGenericComponentType(), actualTypeMap));</span>
        }
<span class="fc" id="L2406">        return typeParameter;</span>
    }

    private static Type getWildcardTypeUpperBounds(Type type) {
<span class="fc bfc" id="L2410" title="All 2 branches covered.">        if (type instanceof WildcardType) {</span>
<span class="fc" id="L2411">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="fc" id="L2412">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2413" title="1 of 2 branches missed.">            return upperBounds.length &gt; 0 ? upperBounds[0] : Object.class;</span>
        }
<span class="fc" id="L2415">        return type;</span>
    }

    public static Class&lt;?&gt; getCollectionItemClass(Type fieldType){
<span class="fc bfc" id="L2419" title="All 2 branches covered.">        if(fieldType instanceof ParameterizedType){</span>
            Class&lt;?&gt; itemClass;
<span class="fc" id="L2421">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L2422" title="All 2 branches covered.">            if(actualTypeArgument instanceof WildcardType){</span>
<span class="fc" id="L2423">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L2424">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2425" title="1 of 2 branches missed.">                if(upperBounds.length == 1){</span>
<span class="fc" id="L2426">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc bfc" id="L2429" title="All 2 branches covered.">            if(actualTypeArgument instanceof Class){</span>
<span class="fc" id="L2430">                itemClass = (Class&lt;?&gt;) actualTypeArgument;</span>
<span class="fc bfc" id="L2431" title="All 2 branches covered.">                if(!Modifier.isPublic(itemClass.getModifiers())){</span>
<span class="fc" id="L2432">                    throw new JSONException(&quot;can not create ASMParser&quot;);</span>
                }
            } else{
<span class="fc" id="L2435">                throw new JSONException(&quot;can not create ASMParser&quot;);</span>
            }
<span class="fc" id="L2437">            return itemClass;</span>
        }
<span class="fc" id="L2439">        return Object.class;</span>
    }

    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<span class="fc" id="L2443">        Type clz = genericArrayType;</span>
<span class="fc" id="L2444">        Type genericComponentType  = genericArrayType.getGenericComponentType();</span>

<span class="fc" id="L2446">        String prefix = &quot;[&quot;;</span>
<span class="pc bpc" id="L2447" title="1 of 2 branches missed.">        while (genericComponentType instanceof GenericArrayType) {</span>
<span class="nc" id="L2448">            genericComponentType = ((GenericArrayType) genericComponentType)</span>
<span class="nc" id="L2449">                    .getGenericComponentType();</span>
<span class="nc" id="L2450">            prefix += prefix;</span>
        }

<span class="fc bfc" id="L2453" title="All 2 branches covered.">        if (genericComponentType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2454">            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</span>
<span class="pc bpc" id="L2455" title="1 of 2 branches missed.">            if (ck.isPrimitive()) {</span>
                try {
<span class="fc bfc" id="L2457" title="All 2 branches covered.">                    if (ck == boolean.class) {</span>
<span class="fc" id="L2458">                        clz = Class.forName(prefix + &quot;Z&quot;);</span>
<span class="fc bfc" id="L2459" title="All 2 branches covered.">                    } else if (ck == char.class) {</span>
<span class="fc" id="L2460">                        clz = Class.forName(prefix + &quot;C&quot;);</span>
<span class="fc bfc" id="L2461" title="All 2 branches covered.">                    } else if (ck == byte.class) {</span>
<span class="fc" id="L2462">                        clz = Class.forName(prefix + &quot;B&quot;);</span>
<span class="fc bfc" id="L2463" title="All 2 branches covered.">                    } else if (ck == short.class) {</span>
<span class="fc" id="L2464">                        clz = Class.forName(prefix + &quot;S&quot;);</span>
<span class="fc bfc" id="L2465" title="All 2 branches covered.">                    } else if (ck == int.class) {</span>
<span class="fc" id="L2466">                        clz = Class.forName(prefix + &quot;I&quot;);</span>
<span class="fc bfc" id="L2467" title="All 2 branches covered.">                    } else if (ck == long.class) {</span>
<span class="fc" id="L2468">                        clz = Class.forName(prefix + &quot;J&quot;);</span>
<span class="fc bfc" id="L2469" title="All 2 branches covered.">                    } else if (ck == float.class) {</span>
<span class="fc" id="L2470">                        clz = Class.forName(prefix + &quot;F&quot;);</span>
<span class="pc bpc" id="L2471" title="1 of 2 branches missed.">                    } else if (ck == double.class) {</span>
<span class="fc" id="L2472">                        clz = Class.forName(prefix + &quot;D&quot;);</span>
                    }
<span class="nc" id="L2474">                } catch (ClassNotFoundException e) {</span>
<span class="fc" id="L2475">                }</span>
            }
        }

<span class="fc" id="L2479">        return clz;</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static Collection createCollection(Type type) {
<span class="fc" id="L2484">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Collection list;
<span class="pc bpc" id="L2486" title="1 of 4 branches missed.">        if(rawClass == AbstractCollection.class //</span>
                || rawClass == Collection.class){
<span class="fc" id="L2488">            list = new ArrayList();</span>
<span class="fc bfc" id="L2489" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(HashSet.class)){</span>
<span class="fc" id="L2490">            list = new HashSet();</span>
<span class="fc bfc" id="L2491" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(LinkedHashSet.class)){</span>
<span class="fc" id="L2492">            list = new LinkedHashSet();</span>
<span class="fc bfc" id="L2493" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(TreeSet.class)){</span>
<span class="fc" id="L2494">            list = new TreeSet();</span>
<span class="fc bfc" id="L2495" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(ArrayList.class)){</span>
<span class="fc" id="L2496">            list = new ArrayList();</span>
<span class="fc bfc" id="L2497" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(EnumSet.class)){</span>
            Type itemType;
<span class="pc bpc" id="L2499" title="1 of 2 branches missed.">            if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2500">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
            } else{
<span class="nc" id="L2502">                itemType = Object.class;</span>
            }
<span class="fc" id="L2504">            list = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="fc bfc" id="L2505" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(Queue.class)){</span>
<span class="fc" id="L2506">            list = new LinkedList();</span>
        } else{
            try{
<span class="fc" id="L2509">                list = (Collection) rawClass.newInstance();</span>
<span class="fc" id="L2510">            } catch(Exception e){</span>
<span class="fc" id="L2511">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
<span class="fc" id="L2512">            }</span>
        }
<span class="fc" id="L2514">        return list;</span>
    }

    public static Class&lt;?&gt; getRawClass(Type type){
<span class="fc bfc" id="L2518" title="All 2 branches covered.">        if(type instanceof Class&lt;?&gt;){</span>
<span class="fc" id="L2519">            return (Class&lt;?&gt;) type;</span>
<span class="pc bpc" id="L2520" title="1 of 2 branches missed.">        } else if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2521">            return getRawClass(((ParameterizedType) type).getRawType());</span>
        } else{
<span class="nc" id="L2523">            throw new JSONException(&quot;TODO&quot;);</span>
        }
    }

    public static boolean isProxy(Class&lt;?&gt; clazz){
<span class="fc bfc" id="L2528" title="All 2 branches covered.">        for(Class&lt;?&gt; item : clazz.getInterfaces()){</span>
<span class="fc" id="L2529">            String interfaceName = item.getName();</span>
<span class="fc bfc" id="L2530" title="All 2 branches covered.">            if(interfaceName.equals(&quot;net.sf.cglib.proxy.Factory&quot;) //</span>
<span class="pc bpc" id="L2531" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.springframework.cglib.proxy.Factory&quot;)){</span>
<span class="fc" id="L2532">                return true;</span>
            }
<span class="fc bfc" id="L2534" title="All 2 branches covered.">            if(interfaceName.equals(&quot;javassist.util.proxy.ProxyObject&quot;) //</span>
<span class="pc bpc" id="L2535" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.apache.ibatis.javassist.util.proxy.ProxyObject&quot;)</span>
                    ){
<span class="fc" id="L2537">                return true;</span>
            }
<span class="pc bpc" id="L2539" title="1 of 2 branches missed.">            if (interfaceName.equals(&quot;org.hibernate.proxy.HibernateProxy&quot;)) {</span>
<span class="nc" id="L2540">                return true;</span>
            }
        }
<span class="fc" id="L2543">        return false;</span>
    }

    public static boolean isTransient(Method method){
<span class="fc bfc" id="L2547" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2548">            return false;</span>
        }
<span class="fc bfc" id="L2550" title="All 2 branches covered.">        if(!transientClassInited){</span>
            try{
<span class="fc" id="L2552">                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</span>
<span class="nc" id="L2553">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2556">                transientClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2559" title="1 of 2 branches missed.">        if(transientClass != null){</span>
<span class="fc" id="L2560">            Annotation annotation = TypeUtils.getAnnotation(method, transientClass);</span>
<span class="fc bfc" id="L2561" title="All 2 branches covered.">            return annotation != null;</span>
        }
<span class="nc" id="L2563">        return false;</span>
    }

    public static boolean isAnnotationPresentOneToMany(Method method) {
<span class="fc bfc" id="L2567" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2568">            return false;</span>
        }

<span class="pc bpc" id="L2571" title="1 of 4 branches missed.">        if (class_OneToMany == null &amp;&amp; !class_OneToMany_error) {</span>
            try {
<span class="fc" id="L2573">                class_OneToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.OneToMany&quot;);</span>
<span class="nc" id="L2574">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2576">                class_OneToMany_error = true;</span>
<span class="fc" id="L2577">            }</span>
        }
<span class="pc bpc" id="L2579" title="2 of 4 branches missed.">        return class_OneToMany != null &amp;&amp; method.isAnnotationPresent(class_OneToMany);</span>

    }

    public static boolean isAnnotationPresentManyToMany(Method method) {
<span class="fc bfc" id="L2584" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2585">            return false;</span>
        }

<span class="pc bpc" id="L2588" title="1 of 4 branches missed.">        if (class_ManyToMany == null &amp;&amp; !class_ManyToMany_error) {</span>
            try {
<span class="fc" id="L2590">                class_ManyToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.ManyToMany&quot;);</span>
<span class="nc" id="L2591">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2593">                class_ManyToMany_error = true;</span>
<span class="fc" id="L2594">            }</span>
        }
<span class="pc bpc" id="L2596" title="3 of 6 branches missed.">        return class_ManyToMany != null &amp;&amp; (method.isAnnotationPresent(class_OneToMany) || method.isAnnotationPresent(class_ManyToMany));</span>

    }

    public static boolean isHibernateInitialized(Object object){
<span class="pc bpc" id="L2601" title="1 of 2 branches missed.">        if(object == null){</span>
<span class="nc" id="L2602">            return false;</span>
        }
<span class="pc bpc" id="L2604" title="2 of 4 branches missed.">        if(method_HibernateIsInitialized == null &amp;&amp; !method_HibernateIsInitialized_error){</span>
            try{
<span class="fc" id="L2606">                Class&lt;?&gt; class_Hibernate = Class.forName(&quot;org.hibernate.Hibernate&quot;);</span>
<span class="fc" id="L2607">                method_HibernateIsInitialized = class_Hibernate.getMethod(&quot;isInitialized&quot;, Object.class);</span>
<span class="nc" id="L2608">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2610">                method_HibernateIsInitialized_error = true;</span>
<span class="fc" id="L2611">            }</span>
        }
<span class="pc bpc" id="L2613" title="1 of 2 branches missed.">        if(method_HibernateIsInitialized != null){</span>
            try{
<span class="fc" id="L2615">                Boolean initialized = (Boolean) method_HibernateIsInitialized.invoke(null, object);</span>
<span class="fc" id="L2616">                return initialized.booleanValue();</span>
<span class="nc" id="L2617">            } catch(Throwable e){</span>
                // skip
            }
        }
<span class="nc" id="L2621">        return true;</span>
    }

    public static double parseDouble(String str) {
<span class="fc" id="L2625">        final int len = str.length();</span>
<span class="fc bfc" id="L2626" title="All 2 branches covered.">        if (len &gt; 10) {</span>
<span class="fc" id="L2627">            return Double.parseDouble(str);</span>
        }

<span class="fc" id="L2630">        boolean negative = false;</span>

<span class="fc" id="L2632">        long longValue = 0;</span>
<span class="fc" id="L2633">        int scale = 0;</span>
<span class="fc bfc" id="L2634" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2635">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2636" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2637">                negative = true;</span>
<span class="fc" id="L2638">                continue;</span>
            }

<span class="fc bfc" id="L2641" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2642" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2643">                    return Double.parseDouble(str);</span>
                }
<span class="fc" id="L2645">                scale = len - i - 1;</span>
<span class="fc" id="L2646">                continue;</span>
            }

<span class="pc bpc" id="L2649" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2650">                int digit = ch - '0';</span>
<span class="fc" id="L2651">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2652">            } else {</span>
<span class="fc" id="L2653">                return Double.parseDouble(str);</span>
            }
        }

<span class="fc bfc" id="L2657" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2658">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2661" title="2 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2663">                return (double) longValue;</span>
            case 1:
<span class="fc" id="L2665">                return ((double) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2667">                return ((double) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2669">                return ((double) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L2671">                return ((double) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L2673">                return ((double) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L2675">                return ((double) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L2677">                return ((double) longValue) / 10000000;</span>
            case 8:
<span class="fc" id="L2679">                return ((double) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L2681">                return ((double) longValue) / 1000000000;</span>
        }

<span class="nc" id="L2684">        return Double.parseDouble(str);</span>
    }

    public static float parseFloat(String str) {
<span class="fc" id="L2688">        final int len = str.length();</span>
<span class="fc bfc" id="L2689" title="All 2 branches covered.">        if (len &gt;= 10) {</span>
<span class="fc" id="L2690">            return Float.parseFloat(str);</span>
        }

<span class="fc" id="L2693">        boolean negative = false;</span>

<span class="fc" id="L2695">        long longValue = 0;</span>
<span class="fc" id="L2696">        int scale = 0;</span>
<span class="fc bfc" id="L2697" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2698">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2699" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2700">                negative = true;</span>
<span class="fc" id="L2701">                continue;</span>
            }

<span class="fc bfc" id="L2704" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2705" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2706">                    return Float.parseFloat(str);</span>
                }
<span class="fc" id="L2708">                scale = len - i - 1;</span>
<span class="fc" id="L2709">                continue;</span>
            }

<span class="pc bpc" id="L2712" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2713">                int digit = ch - '0';</span>
<span class="fc" id="L2714">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2715">            } else {</span>
<span class="fc" id="L2716">                return Float.parseFloat(str);</span>
            }
        }

<span class="fc bfc" id="L2720" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2721">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2724" title="3 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2726">                return (float) longValue;</span>
            case 1:
<span class="fc" id="L2728">                return ((float) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2730">                return ((float) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2732">                return ((float) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L2734">                return ((float) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L2736">                return ((float) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L2738">                return ((float) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L2740">                return ((float) longValue) / 10000000;</span>
            case 8:
<span class="nc" id="L2742">                return ((float) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L2744">                return ((float) longValue) / 1000000000;</span>
        }

<span class="nc" id="L2747">        return Float.parseFloat(str);</span>
    }

    public static long fnv1a_64_lower(String key){
<span class="fc" id="L2751">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2752" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2753">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L2754" title="All 4 branches covered.">            if(ch == '_' || ch == '-'){</span>
<span class="fc" id="L2755">                continue;</span>
            }
<span class="fc bfc" id="L2757" title="All 4 branches covered.">            if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L2758">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L2760">            hashCode ^= ch;</span>
<span class="fc" id="L2761">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2763">        return hashCode;</span>
    }

    public static long fnv1a_64(String key){
<span class="fc" id="L2767">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2768" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2769">            char ch = key.charAt(i);</span>
<span class="fc" id="L2770">            hashCode ^= ch;</span>
<span class="fc" id="L2771">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2773">        return hashCode;</span>
    }

    public static boolean isKotlin(Class clazz) {
<span class="pc bpc" id="L2777" title="1 of 4 branches missed.">        if (kotlin_metadata == null &amp;&amp; !kotlin_metadata_error) {</span>
            try {
<span class="fc" id="L2779">                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</span>
<span class="nc" id="L2780">            } catch (Throwable e) {</span>
<span class="nc" id="L2781">                kotlin_metadata_error = true;</span>
<span class="fc" id="L2782">            }</span>
        }
<span class="pc bpc" id="L2784" title="1 of 4 branches missed.">        return kotlin_metadata != null &amp;&amp; clazz.isAnnotationPresent(kotlin_metadata);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors){
<span class="fc" id="L2788">        return getKoltinConstructor(constructors, null);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors, String[] paramNames){
<span class="fc" id="L2792">        Constructor creatorConstructor = null;</span>
<span class="fc bfc" id="L2793" title="All 2 branches covered.">        for(Constructor&lt;?&gt; constructor : constructors){</span>
<span class="fc" id="L2794">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
<span class="fc bfc" id="L2795" title="All 4 branches covered.">            if (paramNames != null &amp;&amp; parameterTypes.length != paramNames.length) {</span>
<span class="fc" id="L2796">                continue;</span>
            }

<span class="fc bfc" id="L2799" title="All 4 branches covered.">            if(parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)){</span>
<span class="fc" id="L2800">                continue;</span>
            }
<span class="fc bfc" id="L2802" title="All 4 branches covered.">            if(creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length){</span>
<span class="fc" id="L2803">                continue;</span>
            }
<span class="fc" id="L2805">            creatorConstructor = constructor;</span>
        }
<span class="fc" id="L2807">        return creatorConstructor;</span>
    }

    public static String[] getKoltinConstructorParameters(Class clazz){
<span class="pc bpc" id="L2811" title="1 of 4 branches missed.">        if(kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error){</span>
            try{
<span class="fc" id="L2813">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2814">                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</span>
<span class="nc" id="L2815">            } catch(Throwable e){</span>
<span class="nc" id="L2816">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2817">            }</span>
        }
<span class="pc bpc" id="L2819" title="1 of 2 branches missed.">        if (kotlin_kclass_constructor == null){</span>
<span class="nc" id="L2820">            return null;</span>
        }

<span class="pc bpc" id="L2823" title="1 of 4 branches missed.">        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2825">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2826">                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</span>
<span class="nc" id="L2827">            } catch(Throwable e){</span>
<span class="nc" id="L2828">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2829">            }</span>
        }

<span class="pc bpc" id="L2832" title="1 of 4 branches missed.">        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2834">                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</span>
<span class="fc" id="L2835">                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</span>
<span class="nc" id="L2836">            } catch(Throwable e){</span>
<span class="nc" id="L2837">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2838">            }</span>
        }

<span class="pc bpc" id="L2841" title="1 of 4 branches missed.">        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2843">                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</span>
<span class="fc" id="L2844">                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</span>
<span class="nc" id="L2845">            } catch(Throwable e){</span>
<span class="nc" id="L2846">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2847">            }</span>
        }

<span class="pc bpc" id="L2850" title="1 of 2 branches missed.">        if (kotlin_error){</span>
<span class="nc" id="L2851">            return null;</span>
        }

        try{
<span class="fc" id="L2855">            Object constructor = null;</span>
<span class="fc" id="L2856">            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</span>
<span class="fc" id="L2857">            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</span>
<span class="fc bfc" id="L2858" title="All 2 branches covered.">            for(Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()){</span>
<span class="fc" id="L2859">                Object item = iterator.next();</span>
<span class="fc" id="L2860">                List parameters = (List) kotlin_kfunction_getParameters.invoke(item);</span>
<span class="fc bfc" id="L2861" title="All 4 branches covered.">                if (constructor != null &amp;&amp; parameters.size() == 0) {</span>
<span class="fc" id="L2862">                    continue;</span>
                }
<span class="fc" id="L2864">                constructor = item;</span>
            }
<span class="fc" id="L2866">            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</span>
<span class="fc" id="L2867">            String[] names = new String[parameters.size()];</span>
<span class="fc bfc" id="L2868" title="All 2 branches covered.">            for(int i = 0; i &lt; parameters.size(); i++){</span>
<span class="fc" id="L2869">                Object param = parameters.get(i);</span>
<span class="fc" id="L2870">                names[i] = (String) kotlin_kparameter_getName.invoke(param);</span>
            }
<span class="fc" id="L2872">            return names;</span>
<span class="nc" id="L2873">        } catch(Throwable e){</span>
<span class="nc" id="L2874">            e.printStackTrace();</span>
<span class="nc" id="L2875">            kotlin_error = true;</span>
        }
<span class="nc" id="L2877">        return null;</span>
    }

    private static boolean isKotlinIgnore(Class clazz, String methodName) {
<span class="pc bpc" id="L2881" title="1 of 4 branches missed.">        if (kotlinIgnores == null &amp;&amp; !kotlinIgnores_error) {</span>
            try {
<span class="fc" id="L2883">                Map&lt;Class, String[]&gt; map = new HashMap&lt;Class, String[]&gt;();</span>
<span class="fc" id="L2884">                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</span>
<span class="fc" id="L2885">                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2886">                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</span>
<span class="fc" id="L2887">                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2888">                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</span>
<span class="fc" id="L2889">                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2890">                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</span>
<span class="fc" id="L2891">                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2892">                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</span>
<span class="fc" id="L2893">                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2894">                kotlinIgnores = map;</span>
<span class="nc" id="L2895">            } catch (Throwable error) {</span>
<span class="nc" id="L2896">                kotlinIgnores_error = true;</span>
<span class="fc" id="L2897">            }</span>
        }
<span class="pc bpc" id="L2899" title="1 of 2 branches missed.">        if (kotlinIgnores == null) {</span>
<span class="nc" id="L2900">            return false;</span>
        }
<span class="fc" id="L2902">        String[] ignores = kotlinIgnores.get(clazz);</span>
<span class="fc bfc" id="L2903" title="All 4 branches covered.">        return ignores != null &amp;&amp; Arrays.binarySearch(ignores, methodName) &gt;= 0;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; targetClass, Class&lt;A&gt; annotationClass){
<span class="fc" id="L2907">        A targetAnnotation = targetClass.getAnnotation(annotationClass);</span>

<span class="fc" id="L2909">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L2910">        Type type = JSON.getMixInAnnotations(targetClass);</span>
<span class="fc bfc" id="L2911" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2912">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2915" title="All 2 branches covered.">        if(mixInClass != null) {</span>
<span class="fc" id="L2916">            A mixInAnnotation = mixInClass.getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L2917" title="1 of 4 branches missed.">            if(mixInAnnotation == null &amp;&amp; mixInClass.getAnnotations().length &gt; 0){</span>
<span class="nc bnc" id="L2918" title="All 2 branches missed.">                for(Annotation annotation : mixInClass.getAnnotations()){</span>
<span class="nc" id="L2919">                    mixInAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="nc bnc" id="L2920" title="All 2 branches missed.">                    if(mixInAnnotation != null){</span>
<span class="nc" id="L2921">                        break;</span>
                    }
                }
            }
<span class="fc bfc" id="L2925" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L2926">                return mixInAnnotation;</span>
            }
        }

<span class="fc bfc" id="L2930" title="All 4 branches covered.">        if(targetAnnotation == null &amp;&amp; targetClass.getAnnotations().length &gt; 0){</span>
<span class="fc bfc" id="L2931" title="All 2 branches covered.">            for(Annotation annotation : targetClass.getAnnotations()){</span>
<span class="fc" id="L2932">                targetAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L2933" title="1 of 2 branches missed.">                if(targetAnnotation != null){</span>
<span class="nc" id="L2934">                    break;</span>
                }
            }
        }
<span class="fc" id="L2938">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Field field, Class&lt;A&gt; annotationClass){
<span class="fc" id="L2942">        A targetAnnotation = field.getAnnotation(annotationClass);</span>

<span class="fc" id="L2944">        Class&lt;?&gt; clazz = field.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L2946">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L2947">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L2948" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2949">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2952" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L2953">            Field mixInField = null;</span>
<span class="fc" id="L2954">            String fieldName = field.getName();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="pc bpc" id="L2956" title="1 of 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L2957">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L2959">                    mixInField = currClass.getDeclaredField(fieldName);</span>
<span class="fc" id="L2960">                    break;</span>
<span class="fc" id="L2961">                } catch (NoSuchFieldException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L2965" title="All 2 branches covered.">            if (mixInField == null) {</span>
<span class="fc" id="L2966">                return targetAnnotation;</span>
            }
<span class="fc" id="L2968">            mixInAnnotation = mixInField.getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L2969" title="1 of 2 branches missed.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L2970">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L2973">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Method method, Class&lt;A&gt; annotationClass){
<span class="fc" id="L2977">        A targetAnnotation = method.getAnnotation(annotationClass);</span>

<span class="fc" id="L2979">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L2981">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L2982">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L2983" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2984">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2987" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L2988">            Method mixInMethod = null;</span>
<span class="fc" id="L2989">            String methodName = method.getName();</span>
<span class="fc" id="L2990">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="fc bfc" id="L2992" title="All 4 branches covered.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L2993">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L2995">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="fc" id="L2996">                    break;</span>
<span class="fc" id="L2997">                } catch (NoSuchMethodException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L3001" title="All 2 branches covered.">            if (mixInMethod == null) {</span>
<span class="fc" id="L3002">                return targetAnnotation;</span>
            }
<span class="fc" id="L3004">            mixInAnnotation = mixInMethod.getAnnotation(annotationClass);</span>
<span class="fc bfc" id="L3005" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3006">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L3009">        return targetAnnotation;</span>
    }

    public static Annotation[][] getParameterAnnotations(Method method){
<span class="fc" id="L3013">        Annotation[][] targetAnnotations = method.getParameterAnnotations();</span>

<span class="fc" id="L3015">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3017">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3018">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="pc bpc" id="L3019" title="1 of 2 branches missed.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="nc" id="L3020">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="pc bpc" id="L3023" title="1 of 2 branches missed.">        if (mixInClass != null) {</span>
<span class="nc" id="L3024">            Method mixInMethod = null;</span>
<span class="nc" id="L3025">            String methodName = method.getName();</span>
<span class="nc" id="L3026">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="nc bnc" id="L3028" title="All 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="nc" id="L3029">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="nc" id="L3031">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="nc" id="L3032">                    break;</span>
<span class="nc" id="L3033">                } catch (NoSuchMethodException e) {</span>
<span class="nc" id="L3034">                    continue;</span>
                }
            }
<span class="nc bnc" id="L3037" title="All 2 branches missed.">            if (mixInMethod == null) {</span>
<span class="nc" id="L3038">                return targetAnnotations;</span>
            }
<span class="nc" id="L3040">            mixInAnnotations = mixInMethod.getParameterAnnotations();</span>
<span class="nc bnc" id="L3041" title="All 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="nc" id="L3042">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3045">        return targetAnnotations;</span>
    }

    public static Annotation[][] getParameterAnnotations(Constructor constructor){
<span class="fc" id="L3049">        Annotation[][] targetAnnotations = constructor.getParameterAnnotations();</span>

<span class="fc" id="L3051">        Class&lt;?&gt; clazz = constructor.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3053">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3054">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3055" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3056">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3059" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3060">            Constructor mixInConstructor = null;</span>
<span class="fc" id="L3061">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
            // 构建参数列表，因为内部类的构造函数需要传入外部类的引用
<span class="fc" id="L3063">            List&lt;Class&lt;?&gt;&gt; enclosingClasses = new ArrayList&lt;Class&lt;?&gt;&gt;(2);</span>
<span class="fc bfc" id="L3064" title="All 2 branches covered.">            for (Class&lt;?&gt; enclosingClass = mixInClass.getEnclosingClass(); enclosingClass != null; enclosingClass = enclosingClass.getEnclosingClass()) {</span>
<span class="fc" id="L3065">                enclosingClasses.add(enclosingClass);</span>
            }
<span class="fc" id="L3067">            int level = enclosingClasses.size();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="pc bpc" id="L3069" title="2 of 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="nc" id="L3070">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="pc bpc" id="L3072" title="1 of 2 branches missed.">                    if (level != 0) {</span>
<span class="fc" id="L3073">                        Class&lt;?&gt;[] outerClassAndParameterTypes = new Class[level + parameterTypes.length];</span>
<span class="fc" id="L3074">                        System.arraycopy(parameterTypes, 0, outerClassAndParameterTypes, level, parameterTypes.length);</span>
<span class="fc bfc" id="L3075" title="All 2 branches covered.">                        for (int i = level; i &gt; 0 ; i--) {</span>
<span class="fc" id="L3076">                            outerClassAndParameterTypes[i - 1] = enclosingClasses.get(i - 1);</span>
                        }
<span class="fc" id="L3078">                        mixInConstructor = mixInClass.getDeclaredConstructor(outerClassAndParameterTypes);</span>
<span class="fc" id="L3079">                    } else {</span>
<span class="nc" id="L3080">                        mixInConstructor = mixInClass.getDeclaredConstructor(parameterTypes);</span>
                    }
<span class="fc" id="L3082">                    break;</span>
<span class="nc" id="L3083">                } catch (NoSuchMethodException e) {</span>
<span class="nc" id="L3084">                    level--;</span>
                }
            }
<span class="pc bpc" id="L3087" title="1 of 2 branches missed.">            if (mixInConstructor == null) {</span>
<span class="nc" id="L3088">                return targetAnnotations;</span>
            }
<span class="fc" id="L3090">            mixInAnnotations = mixInConstructor.getParameterAnnotations();</span>
<span class="pc bpc" id="L3091" title="1 of 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="fc" id="L3092">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3095">        return targetAnnotations;</span>
    }

    public static boolean isJacksonCreator(Method method) {
<span class="pc bpc" id="L3099" title="1 of 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L3100">            return false;</span>
        }

<span class="pc bpc" id="L3103" title="1 of 4 branches missed.">        if (class_JacksonCreator == null &amp;&amp; !class_JacksonCreator_error) {</span>
            try {
<span class="fc" id="L3105">                class_JacksonCreator = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;com.fasterxml.jackson.annotation.JsonCreator&quot;);</span>
<span class="nc" id="L3106">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L3108">                class_JacksonCreator_error = true;</span>
<span class="fc" id="L3109">            }</span>
        }
<span class="pc bpc" id="L3111" title="1 of 4 branches missed.">        return class_JacksonCreator != null &amp;&amp; method.isAnnotationPresent(class_JacksonCreator);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>