<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONScanner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.parser</a> &gt; <span class="el_source">JSONScanner.java</span></div><h1>JSONScanner.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.parser;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.util.ASMUtils;
import com.alibaba.fastjson.util.IOUtils;

import java.math.BigDecimal;
import java.util.*;

//这个类，为了性能优化做了很多特别处理，一切都是为了性能！！！

/**
 * @author wenshao[szujobs@hotmail.com]
 */
public final class JSONScanner extends JSONLexerBase {

    private final String text;
    private final int    len;

    public JSONScanner(String input){
<span class="fc" id="L37">        this(input, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L38">    }</span>

    public JSONScanner(String input, int features){
<span class="fc" id="L41">        super(features);</span>

<span class="fc" id="L43">        text = input;</span>
<span class="fc" id="L44">        len = text.length();</span>
<span class="fc" id="L45">        bp = -1;</span>

<span class="fc" id="L47">        next();</span>
<span class="fc bfc" id="L48" title="All 2 branches covered.">        if (ch == 65279) { // utf-8 bom</span>
<span class="fc" id="L49">            next();</span>
        }
<span class="fc" id="L51">    }</span>

    public final char charAt(int index) {
<span class="fc bfc" id="L54" title="All 2 branches covered.">        if (index &gt;= len) {</span>
<span class="fc" id="L55">            return EOI;</span>
        }

<span class="fc" id="L58">        return text.charAt(index);</span>
    }

    public final char next() {
<span class="fc" id="L62">        int index = ++bp;</span>
<span class="fc bfc" id="L63" title="All 2 branches covered.">        return ch = (index &gt;= this.len ? //</span>
<span class="fc" id="L64">                EOI //</span>
<span class="fc" id="L65">                : text.charAt(index));</span>
    }

    public JSONScanner(char[] input, int inputLength){
<span class="fc" id="L69">        this(input, inputLength, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L70">    }</span>

    public JSONScanner(char[] input, int inputLength, int features){
<span class="fc" id="L73">        this(new String(input, 0, inputLength), features);</span>
<span class="fc" id="L74">    }</span>

    protected final void copyTo(int offset, int count, char[] dest) {
<span class="fc" id="L77">        text.getChars(offset, offset + count, dest, 0);</span>
<span class="fc" id="L78">    }</span>

    static boolean charArrayCompare(String src, int offset, char[] dest) {
<span class="fc" id="L81">        final int destLen = dest.length;</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (destLen + offset &gt; src.length()) {</span>
<span class="fc" id="L83">            return false;</span>
        }

<span class="fc bfc" id="L86" title="All 2 branches covered.">        for (int i = 0; i &lt; destLen; ++i) {</span>
<span class="fc bfc" id="L87" title="All 2 branches covered.">            if (dest[i] != src.charAt(offset + i)) {</span>
<span class="fc" id="L88">                return false;</span>
            }
        }

<span class="fc" id="L92">        return true;</span>
    }

    public final boolean charArrayCompare(char[] chars) {
<span class="fc" id="L96">        return charArrayCompare(text, bp, chars);</span>
    }

    public final int indexOf(char ch, int startIndex) {
<span class="fc" id="L100">        return text.indexOf(ch, startIndex);</span>
    }

    public final String addSymbol(int offset, int len, int hash, final SymbolTable symbolTable) {
<span class="fc" id="L104">        return symbolTable.addSymbol(text, offset, len, hash);</span>
    }

    public byte[] bytesValue() {
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (token == JSONToken.HEX) {</span>
<span class="fc" id="L109">            int start = np + 1, len = sp;</span>
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">            if (len % 2 != 0) {</span>
<span class="nc" id="L111">                throw new JSONException(&quot;illegal state. &quot; + len);</span>
            }

<span class="fc" id="L114">            byte[] bytes = new byte[len / 2];</span>
<span class="fc bfc" id="L115" title="All 2 branches covered.">            for (int i = 0; i &lt; bytes.length; ++i) {</span>
<span class="fc" id="L116">                char c0 = text.charAt(start + i * 2);</span>
<span class="fc" id="L117">                char c1 = text.charAt(start + i * 2 + 1);</span>

<span class="fc bfc" id="L119" title="All 2 branches covered.">                int b0 = c0 - (c0 &lt;= 57 ? 48 : 55);</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">                int b1 = c1 - (c1 &lt;= 57 ? 48 : 55);</span>
<span class="fc" id="L121">                bytes[i] = (byte) ((b0 &lt;&lt; 4) | b1);</span>
            }

<span class="fc" id="L124">            return bytes;</span>
        }

<span class="fc bfc" id="L127" title="All 2 branches covered.">        if (!hasSpecial) {</span>
<span class="fc" id="L128">            return IOUtils.decodeBase64(text, np + 1, sp);</span>
        } else {
<span class="fc" id="L130">            String escapedText = new String(sbuf, 0, sp);</span>
<span class="fc" id="L131">            return IOUtils.decodeBase64(escapedText);</span>
        }
    }

    /**
     * The value of a literal token, recorded as a string. For integers, leading 0x and 'l' suffixes are suppressed.
     */
    public final String stringVal() {
<span class="fc bfc" id="L139" title="All 2 branches covered.">        if (!hasSpecial) {</span>
<span class="fc" id="L140">            return this.subString(np + 1, sp);</span>
        } else {
<span class="fc" id="L142">            return new String(sbuf, 0, sp);</span>
        }
    }

    public final String subString(int offset, int count) {
<span class="pc bpc" id="L147" title="1 of 2 branches missed.">        if (ASMUtils.IS_ANDROID) {</span>
<span class="nc bnc" id="L148" title="All 2 branches missed.">            if (count &lt; sbuf.length) {</span>
<span class="nc" id="L149">                text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L150">                return new String(sbuf, 0, count);</span>
            } else {
<span class="nc" id="L152">                char[] chars = new char[count];</span>
<span class="nc" id="L153">                text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L154">                return new String(chars);</span>
            }
        } else {
<span class="fc" id="L157">            return text.substring(offset, offset + count);</span>
        }
    }

    public final char[] sub_chars(int offset, int count) {
<span class="pc bpc" id="L162" title="3 of 4 branches missed.">        if (ASMUtils.IS_ANDROID &amp;&amp; count &lt; sbuf.length) {</span>
<span class="nc" id="L163">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L164">            return sbuf;</span>
        } else {
<span class="fc" id="L166">            char[] chars = new char[count];</span>
<span class="fc" id="L167">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="fc" id="L168">            return chars;</span>
        }
    }

    public final String numberString() {
<span class="fc" id="L173">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L175">        int sp = this.sp;</span>
<span class="fc bfc" id="L176" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L177">            sp--;</span>
        }

<span class="fc" id="L180">        return this.subString(np, sp);</span>
    }

    public final BigDecimal decimalValue() {
<span class="fc" id="L184">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L186">        int sp = this.sp;</span>
<span class="fc bfc" id="L187" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L188">            sp--;</span>
        }

<span class="fc" id="L191">        int offset = np, count = sp;</span>
<span class="pc bpc" id="L192" title="1 of 2 branches missed.">        if (count &lt; sbuf.length) {</span>
<span class="fc" id="L193">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="fc" id="L194">            return new BigDecimal(sbuf, 0, count);</span>
        } else {
<span class="nc" id="L196">            char[] chars = new char[count];</span>
<span class="nc" id="L197">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L198">            return new BigDecimal(chars);</span>
        }
    }

    public boolean scanISO8601DateIfMatch() {
<span class="fc" id="L203">        return scanISO8601DateIfMatch(true);</span>
    }

    public boolean scanISO8601DateIfMatch(boolean strict) {
<span class="fc" id="L207">        int rest = len - bp;</span>
<span class="fc" id="L208">        return scanISO8601DateIfMatch(strict, rest);</span>
    }

    private boolean scanISO8601DateIfMatch(boolean strict, int rest) {
<span class="fc bfc" id="L212" title="All 2 branches covered.">        if (rest &lt; 8) {</span>
<span class="fc" id="L213">            return false;</span>
        }

<span class="fc" id="L216">        char c0 = charAt(bp);</span>
<span class="fc" id="L217">        char c1 = charAt(bp + 1);</span>
<span class="fc" id="L218">        char c2 = charAt(bp + 2);</span>
<span class="fc" id="L219">        char c3 = charAt(bp + 3);</span>
<span class="fc" id="L220">        char c4 = charAt(bp + 4);</span>
<span class="fc" id="L221">        char c5 = charAt(bp + 5);</span>
<span class="fc" id="L222">        char c6 = charAt(bp + 6);</span>
<span class="fc" id="L223">        char c7 = charAt(bp + 7);</span>

<span class="fc bfc" id="L225" title="All 4 branches covered.">        if ((!strict) &amp;&amp; rest &gt; 13) {</span>
<span class="fc" id="L226">            char c_r0 = charAt(bp + rest - 1);</span>
<span class="fc" id="L227">            char c_r1 = charAt(bp + rest - 2);</span>
<span class="pc bpc" id="L228" title="6 of 14 branches missed.">            if (c0 == '/' &amp;&amp; c1 == 'D' &amp;&amp; c2 == 'a' &amp;&amp; c3 == 't' &amp;&amp; c4 == 'e' &amp;&amp; c5 == '(' &amp;&amp; c_r0 == '/'</span>
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">                    &amp;&amp; c_r1 == ')') {</span>
<span class="fc" id="L230">                int plusIndex = -1;</span>
<span class="pc bpc" id="L231" title="1 of 2 branches missed.">                for (int i = 6; i &lt; rest; ++i) {</span>
<span class="fc" id="L232">                    char c = charAt(bp + i);</span>
<span class="fc bfc" id="L233" title="All 2 branches covered.">                    if (c == '+') {</span>
<span class="fc" id="L234">                        plusIndex = i;</span>
<span class="fc bfc" id="L235" title="All 4 branches covered.">                    } else if (c &lt; '0' || c &gt; '9') {</span>
<span class="fc" id="L236">                        break;</span>
                    }
                }
<span class="fc bfc" id="L239" title="All 2 branches covered.">                if (plusIndex == -1) {</span>
<span class="fc" id="L240">                    return false;</span>
                }
<span class="fc" id="L242">                int offset = bp + 6;</span>
<span class="fc" id="L243">                String numberText = this.subString(offset, bp + plusIndex - offset);</span>
<span class="fc" id="L244">                long millis = Long.parseLong(numberText);</span>

<span class="fc" id="L246">                calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L247">                calendar.setTimeInMillis(millis);</span>

<span class="fc" id="L249">                token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L250">                return true;</span>
            }
        }

        char c10;
<span class="fc bfc" id="L255" title="All 2 branches covered.">        if (rest == 8</span>
<span class="fc bfc" id="L256" title="All 2 branches covered.">                || rest == 14</span>
<span class="fc bfc" id="L257" title="All 6 branches covered.">                || (rest == 16 &amp;&amp; ((c10 = charAt(bp + 10)) == 'T' || c10 == ' '))</span>
<span class="fc bfc" id="L258" title="All 4 branches covered.">                || (rest == 17 &amp;&amp; charAt(bp + 6) != '-')) {</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">            if (strict) {</span>
<span class="fc" id="L260">                return false;</span>
            }

            char y0, y1, y2, y3, M0, M1, d0, d1;



<span class="fc" id="L267">            char c8 = charAt(bp + 8);</span>

<span class="fc bfc" id="L269" title="All 4 branches covered.">            final boolean c_47 = c4 == '-' &amp;&amp; c7 == '-';</span>
<span class="fc bfc" id="L270" title="All 4 branches covered.">            final boolean sperate16 = c_47 &amp;&amp; rest == 16;</span>
<span class="fc bfc" id="L271" title="All 4 branches covered.">            final boolean sperate17 = c_47 &amp;&amp; rest == 17;</span>
<span class="fc bfc" id="L272" title="All 4 branches covered.">            if (sperate17 || sperate16) {</span>
<span class="fc" id="L273">                y0 = c0;</span>
<span class="fc" id="L274">                y1 = c1;</span>
<span class="fc" id="L275">                y2 = c2;</span>
<span class="fc" id="L276">                y3 = c3;</span>
<span class="fc" id="L277">                M0 = c5;</span>
<span class="fc" id="L278">                M1 = c6;</span>
<span class="fc" id="L279">                d0 = c8;</span>
<span class="fc" id="L280">                d1 = charAt(bp + 9);</span>
<span class="pc bpc" id="L281" title="1 of 4 branches missed.">            } else if (c4 == '-' &amp;&amp; c6 == '-') {</span>
<span class="fc" id="L282">                y0 = c0;</span>
<span class="fc" id="L283">                y1 = c1;</span>
<span class="fc" id="L284">                y2 = c2;</span>
<span class="fc" id="L285">                y3 = c3;</span>
<span class="fc" id="L286">                M0 = '0';</span>
<span class="fc" id="L287">                M1 = c5;</span>
<span class="fc" id="L288">                d0 = '0';</span>
<span class="fc" id="L289">                d1 = c7;</span>
<span class="fc" id="L290">            } else {</span>
<span class="fc" id="L291">                y0 = c0;</span>
<span class="fc" id="L292">                y1 = c1;</span>
<span class="fc" id="L293">                y2 = c2;</span>
<span class="fc" id="L294">                y3 = c3;</span>
<span class="fc" id="L295">                M0 = c4;</span>
<span class="fc" id="L296">                M1 = c5;</span>
<span class="fc" id="L297">                d0 = c6;</span>
<span class="fc" id="L298">                d1 = c7;</span>
            }


<span class="fc bfc" id="L302" title="All 2 branches covered.">            if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L303">                return false;</span>
            }

<span class="fc" id="L306">            setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

            int hour, minute, seconds, millis;
<span class="fc bfc" id="L309" title="All 2 branches covered.">            if (rest != 8) {</span>
<span class="fc" id="L310">                char c9 = charAt(bp + 9);</span>
<span class="fc" id="L311">                c10 = charAt(bp + 10);</span>
<span class="fc" id="L312">                char c11 = charAt(bp + 11);</span>
<span class="fc" id="L313">                char c12 = charAt(bp + 12);</span>
<span class="fc" id="L314">                char c13 = charAt(bp + 13);</span>

                char h0, h1, m0, m1, s0, s1;

<span class="pc bpc" id="L318" title="3 of 8 branches missed.">                if ((sperate17 &amp;&amp; c10 == 'T' &amp;&amp; c13 == ':' &amp;&amp; charAt(bp + 16) == 'Z')</span>
<span class="pc bpc" id="L319" title="2 of 8 branches missed.">                        || (sperate16 &amp;&amp; (c10 == ' ' || c10 == 'T') &amp;&amp; c13 == ':')) {</span>
<span class="fc" id="L320">                    h0 = c11;</span>
<span class="fc" id="L321">                    h1 = c12;</span>
<span class="fc" id="L322">                    m0 = charAt(bp + 14);</span>
<span class="fc" id="L323">                    m1 = charAt(bp + 15);</span>
<span class="fc" id="L324">                    s0 = '0';</span>
<span class="fc" id="L325">                    s1 = '0';</span>
<span class="fc" id="L326">                } else {</span>
<span class="fc" id="L327">                    h0 = c8;</span>
<span class="fc" id="L328">                    h1 = c9;</span>
<span class="fc" id="L329">                    m0 = c10;</span>
<span class="fc" id="L330">                    m1 = c11;</span>
<span class="fc" id="L331">                    s0 = c12;</span>
<span class="fc" id="L332">                    s1 = c13;</span>
                }

<span class="fc bfc" id="L335" title="All 2 branches covered.">                if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L336">                    return false;</span>
                }

<span class="fc bfc" id="L339" title="All 4 branches covered.">                if (rest == 17 &amp;&amp; !sperate17) {</span>
<span class="fc" id="L340">                    char S0 = charAt(bp + 14);</span>
<span class="fc" id="L341">                    char S1 = charAt(bp + 15);</span>
<span class="fc" id="L342">                    char S2 = charAt(bp + 16);</span>
<span class="fc bfc" id="L343" title="All 4 branches covered.">                    if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L344">                        return false;</span>
                    }
<span class="fc bfc" id="L346" title="All 4 branches covered.">                    if (S1 &lt; '0' || S1 &gt; '9') {</span>
<span class="fc" id="L347">                        return false;</span>
                    }
<span class="fc bfc" id="L349" title="All 4 branches covered.">                    if (S2 &lt; '0' || S2 &gt; '9') {</span>
<span class="fc" id="L350">                        return false;</span>
                    }

<span class="fc" id="L353">                    millis = (S0 - '0') * 100 + (S1 - '0') * 10 + (S2 - '0');</span>
<span class="fc" id="L354">                } else {</span>
<span class="fc" id="L355">                    millis = 0;</span>
                }

<span class="fc" id="L358">                hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L359">                minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L360">                seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L361">            } else {</span>
<span class="fc" id="L362">                hour = 0;</span>
<span class="fc" id="L363">                minute = 0;</span>
<span class="fc" id="L364">                seconds = 0;</span>
<span class="fc" id="L365">                millis = 0;</span>
            }

<span class="fc" id="L368">            calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L369">            calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L370">            calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L371">            calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L373">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L374">            return true;</span>
        }

<span class="pc bpc" id="L377" title="1 of 2 branches missed.">        if (rest &lt; 9) {</span>
<span class="nc" id="L378">            return false;</span>
        }

<span class="fc" id="L381">        char c8 = charAt(bp + 8);</span>
<span class="fc" id="L382">        char c9 = charAt(bp + 9);</span>

<span class="fc" id="L384">        int date_len = 10;</span>
        char y0, y1, y2, y3, M0, M1, d0, d1;
<span class="fc bfc" id="L386" title="All 4 branches covered.">        if ((c4 == '-' &amp;&amp; c7 == '-') // cn</span>
<span class="fc bfc" id="L387" title="All 4 branches covered.">                ||  (c4 == '/' &amp;&amp; c7 == '/') // tw yyyy/mm/dd</span>
        ) {
<span class="fc" id="L389">            y0 = c0;</span>
<span class="fc" id="L390">            y1 = c1;</span>
<span class="fc" id="L391">            y2 = c2;</span>
<span class="fc" id="L392">            y3 = c3;</span>
<span class="fc" id="L393">            M0 = c5;</span>
<span class="fc" id="L394">            M1 = c6;</span>

<span class="fc bfc" id="L396" title="All 2 branches covered.">            if (c9 == ' ') {</span>
<span class="fc" id="L397">                d0 = '0';</span>
<span class="fc" id="L398">                d1 = c8;</span>
<span class="fc" id="L399">                date_len = 9;</span>
<span class="fc" id="L400">            } else {</span>
<span class="fc" id="L401">                d0 = c8;</span>
<span class="fc" id="L402">                d1 = c9;</span>
            }
<span class="fc bfc" id="L404" title="All 4 branches covered.">        } else if ((c4 == '-' &amp;&amp; c6 == '-') // cn yyyy-m-dd</span>
        ) {
<span class="fc" id="L406">            y0 = c0;</span>
<span class="fc" id="L407">            y1 = c1;</span>
<span class="fc" id="L408">            y2 = c2;</span>
<span class="fc" id="L409">            y3 = c3;</span>
<span class="fc" id="L410">            M0 = '0';</span>
<span class="fc" id="L411">            M1 = c5;</span>

<span class="fc bfc" id="L413" title="All 2 branches covered.">            if (c8 == ' ') {</span>
<span class="fc" id="L414">                d0 = '0';</span>
<span class="fc" id="L415">                d1 = c7;</span>
<span class="fc" id="L416">                date_len = 8;</span>
<span class="fc" id="L417">            } else {</span>
<span class="fc" id="L418">                d0 = c7;</span>
<span class="fc" id="L419">                d1 = c8;</span>
<span class="fc" id="L420">                date_len = 9;</span>
            }
<span class="pc bpc" id="L422" title="1 of 4 branches missed.">        } else if ((c2 == '.' &amp;&amp; c5 == '.') // de dd.mm.yyyy</span>
<span class="pc bpc" id="L423" title="1 of 4 branches missed.">                || (c2 == '-' &amp;&amp; c5 == '-') // in dd-mm-yyyy</span>
        ) {
<span class="fc" id="L425">            d0 = c0;</span>
<span class="fc" id="L426">            d1 = c1;</span>
<span class="fc" id="L427">            M0 = c3;</span>
<span class="fc" id="L428">            M1 = c4;</span>
<span class="fc" id="L429">            y0 = c6;</span>
<span class="fc" id="L430">            y1 = c7;</span>
<span class="fc" id="L431">            y2 = c8;</span>
<span class="fc" id="L432">            y3 = c9;</span>
<span class="fc bfc" id="L433" title="All 2 branches covered.">        } else if (c8 == 'T') {</span>
<span class="fc" id="L434">            y0 = c0;</span>
<span class="fc" id="L435">            y1 = c1;</span>
<span class="fc" id="L436">            y2 = c2;</span>
<span class="fc" id="L437">            y3 = c3;</span>
<span class="fc" id="L438">            M0 = c4;</span>
<span class="fc" id="L439">            M1 = c5;</span>
<span class="fc" id="L440">            d0 = c6;</span>
<span class="fc" id="L441">            d1 = c7;</span>
<span class="fc" id="L442">            date_len = 8;</span>
<span class="fc" id="L443">        } else {</span>
<span class="fc bfc" id="L444" title="All 4 branches covered.">            if (c4 == '年' || c4 == '년') {</span>
<span class="fc" id="L445">                y0 = c0;</span>
<span class="fc" id="L446">                y1 = c1;</span>
<span class="fc" id="L447">                y2 = c2;</span>
<span class="fc" id="L448">                y3 = c3;</span>

<span class="fc bfc" id="L450" title="All 4 branches covered.">                if (c7 == '月' || c7 == '월') {</span>
<span class="fc" id="L451">                    M0 = c5;</span>
<span class="fc" id="L452">                    M1 = c6;</span>
<span class="fc bfc" id="L453" title="All 4 branches covered.">                    if (c9 == '日' || c9 == '일') {</span>
<span class="fc" id="L454">                        d0 = '0';</span>
<span class="fc" id="L455">                        d1 = c8;</span>
<span class="pc bpc" id="L456" title="1 of 4 branches missed.">                    } else if (charAt(bp + 10) == '日' || charAt(bp + 10) == '일'){</span>
<span class="fc" id="L457">                        d0 = c8;</span>
<span class="fc" id="L458">                        d1 = c9;</span>
<span class="fc" id="L459">                        date_len = 11;</span>
<span class="fc" id="L460">                    } else {</span>
<span class="nc" id="L461">                        return false;</span>
                    }
<span class="pc bpc" id="L463" title="1 of 4 branches missed.">                } else if (c6 == '月' || c6 == '월') {</span>
<span class="fc" id="L464">                    M0 = '0';</span>
<span class="fc" id="L465">                    M1 = c5;</span>
<span class="fc bfc" id="L466" title="All 4 branches covered.">                    if (c8 == '日' || c8 == '일') {</span>
<span class="fc" id="L467">                        d0 = '0';</span>
<span class="fc" id="L468">                        d1 = c7;</span>
<span class="pc bpc" id="L469" title="1 of 4 branches missed.">                    } else if (c9 == '日' || c9 == '일'){</span>
<span class="fc" id="L470">                        d0 = c7;</span>
<span class="fc" id="L471">                        d1 = c8;</span>
<span class="fc" id="L472">                    } else {</span>
<span class="nc" id="L473">                        return false;</span>
                    }
                } else {
<span class="nc" id="L476">                    return false;</span>
                }
            } else {
<span class="fc" id="L479">                return false;</span>
            }
        }

<span class="fc bfc" id="L483" title="All 2 branches covered.">        if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L484">            return false;</span>
        }

<span class="fc" id="L487">        setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

<span class="fc" id="L489">        char t = charAt(bp + date_len);</span>
<span class="pc bpc" id="L490" title="2 of 8 branches missed.">        if (t == 'T' &amp;&amp; rest == 16 &amp;&amp; date_len == 8 &amp;&amp; charAt(bp + 15) == 'Z') {</span>
<span class="fc" id="L491">            char h0 = charAt(bp + date_len + 1);</span>
<span class="fc" id="L492">            char h1 = charAt(bp + date_len + 2);</span>
<span class="fc" id="L493">            char m0 = charAt(bp + date_len + 3);</span>
<span class="fc" id="L494">            char m1 = charAt(bp + date_len + 4);</span>
<span class="fc" id="L495">            char s0 = charAt(bp + date_len + 5);</span>
<span class="fc" id="L496">            char s1 = charAt(bp + date_len + 6);</span>

<span class="pc bpc" id="L498" title="1 of 2 branches missed.">            if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="nc" id="L499">                return false;</span>
            }

<span class="fc" id="L502">            setTime(h0, h1, m0, m1, s0, s1);</span>
<span class="fc" id="L503">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="pc bpc" id="L505" title="1 of 2 branches missed.">            if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L506">                String[] timeZoneIDs = TimeZone.getAvailableIDs(0);</span>
<span class="pc bpc" id="L507" title="1 of 2 branches missed.">                if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L508">                    TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L509">                    calendar.setTimeZone(timeZone);</span>
                }
            }

<span class="fc" id="L513">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L514">            return true;</span>
<span class="fc bfc" id="L515" title="All 6 branches covered.">        } else if (t == 'T' || (t == ' ' &amp;&amp; !strict)) {</span>
<span class="fc bfc" id="L516" title="All 2 branches covered.">            if (rest &lt; date_len + 9) { // &quot;0000-00-00T00:00:00&quot;.length()</span>
<span class="fc" id="L517">                return false;</span>
            }
<span class="pc bpc" id="L519" title="2 of 8 branches missed.">        } else if (t == '&quot;' || t == EOI || t == '日' || t == '일') {</span>
<span class="fc" id="L520">            calendar.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="fc" id="L521">            calendar.set(Calendar.MINUTE, 0);</span>
<span class="fc" id="L522">            calendar.set(Calendar.SECOND, 0);</span>
<span class="fc" id="L523">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="fc" id="L525">            ch = charAt(bp += date_len);</span>

<span class="fc" id="L527">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L528">            return true;</span>
<span class="pc bpc" id="L529" title="1 of 4 branches missed.">        } else if (t == '+' || t == '-') {</span>
<span class="fc bfc" id="L530" title="All 2 branches covered.">            if (len == date_len + 6) {</span>
<span class="pc bpc" id="L531" title="1 of 2 branches missed.">                if (charAt(bp + date_len + 3) != ':' //</span>
<span class="pc bpc" id="L532" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 4) != '0' //</span>
<span class="pc bpc" id="L533" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 5) != '0') {</span>
<span class="nc" id="L534">                    return false;</span>
                }

<span class="fc" id="L537">                setTime('0', '0', '0', '0', '0', '0');</span>
<span class="fc" id="L538">                calendar.set(Calendar.MILLISECOND, 0);</span>
<span class="fc" id="L539">                setTimeZone(t, charAt(bp + date_len + 1), charAt(bp + date_len + 2));</span>
<span class="fc" id="L540">                return true;</span>
            }
<span class="fc" id="L542">            return false;</span>
        } else {
<span class="fc" id="L544">            return false;</span>
        }

<span class="fc bfc" id="L547" title="All 2 branches covered.">        if (charAt(bp + date_len + 3) != ':') {</span>
<span class="fc" id="L548">            return false;</span>
        }
<span class="fc bfc" id="L550" title="All 2 branches covered.">        if (charAt(bp + date_len + 6) != ':') {</span>
<span class="fc" id="L551">            return false;</span>
        }

<span class="fc" id="L554">        char h0 = charAt(bp + date_len + 1);</span>
<span class="fc" id="L555">        char h1 = charAt(bp + date_len + 2);</span>
<span class="fc" id="L556">        char m0 = charAt(bp + date_len + 4);</span>
<span class="fc" id="L557">        char m1 = charAt(bp + date_len + 5);</span>
<span class="fc" id="L558">        char s0 = charAt(bp + date_len + 7);</span>
<span class="fc" id="L559">        char s1 = charAt(bp + date_len + 8);</span>

<span class="fc bfc" id="L561" title="All 2 branches covered.">        if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L562">            return false;</span>
        }

<span class="fc" id="L565">        setTime(h0, h1, m0, m1, s0, s1);</span>

<span class="fc" id="L567">        char dot = charAt(bp + date_len + 9);</span>
<span class="fc" id="L568">        int millisLen = -1; // 有可能没有毫秒区域，没有毫秒区域的时候下一个字符位置有可能是'Z'、'+'、'-'</span>
<span class="fc" id="L569">        int millis = 0;</span>
<span class="fc bfc" id="L570" title="All 2 branches covered.">        if (dot == '.') { // 0000-00-00T00:00:00.000</span>
<span class="fc bfc" id="L571" title="All 2 branches covered.">            if (rest &lt; date_len + 11) {</span>
<span class="fc" id="L572">                return false;</span>
            }

<span class="fc" id="L575">            char S0 = charAt(bp + date_len + 10);</span>
<span class="fc bfc" id="L576" title="All 4 branches covered.">            if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L577">                return false;</span>
            }
<span class="fc" id="L579">            millis = S0 - '0';</span>
<span class="fc" id="L580">            millisLen = 1;</span>

<span class="fc bfc" id="L582" title="All 2 branches covered.">            if (rest &gt; date_len + 11) {</span>
<span class="fc" id="L583">                char S1 = charAt(bp + date_len + 11);</span>
<span class="fc bfc" id="L584" title="All 4 branches covered.">                if (S1 &gt;= '0' &amp;&amp; S1 &lt;= '9') {</span>
<span class="fc" id="L585">                    millis = millis * 10 + (S1 - '0');</span>
<span class="fc" id="L586">                    millisLen = 2;</span>
                }
            }

<span class="fc bfc" id="L590" title="All 2 branches covered.">            if (millisLen == 2) {</span>
<span class="fc" id="L591">                char S2 = charAt(bp + date_len + 12);</span>
<span class="fc bfc" id="L592" title="All 4 branches covered.">                if (S2 &gt;= '0' &amp;&amp; S2 &lt;= '9') {</span>
<span class="fc" id="L593">                    millis = millis * 10 + (S2 - '0');</span>
<span class="fc" id="L594">                    millisLen = 3;</span>
                }
            }
        }
<span class="fc" id="L598">        calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L600">        int timzeZoneLength = 0;</span>
<span class="fc" id="L601">        char timeZoneFlag = charAt(bp + date_len + 10 + millisLen);</span>

<span class="fc bfc" id="L603" title="All 2 branches covered.">        if (timeZoneFlag == ' ') {</span>
<span class="fc" id="L604">            millisLen++;</span>
<span class="fc" id="L605">            timeZoneFlag = charAt(bp + date_len + 10 + millisLen);</span>
        }

<span class="fc bfc" id="L608" title="All 4 branches covered.">        if (timeZoneFlag == '+' || timeZoneFlag == '-') {</span>
<span class="fc" id="L609">            char t0 = charAt(bp + date_len + 10 + millisLen + 1);</span>
<span class="pc bpc" id="L610" title="2 of 4 branches missed.">            if (t0 &lt; '0' || t0 &gt; '1') {</span>
<span class="nc" id="L611">                return false;</span>
            }

<span class="fc" id="L614">            char t1 = charAt(bp + date_len + 10 + millisLen + 2);</span>
<span class="pc bpc" id="L615" title="2 of 4 branches missed.">            if (t1 &lt; '0' || t1 &gt; '9') {</span>
<span class="nc" id="L616">                return false;</span>
            }

<span class="fc" id="L619">            char t2 = charAt(bp + date_len + 10 + millisLen + 3);</span>
<span class="fc" id="L620">            char t3 = '0', t4 = '0';</span>
<span class="fc bfc" id="L621" title="All 2 branches covered.">            if (t2 == ':') { // ThreeLetterISO8601TimeZone</span>
<span class="fc" id="L622">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="fc" id="L623">                t4 = charAt(bp + date_len + 10 + millisLen + 5);</span>

<span class="pc bpc" id="L625" title="1 of 4 branches missed.">                if(t3 == '4' &amp;&amp; t4 == '5') {</span>
                    // handle some special timezones like xx:45

<span class="pc bpc" id="L628" title="1 of 6 branches missed.">                    if (t0 == '1' &amp;&amp; (t1 == '2' || t1 == '3')) {</span>
                        // NZ-CHAT          =&gt; +12:45
                        // Pacific/Chatham  =&gt; +12:45
                        // NZ-CHAT          =&gt; +13:45 (DST)
                        // Pacific/Chatham  =&gt; +13:45 (DST)
<span class="pc bpc" id="L633" title="2 of 6 branches missed.">                    } else if (t0 == '0' &amp;&amp; (t1 == '5' || t1 == '8')) {</span>
                        // Asia/Kathmandu   =&gt; +05:45
                        // Asia/Katmandu    =&gt; +05:45
                        // Australia/Eucla  =&gt; +08:45
                    } else {
<span class="nc" id="L638">                        return false;</span>
                    }
                } else {
                    //handle normal timezone like xx:00 and xx:30
<span class="pc bpc" id="L642" title="1 of 4 branches missed.">                    if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="nc" id="L643">                        return false;</span>
                    }

<span class="pc bpc" id="L646" title="1 of 2 branches missed.">                    if (t4 != '0') {</span>
<span class="nc" id="L647">                        return false;</span>
                    }
                }

<span class="fc" id="L651">                timzeZoneLength = 6;</span>
<span class="fc bfc" id="L652" title="All 2 branches covered.">            } else if (t2 == '0') { // TwoLetterISO8601TimeZone</span>
<span class="fc" id="L653">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="pc bpc" id="L654" title="3 of 4 branches missed.">                if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="nc" id="L655">                    return false;</span>
                }
<span class="fc" id="L657">                timzeZoneLength = 5;</span>
<span class="pc bpc" id="L658" title="1 of 4 branches missed.">            } else if (t2 == '3' &amp;&amp; charAt(bp + date_len + 10 + millisLen + 4) == '0') {</span>
<span class="fc" id="L659">                t3 = '3';</span>
<span class="fc" id="L660">                t4 = '0';</span>
<span class="fc" id="L661">                timzeZoneLength = 5;</span>
<span class="pc bpc" id="L662" title="1 of 4 branches missed.">            } else if (t2 == '4' &amp;&amp; charAt(bp + date_len + 10 + millisLen + 4) == '5') {</span>
<span class="fc" id="L663">                t3 = '4';</span>
<span class="fc" id="L664">                t4 = '5';</span>
<span class="fc" id="L665">                timzeZoneLength = 5;</span>
<span class="fc" id="L666">            } else {</span>
<span class="fc" id="L667">                timzeZoneLength = 3;</span>
            }

<span class="fc" id="L670">            setTimeZone(timeZoneFlag, t0, t1, t3, t4);</span>

<span class="fc bfc" id="L672" title="All 2 branches covered.">        } else if (timeZoneFlag == 'Z') {// UTC</span>
<span class="fc" id="L673">            timzeZoneLength = 1;</span>
<span class="fc bfc" id="L674" title="All 2 branches covered.">            if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L675">                String[] timeZoneIDs = TimeZone.getAvailableIDs(0);</span>
<span class="pc bpc" id="L676" title="1 of 2 branches missed.">                if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L677">                    TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L678">                    calendar.setTimeZone(timeZone);</span>
                }
            }
        }

<span class="fc" id="L683">        char end = charAt(bp + (date_len + 10 + millisLen + timzeZoneLength));</span>
<span class="fc bfc" id="L684" title="All 4 branches covered.">        if (end != EOI &amp;&amp; end != '&quot;') {</span>
<span class="fc" id="L685">            return false;</span>
        }
<span class="fc" id="L687">        ch = charAt(bp += (date_len + 10 + millisLen + timzeZoneLength));</span>

<span class="fc" id="L689">        token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L690">        return true;</span>
    }

    protected void setTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc" id="L694">        int hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L695">        int minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L696">        int seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L697">        calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L698">        calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L699">        calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L700">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1) {
<span class="fc" id="L703">        setTimeZone(timeZoneFlag, t0, t1, '0', '0');</span>
<span class="fc" id="L704">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1, char t3, char t4) {
<span class="fc" id="L707">        int timeZoneOffset = ((t0 - '0') * 10 + (t1 - '0')) * 3600 * 1000;</span>

<span class="fc" id="L709">        timeZoneOffset += ((t3 - '0') * 10 + (t4 - '0')) * 60 * 1000;</span>

<span class="fc bfc" id="L711" title="All 2 branches covered.">        if (timeZoneFlag == '-') {</span>
<span class="fc" id="L712">            timeZoneOffset = -timeZoneOffset;</span>
        }

<span class="fc bfc" id="L715" title="All 2 branches covered.">        if (calendar.getTimeZone().getRawOffset() != timeZoneOffset) {</span>
<span class="fc" id="L716">            calendar.setTimeZone(new SimpleTimeZone(timeZoneOffset, Integer.toString(timeZoneOffset)));</span>
        }
<span class="fc" id="L718">    }</span>

    private boolean checkTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc bfc" id="L721" title="All 2 branches covered.">        if (h0 == '0') {</span>
<span class="fc bfc" id="L722" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L723">                return false;</span>
            }
<span class="fc bfc" id="L725" title="All 2 branches covered.">        } else if (h0 == '1') {</span>
<span class="fc bfc" id="L726" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L727">                return false;</span>
            }
<span class="fc bfc" id="L729" title="All 2 branches covered.">        } else if (h0 == '2') {</span>
<span class="fc bfc" id="L730" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '4') {</span>
<span class="fc" id="L731">                return false;</span>
            }
        } else {
<span class="fc" id="L734">            return false;</span>
        }

<span class="fc bfc" id="L737" title="All 4 branches covered.">        if (m0 &gt;= '0' &amp;&amp; m0 &lt;= '5') {</span>
<span class="fc bfc" id="L738" title="All 4 branches covered.">            if (m1 &lt; '0' || m1 &gt; '9') {</span>
<span class="fc" id="L739">                return false;</span>
            }
<span class="fc bfc" id="L741" title="All 2 branches covered.">        } else if (m0 == '6') {</span>
<span class="fc bfc" id="L742" title="All 2 branches covered.">            if (m1 != '0') {</span>
<span class="fc" id="L743">                return false;</span>
            }
        } else {
<span class="fc" id="L746">            return false;</span>
        }

<span class="fc bfc" id="L749" title="All 4 branches covered.">        if (s0 &gt;= '0' &amp;&amp; s0 &lt;= '5') {</span>
<span class="fc bfc" id="L750" title="All 4 branches covered.">            if (s1 &lt; '0' || s1 &gt; '9') {</span>
<span class="fc" id="L751">                return false;</span>
            }
<span class="fc bfc" id="L753" title="All 2 branches covered.">        } else if (s0 == '6') {</span>
<span class="fc bfc" id="L754" title="All 2 branches covered.">            if (s1 != '0') {</span>
<span class="fc" id="L755">                return false;</span>
            }
        } else {
<span class="fc" id="L758">            return false;</span>
        }

<span class="fc" id="L761">        return true;</span>
    }

    private void setCalendar(char y0, char y1, char y2, char y3, char M0, char M1, char d0, char d1) {
<span class="fc" id="L765">        calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L766">        int year = (y0 - '0') * 1000 + (y1 - '0') * 100 + (y2 - '0') * 10 + (y3 - '0');</span>
<span class="fc" id="L767">        int month = (M0 - '0') * 10 + (M1 - '0') - 1;</span>
<span class="fc" id="L768">        int day = (d0 - '0') * 10 + (d1 - '0');</span>
//        calendar.set(year, month, day);
<span class="fc" id="L770">        calendar.set(Calendar.YEAR, year);</span>
<span class="fc" id="L771">        calendar.set(Calendar.MONTH, month);</span>
<span class="fc" id="L772">        calendar.set(Calendar.DAY_OF_MONTH, day);</span>
<span class="fc" id="L773">    }</span>

    static boolean checkDate(char y0, char y1, char y2, char y3, char M0, char M1, int d0, int d1) {
<span class="pc bpc" id="L776" title="1 of 4 branches missed.">        if (y0 &lt; '0' || y0 &gt; '9') {</span>
<span class="fc" id="L777">            return false;</span>
        }
<span class="fc bfc" id="L779" title="All 4 branches covered.">        if (y1 &lt; '0' || y1 &gt; '9') {</span>
<span class="fc" id="L780">            return false;</span>
        }
<span class="fc bfc" id="L782" title="All 4 branches covered.">        if (y2 &lt; '0' || y2 &gt; '9') {</span>
<span class="fc" id="L783">            return false;</span>
        }
<span class="fc bfc" id="L785" title="All 4 branches covered.">        if (y3 &lt; '0' || y3 &gt; '9') {</span>
<span class="fc" id="L786">            return false;</span>
        }

<span class="fc bfc" id="L789" title="All 2 branches covered.">        if (M0 == '0') {</span>
<span class="fc bfc" id="L790" title="All 4 branches covered.">            if (M1 &lt; '1' || M1 &gt; '9') {</span>
<span class="fc" id="L791">                return false;</span>
            }
<span class="fc bfc" id="L793" title="All 2 branches covered.">        } else if (M0 == '1') {</span>
<span class="fc bfc" id="L794" title="All 6 branches covered.">            if (M1 != '0' &amp;&amp; M1 != '1' &amp;&amp; M1 != '2') {</span>
<span class="fc" id="L795">                return false;</span>
            }
        } else {
<span class="fc" id="L798">            return false;</span>
        }

<span class="fc bfc" id="L801" title="All 2 branches covered.">        if (d0 == '0') {</span>
<span class="fc bfc" id="L802" title="All 4 branches covered.">            if (d1 &lt; '1' || d1 &gt; '9') {</span>
<span class="fc" id="L803">                return false;</span>
            }
<span class="fc bfc" id="L805" title="All 4 branches covered.">        } else if (d0 == '1' || d0 == '2') {</span>
<span class="fc bfc" id="L806" title="All 4 branches covered.">            if (d1 &lt; '0' || d1 &gt; '9') {</span>
<span class="fc" id="L807">                return false;</span>
            }
<span class="fc bfc" id="L809" title="All 2 branches covered.">        } else if (d0 == '3') {</span>
<span class="fc bfc" id="L810" title="All 4 branches covered.">            if (d1 != '0' &amp;&amp; d1 != '1') {</span>
<span class="fc" id="L811">                return false;</span>
            }
        } else {
<span class="fc" id="L814">            return false;</span>
        }

<span class="fc" id="L817">        return true;</span>
    }

    @Override
    public boolean isEOF() {
<span class="pc bpc" id="L822" title="1 of 6 branches missed.">        return bp == len || (ch == EOI &amp;&amp; bp + 1 &gt;= len);</span>
    }

    public int scanFieldInt(char[] fieldName) {
<span class="fc" id="L826">        matchStat = UNKNOWN;</span>
<span class="fc" id="L827">        int startPos = this.bp;</span>
<span class="fc" id="L828">        char startChar = this.ch;</span>

<span class="fc bfc" id="L830" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L831">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L832">            return 0;</span>
        }

<span class="fc" id="L835">        int index = bp + fieldName.length;</span>

<span class="fc" id="L837">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L839" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>

<span class="fc bfc" id="L841" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L842">            ch = charAt(index++);</span>
        }

<span class="fc bfc" id="L845" title="All 2 branches covered.">        final boolean negative = ch == '-';</span>
<span class="fc bfc" id="L846" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L847">            ch = charAt(index++);</span>
        }

        int value;
<span class="fc bfc" id="L851" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L852">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L854">                ch = charAt(index++);</span>
<span class="fc bfc" id="L855" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L856">                    int value_10 = value * 10;</span>
<span class="fc bfc" id="L857" title="All 2 branches covered.">                    if (value_10 &lt; value) {</span>
<span class="fc" id="L858">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L859">                        return 0;</span>
                    }

<span class="fc" id="L862">                    value = value_10 + (ch - '0');</span>
<span class="fc bfc" id="L863" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L864">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L865">                    return 0;</span>
                } else {
                    break;
                }
            }

<span class="fc bfc" id="L871" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L872">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L873">                return 0;</span>
            }

<span class="fc bfc" id="L876" title="All 2 branches covered.">            if (quote) {</span>
<span class="pc bpc" id="L877" title="1 of 2 branches missed.">                if (ch != '&quot;') {</span>
<span class="nc" id="L878">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L879">                    return 0;</span>
                } else {
<span class="fc" id="L881">                    ch = charAt(index++);</span>
                }
            }

            for (;;) {
<span class="fc bfc" id="L886" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L887">                    bp = index - 1;</span>
<span class="fc" id="L888">                    break;</span>
<span class="fc bfc" id="L889" title="All 2 branches covered.">                } else if(isWhitespace(ch)) {</span>
<span class="fc" id="L890">                    ch = charAt(index++);</span>
<span class="fc" id="L891">                    continue;</span>
                } else {
<span class="fc" id="L893">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L894">                    return 0;</span>
                }
            }
        } else {
<span class="fc" id="L898">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L899">            return 0;</span>
        }

<span class="fc bfc" id="L902" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L903">            this.ch = charAt(++bp);</span>
<span class="fc" id="L904">            matchStat = VALUE;</span>
<span class="fc" id="L905">            token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L906" title="1 of 2 branches missed.">            return negative ? -value : value;</span>
        }

<span class="pc bpc" id="L909" title="1 of 2 branches missed.">        if (ch == '}') {</span>
<span class="fc" id="L910">            bp = index - 1;</span>
<span class="fc" id="L911">            ch = charAt(++bp);</span>
            for (; ; ) {
<span class="fc bfc" id="L913" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L914">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L915">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L916">                    break;</span>
<span class="fc bfc" id="L917" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L918">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L919">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L920">                    break;</span>
<span class="fc bfc" id="L921" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L922">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L923">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L924">                    break;</span>
<span class="fc bfc" id="L925" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L926">                    token = JSONToken.EOF;</span>
<span class="fc" id="L927">                    break;</span>
<span class="fc bfc" id="L928" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L929">                    ch = charAt(++bp);</span>
<span class="fc" id="L930">                    continue;</span>
                } else {
<span class="fc" id="L932">                    this.bp = startPos;</span>
<span class="fc" id="L933">                    this.ch = startChar;</span>
<span class="fc" id="L934">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L935">                    return 0;</span>
                }
            }
<span class="fc" id="L938">            matchStat = END;</span>
        }

<span class="pc bpc" id="L941" title="1 of 2 branches missed.">        return negative ? -value : value;</span>
    }

    public String scanFieldString(char[] fieldName) {
<span class="fc" id="L945">        matchStat = UNKNOWN;</span>
<span class="fc" id="L946">        int startPos = this.bp;</span>
<span class="fc" id="L947">        char startChar = this.ch;</span>

        for (;;) {
<span class="fc bfc" id="L950" title="All 2 branches covered.">            if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc bfc" id="L951" title="All 2 branches covered.">                if (isWhitespace(ch)) {</span>
<span class="fc" id="L952">                    next();</span>
<span class="fc" id="L953">                    continue;</span>
                }
<span class="fc" id="L955">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L956">                return stringDefaultValue();</span>
            } else {
                break;
            }
        }

<span class="fc" id="L962">        int index = bp + fieldName.length;</span>

<span class="fc" id="L964">        char ch = charAt(index++);</span>
<span class="fc bfc" id="L965" title="All 2 branches covered.">        if (ch != '&quot;') {</span>
<span class="fc" id="L966">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L968">            return stringDefaultValue();</span>
        }

        final String strVal;
        {
<span class="fc" id="L973">            int startIndex = index;</span>
<span class="fc" id="L974">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L975" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L976">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L979">            String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L980" title="All 2 branches covered.">            if (stringVal.indexOf('\\') != -1) {</span>
<span class="fc" id="L981">                for (;;) {</span>
<span class="fc" id="L982">                    int slashCount = 0;</span>
<span class="pc bpc" id="L983" title="1 of 2 branches missed.">                    for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L984" title="All 2 branches covered.">                        if (charAt(i) == '\\') {</span>
<span class="fc" id="L985">                            slashCount++;</span>
                        } else {
                            break;
                        }
                    }
<span class="fc bfc" id="L990" title="All 2 branches covered.">                    if (slashCount % 2 == 0) {</span>
<span class="fc" id="L991">                        break;</span>
                    }
<span class="fc" id="L993">                    endIndex = indexOf('&quot;', endIndex + 1);</span>
                }

<span class="fc" id="L996">                int chars_len = endIndex - (bp + fieldName.length + 1);</span>
<span class="fc" id="L997">                char[] chars = sub_chars(bp + fieldName.length + 1, chars_len);</span>

<span class="fc" id="L999">                stringVal = readString(chars, chars_len);</span>
            }

<span class="fc" id="L1002">            ch = charAt(endIndex + 1);</span>

            for (;;) {
<span class="fc bfc" id="L1005" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1006">                    bp = endIndex + 1;</span>
<span class="fc" id="L1007">                    this.ch = ch;</span>
<span class="fc" id="L1008">                    strVal = stringVal;</span>
<span class="fc" id="L1009">                    break;</span>
<span class="fc bfc" id="L1010" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1011">                    endIndex++;</span>
<span class="fc" id="L1012">                    ch = charAt(endIndex + 1);</span>
<span class="fc" id="L1013">                } else {</span>
<span class="fc" id="L1014">                    matchStat = NOT_MATCH;</span>

<span class="fc" id="L1016">                    return stringDefaultValue();</span>
                }
            }
        }

<span class="fc bfc" id="L1021" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1022">            this.ch = charAt(++bp);</span>
<span class="fc" id="L1023">            matchStat = VALUE;</span>
<span class="fc" id="L1024">            return strVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L1027">            ch = charAt(++bp);</span>
<span class="fc bfc" id="L1028" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1029">                token = JSONToken.COMMA;</span>
<span class="fc" id="L1030">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1031" title="All 2 branches covered.">            } else if (ch == ']') {</span>
<span class="fc" id="L1032">                token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1033">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1034" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1035">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L1036">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1037" title="All 2 branches covered.">            } else if (ch == EOI) {</span>
<span class="fc" id="L1038">                token = JSONToken.EOF;</span>
<span class="fc" id="L1039">            } else {</span>
<span class="fc" id="L1040">                this.bp = startPos;</span>
<span class="fc" id="L1041">                this.ch = startChar;</span>
<span class="fc" id="L1042">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1043">                return stringDefaultValue();</span>
            }
<span class="fc" id="L1045">            matchStat = END;</span>
        }
<span class="fc" id="L1047">        return strVal;</span>
    }

    public java.util.Date scanFieldDate(char[] fieldName) {
<span class="fc" id="L1051">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1052">        int startPos = this.bp;</span>
<span class="fc" id="L1053">        char startChar = this.ch;</span>

<span class="fc bfc" id="L1055" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1056">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1057">            return null;</span>
        }

<span class="fc" id="L1060">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1062">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L1065" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L1066">            int startIndex = index;</span>
<span class="fc" id="L1067">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1068" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L1069">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L1072">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L1073">            bp = index;</span>
<span class="fc bfc" id="L1074" title="All 2 branches covered.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L1075">                dateVal = calendar.getTime();</span>
<span class="fc" id="L1076">            } else {</span>
<span class="fc" id="L1077">                bp = startPos;</span>
<span class="fc" id="L1078">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1079">                return null;</span>
            }
<span class="fc" id="L1081">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L1082">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L1085" title="1 of 4 branches missed.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1086">                    bp = endIndex + 1;</span>
<span class="fc" id="L1087">                    this.ch = ch;</span>
<span class="fc" id="L1088">                    break;</span>
<span class="nc bnc" id="L1089" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1090">                    endIndex++;</span>
<span class="nc" id="L1091">                    ch = charAt(endIndex + 1);</span>
<span class="nc" id="L1092">                } else {</span>
<span class="nc" id="L1093">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L1095">                    return null;</span>
                }
            }
<span class="pc bpc" id="L1098" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L1099">            long millis = 0;</span>

<span class="fc" id="L1101">            boolean negative = false;</span>
<span class="pc bpc" id="L1102" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L1103">                ch = charAt(index++);</span>
<span class="nc" id="L1104">                negative = true;</span>
            }

<span class="pc bpc" id="L1107" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1108">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L1110">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1111" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1112">                        millis = millis * 10 + (ch - '0');</span>
<span class="fc" id="L1113">                    } else {</span>
<span class="fc bfc" id="L1114" title="All 4 branches covered.">                        if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1115">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L1122" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L1123">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1124">                return null;</span>
            }

<span class="pc bpc" id="L1127" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L1128">                millis = -millis;</span>
            }

<span class="fc" id="L1131">            dateVal = new java.util.Date(millis);</span>
<span class="fc" id="L1132">        } else {</span>
<span class="fc" id="L1133">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L1135">            return null;</span>
        }

<span class="fc bfc" id="L1138" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1139">            this.ch = charAt(++bp);</span>
<span class="fc" id="L1140">            matchStat = VALUE;</span>
<span class="fc" id="L1141">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1142">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L1145">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L1146" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L1147">                token = JSONToken.COMMA;</span>
<span class="nc" id="L1148">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L1149" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L1150">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L1151">                this.ch = charAt(++bp);</span>
<span class="pc bfc" id="L1152" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1153">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L1154">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1155" title="All 2 branches covered.">            } else if (ch == EOI) {</span>
<span class="fc" id="L1156">                token = JSONToken.EOF;</span>
<span class="fc" id="L1157">            } else {</span>
<span class="fc" id="L1158">                this.bp = startPos;</span>
<span class="fc" id="L1159">                this.ch = startChar;</span>
<span class="fc" id="L1160">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1161">                return null;</span>
            }
<span class="fc" id="L1163">            matchStat = END;</span>
        }
<span class="fc" id="L1165">        return dateVal;</span>
    }

    public long scanFieldSymbol(char[] fieldName) {
<span class="fc" id="L1169">        matchStat = UNKNOWN;</span>

<span class="pc bpc" id="L1171" title="1 of 2 branches missed.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="nc" id="L1172">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L1173">            return 0;</span>
        }

<span class="fc" id="L1176">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1178">        char ch = charAt(index++);</span>
<span class="pc bpc" id="L1179" title="1 of 2 branches missed.">        if (ch != '&quot;') {</span>
<span class="nc" id="L1180">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1181">            return 0;</span>
        }

<span class="fc" id="L1184">        long hash = 0xcbf29ce484222325L;</span>
<span class="fc" id="L1185">        for (;;) {</span>
<span class="fc" id="L1186">            ch = charAt(index++);</span>
<span class="fc bfc" id="L1187" title="All 2 branches covered.">            if (ch == '\&quot;') {</span>
<span class="fc" id="L1188">                bp = index;</span>
<span class="fc" id="L1189">                this.ch = ch = charAt(bp);</span>
<span class="fc" id="L1190">                break;</span>
<span class="pc bpc" id="L1191" title="1 of 2 branches missed.">            } else if (index &gt; len) {</span>
<span class="nc" id="L1192">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1193">                return 0;</span>
            }

<span class="fc" id="L1196">            hash ^= ch;</span>
<span class="fc" id="L1197">            hash *= 0x100000001b3L;</span>
        }

        for (;;) {
<span class="pc bpc" id="L1201" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L1202">                this.ch = charAt(++bp);</span>
<span class="nc" id="L1203">                matchStat = VALUE;</span>
<span class="nc" id="L1204">                return hash;</span>
<span class="fc bfc" id="L1205" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1206">                next();</span>
<span class="fc" id="L1207">                skipWhitespace();</span>
<span class="fc" id="L1208">                ch = getCurrent();</span>
<span class="fc bfc" id="L1209" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1210">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1211">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1212" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1213">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1214">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1215" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1216">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1217">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1218" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1219">                    token = JSONToken.EOF;</span>
<span class="fc" id="L1220">                } else {</span>
<span class="fc" id="L1221">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1222">                    return 0;</span>
                }
<span class="fc" id="L1224">                matchStat = END;</span>
<span class="fc" id="L1225">                break;</span>
<span class="pc bpc" id="L1226" title="1 of 2 branches missed.">            } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1227">                ch = charAt(++bp);</span>
<span class="nc" id="L1228">                continue;</span>
            } else {
<span class="fc" id="L1230">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1231">                return 0;</span>
            }
        }

<span class="fc" id="L1235">        return hash;</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;String&gt; scanFieldStringArray(char[] fieldName, Class&lt;?&gt; type) {
<span class="fc" id="L1240">        matchStat = UNKNOWN;</span>

<span class="pc bpc" id="L1242" title="1 of 4 branches missed.">        while (ch == '\n' || ch == ' ') {</span>
<span class="fc" id="L1243">            int index = ++bp;</span>
<span class="pc bpc" id="L1244" title="1 of 2 branches missed.">            ch = (index &gt;= this.len ? //</span>
<span class="nc" id="L1245">                    EOI //</span>
<span class="fc" id="L1246">                    : text.charAt(index));</span>
        }

<span class="fc bfc" id="L1249" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1250">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1251">            return null;</span>
        }

<span class="fc" id="L1254">        Collection&lt;String&gt; list = newCollectionByType(type);</span>

//        if (type.isAssignableFrom(HashSet.class)) {
//            list = new HashSet&lt;String&gt;();
//        } else if (type.isAssignableFrom(ArrayList.class)) {
//            list = new ArrayList&lt;String&gt;();
//        } else {
//            try {
//                list = (Collection&lt;String&gt;) type.newInstance();
//            } catch (Exception e) {
//                throw new JSONException(e.getMessage(), e);
//            }
//        }

<span class="fc" id="L1268">        int startPos = this.bp;</span>
<span class="fc" id="L1269">        char startChar = this.ch;</span>

<span class="fc" id="L1271">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1273">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1275" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L1276">            ch = charAt(index++);</span>

            for (;;) {
<span class="fc bfc" id="L1279" title="All 2 branches covered.">                if (ch == '&quot;') {</span>
<span class="fc" id="L1280">                    int startIndex = index;</span>
<span class="fc" id="L1281">                    int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1282" title="All 2 branches covered.">                    if (endIndex == -1) {</span>
<span class="fc" id="L1283">                        throw new JSONException(&quot;unclosed str&quot;);</span>
                    }

<span class="fc" id="L1286">                    String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L1287" title="All 2 branches covered.">                    if (stringVal.indexOf('\\') != -1) {</span>
<span class="fc" id="L1288">                        for (;;) {</span>
<span class="fc" id="L1289">                            int slashCount = 0;</span>
<span class="pc bpc" id="L1290" title="1 of 2 branches missed.">                            for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L1291" title="All 2 branches covered.">                                if (charAt(i) == '\\') {</span>
<span class="fc" id="L1292">                                    slashCount++;</span>
                                } else {
                                    break;
                                }
                            }
<span class="fc bfc" id="L1297" title="All 2 branches covered.">                            if (slashCount % 2 == 0) {</span>
<span class="fc" id="L1298">                                break;</span>
                            }
<span class="fc" id="L1300">                            endIndex = indexOf('&quot;', endIndex + 1);</span>
                        }

<span class="fc" id="L1303">                        int chars_len = endIndex - startIndex;</span>
<span class="fc" id="L1304">                        char[] chars = sub_chars(startIndex, chars_len);</span>

<span class="fc" id="L1306">                        stringVal = readString(chars, chars_len);</span>
                    }

<span class="fc" id="L1309">                    index = endIndex + 1;</span>
<span class="fc" id="L1310">                    ch = charAt(index++);</span>

<span class="fc" id="L1312">                    list.add(stringVal);</span>
<span class="fc bfc" id="L1313" title="All 4 branches covered.">                } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1314">                    index += 3;</span>
<span class="fc" id="L1315">                    ch = charAt(index++);</span>
<span class="fc" id="L1316">                    list.add(null);</span>
<span class="fc bfc" id="L1317" title="All 4 branches covered.">                } else if (ch == ']' &amp;&amp; list.size() == 0) {</span>
<span class="fc" id="L1318">                    ch = charAt(index++);</span>
<span class="fc" id="L1319">                    break;</span>
                } else {
<span class="fc" id="L1321">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1322">                    return null;</span>
                }

<span class="fc bfc" id="L1325" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1326">                    ch = charAt(index++);</span>
<span class="fc" id="L1327">                    continue;</span>
                }

<span class="fc bfc" id="L1330" title="All 2 branches covered.">                if (ch == ']') {</span>
<span class="fc" id="L1331">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1332" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1333">                        ch = charAt(index++);</span>
                    }
<span class="fc" id="L1335">                    break;</span>
                }

<span class="fc" id="L1338">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1339">                return null;</span>
            }
<span class="fc bfc" id="L1341" title="All 2 branches covered.">        } else if (text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1342">            index += 3;</span>
<span class="fc" id="L1343">            ch = charAt(index++);</span>
<span class="fc" id="L1344">            list = null;</span>
<span class="fc" id="L1345">        } else {</span>
<span class="fc" id="L1346">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1347">            return null;</span>
        }

<span class="fc" id="L1350">        bp = index;</span>
<span class="fc bfc" id="L1351" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1352">            this.ch = charAt(bp);</span>
<span class="fc" id="L1353">            matchStat = VALUE;</span>
<span class="fc" id="L1354">            return list;</span>
<span class="fc bfc" id="L1355" title="All 2 branches covered.">        } else if (ch == '}') {</span>
<span class="fc" id="L1356">            ch = charAt(bp);</span>
            for (;;) {
<span class="fc bfc" id="L1358" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1359">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1360">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1361">                    break;</span>
<span class="fc bfc" id="L1362" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1363">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1364">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1365">                    break;</span>
<span class="fc bfc" id="L1366" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1367">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1368">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1369">                    break;</span>
<span class="fc bfc" id="L1370" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1371">                    token = JSONToken.EOF;</span>
<span class="fc" id="L1372">                    this.ch = ch;</span>
<span class="fc" id="L1373">                    break;</span>
                } else {
<span class="fc" id="L1375">                    boolean space = false;</span>
<span class="fc bfc" id="L1376" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1377">                        ch = charAt(index++);</span>
<span class="fc" id="L1378">                        bp = index;</span>
<span class="fc" id="L1379">                        space = true;</span>
                    }
<span class="fc bfc" id="L1381" title="All 2 branches covered.">                    if (space) {</span>
<span class="fc" id="L1382">                        continue;</span>
                    }

<span class="fc" id="L1385">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1386">                    return null;</span>
                }
            }

<span class="fc" id="L1390">            matchStat = END;</span>
<span class="fc" id="L1391">        } else {</span>
<span class="fc" id="L1392">            this.ch = startChar;</span>
<span class="fc" id="L1393">            bp = startPos;</span>
<span class="fc" id="L1394">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1395">            return null;</span>
        }

<span class="fc" id="L1398">        return list;</span>
    }

    public long scanFieldLong(char[] fieldName) {
<span class="fc" id="L1402">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1403">        int startPos = this.bp;</span>
<span class="fc" id="L1404">        char startChar = this.ch;</span>

<span class="fc bfc" id="L1406" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1407">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1408">            return 0;</span>
        }

<span class="fc" id="L1411">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1413">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1415" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1416" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1417">            ch = charAt(index++);</span>
        }

<span class="fc" id="L1420">        boolean negative = false;</span>
<span class="fc bfc" id="L1421" title="All 2 branches covered.">        if (ch == '-') {</span>
<span class="fc" id="L1422">            ch = charAt(index++);</span>
<span class="fc" id="L1423">            negative = true;</span>
        }

        long value;
<span class="fc bfc" id="L1427" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1428">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L1430">                ch = charAt(index++);</span>
<span class="fc bfc" id="L1431" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1432">                    value = value * 10 + (ch - '0');</span>
<span class="fc bfc" id="L1433" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L1434">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1435">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1437" title="All 2 branches covered.">                    if (quote) {</span>
<span class="fc bfc" id="L1438" title="All 2 branches covered.">                        if (ch != '&quot;') {</span>
<span class="fc" id="L1439">                            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1440">                            return 0;</span>
                        } else {
<span class="fc" id="L1442">                            ch = charAt(index++);</span>
                        }
                    }

<span class="fc bfc" id="L1446" title="All 4 branches covered.">                    if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1447">                        bp = index - 1;</span>
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1453" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1454" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1455">                this.bp = startPos;</span>
<span class="fc" id="L1456">                this.ch = startChar;</span>
<span class="fc" id="L1457">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1458">                return 0;</span>
            }
        } else {
<span class="fc" id="L1461">            this.bp = startPos;</span>
<span class="fc" id="L1462">            this.ch = startChar;</span>
<span class="fc" id="L1463">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1464">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1468" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1469">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1470">                matchStat = VALUE;</span>
<span class="fc" id="L1471">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1472" title="All 2 branches covered.">                return negative ? -value : value;</span>
<span class="fc bfc" id="L1473" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1474">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1476" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1477">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1478">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1479">                        break;</span>
<span class="fc bfc" id="L1480" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1481">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1482">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1483">                        break;</span>
<span class="fc bfc" id="L1484" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1485">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1486">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1487">                        break;</span>
<span class="fc bfc" id="L1488" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1489">                        token = JSONToken.EOF;</span>
<span class="fc" id="L1490">                        break;</span>
<span class="fc bfc" id="L1491" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1492">                        ch = charAt(++bp);</span>
<span class="fc" id="L1493">                    } else {</span>
<span class="fc" id="L1494">                        this.bp = startPos;</span>
<span class="fc" id="L1495">                        this.ch = startChar;</span>
<span class="fc" id="L1496">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1497">                        return 0;</span>
                    }
                }
<span class="fc" id="L1500">                matchStat = END;</span>
<span class="fc" id="L1501">                break;</span>
<span class="fc bfc" id="L1502" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1503">                bp = index;</span>
<span class="fc" id="L1504">                ch = charAt(index++);</span>
<span class="fc" id="L1505">                continue;</span>
            } else {
<span class="fc" id="L1507">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1508">                return 0;</span>
            }
        }

<span class="fc bfc" id="L1512" title="All 2 branches covered.">        return negative ? -value : value;</span>
    }

    public boolean scanFieldBoolean(char[] fieldName) {
<span class="fc" id="L1516">        matchStat = UNKNOWN;</span>

<span class="fc bfc" id="L1518" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1519">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1520">            return false;</span>
        }

<span class="fc" id="L1523">        int startPos = bp;</span>
<span class="fc" id="L1524">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1526">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1528" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1529" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1530">            ch = charAt(index++);</span>
        }

        boolean value;
<span class="fc bfc" id="L1534" title="All 2 branches covered.">        if (ch == 't') {</span>
<span class="fc bfc" id="L1535" title="All 2 branches covered.">            if (charAt(index++) != 'r') {</span>
<span class="fc" id="L1536">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1537">                return false;</span>
            }
<span class="fc bfc" id="L1539" title="All 2 branches covered.">            if (charAt(index++) != 'u') {</span>
<span class="fc" id="L1540">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1541">                return false;</span>
            }
<span class="fc bfc" id="L1543" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1544">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1545">                return false;</span>
            }

<span class="pc bpc" id="L1548" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1549">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1550">                return false;</span>
            }

<span class="fc" id="L1553">            bp = index;</span>
<span class="fc" id="L1554">            ch = charAt(bp);</span>
<span class="fc" id="L1555">            value = true;</span>
<span class="fc bfc" id="L1556" title="All 2 branches covered.">        } else if (ch == 'f') {</span>
<span class="fc bfc" id="L1557" title="All 2 branches covered.">            if (charAt(index++) != 'a') {</span>
<span class="fc" id="L1558">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1559">                return false;</span>
            }
<span class="fc bfc" id="L1561" title="All 2 branches covered.">            if (charAt(index++) != 'l') {</span>
<span class="fc" id="L1562">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1563">                return false;</span>
            }
<span class="fc bfc" id="L1565" title="All 2 branches covered.">            if (charAt(index++) != 's') {</span>
<span class="fc" id="L1566">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1567">                return false;</span>
            }
<span class="fc bfc" id="L1569" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1570">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1571">                return false;</span>
            }

<span class="pc bpc" id="L1574" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1575">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1576">                return false;</span>
            }

<span class="fc" id="L1579">            bp = index;</span>
<span class="fc" id="L1580">            ch = charAt(bp);</span>
<span class="fc" id="L1581">            value = false;</span>
<span class="fc bfc" id="L1582" title="All 2 branches covered.">        } else if (ch == '1') {</span>
<span class="pc bpc" id="L1583" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1584">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1585">                return false;</span>
            }

<span class="fc" id="L1588">            bp = index;</span>
<span class="fc" id="L1589">            ch = charAt(bp);</span>
<span class="fc" id="L1590">            value = true;</span>
<span class="fc bfc" id="L1591" title="All 2 branches covered.">        } else if (ch == '0') {</span>
<span class="pc bpc" id="L1592" title="3 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1593">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1594">                return false;</span>
            }

<span class="fc" id="L1597">            bp = index;</span>
<span class="fc" id="L1598">            ch = charAt(bp);</span>
<span class="fc" id="L1599">            value = false;</span>
<span class="fc" id="L1600">        } else {</span>
<span class="fc" id="L1601">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1602">            return false;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1606" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1607">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1608">                matchStat = VALUE;</span>
<span class="fc" id="L1609">                token = JSONToken.COMMA;</span>
<span class="fc" id="L1610">                break;</span>
<span class="fc bfc" id="L1611" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1612">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1614" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1615">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1616">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1617" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1618">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1619">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1620" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1621">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1622">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1623" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1624">                        token = JSONToken.EOF;</span>
<span class="fc bfc" id="L1625" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1626">                        ch = charAt(++bp);</span>
<span class="fc" id="L1627">                        continue;</span>
                    } else {
<span class="fc" id="L1629">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1630">                        return false;</span>
                    }
                    break;
                }
<span class="fc" id="L1634">                matchStat = END;</span>
<span class="fc" id="L1635">                break;</span>
<span class="fc bfc" id="L1636" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1637">                ch = charAt(++bp);</span>
<span class="fc" id="L1638">            } else {</span>
<span class="fc" id="L1639">                bp = startPos;</span>
<span class="fc" id="L1640">                ch = charAt(bp);</span>
<span class="fc" id="L1641">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1642">                return false;</span>
            }
        }

<span class="fc" id="L1646">        return value;</span>
    }

    public final int scanInt(char expectNext) {
<span class="fc" id="L1650">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1652">        final int mark = bp;</span>
<span class="fc" id="L1653">        int offset = bp;</span>
<span class="fc" id="L1654">        char chLocal = charAt(offset++);</span>

<span class="fc bfc" id="L1656" title="All 2 branches covered.">        while (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1657">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1660" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1662" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1663">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1666" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1667" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1668">            chLocal = charAt(offset++);</span>
        }

        int value;
<span class="fc bfc" id="L1672" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1673">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1675">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1676" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1677">                    int value_10 = value * 10;</span>
<span class="fc bfc" id="L1678" title="All 2 branches covered.">                    if (value_10 &lt; value) {</span>
<span class="fc" id="L1679">                        throw new JSONException(&quot;parseInt error : &quot;</span>
<span class="fc" id="L1680">                                + subString(mark, offset - 1));</span>
                    }
<span class="fc" id="L1682">                    value = value_10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1683" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1684">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1685">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1687" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1688" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1689">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1690">                            return 0;</span>
                        } else {
<span class="fc" id="L1692">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }
<span class="fc bfc" id="L1698" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L1699">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1700">                return 0;</span>
            }
<span class="fc bfc" id="L1702" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1703" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1704" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1705" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1706">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1707">            value = 0;</span>
<span class="fc" id="L1708">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1710" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1711">                chLocal = charAt(offset++);</span>
            }

<span class="fc" id="L1714">            for (;;) {</span>
<span class="fc bfc" id="L1715" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1716">                    bp = offset;</span>
<span class="fc" id="L1717">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1718">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1719">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1720">                    return value;</span>
<span class="fc bfc" id="L1721" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1722">                    bp = offset;</span>
<span class="fc" id="L1723">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1724">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1725">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1726">                    return value;</span>
<span class="pc bpc" id="L1727" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1728">                    chLocal = charAt(offset++);</span>
                    continue;
                }
                break;
            }
<span class="nc" id="L1733">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1734">            return 0;</span>
        } else {
<span class="fc" id="L1736">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1737">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1741" title="All 2 branches covered.">            if (chLocal == expectNext) {</span>
<span class="fc" id="L1742">                bp = offset;</span>
<span class="fc" id="L1743">                this.ch = charAt(bp);</span>
<span class="fc" id="L1744">                matchStat = VALUE;</span>
<span class="fc" id="L1745">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1746" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1748" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1749">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1750">                    continue;</span>
                }
<span class="fc" id="L1752">                matchStat = NOT_MATCH;</span>
<span class="fc bfc" id="L1753" title="All 2 branches covered.">                return negative ? -value : value;</span>
            }
        }
    }

    public  double scanDouble(char seperator) {
<span class="fc" id="L1759">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1761">        int offset = bp;</span>
<span class="fc" id="L1762">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1763" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>
<span class="fc bfc" id="L1764" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1765">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1768" title="All 2 branches covered.">        boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1769" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1770">            chLocal = charAt(offset++);</span>
        }

        double value;
<span class="pc bpc" id="L1774" title="1 of 4 branches missed.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1775">            long intVal = chLocal - '0';</span>
<span class="fc" id="L1776">            for (; ; ) {</span>
<span class="fc" id="L1777">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1778" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1779">                    intVal = intVal * 10 + (chLocal - '0');</span>
                    continue;
                } else {
                    break;
                }
            }

<span class="fc" id="L1786">            long power = 1;</span>
<span class="fc bfc" id="L1787" title="All 2 branches covered.">            boolean small = (chLocal == '.');</span>
<span class="fc bfc" id="L1788" title="All 2 branches covered.">            if (small) {</span>
<span class="fc" id="L1789">                chLocal = charAt(offset++);</span>
<span class="pc bpc" id="L1790" title="1 of 4 branches missed.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1791">                    intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1792">                    power = 10;</span>
<span class="fc" id="L1793">                    for (; ; ) {</span>
<span class="fc" id="L1794">                        chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1795" title="All 4 branches covered.">                        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1796">                            intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1797">                            power *= 10;</span>
                            continue;
                        } else {
                            break;
                        }
                    }
                } else {
<span class="fc" id="L1804">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1805">                    return 0;</span>
                }
            }

<span class="pc bpc" id="L1809" title="1 of 4 branches missed.">            boolean exp = chLocal == 'e' || chLocal == 'E';</span>
<span class="fc bfc" id="L1810" title="All 2 branches covered.">            if (exp) {</span>
<span class="fc" id="L1811">                chLocal = charAt(offset++);</span>
<span class="pc bpc" id="L1812" title="2 of 4 branches missed.">                if (chLocal == '+' || chLocal == '-') {</span>
<span class="fc" id="L1813">                    chLocal = charAt(offset++);</span>
                }
<span class="fc" id="L1815">                for (; ; ) {</span>
<span class="pc bpc" id="L1816" title="1 of 4 branches missed.">                    if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1817">                        chLocal = charAt(offset++);</span>
                    } else {
                        break;
                    }
                }
            }

            int start, count;
<span class="fc bfc" id="L1825" title="All 2 branches covered.">            if (quote) {</span>
<span class="pc bpc" id="L1826" title="1 of 2 branches missed.">                if (chLocal != '&quot;') {</span>
<span class="nc" id="L1827">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L1828">                    return 0;</span>
                } else {
<span class="fc" id="L1830">                    chLocal = charAt(offset++);</span>
                }
<span class="fc" id="L1832">                start = bp + 1;</span>
<span class="fc" id="L1833">                count = offset - start - 2;</span>
<span class="fc" id="L1834">            } else {</span>
<span class="fc" id="L1835">                start = bp;</span>
<span class="fc" id="L1836">                count = offset - start - 1;</span>
            }

<span class="fc bfc" id="L1839" title="All 4 branches covered.">            if (!exp &amp;&amp; count &lt; 18) {</span>
<span class="fc" id="L1840">                value = ((double) intVal) / power;</span>
<span class="fc bfc" id="L1841" title="All 2 branches covered.">                if (negative) {</span>
<span class="fc" id="L1842">                    value = -value;</span>
                }
<span class="fc" id="L1844">            } else {</span>
<span class="fc" id="L1845">                String text = this.subString(start, count);</span>
<span class="fc" id="L1846">                value = Double.parseDouble(text);</span>
            }
<span class="fc bfc" id="L1848" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1849" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1850" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1851" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1852">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1853">            value = 0;</span>
<span class="fc" id="L1854">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1856" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1857">                chLocal = charAt(offset++);</span>
            }

<span class="fc" id="L1860">            for (;;) {</span>
<span class="fc bfc" id="L1861" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1862">                    bp = offset;</span>
<span class="fc" id="L1863">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1864">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1865">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1866">                    return value;</span>
<span class="fc bfc" id="L1867" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1868">                    bp = offset;</span>
<span class="fc" id="L1869">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1870">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1871">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1872">                    return value;</span>
<span class="pc bpc" id="L1873" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1874">                    chLocal = charAt(offset++);</span>
                    continue;
                }
                break;
            }
<span class="nc" id="L1879">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1880">            return 0;</span>
        } else {
<span class="fc" id="L1882">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1883">            return 0;</span>
        }

<span class="fc bfc" id="L1886" title="All 2 branches covered.">        if (chLocal == seperator) {</span>
<span class="fc" id="L1887">            bp = offset;</span>
<span class="fc" id="L1888">            this.ch = this.charAt(bp);</span>
<span class="fc" id="L1889">            matchStat = VALUE;</span>
<span class="fc" id="L1890">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1891">            return value;</span>
        } else {
<span class="fc" id="L1893">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1894">            return value;</span>
        }
    }

    public long scanLong(char seperator) {
<span class="fc" id="L1899">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1901">        int offset = bp;</span>
<span class="fc" id="L1902">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1903" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1905" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1906">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1909" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1910" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1911">            chLocal = charAt(offset++);</span>
        }

        long value;
<span class="fc bfc" id="L1915" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1916">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1918">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1919" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1920">                    value = value * 10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1921" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1922">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1923">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1925" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1926" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1927">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1928">                            return 0;</span>
                        } else {
<span class="fc" id="L1930">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1937" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1938" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1939">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1940">                return 0;</span>
            }
<span class="fc bfc" id="L1942" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1943" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1944" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1945" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1946">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1947">            value = 0;</span>
<span class="fc" id="L1948">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1950" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1951">                chLocal = charAt(offset++);</span>
            }

<span class="fc" id="L1954">            for (;;) {</span>
<span class="fc bfc" id="L1955" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1956">                    bp = offset;</span>
<span class="fc" id="L1957">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1958">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1959">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1960">                    return value;</span>
<span class="fc bfc" id="L1961" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1962">                    bp = offset;</span>
<span class="fc" id="L1963">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1964">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1965">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1966">                    return value;</span>
<span class="pc bpc" id="L1967" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1968">                    chLocal = charAt(offset++);</span>
                    continue;
                }
                break;
            }
<span class="nc" id="L1973">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1974">            return 0;</span>
        } else {
<span class="fc" id="L1976">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1977">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1981" title="All 2 branches covered.">            if (chLocal == seperator) {</span>
<span class="fc" id="L1982">                bp = offset;</span>
<span class="fc" id="L1983">                this.ch = charAt(bp);</span>
<span class="fc" id="L1984">                matchStat = VALUE;</span>
<span class="fc" id="L1985">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1986" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1988" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1989">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1990">                    continue;</span>
                }

<span class="fc" id="L1993">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1994">                return value;</span>
            }
        }
    }

    public java.util.Date scanDate(char seperator) {
<span class="fc" id="L2000">        matchStat = UNKNOWN;</span>
<span class="fc" id="L2001">        int startPos = this.bp;</span>
<span class="fc" id="L2002">        char startChar = this.ch;</span>

<span class="fc" id="L2004">        int index = bp;</span>

<span class="fc" id="L2006">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L2009" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L2010">            int startIndex = index;</span>
<span class="fc" id="L2011">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="pc bpc" id="L2012" title="1 of 2 branches missed.">            if (endIndex == -1) {</span>
<span class="nc" id="L2013">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L2016">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L2017">            bp = index;</span>
<span class="pc bpc" id="L2018" title="1 of 2 branches missed.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L2019">                dateVal = calendar.getTime();</span>
<span class="fc" id="L2020">            } else {</span>
<span class="nc" id="L2021">                bp = startPos;</span>
<span class="nc" id="L2022">                this.ch = startChar;</span>
<span class="nc" id="L2023">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2024">                return null;</span>
            }
<span class="fc" id="L2026">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L2027">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L2030" title="1 of 4 branches missed.">                if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L2031">                    bp = endIndex + 1;</span>
<span class="fc" id="L2032">                    this.ch = ch;</span>
<span class="fc" id="L2033">                    break;</span>
<span class="nc bnc" id="L2034" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L2035">                    endIndex++;</span>
<span class="nc" id="L2036">                    ch = charAt(endIndex + 1);</span>
<span class="nc" id="L2037">                } else {</span>
<span class="nc" id="L2038">                    this.bp = startPos;</span>
<span class="nc" id="L2039">                    this.ch = startChar;</span>
<span class="nc" id="L2040">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L2042">                    return null;</span>
                }
            }
<span class="pc bpc" id="L2045" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L2046">            long millis = 0;</span>

<span class="fc" id="L2048">            boolean negative = false;</span>
<span class="pc bpc" id="L2049" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L2050">                ch = charAt(index++);</span>
<span class="nc" id="L2051">                negative = true;</span>
            }

<span class="pc bpc" id="L2054" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2055">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L2057">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L2058" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2059">                        millis = millis * 10 + (ch - '0');</span>
<span class="fc" id="L2060">                    } else {</span>
<span class="pc bpc" id="L2061" title="1 of 4 branches missed.">                        if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L2062">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L2069" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L2070">                this.bp = startPos;</span>
<span class="nc" id="L2071">                this.ch = startChar;</span>
<span class="nc" id="L2072">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2073">                return null;</span>
            }

<span class="pc bpc" id="L2076" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L2077">                millis = -millis;</span>
            }

<span class="fc" id="L2080">            dateVal = new java.util.Date(millis);</span>
<span class="pc bpc" id="L2081" title="1 of 2 branches missed.">        } else if (ch == 'n'</span>
<span class="pc bpc" id="L2082" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'u'</span>
<span class="pc bpc" id="L2083" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l'</span>
<span class="pc bpc" id="L2084" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l') {</span>
<span class="fc" id="L2085">            dateVal = null;</span>
<span class="fc" id="L2086">            ch = charAt(index);</span>
<span class="fc" id="L2087">            bp = index;</span>
<span class="fc" id="L2088">        } else {</span>
<span class="nc" id="L2089">            this.bp = startPos;</span>
<span class="nc" id="L2090">            this.ch = startChar;</span>
<span class="nc" id="L2091">            matchStat = NOT_MATCH;</span>

<span class="nc" id="L2093">            return null;</span>
        }

<span class="fc bfc" id="L2096" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L2097">            this.ch = charAt(++bp);</span>
<span class="fc" id="L2098">            matchStat = VALUE;</span>
<span class="fc" id="L2099">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L2102">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L2103" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L2104">                token = JSONToken.COMMA;</span>
<span class="nc" id="L2105">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2106" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L2107">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L2108">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2109" title="1 of 2 branches missed.">            } else if (ch == '}') {</span>
<span class="nc" id="L2110">                token = JSONToken.RBRACE;</span>
<span class="nc" id="L2111">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2112" title="1 of 2 branches missed.">            } else if (ch == EOI) {</span>
<span class="fc" id="L2113">                this.ch = EOI;</span>
<span class="fc" id="L2114">                token = JSONToken.EOF;</span>
<span class="fc" id="L2115">            } else {</span>
<span class="nc" id="L2116">                this.bp = startPos;</span>
<span class="nc" id="L2117">                this.ch = startChar;</span>
<span class="nc" id="L2118">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2119">                return null;</span>
            }
<span class="fc" id="L2121">            matchStat = END;</span>
        }
<span class="fc" id="L2123">        return dateVal;</span>
    }

    protected final void arrayCopy(int srcPos, char[] dest, int destPos, int length) {
<span class="fc" id="L2127">        text.getChars(srcPos, srcPos + length, dest, destPos);</span>
<span class="fc" id="L2128">    }</span>

    public String info() {
<span class="fc" id="L2131">        StringBuilder buf = new StringBuilder();</span>

//        buf.append(&quot;pos &quot;).append(bp);
//        return &quot;pos &quot; + bp //
//                + &quot;, json : &quot; //
//                + (text.length() &lt; 65536 //
//                ? text //
//                : text.substring(0, 65536));

<span class="fc" id="L2140">        int line = 1;</span>
<span class="fc" id="L2141">        int column = 1;</span>
<span class="fc bfc" id="L2142" title="All 2 branches covered.">        for (int i = 0; i &lt; bp; ++i, column++) {</span>
<span class="fc" id="L2143">            char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2144" title="1 of 2 branches missed.">            if (ch == '\n') {</span>
<span class="nc" id="L2145">                column = 1;</span>
<span class="nc" id="L2146">                line++;</span>
            }
        }

<span class="fc" id="L2150">        buf.append(&quot;pos &quot;).append(bp)</span>
<span class="fc" id="L2151">                .append(&quot;, line &quot;).append(line)</span>
<span class="fc" id="L2152">                .append(&quot;, column &quot;).append(column);</span>

<span class="pc bpc" id="L2154" title="1 of 2 branches missed.">        if (text.length() &lt; 65535) {</span>
<span class="fc" id="L2155">            buf.append(text);</span>
<span class="fc" id="L2156">        } else {</span>
<span class="nc" id="L2157">            buf.append(text.substring(0, 65535));</span>
        }

<span class="fc" id="L2160">        return buf.toString();</span>
    }

    // for hsf support
    public String[] scanFieldStringArray(char[] fieldName, int argTypesCount, SymbolTable typeSymbolTable) {
<span class="fc" id="L2165">        int startPos = bp;</span>
<span class="fc" id="L2166">        char starChar = ch;</span>

<span class="fc bfc" id="L2168" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2169">            next();</span>
        }

        int offset;
        char ch;
<span class="fc bfc" id="L2174" title="All 2 branches covered.">        if (fieldName != null) {</span>
<span class="fc" id="L2175">            matchStat = UNKNOWN;</span>
<span class="fc bfc" id="L2176" title="All 2 branches covered.">            if (!charArrayCompare(fieldName)) {</span>
<span class="fc" id="L2177">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L2178">                return null;</span>
            }

<span class="fc" id="L2181">            offset = bp + fieldName.length;</span>
<span class="fc" id="L2182">            ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2183" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2184">                ch = text.charAt(offset++);</span>
            }

<span class="pc bpc" id="L2187" title="1 of 2 branches missed.">            if (ch == ':') {</span>
<span class="fc" id="L2188">                ch = text.charAt(offset++);</span>
<span class="fc" id="L2189">            } else {</span>
<span class="nc" id="L2190">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2191">                return null;</span>
            }

<span class="fc bfc" id="L2194" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2195">                ch = text.charAt(offset++);</span>
            }
<span class="fc" id="L2197">        } else {</span>
<span class="fc" id="L2198">            offset = bp + 1;</span>
<span class="fc" id="L2199">            ch = this.ch;</span>
        }

<span class="fc bfc" id="L2202" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L2203">            bp = offset;</span>
<span class="fc" id="L2204">            this.ch = text.charAt(bp);</span>
<span class="pc bpc" id="L2205" title="2 of 4 branches missed.">        } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, bp + 1)) {</span>
<span class="fc" id="L2206">            bp += 4;</span>
<span class="fc" id="L2207">            this.ch = text.charAt(bp);</span>
<span class="fc" id="L2208">            return null;</span>
        } else {
<span class="nc" id="L2210">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2211">            return null;</span>
        }

<span class="pc bpc" id="L2214" title="1 of 2 branches missed.">        String[] types = argTypesCount &gt;= 0 ? new String[argTypesCount] : new String[4];</span>
<span class="fc" id="L2215">        int typeIndex = 0;</span>
<span class="fc" id="L2216">        for (;;) {</span>
<span class="fc bfc" id="L2217" title="All 2 branches covered.">            while (isWhitespace(this.ch)) {</span>
<span class="fc" id="L2218">                next();</span>
            }

<span class="fc bfc" id="L2221" title="All 2 branches covered.">            if (this.ch != '\&quot;') {</span>
<span class="fc" id="L2222">                this.bp = startPos;</span>
<span class="fc" id="L2223">                this.ch = starChar;</span>
<span class="fc" id="L2224">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L2225">                return null;</span>
            }

<span class="fc" id="L2228">            String type = scanSymbol(typeSymbolTable, '&quot;');</span>
<span class="pc bpc" id="L2229" title="1 of 2 branches missed.">            if (typeIndex == types.length) {</span>
<span class="nc" id="L2230">                int newCapacity = types.length + (types.length &gt;&gt; 1) + 1;</span>
<span class="nc" id="L2231">                String[] array = new String[newCapacity];</span>
<span class="nc" id="L2232">                System.arraycopy(types, 0, array, 0, types.length);</span>
<span class="nc" id="L2233">                types = array;</span>
            }
<span class="fc" id="L2235">            types[typeIndex++] = type;</span>
<span class="pc bpc" id="L2236" title="1 of 2 branches missed.">            while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2237">                next();</span>
            }
<span class="fc bfc" id="L2239" title="All 2 branches covered.">            if (this.ch == ',') {</span>
<span class="fc" id="L2240">                next();</span>
                continue;
            }
            break;
        }
<span class="pc bpc" id="L2245" title="1 of 2 branches missed.">        if (types.length != typeIndex) {</span>
<span class="fc" id="L2246">            String[] array = new String[typeIndex];</span>
<span class="fc" id="L2247">            System.arraycopy(types, 0, array, 0, typeIndex);</span>
<span class="fc" id="L2248">            types = array;</span>
        }

<span class="pc bpc" id="L2251" title="1 of 2 branches missed.">        while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2252">            next();</span>
        }

<span class="pc bpc" id="L2255" title="1 of 2 branches missed.">        if (this.ch == ']') {</span>
<span class="fc" id="L2256">            next();</span>
<span class="fc" id="L2257">        } else {</span>
<span class="nc" id="L2258">            this.bp = startPos;</span>
<span class="nc" id="L2259">            this.ch = starChar;</span>
<span class="nc" id="L2260">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2261">            return null;</span>
        }

<span class="fc" id="L2264">        return types;</span>
    }

    public boolean matchField2(char[] fieldName) {
<span class="fc bfc" id="L2268" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2269">            next();</span>
        }

<span class="pc bpc" id="L2272" title="1 of 2 branches missed.">        if (!charArrayCompare(fieldName)) {</span>
<span class="nc" id="L2273">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2274">            return false;</span>
        }

<span class="fc" id="L2277">        int offset = bp + fieldName.length;</span>
<span class="fc" id="L2278">        char ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2279" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2280">            ch = text.charAt(offset++);</span>
        }

<span class="pc bpc" id="L2283" title="1 of 2 branches missed.">        if (ch == ':') {</span>
<span class="fc" id="L2284">            this.bp = offset;</span>
<span class="fc" id="L2285">            this.ch = charAt(bp);</span>
<span class="fc" id="L2286">            return true;</span>
        } else {
<span class="nc" id="L2288">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2289">            return false;</span>
        }
    }

    public final void skipObject() {
<span class="nc" id="L2294">        skipObject(false);</span>
<span class="nc" id="L2295">    }</span>

    public final void skipObject(boolean valid) {
<span class="fc" id="L2298">        boolean quote = false;</span>
<span class="fc" id="L2299">        int braceCnt = 0;</span>
<span class="fc" id="L2300">        int i = bp;</span>
<span class="fc bfc" id="L2301" title="All 2 branches covered.">        for (; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2302">            final char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2303" title="1 of 2 branches missed.">            if (ch == '\\') {</span>
<span class="nc bnc" id="L2304" title="All 2 branches missed.">                if (i &lt; len - 1) {</span>
<span class="nc" id="L2305">                    ++i;</span>
<span class="nc" id="L2306">                    continue;</span>
                } else {
<span class="nc" id="L2308">                    this.ch = ch;</span>
<span class="nc" id="L2309">                    this.bp = i;</span>
<span class="nc" id="L2310">                    throw new JSONException(&quot;illegal str, &quot; + info());</span>
                }
<span class="fc bfc" id="L2312" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc bfc" id="L2313" title="All 2 branches covered.">                quote = !quote;</span>
<span class="fc bfc" id="L2314" title="All 2 branches covered.">            } else if (ch == '{') {</span>
<span class="pc bpc" id="L2315" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2316">                    continue;</span>
                }
<span class="fc" id="L2318">                braceCnt++;</span>
<span class="fc bfc" id="L2319" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc bfc" id="L2320" title="All 2 branches covered.">                if (quote) {</span>
<span class="fc" id="L2321">                    continue;</span>
                } else {
<span class="fc" id="L2323">                    braceCnt--;</span>
                }
<span class="fc bfc" id="L2325" title="All 2 branches covered.">                if (braceCnt == -1) {</span>
<span class="fc" id="L2326">                    this.bp = i + 1;</span>
<span class="fc bfc" id="L2327" title="All 2 branches covered.">                    if (this.bp == text.length()) {</span>
<span class="fc" id="L2328">                        this.ch = EOI;</span>
<span class="fc" id="L2329">                        this.token = JSONToken.EOF;</span>
<span class="fc" id="L2330">                        return;</span>
                    }
<span class="fc" id="L2332">                    this.ch = text.charAt(this.bp);</span>
<span class="fc bfc" id="L2333" title="All 2 branches covered.">                    if (this.ch == ',') {</span>
<span class="fc" id="L2334">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L2335">                        int index = ++bp;</span>
<span class="pc bpc" id="L2336" title="1 of 2 branches missed.">                        this.ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2337">                                ? EOI //</span>
<span class="fc" id="L2338">                                : text.charAt(index));</span>
<span class="fc" id="L2339">                        return;</span>
<span class="fc bfc" id="L2340" title="All 2 branches covered.">                    } else if (this.ch == '}') {</span>
<span class="fc" id="L2341">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L2342">                        next();</span>
<span class="fc" id="L2343">                        return;</span>
<span class="fc bfc" id="L2344" title="All 2 branches covered.">                    } else if (this.ch == ']') {</span>
<span class="fc" id="L2345">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L2346">                        next();</span>
<span class="fc" id="L2347">                        return;</span>
                    } else {
<span class="fc" id="L2349">                        nextToken(JSONToken.COMMA);</span>
                    }
<span class="fc" id="L2351">                    return;</span>
                }
            }
        }

<span class="fc bfc" id="L2356" title="All 2 branches covered.">        for (int j = 0; j &lt; bp; j++) {</span>
<span class="fc bfc" id="L2357" title="All 4 branches covered.">            if (j &lt; text.length() &amp;&amp; text.charAt(j) == ' ') {</span>
<span class="fc" id="L2358">                i++;</span>
            }
        }

<span class="fc bfc" id="L2362" title="All 2 branches covered.">        if (i == text.length()) {</span>
<span class="fc" id="L2363">            throw new JSONException(&quot;illegal str, &quot; + info());</span>
        }
<span class="fc" id="L2365">    }</span>

    public final void skipArray() {
<span class="nc" id="L2368">        skipArray(false);</span>
<span class="nc" id="L2369">    }</span>

    public final void skipArray(boolean valid) {
<span class="fc" id="L2372">        boolean quote = false;</span>
<span class="fc" id="L2373">        int bracketCnt = 0;</span>
<span class="fc" id="L2374">        int i = bp;</span>
<span class="fc bfc" id="L2375" title="All 2 branches covered.">        for (; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2376">            char ch = text.charAt(i);</span>
<span class="pc bpc" id="L2377" title="1 of 2 branches missed.">            if (ch == '\\') {</span>
<span class="nc bnc" id="L2378" title="All 2 branches missed.">                if (i &lt; len - 1) {</span>
<span class="nc" id="L2379">                    ++i;</span>
<span class="nc" id="L2380">                    continue;</span>
                } else {
<span class="nc" id="L2382">                    this.ch = ch;</span>
<span class="nc" id="L2383">                    this.bp = i;</span>
<span class="nc" id="L2384">                    throw new JSONException(&quot;illegal str, &quot; + info());</span>
                }
<span class="fc bfc" id="L2386" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc bfc" id="L2387" title="All 2 branches covered.">                quote = !quote;</span>
<span class="fc bfc" id="L2388" title="All 2 branches covered.">            } else if (ch == '[') {</span>
<span class="pc bpc" id="L2389" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2390">                    continue;</span>
                }
<span class="fc" id="L2392">                bracketCnt++;</span>
<span class="fc bfc" id="L2393" title="All 4 branches covered.">            } else if (ch == '{' &amp;&amp; valid) {</span>
                {
<span class="fc" id="L2395">                    int index = ++bp;</span>
<span class="fc bfc" id="L2396" title="All 2 branches covered.">                    this.ch = (index &gt;= text.length() //</span>
<span class="fc" id="L2397">                            ? EOI //</span>
<span class="fc" id="L2398">                            : text.charAt(index));</span>
                }

<span class="fc" id="L2401">                skipObject(valid);</span>
<span class="fc bfc" id="L2402" title="All 2 branches covered.">            } else if (ch == ']') {</span>
<span class="pc bpc" id="L2403" title="1 of 2 branches missed.">                if (quote) {</span>
<span class="nc" id="L2404">                    continue;</span>
                } else {
<span class="fc" id="L2406">                    bracketCnt--;</span>
                }
<span class="fc bfc" id="L2408" title="All 2 branches covered.">                if (bracketCnt == -1) {</span>
<span class="fc" id="L2409">                    this.bp = i + 1;</span>
<span class="fc bfc" id="L2410" title="All 2 branches covered.">                    if (this.bp == text.length()) {</span>
<span class="fc" id="L2411">                        this.ch = EOI;</span>
<span class="fc" id="L2412">                        token = JSONToken.EOF;</span>
<span class="fc" id="L2413">                        return;</span>
                    }
<span class="fc" id="L2415">                    this.ch = text.charAt(this.bp);</span>
<span class="fc" id="L2416">                    nextToken(JSONToken.COMMA);</span>
<span class="fc" id="L2417">                    return;</span>
                }
            }
        }

<span class="pc bpc" id="L2422" title="1 of 2 branches missed.">        if (i == text.length()) {</span>
<span class="fc" id="L2423">            throw new JSONException(&quot;illegal str, &quot; + info());</span>
        }
<span class="nc" id="L2425">    }</span>

    public final void skipString() {
<span class="pc bpc" id="L2428" title="1 of 2 branches missed.">        if (ch == '&quot;') {</span>
<span class="pc bpc" id="L2429" title="1 of 2 branches missed.">            for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2430">                char c = text.charAt(i);</span>
<span class="fc bfc" id="L2431" title="All 2 branches covered.">                if (c == '\\') {</span>
<span class="pc bpc" id="L2432" title="1 of 2 branches missed.">                    if (i &lt; len - 1) {</span>
<span class="fc" id="L2433">                        ++i;</span>
<span class="fc" id="L2434">                        continue;</span>
                    }
<span class="fc bfc" id="L2436" title="All 2 branches covered.">                } else if (c == '&quot;') {</span>
<span class="fc" id="L2437">                    this.ch = text.charAt(bp = i + 1);</span>
<span class="fc" id="L2438">                    return;</span>
                }
            }
<span class="nc" id="L2441">            throw new JSONException(&quot;unclosed str&quot;);</span>
        } else {
<span class="nc" id="L2443">            throw new UnsupportedOperationException();</span>
        }
    }

    public boolean seekArrayToItem(int index) {
<span class="pc bpc" id="L2448" title="1 of 2 branches missed.">        if (index &lt; 0) {</span>
<span class="nc" id="L2449">            throw new IllegalArgumentException(&quot;index must &gt; 0, but &quot; + index);</span>
        }

<span class="fc bfc" id="L2452" title="All 2 branches covered.">        if (token == JSONToken.EOF) {</span>
<span class="fc" id="L2453">            return false;</span>
        }

<span class="pc bpc" id="L2456" title="1 of 2 branches missed.">        if (token != JSONToken.LBRACKET) {</span>
<span class="nc" id="L2457">            throw new UnsupportedOperationException();</span>
        }
//        nextToken();

<span class="fc bfc" id="L2461" title="All 2 branches covered.">        for (int i = 0; i &lt; index; ++i) {</span>
<span class="fc" id="L2462">            skipWhitespace();</span>
<span class="pc bpc" id="L2463" title="1 of 4 branches missed.">            if (ch == '&quot;' || ch == '\'') {</span>
<span class="fc" id="L2464">                skipString();</span>
<span class="pc bpc" id="L2465" title="1 of 2 branches missed.">                if (ch == ',') {</span>
<span class="fc" id="L2466">                    next();</span>
<span class="fc" id="L2467">                    continue;</span>
<span class="nc bnc" id="L2468" title="All 2 branches missed.">                } else if (ch == ']') {</span>
<span class="nc" id="L2469">                    next();</span>
<span class="nc" id="L2470">                    nextToken(JSONToken.COMMA);</span>
<span class="nc" id="L2471">                    return false;</span>
                } else {
<span class="nc" id="L2473">                    throw new JSONException(&quot;illegal json.&quot;);</span>
                }
<span class="fc bfc" id="L2475" title="All 2 branches covered.">            } else if (ch == '{') {</span>
<span class="fc" id="L2476">                next();</span>
<span class="fc" id="L2477">                token = JSONToken.LBRACE;</span>
<span class="fc" id="L2478">                skipObject(false);</span>
<span class="fc bfc" id="L2479" title="All 2 branches covered.">            } else if (ch == '[') {</span>
<span class="fc" id="L2480">                next();</span>
<span class="fc" id="L2481">                token = JSONToken.LBRACKET;</span>
<span class="fc" id="L2482">                skipArray(false);</span>
<span class="fc" id="L2483">            } else {</span>
<span class="fc" id="L2484">                boolean match = false;</span>
<span class="pc bpc" id="L2485" title="1 of 2 branches missed.">                for (int j = bp + 1; j &lt; text.length(); ++j) {</span>
<span class="fc" id="L2486">                    char c = text.charAt(j);</span>
<span class="fc bfc" id="L2487" title="All 2 branches covered.">                    if (c == ',') {</span>
<span class="fc" id="L2488">                        match = true;</span>
<span class="fc" id="L2489">                        bp = j + 1;</span>
<span class="fc" id="L2490">                        ch = charAt(bp);</span>
<span class="fc" id="L2491">                        break;</span>
<span class="fc bfc" id="L2492" title="All 2 branches covered.">                    } else if (c == ']') {</span>
<span class="fc" id="L2493">                        bp = j + 1;</span>
<span class="fc" id="L2494">                        ch = charAt(bp);</span>
<span class="fc" id="L2495">                        nextToken();</span>
<span class="fc" id="L2496">                        return false;</span>
                    }
                }

<span class="pc bpc" id="L2500" title="1 of 2 branches missed.">                if (!match) {</span>
<span class="nc" id="L2501">                    throw new JSONException(&quot;illegal json.&quot;);</span>
                }

                continue;
            }

<span class="pc bpc" id="L2507" title="1 of 2 branches missed.">            if (token == JSONToken.COMMA) {</span>
<span class="fc" id="L2508">                continue;</span>
<span class="nc bnc" id="L2509" title="All 2 branches missed.">            } else if (token == JSONToken.RBRACKET) {</span>
<span class="nc" id="L2510">                return false;</span>
            } else {
<span class="nc" id="L2512">                throw new UnsupportedOperationException();</span>
            }

        }

<span class="fc" id="L2517">        nextToken();</span>
<span class="fc" id="L2518">        return true;</span>
    }

    public int seekObjectToField(long fieldNameHash, boolean deepScan) {
<span class="fc bfc" id="L2522" title="All 2 branches covered.">        if (token == JSONToken.EOF) {</span>
<span class="fc" id="L2523">            return JSONLexer.NOT_MATCH;</span>
        }

<span class="pc bpc" id="L2526" title="1 of 4 branches missed.">        if (token == JSONToken.RBRACE || token == JSONToken.RBRACKET) {</span>
<span class="fc" id="L2527">            nextToken();</span>
<span class="fc" id="L2528">            return JSONLexer.NOT_MATCH;</span>
        }

<span class="pc bpc" id="L2531" title="1 of 4 branches missed.">        if (token != JSONToken.LBRACE &amp;&amp; token != JSONToken.COMMA) {</span>
<span class="nc" id="L2532">            throw new UnsupportedOperationException(JSONToken.name(token));</span>
        }

        for (;;) {
<span class="fc bfc" id="L2536" title="All 2 branches covered.">            if (ch == '}') {</span>
<span class="fc" id="L2537">                next();</span>
<span class="fc" id="L2538">                nextToken();</span>
<span class="fc" id="L2539">                return JSONLexer.NOT_MATCH;</span>
            }
<span class="pc bpc" id="L2541" title="1 of 2 branches missed.">            if (ch == EOI) {</span>
<span class="nc" id="L2542">                return JSONLexer.NOT_MATCH;</span>
            }

<span class="fc bfc" id="L2545" title="All 2 branches covered.">            if (ch != '&quot;') {</span>
<span class="fc" id="L2546">                skipWhitespace();</span>
            }

            long hash;
<span class="pc bpc" id="L2550" title="1 of 2 branches missed.">            if (ch == '&quot;') {</span>
<span class="fc" id="L2551">                hash = 0xcbf29ce484222325L;</span>

<span class="pc bpc" id="L2553" title="1 of 2 branches missed.">                for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2554">                    char c = text.charAt(i);</span>
<span class="pc bpc" id="L2555" title="1 of 2 branches missed.">                    if (c == '\\') {</span>
<span class="nc" id="L2556">                        ++i;</span>
<span class="nc bnc" id="L2557" title="All 2 branches missed.">                        if (i == text.length()) {</span>
<span class="nc" id="L2558">                            throw new JSONException(&quot;unclosed str, &quot; + info());</span>
                        }
<span class="nc" id="L2560">                        c = text.charAt(i);</span>
                    }

<span class="fc bfc" id="L2563" title="All 2 branches covered.">                    if (c == '&quot;') {</span>
<span class="fc" id="L2564">                        bp = i + 1;</span>
<span class="pc bpc" id="L2565" title="1 of 2 branches missed.">                        ch = (bp &gt;= text.length() //</span>
<span class="nc" id="L2566">                                ? EOI //</span>
<span class="fc" id="L2567">                                : text.charAt(bp));</span>
<span class="fc" id="L2568">                        break;</span>
                    }

<span class="fc" id="L2571">                    hash ^= c;</span>
<span class="fc" id="L2572">                    hash *= 0x100000001b3L;</span>
                }
<span class="nc" id="L2574">            } else {</span>
<span class="nc" id="L2575">                throw new UnsupportedOperationException();</span>
            }

<span class="fc bfc" id="L2578" title="All 2 branches covered.">            if (hash == fieldNameHash) {</span>
<span class="fc bfc" id="L2579" title="All 2 branches covered.">                if (ch != ':') {</span>
<span class="fc" id="L2580">                    skipWhitespace();</span>
                }
<span class="pc bpc" id="L2582" title="1 of 2 branches missed.">                if (ch == ':') {</span>
                    {
<span class="fc" id="L2584">                        int index = ++bp;</span>
<span class="pc bpc" id="L2585" title="1 of 2 branches missed.">                        ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2586">                                ? EOI //</span>
<span class="fc" id="L2587">                                : text.charAt(index));</span>
                    }
<span class="pc bpc" id="L2589" title="1 of 2 branches missed.">                    if (ch == ',') {</span>
                        {
<span class="nc" id="L2591">                            int index = ++bp;</span>
<span class="nc bnc" id="L2592" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2593">                                    ? EOI //</span>
<span class="nc" id="L2594">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2596">                        token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L2597" title="1 of 2 branches missed.">                    } else if (ch == ']') {</span>
                        {
<span class="nc" id="L2599">                            int index = ++bp;</span>
<span class="nc bnc" id="L2600" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2601">                                    ? EOI //</span>
<span class="nc" id="L2602">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2604">                        token = JSONToken.RBRACKET;</span>
<span class="pc bpc" id="L2605" title="1 of 2 branches missed.">                    } else if (ch == '}') {</span>
                        {
<span class="nc" id="L2607">                            int index = ++bp;</span>
<span class="nc bnc" id="L2608" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2609">                                    ? EOI //</span>
<span class="nc" id="L2610">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2612">                        token = JSONToken.RBRACE;</span>
<span class="pc bfc" id="L2613" title="All 4 branches covered.">                    } else if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2614">                        sp = 0;</span>
<span class="fc" id="L2615">                        pos = bp;</span>
<span class="fc" id="L2616">                        scanNumber();</span>
<span class="fc" id="L2617">                    } else {</span>
<span class="fc" id="L2618">                        nextToken(JSONToken.LITERAL_INT);</span>
                    }
                }
<span class="fc" id="L2621">                return VALUE;</span>
            }

<span class="fc bfc" id="L2624" title="All 2 branches covered.">            if (ch != ':') {</span>
<span class="fc" id="L2625">                skipWhitespace();</span>
            }

<span class="pc bpc" id="L2628" title="1 of 2 branches missed.">            if (ch == ':') {</span>
<span class="fc" id="L2629">                int index = ++bp;</span>
<span class="pc bpc" id="L2630" title="1 of 2 branches missed.">                ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2631">                        ? EOI //</span>
<span class="fc" id="L2632">                        : text.charAt(index));</span>
<span class="fc" id="L2633">            } else {</span>
<span class="nc" id="L2634">                throw new JSONException(&quot;illegal json, &quot; + info());</span>
            }

<span class="pc bpc" id="L2637" title="1 of 2 branches missed.">            if (ch != '&quot;'</span>
<span class="pc bpc" id="L2638" title="1 of 2 branches missed.">                    &amp;&amp; ch != '\''</span>
<span class="pc bpc" id="L2639" title="1 of 2 branches missed.">                    &amp;&amp; ch != '{'</span>
<span class="pc bpc" id="L2640" title="1 of 2 branches missed.">                    &amp;&amp; ch != '['</span>
<span class="pc bpc" id="L2641" title="1 of 2 branches missed.">                    &amp;&amp; ch != '0'</span>
<span class="fc bfc" id="L2642" title="All 2 branches covered.">                    &amp;&amp; ch != '1'</span>
<span class="pc bpc" id="L2643" title="1 of 2 branches missed.">                    &amp;&amp; ch != '2'</span>
<span class="pc bpc" id="L2644" title="1 of 2 branches missed.">                    &amp;&amp; ch != '3'</span>
<span class="pc bpc" id="L2645" title="1 of 2 branches missed.">                    &amp;&amp; ch != '4'</span>
<span class="pc bpc" id="L2646" title="1 of 2 branches missed.">                    &amp;&amp; ch != '5'</span>
<span class="pc bpc" id="L2647" title="1 of 2 branches missed.">                    &amp;&amp; ch != '6'</span>
<span class="pc bpc" id="L2648" title="1 of 2 branches missed.">                    &amp;&amp; ch != '7'</span>
<span class="pc bpc" id="L2649" title="1 of 2 branches missed.">                    &amp;&amp; ch != '8'</span>
<span class="pc bpc" id="L2650" title="1 of 2 branches missed.">                    &amp;&amp; ch != '9'</span>
<span class="pc bpc" id="L2651" title="1 of 2 branches missed.">                    &amp;&amp; ch != '+'</span>
<span class="pc bpc" id="L2652" title="1 of 2 branches missed.">                    &amp;&amp; ch != '-') {</span>
<span class="fc" id="L2653">                skipWhitespace();</span>
            }

            // skip fieldValues
<span class="pc bpc" id="L2657" title="2 of 8 branches missed.">            if (ch == '-' || ch == '+' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L2658">                next();</span>
<span class="pc bpc" id="L2659" title="1 of 4 branches missed.">                while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2660">                    next();</span>
                }

                // scale
<span class="fc bfc" id="L2664" title="All 2 branches covered.">                if (ch == '.') {</span>
<span class="fc" id="L2665">                    next();</span>
<span class="pc bpc" id="L2666" title="1 of 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2667">                        next();</span>
                    }
                }

                // exp
<span class="pc bpc" id="L2672" title="2 of 4 branches missed.">                if (ch == 'E' || ch == 'e') {</span>
<span class="nc" id="L2673">                    next();</span>
<span class="nc bnc" id="L2674" title="All 4 branches missed.">                    if (ch == '-' || ch == '+') {</span>
<span class="nc" id="L2675">                        next();</span>
                    }
<span class="nc bnc" id="L2677" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2678">                        next();</span>
                    }
                }

<span class="fc bfc" id="L2682" title="All 2 branches covered.">                if (ch != ',') {</span>
<span class="fc" id="L2683">                    skipWhitespace();</span>
                }
<span class="fc bfc" id="L2685" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2686">                    next();</span>
                }
<span class="fc bfc" id="L2688" title="All 2 branches covered.">            } else if (ch == '&quot;') {</span>
<span class="fc" id="L2689">                skipString();</span>

<span class="pc bpc" id="L2691" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2692">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2695" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2696">                    next();</span>
                }
<span class="fc bfc" id="L2698" title="All 2 branches covered.">            } else if (ch == 't') {</span>
<span class="fc" id="L2699">                next();</span>
<span class="pc bpc" id="L2700" title="1 of 2 branches missed.">                if (ch == 'r') {</span>
<span class="fc" id="L2701">                    next();</span>
<span class="pc bpc" id="L2702" title="1 of 2 branches missed.">                    if (ch == 'u') {</span>
<span class="fc" id="L2703">                        next();</span>
<span class="pc bpc" id="L2704" title="1 of 2 branches missed.">                        if (ch == 'e') {</span>
<span class="fc" id="L2705">                            next();</span>
                        }
                    }
                }

<span class="pc bpc" id="L2710" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2711">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2714" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2715">                    next();</span>
                }
<span class="fc bfc" id="L2717" title="All 2 branches covered.">            } else if (ch == 'n') {</span>
<span class="fc" id="L2718">                next();</span>
<span class="pc bpc" id="L2719" title="1 of 2 branches missed.">                if (ch == 'u') {</span>
<span class="fc" id="L2720">                    next();</span>
<span class="pc bpc" id="L2721" title="1 of 2 branches missed.">                    if (ch == 'l') {</span>
<span class="fc" id="L2722">                        next();</span>
<span class="pc bpc" id="L2723" title="1 of 2 branches missed.">                        if (ch == 'l') {</span>
<span class="fc" id="L2724">                            next();</span>
                        }
                    }
                }

<span class="pc bpc" id="L2729" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2730">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2733" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2734">                    next();</span>
                }
<span class="fc bfc" id="L2736" title="All 2 branches covered.">            } else if (ch == 'f') {</span>
<span class="fc" id="L2737">                next();</span>
<span class="pc bpc" id="L2738" title="1 of 2 branches missed.">                if (ch == 'a') {</span>
<span class="fc" id="L2739">                    next();</span>
<span class="pc bpc" id="L2740" title="1 of 2 branches missed.">                    if (ch == 'l') {</span>
<span class="fc" id="L2741">                        next();</span>
<span class="pc bpc" id="L2742" title="1 of 2 branches missed.">                        if (ch == 's') {</span>
<span class="fc" id="L2743">                            next();</span>
<span class="pc bpc" id="L2744" title="1 of 2 branches missed.">                            if (ch == 'e') {</span>
<span class="fc" id="L2745">                                next();</span>
                            }
                        }
                    }
                }

<span class="pc bpc" id="L2751" title="1 of 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="fc" id="L2752">                    skipWhitespace();</span>
                }

<span class="fc bfc" id="L2755" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L2756">                    next();</span>
                }
<span class="fc bfc" id="L2758" title="All 2 branches covered.">            } else if (ch == '{') {</span>
                {
<span class="fc" id="L2760">                    int index = ++bp;</span>
<span class="pc bpc" id="L2761" title="1 of 2 branches missed.">                    ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2762">                            ? EOI //</span>
<span class="fc" id="L2763">                            : text.charAt(index));</span>
                }
<span class="fc bfc" id="L2765" title="All 2 branches covered.">                if (deepScan) {</span>
<span class="fc" id="L2766">                    token = JSONToken.LBRACE;</span>
<span class="fc" id="L2767">                    return OBJECT;</span>
                }

<span class="fc" id="L2770">                skipObject(false);</span>
<span class="fc bfc" id="L2771" title="All 2 branches covered.">                if (token == JSONToken.RBRACE) {</span>
<span class="fc" id="L2772">                    return JSONLexer.NOT_MATCH;</span>
                }
<span class="pc bpc" id="L2774" title="1 of 2 branches missed.">            } else if (ch == '[') {</span>
<span class="fc" id="L2775">                next();</span>
<span class="fc bfc" id="L2776" title="All 2 branches covered.">                if (deepScan) {</span>
<span class="fc" id="L2777">                    token = JSONToken.LBRACKET;</span>
<span class="fc" id="L2778">                    return ARRAY;</span>
                }
<span class="fc" id="L2780">                skipArray(false);</span>
<span class="pc bpc" id="L2781" title="1 of 2 branches missed.">                if (token == JSONToken.RBRACE) {</span>
<span class="nc" id="L2782">                    return JSONLexer.NOT_MATCH;</span>
                }
            } else {
<span class="nc" id="L2785">                throw new UnsupportedOperationException();</span>
            }
        }
    }

    public int seekObjectToField(long[] fieldNameHash) {
<span class="pc bpc" id="L2791" title="1 of 4 branches missed.">        if (token != JSONToken.LBRACE &amp;&amp; token != JSONToken.COMMA) {</span>
<span class="nc" id="L2792">            throw new UnsupportedOperationException();</span>
        }

        for (;;) {
<span class="pc bpc" id="L2796" title="1 of 2 branches missed.">            if (ch == '}') {</span>
<span class="nc" id="L2797">                next();</span>
<span class="nc" id="L2798">                nextToken();</span>
<span class="nc" id="L2799">                this.matchStat = JSONLexer.NOT_MATCH;</span>
<span class="nc" id="L2800">                return -1;</span>
            }
<span class="pc bpc" id="L2802" title="1 of 2 branches missed.">            if (ch == EOI) {</span>
<span class="nc" id="L2803">                this.matchStat = JSONLexer.NOT_MATCH;</span>
<span class="nc" id="L2804">                return -1;</span>
            }

<span class="pc bpc" id="L2807" title="1 of 2 branches missed.">            if (ch != '&quot;') {</span>
<span class="fc" id="L2808">                skipWhitespace();</span>
            }

            long hash;
<span class="pc bpc" id="L2812" title="1 of 2 branches missed.">            if (ch == '&quot;') {</span>
<span class="fc" id="L2813">                hash = 0xcbf29ce484222325L;</span>

<span class="pc bpc" id="L2815" title="1 of 2 branches missed.">                for (int i = bp + 1; i &lt; text.length(); ++i) {</span>
<span class="fc" id="L2816">                    char c = text.charAt(i);</span>
<span class="pc bpc" id="L2817" title="1 of 2 branches missed.">                    if (c == '\\') {</span>
<span class="nc" id="L2818">                        ++i;</span>
<span class="nc bnc" id="L2819" title="All 2 branches missed.">                        if (i == text.length()) {</span>
<span class="nc" id="L2820">                            throw new JSONException(&quot;unclosed str, &quot; + info());</span>
                        }
<span class="nc" id="L2822">                        c = text.charAt(i);</span>
                    }

<span class="fc bfc" id="L2825" title="All 2 branches covered.">                    if (c == '&quot;') {</span>
<span class="fc" id="L2826">                        bp = i + 1;</span>
<span class="pc bpc" id="L2827" title="1 of 2 branches missed.">                        ch = (bp &gt;= text.length() //</span>
<span class="nc" id="L2828">                                ? EOI //</span>
<span class="fc" id="L2829">                                : text.charAt(bp));</span>
<span class="fc" id="L2830">                        break;</span>
                    }

<span class="fc" id="L2833">                    hash ^= c;</span>
<span class="fc" id="L2834">                    hash *= 0x100000001b3L;</span>
                }
<span class="nc" id="L2836">            } else {</span>
<span class="nc" id="L2837">                throw new UnsupportedOperationException();</span>
            }

<span class="fc" id="L2840">            int matchIndex = -1;</span>
<span class="pc bpc" id="L2841" title="1 of 2 branches missed.">            for (int i = 0; i &lt; fieldNameHash.length; i++) {</span>
<span class="fc bfc" id="L2842" title="All 2 branches covered.">                if (hash == fieldNameHash[i]) {</span>
<span class="fc" id="L2843">                    matchIndex = i;</span>
<span class="fc" id="L2844">                    break;</span>
                }
            }

<span class="pc bpc" id="L2848" title="1 of 2 branches missed.">            if (matchIndex != -1) {</span>
<span class="pc bpc" id="L2849" title="1 of 2 branches missed.">                if (ch != ':') {</span>
<span class="fc" id="L2850">                    skipWhitespace();</span>
                }
<span class="pc bpc" id="L2852" title="1 of 2 branches missed.">                if (ch == ':') {</span>
                    {
<span class="fc" id="L2854">                        int index = ++bp;</span>
<span class="pc bpc" id="L2855" title="1 of 2 branches missed.">                        ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2856">                                ? EOI //</span>
<span class="fc" id="L2857">                                : text.charAt(index));</span>
                    }
<span class="pc bpc" id="L2859" title="1 of 2 branches missed.">                    if (ch == ',') {</span>
                        {
<span class="nc" id="L2861">                            int index = ++bp;</span>
<span class="nc bnc" id="L2862" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2863">                                    ? EOI //</span>
<span class="nc" id="L2864">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2866">                        token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L2867" title="1 of 2 branches missed.">                    } else if (ch == ']') {</span>
                        {
<span class="nc" id="L2869">                            int index = ++bp;</span>
<span class="nc bnc" id="L2870" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2871">                                    ? EOI //</span>
<span class="nc" id="L2872">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2874">                        token = JSONToken.RBRACKET;</span>
<span class="pc bpc" id="L2875" title="1 of 2 branches missed.">                    } else if (ch == '}') {</span>
                        {
<span class="nc" id="L2877">                            int index = ++bp;</span>
<span class="nc bnc" id="L2878" title="All 2 branches missed.">                            ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2879">                                    ? EOI //</span>
<span class="nc" id="L2880">                                    : text.charAt(index));</span>
                        }
<span class="nc" id="L2882">                        token = JSONToken.RBRACE;</span>
<span class="pc bpc" id="L2883" title="3 of 4 branches missed.">                    } else if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2884">                        sp = 0;</span>
<span class="nc" id="L2885">                        pos = bp;</span>
<span class="nc" id="L2886">                        scanNumber();</span>
<span class="nc" id="L2887">                    } else {</span>
<span class="fc" id="L2888">                        nextToken(JSONToken.LITERAL_INT);</span>
                    }
                }

<span class="fc" id="L2892">                matchStat = VALUE;</span>
<span class="fc" id="L2893">                return matchIndex;</span>
            }

<span class="nc bnc" id="L2896" title="All 2 branches missed.">            if (ch != ':') {</span>
<span class="nc" id="L2897">                skipWhitespace();</span>
            }

<span class="nc bnc" id="L2900" title="All 2 branches missed.">            if (ch == ':') {</span>
<span class="nc" id="L2901">                int index = ++bp;</span>
<span class="nc bnc" id="L2902" title="All 2 branches missed.">                ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2903">                        ? EOI //</span>
<span class="nc" id="L2904">                        : text.charAt(index));</span>
<span class="nc" id="L2905">            } else {</span>
<span class="nc" id="L2906">                throw new JSONException(&quot;illegal json, &quot; + info());</span>
            }

<span class="nc bnc" id="L2909" title="All 2 branches missed.">            if (ch != '&quot;'</span>
<span class="nc bnc" id="L2910" title="All 2 branches missed.">                    &amp;&amp; ch != '\''</span>
<span class="nc bnc" id="L2911" title="All 2 branches missed.">                    &amp;&amp; ch != '{'</span>
<span class="nc bnc" id="L2912" title="All 2 branches missed.">                    &amp;&amp; ch != '['</span>
<span class="nc bnc" id="L2913" title="All 2 branches missed.">                    &amp;&amp; ch != '0'</span>
<span class="nc bnc" id="L2914" title="All 2 branches missed.">                    &amp;&amp; ch != '1'</span>
<span class="nc bnc" id="L2915" title="All 2 branches missed.">                    &amp;&amp; ch != '2'</span>
<span class="nc bnc" id="L2916" title="All 2 branches missed.">                    &amp;&amp; ch != '3'</span>
<span class="nc bnc" id="L2917" title="All 2 branches missed.">                    &amp;&amp; ch != '4'</span>
<span class="nc bnc" id="L2918" title="All 2 branches missed.">                    &amp;&amp; ch != '5'</span>
<span class="nc bnc" id="L2919" title="All 2 branches missed.">                    &amp;&amp; ch != '6'</span>
<span class="nc bnc" id="L2920" title="All 2 branches missed.">                    &amp;&amp; ch != '7'</span>
<span class="nc bnc" id="L2921" title="All 2 branches missed.">                    &amp;&amp; ch != '8'</span>
<span class="nc bnc" id="L2922" title="All 2 branches missed.">                    &amp;&amp; ch != '9'</span>
<span class="nc bnc" id="L2923" title="All 2 branches missed.">                    &amp;&amp; ch != '+'</span>
<span class="nc bnc" id="L2924" title="All 2 branches missed.">                    &amp;&amp; ch != '-') {</span>
<span class="nc" id="L2925">                skipWhitespace();</span>
            }

            // skip fieldValues
<span class="nc bnc" id="L2929" title="All 8 branches missed.">            if (ch == '-' || ch == '+' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="nc" id="L2930">                next();</span>
<span class="nc bnc" id="L2931" title="All 4 branches missed.">                while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2932">                    next();</span>
                }

                // scale
<span class="nc bnc" id="L2936" title="All 2 branches missed.">                if (ch == '.') {</span>
<span class="nc" id="L2937">                    next();</span>
<span class="nc bnc" id="L2938" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2939">                        next();</span>
                    }
                }

                // exp
<span class="nc bnc" id="L2944" title="All 4 branches missed.">                if (ch == 'E' || ch == 'e') {</span>
<span class="nc" id="L2945">                    next();</span>
<span class="nc bnc" id="L2946" title="All 4 branches missed.">                    if (ch == '-' || ch == '+') {</span>
<span class="nc" id="L2947">                        next();</span>
                    }
<span class="nc bnc" id="L2949" title="All 4 branches missed.">                    while (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="nc" id="L2950">                        next();</span>
                    }
                }

<span class="nc bnc" id="L2954" title="All 2 branches missed.">                if (ch != ',') {</span>
<span class="nc" id="L2955">                    skipWhitespace();</span>
                }
<span class="nc bnc" id="L2957" title="All 2 branches missed.">                if (ch == ',') {</span>
<span class="nc" id="L2958">                    next();</span>
                }
<span class="nc bnc" id="L2960" title="All 2 branches missed.">            } else if (ch == '&quot;') {</span>
<span class="nc" id="L2961">                skipString();</span>

<span class="nc bnc" id="L2963" title="All 4 branches missed.">                if (ch != ',' &amp;&amp; ch != '}') {</span>
<span class="nc" id="L2964">                    skipWhitespace();</span>
                }

<span class="nc bnc" id="L2967" title="All 2 branches missed.">                if (ch == ',') {</span>
<span class="nc" id="L2968">                    next();</span>
                }
<span class="nc bnc" id="L2970" title="All 2 branches missed.">            } else if (ch == '{') {</span>
                {
<span class="nc" id="L2972">                    int index = ++bp;</span>
<span class="nc bnc" id="L2973" title="All 2 branches missed.">                    ch = (index &gt;= text.length() //</span>
<span class="nc" id="L2974">                            ? EOI //</span>
<span class="nc" id="L2975">                            : text.charAt(index));</span>
                }

<span class="nc" id="L2978">                skipObject(false);</span>
<span class="nc bnc" id="L2979" title="All 2 branches missed.">            } else if (ch == '[') {</span>
<span class="nc" id="L2980">                next();</span>

<span class="nc" id="L2982">                skipArray(false);</span>
<span class="nc" id="L2983">            } else {</span>
<span class="nc" id="L2984">                throw new UnsupportedOperationException();</span>
            }
        }
    }

    public String scanTypeName(SymbolTable symbolTable) {
<span class="fc bfc" id="L2990" title="All 2 branches covered.">        if (text.startsWith(&quot;\&quot;@type\&quot;:\&quot;&quot;, bp)) {</span>
<span class="fc" id="L2991">            int p = text.indexOf('&quot;', bp + 9);</span>
<span class="pc bpc" id="L2992" title="1 of 2 branches missed.">            if (p != -1) {</span>
<span class="fc" id="L2993">                bp += 9;</span>
<span class="fc" id="L2994">                int h = 0;</span>
<span class="fc bfc" id="L2995" title="All 2 branches covered.">                for (int i = bp; i &lt; p; i++) {</span>
<span class="fc" id="L2996">                    h = 31 * h + text.charAt(i);</span>
                }
<span class="fc" id="L2998">                String typeName = addSymbol(bp, p - bp, h, symbolTable);</span>
<span class="fc" id="L2999">                char separator = text.charAt(p + 1);</span>
<span class="pc bpc" id="L3000" title="1 of 4 branches missed.">                if (separator != ',' &amp;&amp; separator != ']') {</span>
<span class="nc" id="L3001">                    return null;</span>
                }
<span class="fc" id="L3003">                bp = p + 2;</span>
<span class="fc" id="L3004">                ch = text.charAt(bp);</span>
<span class="fc" id="L3005">                return typeName;</span>
            }
        }

<span class="fc" id="L3009">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>