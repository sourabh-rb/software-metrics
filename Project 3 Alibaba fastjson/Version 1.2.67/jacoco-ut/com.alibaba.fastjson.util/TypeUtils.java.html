<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.util</a> &gt; <span class="el_source">TypeUtils.java</span></div><h1>TypeUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.util;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.PropertyNamingStrategy;
import com.alibaba.fastjson.annotation.JSONField;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.parser.DefaultJSONParser;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONScanner;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.deserializer.EnumDeserializer;
import com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer;
import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;
import com.alibaba.fastjson.serializer.CalendarCodec;
import com.alibaba.fastjson.serializer.SerializeBeanInfo;
import com.alibaba.fastjson.serializer.SerializerFeature;

import java.lang.annotation.Annotation;
import java.lang.reflect.AccessibleObject;
import java.lang.reflect.Array;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.GenericArrayType;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Proxy;
import java.lang.reflect.Type;
import java.lang.reflect.TypeVariable;
import java.lang.reflect.WildcardType;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.security.AccessControlException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;
import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

/**
 * @author wenshao[szujobs@hotmail.com]
 */
<span class="fc" id="L64">public class TypeUtils{</span>
<span class="fc" id="L65">    private static final Pattern NUMBER_WITH_TRAILING_ZEROS_PATTERN = Pattern.compile(&quot;\\.0*$&quot;);</span>

<span class="fc" id="L67">    public static boolean compatibleWithJavaBean = false;</span>
    /** 根据field name的大小写输出输入数据 */
<span class="fc" id="L69">    public static boolean compatibleWithFieldName = false;</span>
<span class="fc" id="L70">    private static boolean setAccessibleEnable = true;</span>
<span class="fc" id="L71">    private static boolean oracleTimestampMethodInited = false;</span>
    private static Method oracleTimestampMethod;
<span class="fc" id="L73">    private static boolean oracleDateMethodInited = false;</span>
    private static Method oracleDateMethod;
<span class="fc" id="L75">    private static boolean optionalClassInited = false;</span>
    private static Class&lt;?&gt; optionalClass;
<span class="fc" id="L77">    private static boolean transientClassInited = false;</span>
    private static Class&lt;? extends Annotation&gt; transientClass;

<span class="fc" id="L80">    private static Class&lt;? extends Annotation&gt; class_OneToMany = null;</span>
<span class="fc" id="L81">    private static boolean class_OneToMany_error = false;</span>
<span class="fc" id="L82">    private static Class&lt;? extends Annotation&gt; class_ManyToMany = null;</span>
<span class="fc" id="L83">    private static boolean class_ManyToMany_error = false;</span>

<span class="fc" id="L85">    private static Method method_HibernateIsInitialized = null;</span>
<span class="fc" id="L86">    private static boolean method_HibernateIsInitialized_error = false;</span>
    private static volatile Class kotlin_metadata;
    private static volatile boolean kotlin_metadata_error;
    private static volatile boolean kotlin_class_klass_error;
    private static volatile Constructor kotlin_kclass_constructor;
    private static volatile Method kotlin_kclass_getConstructors;
    private static volatile Method kotlin_kfunction_getParameters;
    private static volatile Method kotlin_kparameter_getName;
    private static volatile boolean kotlin_error;
    private static volatile Map&lt;Class,String[]&gt; kotlinIgnores;
    private static volatile boolean kotlinIgnores_error;
<span class="fc" id="L97">    private static ConcurrentMap&lt;String,Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String,Class&lt;?&gt;&gt;(256, 0.75f, 1);</span>
    private static Class&lt;?&gt; pathClass;
<span class="fc" id="L99">    private static boolean pathClass_error = false;</span>

<span class="fc" id="L101">    private static Class&lt;? extends Annotation&gt; class_JacksonCreator = null;</span>
<span class="fc" id="L102">    private static boolean class_JacksonCreator_error = false;</span>

<span class="fc" id="L104">    private static volatile Class class_Clob = null;</span>
<span class="fc" id="L105">    private static volatile boolean class_Clob_error = false;</span>

<span class="fc" id="L107">    private static volatile Class class_XmlAccessType = null;</span>
<span class="fc" id="L108">    private static volatile Class class_XmlAccessorType = null;</span>
<span class="fc" id="L109">    private static volatile boolean classXmlAccessorType_error = false;</span>
<span class="fc" id="L110">    private static volatile Method method_XmlAccessorType_value = null;</span>
<span class="fc" id="L111">    private static volatile Field field_XmlAccessType_FIELD = null;</span>
<span class="fc" id="L112">    private static volatile Object field_XmlAccessType_FIELD_VALUE = null;</span>

    static{
        try{
<span class="fc" id="L116">            TypeUtils.compatibleWithJavaBean = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHJAVABEAN));</span>
<span class="fc" id="L117">            TypeUtils.compatibleWithFieldName = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHFIELDNAME));</span>
<span class="pc" id="L118">        } catch(Throwable e){</span>
            // skip
        }
    }

    static{
<span class="fc" id="L124">        addBaseClassMappings();</span>
<span class="fc" id="L125">    }</span>


    public static boolean isXmlField(Class clazz) {
<span class="pc bpc" id="L129" title="1 of 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L131">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="pc" id="L132">            } catch(Throwable ex){</span>
<span class="nc" id="L133">                classXmlAccessorType_error = true;</span>
            }
        }

<span class="pc bpc" id="L137" title="1 of 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L138">            return false;</span>
        }

<span class="fc" id="L141">        Annotation annotation = TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
<span class="fc bfc" id="L142" title="All 2 branches covered.">        if (annotation == null) {</span>
<span class="fc" id="L143">            return false;</span>
        }

<span class="pc bpc" id="L146" title="1 of 4 branches missed.">        if (method_XmlAccessorType_value == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L148">                method_XmlAccessorType_value = class_XmlAccessorType.getMethod(&quot;value&quot;);</span>
<span class="pc" id="L149">            } catch(Throwable ex){</span>
<span class="nc" id="L150">                classXmlAccessorType_error = true;</span>
            }
        }

<span class="pc bpc" id="L154" title="1 of 2 branches missed.">        if (method_XmlAccessorType_value == null) {</span>
<span class="nc" id="L155">            return false;</span>
        }

<span class="fc" id="L158">        Object value = null;</span>
<span class="pc bpc" id="L159" title="1 of 2 branches missed.">        if (!classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L161">                value = method_XmlAccessorType_value.invoke(annotation);</span>
<span class="pc" id="L162">            } catch (Throwable ex) {</span>
<span class="nc" id="L163">                classXmlAccessorType_error = true;</span>
            }
        }
<span class="pc bpc" id="L166" title="1 of 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L167">            return false;</span>
        }

<span class="pc bpc" id="L170" title="1 of 4 branches missed.">        if (class_XmlAccessType == null &amp;&amp; !classXmlAccessorType_error) {</span>
            try {
<span class="fc" id="L172">                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);</span>
<span class="fc" id="L173">                field_XmlAccessType_FIELD = class_XmlAccessType.getField(&quot;FIELD&quot;);</span>
<span class="fc" id="L174">                field_XmlAccessType_FIELD_VALUE = field_XmlAccessType_FIELD.get(null);</span>
<span class="pc" id="L175">            } catch(Throwable ex){</span>
<span class="nc" id="L176">                classXmlAccessorType_error = true;</span>
            }
        }

<span class="pc bpc" id="L180" title="1 of 2 branches missed.">        return value == field_XmlAccessType_FIELD_VALUE;</span>
    }

    public static Annotation getXmlAccessorType(Class clazz) {
<span class="nc bnc" id="L184" title="All 4 branches missed.">        if (class_XmlAccessorType == null &amp;&amp; !classXmlAccessorType_error) {</span>

            try{
<span class="nc" id="L187">                class_XmlAccessorType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessorType&quot;);</span>
<span class="nc" id="L188">            } catch(Throwable ex){</span>
<span class="nc" id="L189">                classXmlAccessorType_error = true;</span>
            }
        }

<span class="nc bnc" id="L193" title="All 2 branches missed.">        if (class_XmlAccessorType == null) {</span>
<span class="nc" id="L194">            return null;</span>
        }

<span class="nc" id="L197">        return  TypeUtils.getAnnotation(clazz, class_XmlAccessorType);</span>
    }

//
//    public static boolean isXmlAccessType(Class clazz) {
//        if (class_XmlAccessType == null &amp;&amp; !class_XmlAccessType_error) {
//
//            try{
//                class_XmlAccessType = Class.forName(&quot;javax.xml.bind.annotation.XmlAccessType&quot;);
//            } catch(Throwable ex){
//                class_XmlAccessType_error = true;
//            }
//        }
//
//        if (class_XmlAccessType == null) {
//            return false;
//        }
//
//        return  class_XmlAccessType.isAssignableFrom(clazz);
//    }

    public static boolean isClob(Class clazz) {
<span class="pc bpc" id="L219" title="1 of 4 branches missed.">        if (class_Clob == null &amp;&amp; !class_Clob_error) {</span>

            try{
<span class="fc" id="L222">                class_Clob = Class.forName(&quot;java.sql.Clob&quot;);</span>
<span class="pc" id="L223">            } catch(Throwable ex){</span>
<span class="nc" id="L224">                class_Clob_error = true;</span>
            }
        }

<span class="pc bpc" id="L228" title="1 of 2 branches missed.">        if (class_Clob == null) {</span>
<span class="nc" id="L229">            return false;</span>
        }

<span class="fc" id="L232">        return  class_Clob.isAssignableFrom(clazz);</span>
    }

    public static String castToString(Object value){
<span class="fc bfc" id="L236" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L237">            return null;</span>
        }
<span class="fc" id="L239">        return value.toString();</span>
    }

    public static Byte castToByte(Object value){
<span class="fc bfc" id="L243" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L244">            return null;</span>
        }

<span class="pc bpc" id="L247" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L248">            return byteValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L251" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L252">            return ((Number) value).byteValue();</span>
        }

<span class="fc bfc" id="L255" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L256">            String strVal = (String) value;</span>
<span class="fc bfc" id="L257" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L258" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L259" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L260">                return null;</span>
            }
<span class="fc" id="L262">            return Byte.parseByte(strVal);</span>
        }
<span class="fc" id="L264">        throw new JSONException(&quot;can not cast to byte, value : &quot; + value);</span>
    }

    public static Character castToChar(Object value){
<span class="fc bfc" id="L268" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L269">            return null;</span>
        }
<span class="fc bfc" id="L271" title="All 2 branches covered.">        if(value instanceof Character){</span>
<span class="fc" id="L272">            return (Character) value;</span>
        }
<span class="fc bfc" id="L274" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L275">            String strVal = (String) value;</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L277">                return null;</span>
            }
<span class="fc bfc" id="L279" title="All 2 branches covered.">            if(strVal.length() != 1){</span>
<span class="fc" id="L280">                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
            }
<span class="fc" id="L282">            return strVal.charAt(0);</span>
        }
<span class="fc" id="L284">        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
    }

    public static Short castToShort(Object value){
<span class="fc bfc" id="L288" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L289">            return null;</span>
        }

<span class="pc bpc" id="L292" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L293">            return shortValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L296" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L297">            return ((Number) value).shortValue();</span>
        }

<span class="fc bfc" id="L300" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L301">            String strVal = (String) value;</span>
<span class="fc bfc" id="L302" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L304" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L305">                return null;</span>
            }
<span class="fc" id="L307">            return Short.parseShort(strVal);</span>
        }

<span class="fc" id="L310">        throw new JSONException(&quot;can not cast to short, value : &quot; + value);</span>
    }

    public static BigDecimal castToBigDecimal(Object value){
<span class="fc bfc" id="L314" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L315">            return null;</span>
        }
<span class="fc bfc" id="L317" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L318">            return (BigDecimal) value;</span>
        }
<span class="fc bfc" id="L320" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L321">            return new BigDecimal((BigInteger) value);</span>
        }
<span class="fc" id="L323">        String strVal = value.toString();</span>
<span class="fc bfc" id="L324" title="All 2 branches covered.">        if(strVal.length() == 0){</span>
<span class="fc" id="L325">            return null;</span>
        }
<span class="fc bfc" id="L327" title="All 4 branches covered.">        if(value instanceof Map &amp;&amp; ((Map) value).size() == 0){</span>
<span class="fc" id="L328">            return null;</span>
        }
<span class="fc" id="L330">        return new BigDecimal(strVal);</span>
    }

    public static BigInteger castToBigInteger(Object value){
<span class="fc bfc" id="L334" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L335">            return null;</span>
        }
<span class="fc bfc" id="L337" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L338">            return (BigInteger) value;</span>
        }
<span class="fc bfc" id="L340" title="All 4 branches covered.">        if(value instanceof Float || value instanceof Double){</span>
<span class="fc" id="L341">            return BigInteger.valueOf(((Number) value).longValue());</span>
        }
<span class="fc bfc" id="L343" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L344">            BigDecimal decimal = (BigDecimal) value;</span>
<span class="fc" id="L345">            int scale = decimal.scale();</span>
<span class="pc bpc" id="L346" title="1 of 4 branches missed.">            if (scale &gt; -1000 &amp;&amp; scale &lt; 1000) {</span>
<span class="fc" id="L347">                return ((BigDecimal) value).toBigInteger();</span>
            }
        }
<span class="fc" id="L350">        String strVal = value.toString();</span>
<span class="fc bfc" id="L351" title="All 2 branches covered.">        if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L352" title="1 of 2 branches missed.">                || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L353" title="1 of 2 branches missed.">                || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L354">            return null;</span>
        }
<span class="fc" id="L356">        return new BigInteger(strVal);</span>
    }

    public static Float castToFloat(Object value){
<span class="fc bfc" id="L360" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L361">            return null;</span>
        }
<span class="fc bfc" id="L363" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L364">            return ((Number) value).floatValue();</span>
        }
<span class="fc bfc" id="L366" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L367">            String strVal = value.toString();</span>
<span class="fc bfc" id="L368" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L369" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L371">                return null;</span>
            }
<span class="fc bfc" id="L373" title="All 2 branches covered.">            if(strVal.indexOf(',') != -1){</span>
<span class="fc" id="L374">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L376">            return Float.parseFloat(strVal);</span>
        }
<span class="fc" id="L378">        throw new JSONException(&quot;can not cast to float, value : &quot; + value);</span>
    }

    public static Double castToDouble(Object value){
<span class="fc bfc" id="L382" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L383">            return null;</span>
        }
<span class="fc bfc" id="L385" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L386">            return ((Number) value).doubleValue();</span>
        }
<span class="fc bfc" id="L388" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L389">            String strVal = value.toString();</span>
<span class="fc bfc" id="L390" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L391" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L392" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L393">                return null;</span>
            }
<span class="fc bfc" id="L395" title="All 2 branches covered.">            if(strVal.indexOf(',') != -1){</span>
<span class="fc" id="L396">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L398">            return Double.parseDouble(strVal);</span>
        }
<span class="fc" id="L400">        throw new JSONException(&quot;can not cast to double, value : &quot; + value);</span>
    }

    public static Date castToDate(Object value){
<span class="fc" id="L404">        return castToDate(value, null);</span>
    }

    public static Date castToDate(Object value, String format){
<span class="fc bfc" id="L408" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L409">            return null;</span>
        }

<span class="fc bfc" id="L412" title="All 2 branches covered.">        if(value instanceof Date){ // 使用频率最高的，应优先处理</span>
<span class="fc" id="L413">            return (Date) value;</span>
        }

<span class="fc bfc" id="L416" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L417">            return ((Calendar) value).getTime();</span>
        }

<span class="fc" id="L420">        long longValue = -1;</span>

<span class="fc bfc" id="L422" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L423">            longValue = longValue((BigDecimal) value);</span>
<span class="nc" id="L424">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L427" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L428">            longValue = ((Number) value).longValue();</span>
<span class="pc bpc" id="L429" title="1 of 2 branches missed.">            if (&quot;unixtime&quot;.equals(format)) {</span>
<span class="nc" id="L430">                longValue *= 1000;</span>
            }
<span class="fc" id="L432">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L435" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L436">            String strVal = (String) value;</span>
<span class="fc" id="L437">            JSONScanner dateLexer = new JSONScanner(strVal);</span>
            try{
<span class="fc bfc" id="L439" title="All 2 branches covered.">                if(dateLexer.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L440">                    Calendar calendar = dateLexer.getCalendar();</span>
<span class="fc" id="L441">                    return calendar.getTime();</span>
                }
            } finally{
<span class="fc" id="L444">                dateLexer.close();</span>
            }

<span class="pc bpc" id="L447" title="1 of 4 branches missed.">            if (strVal.startsWith(&quot;/Date(&quot;) &amp;&amp; strVal.endsWith(&quot;)/&quot;)) {</span>
<span class="fc" id="L448">                strVal = strVal.substring(6, strVal.length() - 2);</span>
            }

<span class="pc bpc" id="L451" title="1 of 4 branches missed.">            if (strVal.indexOf('-') &gt; 0 || strVal.indexOf('+') &gt; 0) {</span>
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">                if (format == null) {</span>
<span class="fc bfc" id="L453" title="All 2 branches covered.">                    if (strVal.length() == JSON.DEFFAULT_DATE_FORMAT.length()</span>
<span class="pc bpc" id="L454" title="1 of 4 branches missed.">                            || (strVal.length() == 22 &amp;&amp; JSON.DEFFAULT_DATE_FORMAT.equals(&quot;yyyyMMddHHmmssSSSZ&quot;))) {</span>
<span class="fc" id="L455">                        format = JSON.DEFFAULT_DATE_FORMAT;</span>
<span class="fc bfc" id="L456" title="All 2 branches covered.">                    } else if (strVal.length() == 10) {</span>
<span class="fc" id="L457">                        format = &quot;yyyy-MM-dd&quot;;</span>
<span class="pc bpc" id="L458" title="1 of 2 branches missed.">                    } else if (strVal.length() == &quot;yyyy-MM-dd HH:mm:ss&quot;.length()) {</span>
<span class="nc" id="L459">                        format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
<span class="pc bpc" id="L460" title="1 of 2 branches missed.">                    } else if (strVal.length() == 29</span>
<span class="nc bnc" id="L461" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(26) == ':'</span>
<span class="nc bnc" id="L462" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(28) == '0') {</span>
<span class="nc" id="L463">                        format = &quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;;</span>
<span class="pc bpc" id="L464" title="2 of 4 branches missed.">                    } else if (strVal.length() == 23 &amp;&amp; strVal.charAt(19) == ',') {</span>
<span class="fc" id="L465">                        format = &quot;yyyy-MM-dd HH:mm:ss,SSS&quot;;</span>
<span class="fc" id="L466">                    } else {</span>
<span class="nc" id="L467">                        format = &quot;yyyy-MM-dd HH:mm:ss.SSS&quot;;</span>
                    }
                }

<span class="fc" id="L471">                SimpleDateFormat dateFormat = new SimpleDateFormat(format, JSON.defaultLocale);</span>
<span class="fc" id="L472">                dateFormat.setTimeZone(JSON.defaultTimeZone);</span>
                try{
<span class="fc" id="L474">                    return dateFormat.parse(strVal);</span>
<span class="fc" id="L475">                } catch(ParseException e){</span>
<span class="fc" id="L476">                    throw new JSONException(&quot;can not cast to Date, value : &quot; + strVal);</span>
                }
            }
<span class="fc bfc" id="L479" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L480">                return null;</span>
            }
<span class="fc" id="L482">            longValue = Long.parseLong(strVal);</span>
        }

<span class="fc bfc" id="L485" title="All 2 branches covered.">        if (longValue == -1) {</span>
<span class="fc" id="L486">            Class&lt;?&gt; clazz = value.getClass();</span>
<span class="fc bfc" id="L487" title="All 2 branches covered.">            if(&quot;oracle.sql.TIMESTAMP&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L488" title="2 of 4 branches missed.">                if(oracleTimestampMethod == null &amp;&amp; !oracleTimestampMethodInited){</span>
                    try{
<span class="fc" id="L490">                        oracleTimestampMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="pc" id="L491">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L494">                        oracleTimestampMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L499">                    result = oracleTimestampMethod.invoke(value);</span>
<span class="pc" id="L500">                } catch(Exception e){</span>
<span class="nc" id="L501">                    throw new JSONException(&quot;can not cast oracle.sql.TIMESTAMP to Date&quot;, e);</span>
                }
<span class="fc" id="L503">                return (Date) result;</span>
            }
<span class="fc bfc" id="L505" title="All 2 branches covered.">            if(&quot;oracle.sql.DATE&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L506" title="2 of 4 branches missed.">                if(oracleDateMethod == null &amp;&amp; !oracleDateMethodInited){</span>
                    try{
<span class="fc" id="L508">                        oracleDateMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="pc" id="L509">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L512">                        oracleDateMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L517">                    result = oracleDateMethod.invoke(value);</span>
<span class="pc" id="L518">                } catch(Exception e){</span>
<span class="nc" id="L519">                    throw new JSONException(&quot;can not cast oracle.sql.DATE to Date&quot;, e);</span>
                }
<span class="fc" id="L521">                return (Date) result;</span>
            }

<span class="fc" id="L524">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value);</span>
        }

<span class="fc" id="L527">        return new Date(longValue);</span>
    }

    public static java.sql.Date castToSqlDate(Object value){
<span class="fc bfc" id="L531" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L532">            return null;</span>
        }
<span class="fc bfc" id="L534" title="All 2 branches covered.">        if(value instanceof java.sql.Date){</span>
<span class="fc" id="L535">            return (java.sql.Date) value;</span>
        }
<span class="fc bfc" id="L537" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L538">            return new java.sql.Date(((java.util.Date) value).getTime());</span>
        }
<span class="fc bfc" id="L540" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L541">            return new java.sql.Date(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L544">        long longValue = 0;</span>
<span class="fc bfc" id="L545" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L546">            longValue = longValue((BigDecimal) value);</span>
<span class="pc bfc" id="L547" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L548">            longValue = ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L551" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L552">            String strVal = (String) value;</span>
<span class="fc bfc" id="L553" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L554" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L555" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L556">                return null;</span>
            }
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="fc" id="L559">                longValue = Long.parseLong(strVal);</span>
<span class="fc" id="L560">            } else{</span>
<span class="nc" id="L561">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L562" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L563">                    longValue = scanner.getCalendar().getTime().getTime();</span>
<span class="nc" id="L564">                } else{</span>
<span class="nc" id="L565">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L569" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L570">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L572">        return new java.sql.Date(longValue);</span>
    }

    public static long longExtractValue(Number number) {
<span class="fc bfc" id="L576" title="All 2 branches covered.">        if (number instanceof BigDecimal) {</span>
<span class="fc" id="L577">            return ((BigDecimal) number).longValueExact();</span>
        }

<span class="fc" id="L580">        return number.longValue();</span>
    }

    public static java.sql.Time castToSqlTime(Object value){
<span class="pc bpc" id="L584" title="1 of 2 branches missed.">        if(value == null){</span>
<span class="nc" id="L585">            return null;</span>
        }
<span class="pc bpc" id="L587" title="1 of 2 branches missed.">        if(value instanceof java.sql.Time){</span>
<span class="nc" id="L588">            return (java.sql.Time) value;</span>
        }
<span class="pc bpc" id="L590" title="1 of 2 branches missed.">        if(value instanceof java.util.Date){</span>
<span class="nc" id="L591">            return new java.sql.Time(((java.util.Date) value).getTime());</span>
        }
<span class="pc bpc" id="L593" title="1 of 2 branches missed.">        if(value instanceof Calendar){</span>
<span class="nc" id="L594">            return new java.sql.Time(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L597">        long longValue = 0;</span>
<span class="fc bfc" id="L598" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L599">            longValue = longValue((BigDecimal) value);</span>
<span class="pc bpc" id="L600" title="1 of 2 branches missed.">        } else if(value instanceof Number){</span>
<span class="fc" id="L601">            longValue = ((Number) value).longValue();</span>
        }

<span class="pc bpc" id="L604" title="1 of 2 branches missed.">        if(value instanceof String){</span>
<span class="nc" id="L605">            String strVal = (String) value;</span>
<span class="nc bnc" id="L606" title="All 2 branches missed.">            if(strVal.length() == 0 //</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">                    || &quot;null&quot;.equalsIgnoreCase(strVal)){</span>
<span class="nc" id="L608">                return null;</span>
            }
<span class="nc bnc" id="L610" title="All 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="nc" id="L611">                longValue = Long.parseLong(strVal);</span>
<span class="nc" id="L612">            } else{</span>
<span class="nc" id="L613">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L614" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L615">                    longValue = scanner.getCalendar().getTime().getTime();</span>
<span class="nc" id="L616">                } else{</span>
<span class="nc" id="L617">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="pc bpc" id="L621" title="1 of 2 branches missed.">        if(longValue &lt;= 0){</span>
<span class="nc" id="L622">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L624">        return new java.sql.Time(longValue);</span>
    }

    public static java.sql.Timestamp castToTimestamp(Object value){
<span class="fc bfc" id="L628" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L629">            return null;</span>
        }
<span class="fc bfc" id="L631" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L632">            return new java.sql.Timestamp(((Calendar) value).getTimeInMillis());</span>
        }
<span class="fc bfc" id="L634" title="All 2 branches covered.">        if(value instanceof java.sql.Timestamp){</span>
<span class="fc" id="L635">            return (java.sql.Timestamp) value;</span>
        }
<span class="fc bfc" id="L637" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L638">            return new java.sql.Timestamp(((java.util.Date) value).getTime());</span>
        }
<span class="fc" id="L640">        long longValue = 0;</span>
<span class="fc bfc" id="L641" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L642">            longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L643" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L644">            longValue = ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L646" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L647">            String strVal = (String) value;</span>
<span class="fc bfc" id="L648" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L649" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L650" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L651">                return null;</span>
            }
<span class="pc bpc" id="L653" title="1 of 2 branches missed.">            if(strVal.endsWith(&quot;.000000000&quot;)){</span>
<span class="nc" id="L654">                strVal = strVal.substring(0, strVal.length() - 10);</span>
<span class="pc bpc" id="L655" title="1 of 2 branches missed.">            } else if(strVal.endsWith(&quot;.000000&quot;)){</span>
<span class="nc" id="L656">                strVal = strVal.substring(0, strVal.length() - 7);</span>
            }

<span class="fc bfc" id="L659" title="All 2 branches covered.">            if (strVal.length() == 29</span>
<span class="pc bpc" id="L660" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(4) == '-'</span>
<span class="pc bpc" id="L661" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(7) == '-'</span>
<span class="pc bpc" id="L662" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(10) == ' '</span>
<span class="pc bpc" id="L663" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(13) == ':'</span>
<span class="pc bpc" id="L664" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(16) == ':'</span>
<span class="pc bpc" id="L665" title="1 of 2 branches missed.">                    &amp;&amp; strVal.charAt(19) == '.') {</span>
<span class="fc" id="L666">                int year = num(</span>
<span class="fc" id="L667">                        strVal.charAt(0),</span>
<span class="fc" id="L668">                        strVal.charAt(1),</span>
<span class="fc" id="L669">                        strVal.charAt(2),</span>
<span class="fc" id="L670">                        strVal.charAt(3));</span>
<span class="fc" id="L671">                int month = num(</span>
<span class="fc" id="L672">                        strVal.charAt(5),</span>
<span class="fc" id="L673">                        strVal.charAt(6));</span>
<span class="fc" id="L674">                int day = num(</span>
<span class="fc" id="L675">                        strVal.charAt(8),</span>
<span class="fc" id="L676">                        strVal.charAt(9));</span>
<span class="fc" id="L677">                int hour = num(</span>
<span class="fc" id="L678">                        strVal.charAt(11),</span>
<span class="fc" id="L679">                        strVal.charAt(12));</span>
<span class="fc" id="L680">                int minute = num(</span>
<span class="fc" id="L681">                        strVal.charAt(14),</span>
<span class="fc" id="L682">                        strVal.charAt(15));</span>
<span class="fc" id="L683">                int second = num(</span>
<span class="fc" id="L684">                        strVal.charAt(17),</span>
<span class="fc" id="L685">                        strVal.charAt(18));</span>
<span class="fc" id="L686">                int nanos = num(</span>
<span class="fc" id="L687">                        strVal.charAt(20),</span>
<span class="fc" id="L688">                        strVal.charAt(21),</span>
<span class="fc" id="L689">                        strVal.charAt(22),</span>
<span class="fc" id="L690">                        strVal.charAt(23),</span>
<span class="fc" id="L691">                        strVal.charAt(24),</span>
<span class="fc" id="L692">                        strVal.charAt(25),</span>
<span class="fc" id="L693">                        strVal.charAt(26),</span>
<span class="fc" id="L694">                        strVal.charAt(27),</span>
<span class="fc" id="L695">                        strVal.charAt(28));</span>
<span class="fc" id="L696">                return new java.sql.Timestamp(year - 1900, month - 1, day, hour, minute, second, nanos);</span>
            }

<span class="pc bpc" id="L699" title="1 of 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="fc" id="L700">                longValue = Long.parseLong(strVal);</span>
<span class="fc" id="L701">            } else {</span>
<span class="nc" id="L702">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L703" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L704">                    longValue = scanner.getCalendar().getTime().getTime();</span>
<span class="nc" id="L705">                } else{</span>
<span class="nc" id="L706">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L710" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L711">            throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + value);</span>
        }
<span class="fc" id="L713">        return new java.sql.Timestamp(longValue);</span>
    }

    static int num(char c0, char c1) {
<span class="pc bpc" id="L717" title="1 of 2 branches missed.">        if (c0 &gt;= '0'</span>
<span class="pc bpc" id="L718" title="1 of 2 branches missed.">                &amp;&amp; c0 &lt;= '9'</span>
<span class="pc bpc" id="L719" title="1 of 2 branches missed.">                &amp;&amp; c1 &gt;= '0'</span>
<span class="pc bpc" id="L720" title="1 of 2 branches missed.">                &amp;&amp; c1 &lt;= '9'</span>
        ) {
<span class="fc" id="L722">            return (c0 - '0') * 10</span>
<span class="fc" id="L723">                    + (c1 - '0');</span>
        }

<span class="nc" id="L726">        return -1;</span>
    }

    static int num(char c0, char c1, char c2, char c3) {
<span class="pc bpc" id="L730" title="1 of 2 branches missed.">        if (c0 &gt;= '0'</span>
<span class="pc bpc" id="L731" title="1 of 2 branches missed.">                &amp;&amp; c0 &lt;= '9'</span>
<span class="pc bpc" id="L732" title="1 of 2 branches missed.">                &amp;&amp; c1 &gt;= '0'</span>
<span class="pc bpc" id="L733" title="1 of 2 branches missed.">                &amp;&amp; c1 &lt;= '9'</span>
<span class="pc bpc" id="L734" title="1 of 2 branches missed.">                &amp;&amp; c2 &gt;= '0'</span>
<span class="pc bpc" id="L735" title="1 of 2 branches missed.">                &amp;&amp; c2 &lt;= '9'</span>
<span class="pc bpc" id="L736" title="1 of 2 branches missed.">                &amp;&amp; c3 &gt;= '0'</span>
<span class="pc bpc" id="L737" title="1 of 2 branches missed.">                &amp;&amp; c3 &lt;= '9'</span>
        ) {
<span class="fc" id="L739">            return (c0 - '0') * 1000</span>
<span class="fc" id="L740">                    + (c1 - '0') * 100</span>
<span class="fc" id="L741">                    + (c2 - '0') * 10</span>
<span class="fc" id="L742">                    + (c3 - '0');</span>
        }

<span class="nc" id="L745">        return -1;</span>
    }

    static int num(char c0, char c1, char c2, char c3, char c4, char c5, char c6, char c7, char c8) {
<span class="pc bpc" id="L749" title="1 of 2 branches missed.">        if (c0 &gt;= '0'</span>
<span class="pc bpc" id="L750" title="1 of 2 branches missed.">                &amp;&amp; c0 &lt;= '9'</span>
<span class="pc bpc" id="L751" title="1 of 2 branches missed.">                &amp;&amp; c1 &gt;= '0'</span>
<span class="pc bpc" id="L752" title="1 of 2 branches missed.">                &amp;&amp; c1 &lt;= '9'</span>
<span class="pc bpc" id="L753" title="1 of 2 branches missed.">                &amp;&amp; c2 &gt;= '0'</span>
<span class="pc bpc" id="L754" title="1 of 2 branches missed.">                &amp;&amp; c2 &lt;= '9'</span>
<span class="pc bpc" id="L755" title="1 of 2 branches missed.">                &amp;&amp; c3 &gt;= '0'</span>
<span class="pc bpc" id="L756" title="1 of 2 branches missed.">                &amp;&amp; c3 &lt;= '9'</span>
<span class="pc bpc" id="L757" title="1 of 2 branches missed.">                &amp;&amp; c4 &gt;= '0'</span>
<span class="pc bpc" id="L758" title="1 of 2 branches missed.">                &amp;&amp; c4 &lt;= '9'</span>
<span class="pc bpc" id="L759" title="1 of 2 branches missed.">                &amp;&amp; c5 &gt;= '0'</span>
<span class="pc bpc" id="L760" title="1 of 2 branches missed.">                &amp;&amp; c5 &lt;= '9'</span>
<span class="pc bpc" id="L761" title="1 of 2 branches missed.">                &amp;&amp; c6 &gt;= '0'</span>
<span class="pc bpc" id="L762" title="1 of 2 branches missed.">                &amp;&amp; c6 &lt;= '9'</span>
<span class="pc bpc" id="L763" title="1 of 2 branches missed.">                &amp;&amp; c7 &gt;= '0'</span>
<span class="pc bpc" id="L764" title="1 of 2 branches missed.">                &amp;&amp; c7 &lt;= '9'</span>
<span class="pc bpc" id="L765" title="1 of 2 branches missed.">                &amp;&amp; c8 &gt;= '0'</span>
<span class="pc bpc" id="L766" title="1 of 2 branches missed.">                &amp;&amp; c8 &lt;= '9'</span>
        ) {
<span class="fc" id="L768">            return (c0 - '0') * 100000000</span>
<span class="fc" id="L769">                    + (c1 - '0') * 10000000</span>
<span class="fc" id="L770">                    + (c2 - '0') * 1000000</span>
<span class="fc" id="L771">                    + (c3 - '0') * 100000</span>
<span class="fc" id="L772">                    + (c4 - '0') * 10000</span>
<span class="fc" id="L773">                    + (c5 - '0') * 1000</span>
<span class="fc" id="L774">                    + (c6 - '0') * 100</span>
<span class="fc" id="L775">                    + (c7 - '0') * 10</span>
<span class="fc" id="L776">                    + (c8 - '0');</span>
        }

<span class="nc" id="L779">        return -1;</span>
    }

    public static boolean isNumber(String str){
<span class="fc bfc" id="L783" title="All 2 branches covered.">        for(int i = 0; i &lt; str.length(); ++i){</span>
<span class="fc" id="L784">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L785" title="1 of 4 branches missed.">            if(ch == '+' || ch == '-'){</span>
<span class="pc bpc" id="L786" title="1 of 2 branches missed.">                if(i != 0){</span>
<span class="nc" id="L787">                    return false;</span>
                } 
<span class="fc bfc" id="L789" title="All 4 branches covered.">            } else if(ch &lt; '0' || ch &gt; '9'){</span>
<span class="fc" id="L790">                return false;</span>
            }
        }
<span class="fc" id="L793">        return true;</span>
    }

    public static Long castToLong(Object value){
<span class="fc bfc" id="L797" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L798">            return null;</span>
        }

<span class="pc bpc" id="L801" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L802">            return longValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L805" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L806">            return ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L809" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L810">            String strVal = (String) value;</span>
<span class="fc bfc" id="L811" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L812" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L813" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L814">                return null;</span>
            }
<span class="fc bfc" id="L816" title="All 2 branches covered.">            if(strVal.indexOf(',') != -1){</span>
<span class="fc" id="L817">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            try{
<span class="fc" id="L820">                return Long.parseLong(strVal);</span>
<span class="fc" id="L821">            } catch(NumberFormatException ex){</span>
                //
            }
<span class="fc" id="L824">            JSONScanner dateParser = new JSONScanner(strVal);</span>
<span class="fc" id="L825">            Calendar calendar = null;</span>
<span class="fc bfc" id="L826" title="All 2 branches covered.">            if(dateParser.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L827">                calendar = dateParser.getCalendar();</span>
            }
<span class="fc" id="L829">            dateParser.close();</span>
<span class="fc bfc" id="L830" title="All 2 branches covered.">            if(calendar != null){</span>
<span class="fc" id="L831">                return calendar.getTimeInMillis();</span>
            }
        }

<span class="fc bfc" id="L835" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L836">            Map map = (Map) value;</span>
<span class="fc bfc" id="L837" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L838" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L839" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L840">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L841">                iter.next();</span>
<span class="fc" id="L842">                Object value2 = iter.next();</span>
<span class="fc" id="L843">                return castToLong(value2);</span>
            }
        }
        
<span class="fc" id="L847">        throw new JSONException(&quot;can not cast to long, value : &quot; + value);</span>
    }

    public static byte byteValue(BigDecimal decimal) {
<span class="pc bpc" id="L851" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L852">            return 0;</span>
        }

<span class="fc" id="L855">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L856" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L857">            return decimal.byteValue();</span>
        }

<span class="nc" id="L860">        return decimal.byteValueExact();</span>
    }

    public static short shortValue(BigDecimal decimal) {
<span class="pc bpc" id="L864" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L865">            return 0;</span>
        }

<span class="fc" id="L868">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L869" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L870">            return decimal.shortValue();</span>
        }

<span class="nc" id="L873">        return decimal.shortValueExact();</span>
    }

    public static int intValue(BigDecimal decimal) {
<span class="pc bpc" id="L877" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L878">            return 0;</span>
        }

<span class="fc" id="L881">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L882" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L883">            return decimal.intValue();</span>
        }

<span class="nc" id="L886">        return decimal.intValueExact();</span>
    }

    public static long longValue(BigDecimal decimal) {
<span class="pc bpc" id="L890" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L891">            return 0;</span>
        }

<span class="fc" id="L894">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L895" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L896">            return decimal.longValue();</span>
        }

<span class="nc" id="L899">        return decimal.longValueExact();</span>
    }

    public static Integer castToInt(Object value){
<span class="fc bfc" id="L903" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L904">            return null;</span>
        }

<span class="fc bfc" id="L907" title="All 2 branches covered.">        if(value instanceof Integer){</span>
<span class="fc" id="L908">            return (Integer) value;</span>
        }

<span class="fc bfc" id="L911" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L912">            return intValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L915" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L916">            return ((Number) value).intValue();</span>
        }

<span class="fc bfc" id="L919" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L920">            String strVal = (String) value;</span>
<span class="fc bfc" id="L921" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L922" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L923" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L924">                return null;</span>
            }
<span class="fc bfc" id="L926" title="All 2 branches covered.">            if(strVal.indexOf(',') != -1){</span>
<span class="fc" id="L927">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            
<span class="fc" id="L930">            Matcher matcher = NUMBER_WITH_TRAILING_ZEROS_PATTERN.matcher(strVal);</span>
<span class="fc bfc" id="L931" title="All 2 branches covered.">            if(matcher.find()) {</span>
<span class="fc" id="L932">                strVal = matcher.replaceAll(&quot;&quot;);</span>
            }
<span class="fc" id="L934">            return Integer.parseInt(strVal);</span>
        }

<span class="fc bfc" id="L937" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="pc bpc" id="L938" title="1 of 2 branches missed.">            return (Boolean) value ? 1 : 0;</span>
        }
<span class="fc bfc" id="L940" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L941">            Map map = (Map) value;</span>
<span class="fc bfc" id="L942" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L943" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L944" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L945">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L946">                iter.next();</span>
<span class="fc" id="L947">                Object value2 = iter.next();</span>
<span class="fc" id="L948">                return castToInt(value2);</span>
            }
        }
<span class="fc" id="L951">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static byte[] castToBytes(Object value){
<span class="fc bfc" id="L955" title="All 2 branches covered.">        if(value instanceof byte[]){</span>
<span class="fc" id="L956">            return (byte[]) value;</span>
        }
<span class="fc bfc" id="L958" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L959">            return IOUtils.decodeBase64((String) value);</span>
        }
<span class="fc" id="L961">        throw new JSONException(&quot;can not cast to byte[], value : &quot; + value);</span>
    }

    public static Boolean castToBoolean(Object value){
<span class="fc bfc" id="L965" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L966">            return null;</span>
        }
<span class="fc bfc" id="L968" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="fc" id="L969">            return (Boolean) value;</span>
        }

<span class="fc bfc" id="L972" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc bnc" id="L973" title="All 2 branches missed.">            return intValue((BigDecimal) value) == 1;</span>
        }

<span class="fc bfc" id="L976" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc bfc" id="L977" title="All 2 branches covered.">            return ((Number) value).intValue() == 1;</span>
        }

<span class="fc bfc" id="L980" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L981">            String strVal = (String) value;</span>
<span class="fc bfc" id="L982" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L983" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L984" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L985">                return null;</span>
            }
<span class="fc bfc" id="L987" title="All 2 branches covered.">            if(&quot;true&quot;.equalsIgnoreCase(strVal) //</span>
<span class="pc bpc" id="L988" title="1 of 2 branches missed.">                    || &quot;1&quot;.equals(strVal)){</span>
<span class="fc" id="L989">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L991" title="All 2 branches covered.">            if(&quot;false&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L992" title="All 2 branches covered.">                    || &quot;0&quot;.equals(strVal)){</span>
<span class="fc" id="L993">                return Boolean.FALSE;</span>
            }
<span class="fc bfc" id="L995" title="All 2 branches covered.">            if(&quot;Y&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L996" title="All 2 branches covered.">                    || &quot;T&quot;.equals(strVal)){</span>
<span class="fc" id="L997">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L999" title="All 2 branches covered.">            if(&quot;F&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L1000" title="All 2 branches covered.">                    || &quot;N&quot;.equals(strVal)){</span>
<span class="fc" id="L1001">                return Boolean.FALSE;</span>
            }
        }
<span class="fc" id="L1004">        throw new JSONException(&quot;can not cast to boolean, value : &quot; + value);</span>
    }

    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz){
<span class="fc" id="L1008">        return cast(obj, clazz, ParserConfig.getGlobalInstance());</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T cast(Object obj, Class&lt;T&gt; clazz, ParserConfig config){
<span class="fc bfc" id="L1013" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc bfc" id="L1014" title="All 2 branches covered.">            if(clazz == int.class){</span>
<span class="fc" id="L1015">                return (T) Integer.valueOf(0);</span>
<span class="fc bfc" id="L1016" title="All 2 branches covered.">            } else if(clazz == long.class){</span>
<span class="fc" id="L1017">                return (T) Long.valueOf(0);</span>
<span class="fc bfc" id="L1018" title="All 2 branches covered.">            } else if(clazz == short.class){</span>
<span class="fc" id="L1019">                return (T) Short.valueOf((short) 0);</span>
<span class="fc bfc" id="L1020" title="All 2 branches covered.">            } else if(clazz == byte.class){</span>
<span class="fc" id="L1021">                return (T) Byte.valueOf((byte) 0);</span>
<span class="fc bfc" id="L1022" title="All 2 branches covered.">            } else if(clazz == float.class){</span>
<span class="fc" id="L1023">                return (T) Float.valueOf(0);</span>
<span class="fc bfc" id="L1024" title="All 2 branches covered.">            } else if(clazz == double.class){</span>
<span class="fc" id="L1025">                return (T) Double.valueOf(0);</span>
<span class="fc bfc" id="L1026" title="All 2 branches covered.">            } else if(clazz == boolean.class){</span>
<span class="fc" id="L1027">                return (T) Boolean.FALSE;</span>
            }
<span class="fc" id="L1029">            return null;</span>
        }

<span class="fc bfc" id="L1032" title="All 2 branches covered.">        if(clazz == null){</span>
<span class="fc" id="L1033">            throw new IllegalArgumentException(&quot;clazz is null&quot;);</span>
        }

<span class="fc bfc" id="L1036" title="All 2 branches covered.">        if(clazz == obj.getClass()){</span>
<span class="fc" id="L1037">            return (T) obj;</span>
        }

<span class="fc bfc" id="L1040" title="All 2 branches covered.">        if(obj instanceof Map){</span>
<span class="fc bfc" id="L1041" title="All 2 branches covered.">            if(clazz == Map.class){</span>
<span class="fc" id="L1042">                return (T) obj;</span>
            }

<span class="fc" id="L1045">            Map map = (Map) obj;</span>
<span class="fc bfc" id="L1046" title="All 4 branches covered.">            if(clazz == Object.class &amp;&amp; !map.containsKey(JSON.DEFAULT_TYPE_KEY)){</span>
<span class="fc" id="L1047">                return (T) obj;</span>
            }
<span class="fc" id="L1049">            return castToJavaBean((Map&lt;String,Object&gt;) obj, clazz, config);</span>
        }

<span class="fc bfc" id="L1052" title="All 2 branches covered.">        if(clazz.isArray()){</span>
<span class="fc bfc" id="L1053" title="All 2 branches covered.">            if(obj instanceof Collection){</span>
<span class="fc" id="L1054">                Collection collection = (Collection) obj;</span>
<span class="fc" id="L1055">                int index = 0;</span>
<span class="fc" id="L1056">                Object array = Array.newInstance(clazz.getComponentType(), collection.size());</span>
<span class="fc bfc" id="L1057" title="All 2 branches covered.">                for(Object item : collection){</span>
<span class="fc" id="L1058">                    Object value = cast(item, clazz.getComponentType(), config);</span>
<span class="fc" id="L1059">                    Array.set(array, index, value);</span>
<span class="fc" id="L1060">                    index++;</span>
                }
<span class="fc" id="L1062">                return (T) array;</span>
            }
<span class="fc bfc" id="L1064" title="All 2 branches covered.">            if(clazz == byte[].class){</span>
<span class="fc" id="L1065">                return (T) castToBytes(obj);</span>
            }
        }

<span class="fc bfc" id="L1069" title="All 2 branches covered.">        if(clazz.isAssignableFrom(obj.getClass())){</span>
<span class="fc" id="L1070">            return (T) obj;</span>
        }

<span class="fc bfc" id="L1073" title="All 4 branches covered.">        if(clazz == boolean.class || clazz == Boolean.class){</span>
<span class="fc" id="L1074">            return (T) castToBoolean(obj);</span>
        }

<span class="fc bfc" id="L1077" title="All 4 branches covered.">        if(clazz == byte.class || clazz == Byte.class){</span>
<span class="fc" id="L1078">            return (T) castToByte(obj);</span>
        }

<span class="pc bpc" id="L1081" title="1 of 4 branches missed.">        if(clazz == char.class || clazz == Character.class){</span>
<span class="fc" id="L1082">            return (T) castToChar(obj);</span>
        }

<span class="fc bfc" id="L1085" title="All 4 branches covered.">        if(clazz == short.class || clazz == Short.class){</span>
<span class="fc" id="L1086">            return (T) castToShort(obj);</span>
        }

<span class="fc bfc" id="L1089" title="All 4 branches covered.">        if(clazz == int.class || clazz == Integer.class){</span>
<span class="fc" id="L1090">            return (T) castToInt(obj);</span>
        }

<span class="fc bfc" id="L1093" title="All 4 branches covered.">        if(clazz == long.class || clazz == Long.class){</span>
<span class="fc" id="L1094">            return (T) castToLong(obj);</span>
        }

<span class="fc bfc" id="L1097" title="All 4 branches covered.">        if(clazz == float.class || clazz == Float.class){</span>
<span class="fc" id="L1098">            return (T) castToFloat(obj);</span>
        }

<span class="fc bfc" id="L1101" title="All 4 branches covered.">        if(clazz == double.class || clazz == Double.class){</span>
<span class="fc" id="L1102">            return (T) castToDouble(obj);</span>
        }

<span class="fc bfc" id="L1105" title="All 2 branches covered.">        if(clazz == String.class){</span>
<span class="fc" id="L1106">            return (T) castToString(obj);</span>
        }

<span class="fc bfc" id="L1109" title="All 2 branches covered.">        if(clazz == BigDecimal.class){</span>
<span class="fc" id="L1110">            return (T) castToBigDecimal(obj);</span>
        }

<span class="fc bfc" id="L1113" title="All 2 branches covered.">        if(clazz == BigInteger.class){</span>
<span class="fc" id="L1114">            return (T) castToBigInteger(obj);</span>
        }

<span class="fc bfc" id="L1117" title="All 2 branches covered.">        if(clazz == Date.class){</span>
<span class="fc" id="L1118">            return (T) castToDate(obj);</span>
        }

<span class="fc bfc" id="L1121" title="All 2 branches covered.">        if(clazz == java.sql.Date.class){</span>
<span class="fc" id="L1122">            return (T) castToSqlDate(obj);</span>
        }

<span class="fc bfc" id="L1125" title="All 2 branches covered.">        if(clazz == java.sql.Time.class){</span>
<span class="fc" id="L1126">            return (T) castToSqlTime(obj);</span>
        }

<span class="fc bfc" id="L1129" title="All 2 branches covered.">        if(clazz == java.sql.Timestamp.class){</span>
<span class="fc" id="L1130">            return (T) castToTimestamp(obj);</span>
        }

<span class="fc bfc" id="L1133" title="All 2 branches covered.">        if(clazz.isEnum()){</span>
<span class="fc" id="L1134">            return castToEnum(obj, clazz, config);</span>
        }

<span class="fc bfc" id="L1137" title="All 2 branches covered.">        if(Calendar.class.isAssignableFrom(clazz)){</span>
<span class="fc" id="L1138">            Date date = castToDate(obj);</span>
            Calendar calendar;
<span class="fc bfc" id="L1140" title="All 2 branches covered.">            if(clazz == Calendar.class){</span>
<span class="fc" id="L1141">                calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L1142">            } else{</span>
                try{
<span class="fc" id="L1144">                    calendar = (Calendar) clazz.newInstance();</span>
<span class="fc" id="L1145">                } catch(Exception e){</span>
<span class="fc" id="L1146">                    throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), e);</span>
                }
            }
<span class="fc" id="L1149">            calendar.setTime(date);</span>
<span class="fc" id="L1150">            return (T) calendar;</span>
        }

<span class="fc" id="L1153">        String className = clazz.getName();</span>
<span class="fc bfc" id="L1154" title="All 2 branches covered.">        if(className.equals(&quot;javax.xml.datatype.XMLGregorianCalendar&quot;)){</span>
<span class="fc" id="L1155">            Date date = castToDate(obj);</span>
<span class="fc" id="L1156">            Calendar calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L1157">            calendar.setTime(date);</span>
<span class="fc" id="L1158">            return (T) CalendarCodec.instance.createXMLGregorianCalendar(calendar);</span>
        }

<span class="fc bfc" id="L1161" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L1162">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1163" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L1164" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1165" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L1166">                return null;</span>
            }

<span class="pc bpc" id="L1169" title="1 of 2 branches missed.">            if(clazz == java.util.Currency.class){</span>
<span class="nc" id="L1170">                return (T) java.util.Currency.getInstance(strVal);</span>
            }

<span class="pc bpc" id="L1173" title="1 of 2 branches missed.">            if(clazz == java.util.Locale.class){</span>
<span class="nc" id="L1174">                return (T) toLocale(strVal);</span>
            }

<span class="pc bpc" id="L1177" title="1 of 2 branches missed.">            if (className.startsWith(&quot;java.time.&quot;)) {</span>
<span class="nc" id="L1178">                String json = JSON.toJSONString(strVal);</span>
<span class="nc" id="L1179">                return JSON.parseObject(json, clazz);</span>
            }
        }

<span class="fc" id="L1183">        final ObjectDeserializer objectDeserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1184" title="All 2 branches covered.">        if (objectDeserializer != null) {</span>
<span class="fc" id="L1185">            String str = JSON.toJSONString(obj);</span>
<span class="nc" id="L1186">            return JSON.parseObject(str, clazz);</span>
        }
<span class="fc" id="L1188">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    public static Locale toLocale(String strVal){
<span class="fc" id="L1192">        String[] items = strVal.split(&quot;_&quot;);</span>
<span class="fc bfc" id="L1193" title="All 2 branches covered.">        if(items.length == 1){</span>
<span class="fc" id="L1194">            return new Locale(items[0]);</span>
        }
<span class="fc bfc" id="L1196" title="All 2 branches covered.">        if(items.length == 2){</span>
<span class="fc" id="L1197">            return new Locale(items[0], items[1]);</span>
        }
<span class="fc" id="L1199">        return new Locale(items[0], items[1], items[2]);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T castToEnum(Object obj, Class&lt;T&gt; clazz, ParserConfig mapping){
        try{
<span class="fc bfc" id="L1205" title="All 2 branches covered.">            if(obj instanceof String){</span>
<span class="fc" id="L1206">                String name = (String) obj;</span>
<span class="fc bfc" id="L1207" title="All 2 branches covered.">                if(name.length() == 0){</span>
<span class="fc" id="L1208">                    return null;</span>
                }

<span class="pc bpc" id="L1211" title="1 of 2 branches missed.">                if (mapping == null) {</span>
<span class="fc" id="L1212">                    mapping = ParserConfig.getGlobalInstance();</span>
                }

<span class="fc" id="L1215">                ObjectDeserializer deserializer = mapping.getDeserializer(clazz);</span>
<span class="pc bpc" id="L1216" title="1 of 2 branches missed.">                if (deserializer instanceof EnumDeserializer) {</span>
<span class="fc" id="L1217">                    EnumDeserializer enumDeserializer = (EnumDeserializer) deserializer;</span>
<span class="fc" id="L1218">                    return (T) enumDeserializer.getEnumByHashCode(TypeUtils.fnv1a_64(name));</span>
                }

<span class="nc" id="L1221">                return (T) Enum.valueOf((Class&lt;? extends Enum&gt;) clazz, name);</span>
            }

<span class="fc bfc" id="L1224" title="All 2 branches covered.">            if(obj instanceof BigDecimal){</span>
<span class="nc" id="L1225">                int ordinal = intValue((BigDecimal) obj);</span>
<span class="nc" id="L1226">                Object[] values = clazz.getEnumConstants();</span>
<span class="nc bnc" id="L1227" title="All 2 branches missed.">                if(ordinal &lt; values.length){</span>
<span class="nc" id="L1228">                    return (T) values[ordinal];</span>
                }
            }

<span class="fc bfc" id="L1232" title="All 2 branches covered.">            if(obj instanceof Number){</span>
<span class="fc" id="L1233">                int ordinal = ((Number) obj).intValue();</span>
<span class="fc" id="L1234">                Object[] values = clazz.getEnumConstants();</span>
<span class="fc bfc" id="L1235" title="All 2 branches covered.">                if(ordinal &lt; values.length){</span>
<span class="fc" id="L1236">                    return (T) values[ordinal];</span>
                }
            }
<span class="fc" id="L1239">        } catch(Exception ex){</span>
<span class="fc" id="L1240">            throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), ex);</span>
        }
<span class="fc" id="L1242">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping){
<span class="fc bfc" id="L1247" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc" id="L1248">            return null;</span>
        }
<span class="fc bfc" id="L1250" title="All 2 branches covered.">        if(type instanceof Class){</span>
<span class="fc" id="L1251">            return cast(obj, (Class&lt;T&gt;) type, mapping);</span>
        }
<span class="fc bfc" id="L1253" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1254">            return (T) cast(obj, (ParameterizedType) type, mapping);</span>
        }
<span class="pc bpc" id="L1256" title="1 of 2 branches missed.">        if(obj instanceof String){</span>
<span class="fc" id="L1257">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1258" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L1259" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1260" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L1261">                return null;</span>
            }
        }
<span class="pc bpc" id="L1264" title="1 of 2 branches missed.">        if(type instanceof TypeVariable){</span>
<span class="nc" id="L1265">            return (T) obj;</span>
        }
<span class="fc" id="L1267">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping){
<span class="fc" id="L1272">        Type rawTye = type.getRawType();</span>

<span class="fc bfc" id="L1274" title="All 4 branches covered.">        if(rawTye == List.class || rawTye == ArrayList.class){</span>
<span class="fc" id="L1275">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1276" title="All 2 branches covered.">            if(obj instanceof List){</span>
<span class="fc" id="L1277">                List listObj = (List) obj;</span>
<span class="fc" id="L1278">                List arrayList = new ArrayList(listObj.size());</span>

<span class="fc bfc" id="L1280" title="All 2 branches covered.">                for (int i = 0; i &lt; listObj.size(); i++) {</span>
<span class="fc" id="L1281">                    Object item = listObj.get(i);</span>

                    Object itemValue;
<span class="pc bpc" id="L1284" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1285" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1286">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
<span class="fc" id="L1287">                        } else {</span>
<span class="fc" id="L1288">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
<span class="fc" id="L1290">                    } else {</span>
<span class="nc" id="L1291">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1294">                    arrayList.add(itemValue);</span>
                }
<span class="fc" id="L1296">                return (T) arrayList;</span>
            }
        }

<span class="pc bpc" id="L1300" title="2 of 4 branches missed.">        if(rawTye == Set.class || rawTye == HashSet.class //</span>
<span class="pc bpc" id="L1301" title="1 of 2 branches missed.">                || rawTye == TreeSet.class //</span>
<span class="fc bfc" id="L1302" title="All 2 branches covered.">                || rawTye == Collection.class //</span>
<span class="fc bfc" id="L1303" title="All 2 branches covered.">                || rawTye == List.class //</span>
<span class="fc bfc" id="L1304" title="All 2 branches covered.">                || rawTye == ArrayList.class){</span>
<span class="fc" id="L1305">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1306" title="All 2 branches covered.">            if(obj instanceof Iterable){</span>
                Collection collection;
<span class="pc bpc" id="L1308" title="2 of 4 branches missed.">                if(rawTye == Set.class || rawTye == HashSet.class){</span>
<span class="nc" id="L1309">                    collection = new HashSet();</span>
<span class="pc bpc" id="L1310" title="1 of 2 branches missed.">                } else if(rawTye == TreeSet.class){</span>
<span class="nc" id="L1311">                    collection = new TreeSet();</span>
<span class="nc" id="L1312">                } else{</span>
<span class="fc" id="L1313">                    collection = new ArrayList();</span>
                }
<span class="fc bfc" id="L1315" title="All 2 branches covered.">                for(Iterator it = ((Iterable) obj).iterator(); it.hasNext(); ){</span>
<span class="fc" id="L1316">                    Object item = it.next();</span>

                    Object itemValue;
<span class="pc bpc" id="L1319" title="1 of 2 branches missed.">                    if (itemType instanceof Class) {</span>
<span class="pc bpc" id="L1320" title="1 of 4 branches missed.">                        if (item != null &amp;&amp; item.getClass() == JSONObject.class) {</span>
<span class="fc" id="L1321">                            itemValue = ((JSONObject) item).toJavaObject((Class&lt;T&gt;) itemType, mapping, 0);</span>
<span class="fc" id="L1322">                        } else {</span>
<span class="fc" id="L1323">                            itemValue = cast(item, (Class&lt;T&gt;) itemType, mapping);</span>
                        }
<span class="fc" id="L1325">                    } else {</span>
<span class="nc" id="L1326">                        itemValue = cast(item, itemType, mapping);</span>
                    }

<span class="fc" id="L1329">                    collection.add(itemValue);</span>
                }
<span class="fc" id="L1331">                return (T) collection;</span>
            }
        }

<span class="fc bfc" id="L1335" title="All 4 branches covered.">        if(rawTye == Map.class || rawTye == HashMap.class){</span>
<span class="fc" id="L1336">            Type keyType = type.getActualTypeArguments()[0];</span>
<span class="fc" id="L1337">            Type valueType = type.getActualTypeArguments()[1];</span>
<span class="fc bfc" id="L1338" title="All 2 branches covered.">            if(obj instanceof Map){</span>
<span class="fc" id="L1339">                Map map = new HashMap();</span>
<span class="fc bfc" id="L1340" title="All 2 branches covered.">                for(Map.Entry entry : ((Map&lt;?,?&gt;) obj).entrySet()){</span>
<span class="fc" id="L1341">                    Object key = cast(entry.getKey(), keyType, mapping);</span>
<span class="fc" id="L1342">                    Object value = cast(entry.getValue(), valueType, mapping);</span>
<span class="fc" id="L1343">                    map.put(key, value);</span>
                }
<span class="fc" id="L1345">                return (T) map;</span>
            }
        }
<span class="fc bfc" id="L1348" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L1349">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1350" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L1351">                return null;</span>
            }
        }
<span class="fc bfc" id="L1354" title="All 2 branches covered.">        if(type.getActualTypeArguments().length == 1){</span>
<span class="fc" id="L1355">            Type argType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1356" title="All 2 branches covered.">            if(argType instanceof WildcardType){</span>
<span class="nc" id="L1357">                return (T) cast(obj, rawTye, mapping);</span>
            }
        }

<span class="pc bpc" id="L1361" title="2 of 6 branches missed.">        if (rawTye == Map.Entry.class &amp;&amp; obj instanceof Map &amp;&amp; ((Map) obj).size() == 1) {</span>
<span class="fc" id="L1362">            Map.Entry entry = (Map.Entry) ((Map) obj).entrySet().iterator().next();</span>
<span class="fc" id="L1363">            return (T) entry;</span>
        }

<span class="pc bpc" id="L1366" title="1 of 2 branches missed.">        if (rawTye instanceof Class) {</span>
<span class="fc bfc" id="L1367" title="All 2 branches covered.">            if (mapping == null) {</span>
<span class="fc" id="L1368">                mapping = ParserConfig.global;</span>
            }
<span class="fc" id="L1370">            ObjectDeserializer deserializer = mapping.getDeserializer(rawTye);</span>
<span class="pc bpc" id="L1371" title="1 of 2 branches missed.">            if (deserializer != null) {</span>
<span class="fc" id="L1372">                String str = JSON.toJSONString(obj);</span>
<span class="fc" id="L1373">                DefaultJSONParser parser = new DefaultJSONParser(str, mapping);</span>
<span class="fc" id="L1374">                return (T) deserializer.deserialze(parser, type, null);</span>
            }
        }

<span class="nc" id="L1378">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;})
    public static &lt;T&gt; T castToJavaBean(Map&lt;String,Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config){
        try{
<span class="fc bfc" id="L1384" title="All 2 branches covered.">            if(clazz == StackTraceElement.class){</span>
<span class="fc" id="L1385">                String declaringClass = (String) map.get(&quot;className&quot;);</span>
<span class="fc" id="L1386">                String methodName = (String) map.get(&quot;methodName&quot;);</span>
<span class="fc" id="L1387">                String fileName = (String) map.get(&quot;fileName&quot;);</span>
                int lineNumber;
                {
<span class="fc" id="L1390">                    Number value = (Number) map.get(&quot;lineNumber&quot;);</span>
<span class="fc bfc" id="L1391" title="All 2 branches covered.">                    if(value == null) {</span>
<span class="fc" id="L1392">                        lineNumber = 0;</span>
<span class="fc bfc" id="L1393" title="All 2 branches covered.">                    } else if (value instanceof BigDecimal) {</span>
<span class="nc" id="L1394">                        lineNumber = ((BigDecimal) value).intValueExact();</span>
<span class="nc" id="L1395">                    } else{</span>
<span class="fc" id="L1396">                        lineNumber = value.intValue();</span>
                    }
                }
<span class="fc" id="L1399">                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</span>
            }

            {
<span class="fc" id="L1403">                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</span>
<span class="fc bfc" id="L1404" title="All 2 branches covered.">                if(iClassObject instanceof String){</span>
<span class="fc" id="L1405">                    String className = (String) iClassObject;</span>
                    Class&lt;?&gt; loadClazz;
<span class="fc bfc" id="L1407" title="All 2 branches covered.">                    if(config == null){</span>
<span class="fc" id="L1408">                        config = ParserConfig.global;</span>
                    }
<span class="fc" id="L1410">                    loadClazz = config.checkAutoType(className, null);</span>
<span class="pc bpc" id="L1411" title="1 of 2 branches missed.">                    if(loadClazz == null){</span>
<span class="nc" id="L1412">                        throw new ClassNotFoundException(className + &quot; not found&quot;);</span>
                    }
<span class="fc bfc" id="L1414" title="All 2 branches covered.">                    if(!loadClazz.equals(clazz)){</span>
<span class="fc" id="L1415">                        return (T) castToJavaBean(map, loadClazz, config);</span>
                    }
                }
            }

<span class="fc bfc" id="L1420" title="All 2 branches covered.">            if(clazz.isInterface()){</span>
                JSONObject object;
<span class="fc bfc" id="L1422" title="All 2 branches covered.">                if(map instanceof JSONObject){</span>
<span class="fc" id="L1423">                    object = (JSONObject) map;</span>
<span class="fc" id="L1424">                } else{</span>
<span class="fc" id="L1425">                    object = new JSONObject(map);</span>
                }
<span class="fc bfc" id="L1427" title="All 2 branches covered.">                if(config == null){</span>
<span class="fc" id="L1428">                    config = ParserConfig.getGlobalInstance();</span>
                }
<span class="fc" id="L1430">                ObjectDeserializer deserializer = config.get(clazz);</span>
<span class="fc bfc" id="L1431" title="All 2 branches covered.">                if(deserializer != null){</span>
<span class="fc" id="L1432">                    String json = JSON.toJSONString(object);</span>
<span class="fc" id="L1433">                    return JSON.parseObject(json, clazz);</span>
                }
<span class="fc" id="L1435">                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span>
<span class="fc" id="L1436">                        new Class&lt;?&gt;[]{clazz}, object);</span>
            }

<span class="fc bfc" id="L1439" title="All 2 branches covered.">            if(clazz == Locale.class){</span>
<span class="fc" id="L1440">                Object arg0 = map.get(&quot;language&quot;);</span>
<span class="fc" id="L1441">                Object arg1 = map.get(&quot;country&quot;);</span>
<span class="pc bpc" id="L1442" title="1 of 2 branches missed.">                if(arg0 instanceof String){</span>
<span class="fc" id="L1443">                    String language = (String) arg0;</span>
<span class="pc bpc" id="L1444" title="1 of 2 branches missed.">                    if(arg1 instanceof String){</span>
<span class="fc" id="L1445">                        String country = (String) arg1;</span>
<span class="fc" id="L1446">                        return (T) new Locale(language, country);</span>
<span class="nc bnc" id="L1447" title="All 2 branches missed.">                    } else if(arg1 == null){</span>
<span class="nc" id="L1448">                        return (T) new Locale(language);</span>
                    }
                }
            }

<span class="pc bpc" id="L1453" title="3 of 4 branches missed.">            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="nc" id="L1454">                return (T) map.toString();</span>
            }

<span class="pc bpc" id="L1457" title="1 of 4 branches missed.">            if (clazz == JSON.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1458">                return (T) map;</span>
            }

<span class="pc bpc" id="L1461" title="1 of 4 branches missed.">            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1462">                JSONObject jsonObject = (JSONObject) map;</span>
<span class="fc" id="L1463">                Map innerMap = jsonObject.getInnerMap();</span>
<span class="pc bpc" id="L1464" title="1 of 2 branches missed.">                if (innerMap instanceof LinkedHashMap) {</span>
<span class="fc" id="L1465">                    return (T) innerMap;</span>
                } else {
<span class="nc" id="L1467">                    LinkedHashMap linkedHashMap = new LinkedHashMap();</span>
<span class="nc" id="L1468">                    linkedHashMap.putAll(innerMap);</span>
                }
            }

<span class="fc bfc" id="L1472" title="All 2 branches covered.">            if (clazz.isInstance(map)) {</span>
<span class="fc" id="L1473">                return (T) map;</span>
            }

<span class="fc bfc" id="L1476" title="All 2 branches covered.">            if (clazz == JSONObject.class) {</span>
<span class="fc" id="L1477">                return (T) new JSONObject(map);</span>
            }

<span class="fc bfc" id="L1480" title="All 2 branches covered.">            if (config == null) {</span>
<span class="fc" id="L1481">                config = ParserConfig.getGlobalInstance();</span>
            }

<span class="fc" id="L1484">            JavaBeanDeserializer javaBeanDeser = null;</span>
<span class="fc" id="L1485">            ObjectDeserializer deserializer = config.getDeserializer(clazz);</span>
<span class="fc bfc" id="L1486" title="All 2 branches covered.">            if (deserializer instanceof JavaBeanDeserializer) {</span>
<span class="fc" id="L1487">                javaBeanDeser = (JavaBeanDeserializer) deserializer;</span>
            }

<span class="fc bfc" id="L1490" title="All 2 branches covered.">            if(javaBeanDeser == null){</span>
<span class="fc" id="L1491">                throw new JSONException(&quot;can not get javaBeanDeserializer. &quot; + clazz.getName());</span>
            }
<span class="fc" id="L1493">            return (T) javaBeanDeser.createInstance(map, config);</span>
<span class="fc" id="L1494">        } catch(Exception e){</span>
<span class="fc" id="L1495">            throw new JSONException(e.getMessage(), e);</span>
        }
    }

    private static void addBaseClassMappings(){
<span class="fc" id="L1500">        mappings.put(&quot;byte&quot;, byte.class);</span>
<span class="fc" id="L1501">        mappings.put(&quot;short&quot;, short.class);</span>
<span class="fc" id="L1502">        mappings.put(&quot;int&quot;, int.class);</span>
<span class="fc" id="L1503">        mappings.put(&quot;long&quot;, long.class);</span>
<span class="fc" id="L1504">        mappings.put(&quot;float&quot;, float.class);</span>
<span class="fc" id="L1505">        mappings.put(&quot;double&quot;, double.class);</span>
<span class="fc" id="L1506">        mappings.put(&quot;boolean&quot;, boolean.class);</span>
<span class="fc" id="L1507">        mappings.put(&quot;char&quot;, char.class);</span>
<span class="fc" id="L1508">        mappings.put(&quot;[byte&quot;, byte[].class);</span>
<span class="fc" id="L1509">        mappings.put(&quot;[short&quot;, short[].class);</span>
<span class="fc" id="L1510">        mappings.put(&quot;[int&quot;, int[].class);</span>
<span class="fc" id="L1511">        mappings.put(&quot;[long&quot;, long[].class);</span>
<span class="fc" id="L1512">        mappings.put(&quot;[float&quot;, float[].class);</span>
<span class="fc" id="L1513">        mappings.put(&quot;[double&quot;, double[].class);</span>
<span class="fc" id="L1514">        mappings.put(&quot;[boolean&quot;, boolean[].class);</span>
<span class="fc" id="L1515">        mappings.put(&quot;[char&quot;, char[].class);</span>
<span class="fc" id="L1516">        mappings.put(&quot;[B&quot;, byte[].class);</span>
<span class="fc" id="L1517">        mappings.put(&quot;[S&quot;, short[].class);</span>
<span class="fc" id="L1518">        mappings.put(&quot;[I&quot;, int[].class);</span>
<span class="fc" id="L1519">        mappings.put(&quot;[J&quot;, long[].class);</span>
<span class="fc" id="L1520">        mappings.put(&quot;[F&quot;, float[].class);</span>
<span class="fc" id="L1521">        mappings.put(&quot;[D&quot;, double[].class);</span>
<span class="fc" id="L1522">        mappings.put(&quot;[C&quot;, char[].class);</span>
<span class="fc" id="L1523">        mappings.put(&quot;[Z&quot;, boolean[].class);</span>
<span class="fc" id="L1524">        Class&lt;?&gt;[] classes = new Class[]{</span>
<span class="fc" id="L1525">                Object.class,</span>
<span class="fc" id="L1526">                java.lang.Cloneable.class,</span>
<span class="fc" id="L1527">                loadClass(&quot;java.lang.AutoCloseable&quot;),</span>
<span class="fc" id="L1528">                java.lang.Exception.class,</span>
<span class="fc" id="L1529">                java.lang.RuntimeException.class,</span>
<span class="fc" id="L1530">                java.lang.IllegalAccessError.class,</span>
<span class="fc" id="L1531">                java.lang.IllegalAccessException.class,</span>
<span class="fc" id="L1532">                java.lang.IllegalArgumentException.class,</span>
<span class="fc" id="L1533">                java.lang.IllegalMonitorStateException.class,</span>
<span class="fc" id="L1534">                java.lang.IllegalStateException.class,</span>
<span class="fc" id="L1535">                java.lang.IllegalThreadStateException.class,</span>
<span class="fc" id="L1536">                java.lang.IndexOutOfBoundsException.class,</span>
<span class="fc" id="L1537">                java.lang.InstantiationError.class,</span>
<span class="fc" id="L1538">                java.lang.InstantiationException.class,</span>
<span class="fc" id="L1539">                java.lang.InternalError.class,</span>
<span class="fc" id="L1540">                java.lang.InterruptedException.class,</span>
<span class="fc" id="L1541">                java.lang.LinkageError.class,</span>
<span class="fc" id="L1542">                java.lang.NegativeArraySizeException.class,</span>
<span class="fc" id="L1543">                java.lang.NoClassDefFoundError.class,</span>
<span class="fc" id="L1544">                java.lang.NoSuchFieldError.class,</span>
<span class="fc" id="L1545">                java.lang.NoSuchFieldException.class,</span>
<span class="fc" id="L1546">                java.lang.NoSuchMethodError.class,</span>
<span class="fc" id="L1547">                java.lang.NoSuchMethodException.class,</span>
<span class="fc" id="L1548">                java.lang.NullPointerException.class,</span>
<span class="fc" id="L1549">                java.lang.NumberFormatException.class,</span>
<span class="fc" id="L1550">                java.lang.OutOfMemoryError.class,</span>
<span class="fc" id="L1551">                java.lang.SecurityException.class,</span>
<span class="fc" id="L1552">                java.lang.StackOverflowError.class,</span>
<span class="fc" id="L1553">                java.lang.StringIndexOutOfBoundsException.class,</span>
<span class="fc" id="L1554">                java.lang.TypeNotPresentException.class,</span>
<span class="fc" id="L1555">                java.lang.VerifyError.class,</span>
<span class="fc" id="L1556">                java.lang.StackTraceElement.class,</span>
<span class="fc" id="L1557">                java.util.HashMap.class,</span>
<span class="fc" id="L1558">                java.util.Hashtable.class,</span>
<span class="fc" id="L1559">                java.util.TreeMap.class,</span>
<span class="fc" id="L1560">                java.util.IdentityHashMap.class,</span>
<span class="fc" id="L1561">                java.util.WeakHashMap.class,</span>
<span class="fc" id="L1562">                java.util.LinkedHashMap.class,</span>
<span class="fc" id="L1563">                java.util.HashSet.class,</span>
<span class="fc" id="L1564">                java.util.LinkedHashSet.class,</span>
<span class="fc" id="L1565">                java.util.TreeSet.class,</span>
<span class="fc" id="L1566">                java.util.ArrayList.class,</span>
<span class="fc" id="L1567">                java.util.concurrent.TimeUnit.class,</span>
<span class="fc" id="L1568">                java.util.concurrent.ConcurrentHashMap.class,</span>
<span class="fc" id="L1569">                java.util.concurrent.atomic.AtomicInteger.class,</span>
<span class="fc" id="L1570">                java.util.concurrent.atomic.AtomicLong.class,</span>
<span class="fc" id="L1571">                java.util.Collections.EMPTY_MAP.getClass(),</span>
<span class="fc" id="L1572">                java.lang.Boolean.class,</span>
<span class="fc" id="L1573">                java.lang.Character.class,</span>
<span class="fc" id="L1574">                java.lang.Byte.class,</span>
<span class="fc" id="L1575">                java.lang.Short.class,</span>
<span class="fc" id="L1576">                java.lang.Integer.class,</span>
<span class="fc" id="L1577">                java.lang.Long.class,</span>
<span class="fc" id="L1578">                java.lang.Float.class,</span>
<span class="fc" id="L1579">                java.lang.Double.class,</span>
<span class="fc" id="L1580">                java.lang.Number.class,</span>
<span class="fc" id="L1581">                java.lang.String.class,</span>
<span class="fc" id="L1582">                java.math.BigDecimal.class,</span>
<span class="fc" id="L1583">                java.math.BigInteger.class,</span>
<span class="fc" id="L1584">                java.util.BitSet.class,</span>
<span class="fc" id="L1585">                java.util.Calendar.class,</span>
<span class="fc" id="L1586">                java.util.Date.class,</span>
<span class="fc" id="L1587">                java.util.Locale.class,</span>
<span class="fc" id="L1588">                java.util.UUID.class,</span>
<span class="fc" id="L1589">                java.sql.Time.class,</span>
<span class="fc" id="L1590">                java.sql.Date.class,</span>
<span class="fc" id="L1591">                java.sql.Timestamp.class,</span>
<span class="fc" id="L1592">                java.text.SimpleDateFormat.class,</span>
<span class="fc" id="L1593">                com.alibaba.fastjson.JSONObject.class,</span>
<span class="fc" id="L1594">                com.alibaba.fastjson.JSONPObject.class,</span>
<span class="fc" id="L1595">                com.alibaba.fastjson.JSONArray.class,</span>
        };
<span class="fc bfc" id="L1597" title="All 2 branches covered.">        for(Class clazz : classes){</span>
<span class="pc bpc" id="L1598" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1599">                continue;</span>
            }
<span class="fc" id="L1601">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1603">    }</span>

    public static void clearClassMapping(){
<span class="fc" id="L1606">        mappings.clear();</span>
<span class="fc" id="L1607">        addBaseClassMappings();</span>
<span class="fc" id="L1608">    }</span>

    public static void addMapping(String className, Class&lt;?&gt; clazz) {
<span class="fc" id="L1611">        mappings.put(className, clazz);</span>
<span class="fc" id="L1612">    }</span>

    public static Class&lt;?&gt; loadClass(String className){
<span class="fc" id="L1615">        return loadClass(className, null);</span>
    }

    public static boolean isPath(Class&lt;?&gt; clazz){
<span class="pc bpc" id="L1619" title="1 of 4 branches missed.">        if(pathClass == null &amp;&amp; !pathClass_error){</span>
            try{
<span class="fc" id="L1621">                pathClass = Class.forName(&quot;java.nio.file.Path&quot;);</span>
<span class="pc" id="L1622">            } catch(Throwable ex){</span>
<span class="nc" id="L1623">                pathClass_error = true;</span>
            }
        }
<span class="pc bpc" id="L1626" title="1 of 2 branches missed.">        if(pathClass != null){</span>
<span class="fc" id="L1627">            return pathClass.isAssignableFrom(clazz);</span>
        }
<span class="nc" id="L1629">        return false;</span>
    }

    public static Class&lt;?&gt; getClassFromMapping(String className){
<span class="fc" id="L1633">        return mappings.get(className);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader) {
<span class="fc" id="L1637">        return loadClass(className, classLoader, false);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, boolean cache) {
<span class="pc bpc" id="L1641" title="1 of 6 branches missed.">        if(className == null || className.length() == 0 || className.length() &gt; 128){</span>
<span class="fc" id="L1642">            return null;</span>
        }

<span class="fc" id="L1645">        Class&lt;?&gt; clazz = mappings.get(className);</span>
<span class="fc bfc" id="L1646" title="All 2 branches covered.">        if(clazz != null){</span>
<span class="fc" id="L1647">            return clazz;</span>
        }

<span class="fc bfc" id="L1650" title="All 2 branches covered.">        if(className.charAt(0) == '['){</span>
<span class="fc" id="L1651">            Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);</span>
<span class="fc" id="L1652">            return Array.newInstance(componentType, 0).getClass();</span>
        }

<span class="pc bpc" id="L1655" title="1 of 4 branches missed.">        if(className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)){</span>
<span class="fc" id="L1656">            String newClassName = className.substring(1, className.length() - 1);</span>
<span class="fc" id="L1657">            return loadClass(newClassName, classLoader);</span>
        }

        try{
<span class="fc bfc" id="L1661" title="All 2 branches covered.">            if(classLoader != null){</span>
<span class="fc" id="L1662">                clazz = classLoader.loadClass(className);</span>
<span class="pc bpc" id="L1663" title="1 of 2 branches missed.">                if (cache) {</span>
<span class="nc" id="L1664">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1666">                return clazz;</span>
            }
<span class="fc" id="L1668">        } catch(Throwable e){</span>
<span class="fc" id="L1669">            e.printStackTrace();</span>
            // skip
        }
        try{
<span class="fc" id="L1673">            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="pc bpc" id="L1674" title="1 of 4 branches missed.">            if(contextClassLoader != null &amp;&amp; contextClassLoader != classLoader){</span>
<span class="fc" id="L1675">                clazz = contextClassLoader.loadClass(className);</span>
<span class="fc bfc" id="L1676" title="All 2 branches covered.">                if (cache) {</span>
<span class="fc" id="L1677">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1679">                return clazz;</span>
            }
<span class="fc" id="L1681">        } catch(Throwable e){</span>
            // skip
        }
        try{
<span class="fc" id="L1685">            clazz = Class.forName(className);</span>
<span class="pc bpc" id="L1686" title="1 of 2 branches missed.">            if (cache) {</span>
<span class="nc" id="L1687">                mappings.put(className, clazz);</span>
            }
<span class="fc" id="L1689">            return clazz;</span>
<span class="fc" id="L1690">        } catch(Throwable e){</span>
            // skip
        }
<span class="fc" id="L1693">        return clazz;</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1699">        return buildBeanInfo(beanType, aliasMap, propertyNamingStrategy, false);</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy //
            , boolean fieldBased //
    ){
<span class="fc" id="L1707">        JSONType jsonType = TypeUtils.getAnnotation(beanType,JSONType.class);</span>
<span class="fc" id="L1708">        String[] orders = null;</span>
        final int features;
<span class="fc" id="L1710">        String typeName = null, typeKey = null;</span>
<span class="fc bfc" id="L1711" title="All 2 branches covered.">        if(jsonType != null){</span>
<span class="fc" id="L1712">            orders = jsonType.orders();</span>

<span class="fc" id="L1714">            typeName = jsonType.typeName();</span>
<span class="fc bfc" id="L1715" title="All 2 branches covered.">            if(typeName.length() == 0){</span>
<span class="fc" id="L1716">                typeName = null;</span>
            }

<span class="fc" id="L1719">            PropertyNamingStrategy jsonTypeNaming = jsonType.naming();</span>
<span class="fc bfc" id="L1720" title="All 2 branches covered.">            if (jsonTypeNaming != PropertyNamingStrategy.CamelCase) {</span>
<span class="fc" id="L1721">                propertyNamingStrategy = jsonTypeNaming;</span>
            }

<span class="fc" id="L1724">            features = SerializerFeature.of(jsonType.serialzeFeatures());</span>
<span class="fc" id="L1725">            for(Class&lt;?&gt; supperClass = beanType.getSuperclass()</span>
<span class="pc bpc" id="L1726" title="1 of 4 branches missed.">                ; supperClass != null &amp;&amp; supperClass != Object.class</span>
<span class="fc" id="L1727">                    ; supperClass = supperClass.getSuperclass()){</span>
<span class="fc" id="L1728">                JSONType superJsonType = TypeUtils.getAnnotation(supperClass,JSONType.class);</span>
<span class="fc bfc" id="L1729" title="All 2 branches covered.">                if(superJsonType == null){</span>
<span class="fc" id="L1730">                    break;</span>
                }
<span class="fc" id="L1732">                typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1733" title="1 of 2 branches missed.">                if(typeKey.length() != 0){</span>
<span class="nc" id="L1734">                    break;</span>
                }
            }

<span class="fc bfc" id="L1738" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : beanType.getInterfaces()){</span>
<span class="fc" id="L1739">                JSONType superJsonType = TypeUtils.getAnnotation(interfaceClass,JSONType.class);</span>
<span class="fc bfc" id="L1740" title="All 2 branches covered.">                if(superJsonType != null){</span>
<span class="fc" id="L1741">                    typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1742" title="1 of 2 branches missed.">                    if(typeKey.length() != 0){</span>
<span class="fc" id="L1743">                        break;</span>
                    }
                }
            }

<span class="fc bfc" id="L1748" title="All 4 branches covered.">            if(typeKey != null &amp;&amp; typeKey.length() == 0){</span>
<span class="fc" id="L1749">                typeKey = null;</span>
            }
<span class="fc" id="L1751">        } else{</span>
<span class="fc" id="L1752">            features = 0;</span>
        }
        // fieldName,field ，先生成fieldName的快照，减少之后的findField的轮询
<span class="fc" id="L1755">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1756">        ParserConfig.parserAllFieldToCache(beanType, fieldCacheMap);</span>
<span class="fc bfc" id="L1757" title="All 2 branches covered.">        List&lt;FieldInfo&gt; fieldInfoList = fieldBased</span>
<span class="fc" id="L1758">                ? computeGettersWithFieldBase(beanType, aliasMap, false, propertyNamingStrategy) //</span>
<span class="fc" id="L1759">                : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</span>
<span class="fc" id="L1760">        FieldInfo[] fields = new FieldInfo[fieldInfoList.size()];</span>
<span class="fc" id="L1761">        fieldInfoList.toArray(fields);</span>
        FieldInfo[] sortedFields;
        List&lt;FieldInfo&gt; sortedFieldList;
<span class="fc bfc" id="L1764" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length != 0){</span>
<span class="pc bpc" id="L1765" title="1 of 2 branches missed.">            sortedFieldList = fieldBased</span>
<span class="nc" id="L1766">                    ? computeGettersWithFieldBase(beanType, aliasMap, true, propertyNamingStrategy) //</span>
<span class="fc" id="L1767">                    : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, true, propertyNamingStrategy);</span>
<span class="fc" id="L1768">        } else{</span>
<span class="fc" id="L1769">            sortedFieldList = new ArrayList&lt;FieldInfo&gt;(fieldInfoList);</span>
<span class="fc" id="L1770">            Collections.sort(sortedFieldList);</span>
        }
<span class="fc" id="L1772">        sortedFields = new FieldInfo[sortedFieldList.size()];</span>
<span class="fc" id="L1773">        sortedFieldList.toArray(sortedFields);</span>
<span class="fc bfc" id="L1774" title="All 2 branches covered.">        if(Arrays.equals(sortedFields, fields)){</span>
<span class="fc" id="L1775">            sortedFields = fields;</span>
        }
<span class="fc" id="L1777">        return new SerializeBeanInfo(beanType, jsonType, typeName, typeKey, features, fields, sortedFields);</span>
    }

    public static List&lt;FieldInfo&gt; computeGettersWithFieldBase(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            boolean sorted, //
            PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1785">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc bfc" id="L1786" title="All 2 branches covered.">        for(Class&lt;?&gt; currentClass = clazz; currentClass != null; currentClass = currentClass.getSuperclass()){</span>
<span class="fc" id="L1787">            Field[] fields = currentClass.getDeclaredFields();</span>
<span class="fc" id="L1788">            computeFields(currentClass, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
        }
<span class="fc" id="L1790">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap){
<span class="fc" id="L1794">        return computeGetters(clazz, aliasMap, true);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap, boolean sorted){
<span class="fc" id="L1798">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc" id="L1799">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1800">        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</span>
<span class="fc" id="L1801">        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
                                                 JSONType jsonType, //
                                                 Map&lt;String,String&gt; aliasMap, //
                                                 Map&lt;String,Field&gt; fieldCacheMap, //
                                                 boolean sorted, //
                                                 PropertyNamingStrategy propertyNamingStrategy //
    ){
<span class="fc" id="L1811">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc" id="L1812">        boolean kotlin = TypeUtils.isKotlin(clazz);</span>
        // for kotlin
<span class="fc" id="L1814">        Constructor[] constructors = null;</span>
<span class="fc" id="L1815">        Annotation[][] paramAnnotationArrays = null;</span>
<span class="fc" id="L1816">        String[] paramNames = null;</span>
<span class="fc" id="L1817">        short[] paramNameMapping = null;</span>
<span class="fc" id="L1818">        Method[] methods = clazz.getMethods();</span>
<span class="fc bfc" id="L1819" title="All 2 branches covered.">        for(Method method : methods){</span>
<span class="fc" id="L1820">            String methodName = method.getName();</span>
<span class="fc" id="L1821">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1822">            String label = null;</span>
<span class="fc bfc" id="L1823" title="All 2 branches covered.">            if(Modifier.isStatic(method.getModifiers())){</span>
<span class="fc" id="L1824">                continue;</span>
            }
<span class="fc bfc" id="L1826" title="All 2 branches covered.">            if(method.getReturnType().equals(Void.TYPE)){</span>
<span class="fc" id="L1827">                continue;</span>
            }
<span class="fc bfc" id="L1829" title="All 2 branches covered.">            if(method.getParameterTypes().length != 0){</span>
<span class="fc" id="L1830">                continue;</span>
            }
<span class="fc bfc" id="L1832" title="All 2 branches covered.">            if(method.getReturnType() == ClassLoader.class){</span>
<span class="fc" id="L1833">                continue;</span>
            }

<span class="fc bfc" id="L1836" title="All 2 branches covered.">            if(methodName.equals(&quot;getMetaClass&quot;)</span>
<span class="pc bpc" id="L1837" title="1 of 2 branches missed.">                    &amp;&amp; method.getReturnType().getName().equals(&quot;groovy.lang.MetaClass&quot;)){</span>
<span class="fc" id="L1838">                continue;</span>
            }
<span class="fc bfc" id="L1840" title="All 2 branches covered.">            if(methodName.equals(&quot;getSuppressed&quot;)</span>
<span class="pc bpc" id="L1841" title="1 of 2 branches missed.">                    &amp;&amp; method.getDeclaringClass() == Throwable.class){</span>
<span class="fc" id="L1842">                continue;</span>
            }

<span class="fc bfc" id="L1845" title="All 4 branches covered.">            if(kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)){</span>
<span class="fc" id="L1846">                continue;</span>
            }
            /**
             *  如果在属性或者方法上存在JSONField注解，并且定制了name属性，不以类上的propertyNamingStrategy设置为准，以此字段的JSONField的name定制为准。
             */
<span class="fc" id="L1851">            Boolean fieldAnnotationAndNameExists = false;</span>
<span class="fc" id="L1852">            JSONField annotation = TypeUtils.getAnnotation(method, JSONField.class);</span>
<span class="fc bfc" id="L1853" title="All 2 branches covered.">            if(annotation == null){</span>
<span class="fc" id="L1854">                annotation = getSuperMethodAnnotation(clazz, method);</span>
            }
<span class="fc bfc" id="L1856" title="All 4 branches covered.">            if(annotation == null &amp;&amp; kotlin){</span>
<span class="fc bfc" id="L1857" title="All 2 branches covered.">                if(constructors == null){</span>
<span class="fc" id="L1858">                    constructors = clazz.getDeclaredConstructors();</span>
<span class="fc" id="L1859">                    Constructor creatorConstructor = TypeUtils.getKoltinConstructor(constructors);</span>
<span class="pc bpc" id="L1860" title="1 of 2 branches missed.">                    if(creatorConstructor != null){</span>
<span class="fc" id="L1861">                        paramAnnotationArrays = TypeUtils.getParameterAnnotations(creatorConstructor);</span>
<span class="fc" id="L1862">                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</span>
<span class="pc bpc" id="L1863" title="1 of 2 branches missed.">                        if(paramNames != null){</span>
<span class="fc" id="L1864">                            String[] paramNames_sorted = new String[paramNames.length];</span>
<span class="fc" id="L1865">                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</span>

<span class="fc" id="L1867">                            Arrays.sort(paramNames_sorted);</span>
<span class="fc" id="L1868">                            paramNameMapping = new short[paramNames.length];</span>
<span class="fc bfc" id="L1869" title="All 2 branches covered.">                            for(short p = 0; p &lt; paramNames.length; p++){</span>
<span class="fc" id="L1870">                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</span>
<span class="fc" id="L1871">                                paramNameMapping[index] = p;</span>
                            }
<span class="fc" id="L1873">                            paramNames = paramNames_sorted;</span>
                        }
                    }
                }
<span class="pc bpc" id="L1877" title="2 of 6 branches missed.">                if(paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc" id="L1878">                    String propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1879">                    int p = Arrays.binarySearch(paramNames, propertyName);</span>
<span class="fc bfc" id="L1880" title="All 2 branches covered.">                    if (p &lt; 0) {</span>
<span class="fc bfc" id="L1881" title="All 2 branches covered.">                        for (int i = 0; i &lt; paramNames.length; i++) {</span>
<span class="fc bfc" id="L1882" title="All 2 branches covered.">                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</span>
<span class="fc" id="L1883">                                p = i;</span>
<span class="fc" id="L1884">                                break;</span>
                            }
                        }
                    }
<span class="fc bfc" id="L1888" title="All 2 branches covered.">                    if(p &gt;= 0){</span>
<span class="fc" id="L1889">                        short index = paramNameMapping[p];</span>
<span class="fc" id="L1890">                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</span>
<span class="pc bpc" id="L1891" title="1 of 2 branches missed.">                        if(paramAnnotations != null){</span>
<span class="pc bfc" id="L1892" title="All 2 branches covered.">                            for(Annotation paramAnnotation : paramAnnotations){</span>
<span class="pc bpc" id="L1893" title="1 of 2 branches missed.">                                if(paramAnnotation instanceof JSONField){</span>
<span class="fc" id="L1894">                                    annotation = (JSONField) paramAnnotation;</span>
<span class="fc" id="L1895">                                    break;</span>
                                }
                            }
                        }
<span class="fc bfc" id="L1899" title="All 2 branches covered.">                        if(annotation == null){</span>
<span class="fc" id="L1900">                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1901" title="All 2 branches covered.">                            if(field != null){</span>
<span class="fc" id="L1902">                                annotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
                            }
                        }
                    }
                }
            }
<span class="fc bfc" id="L1908" title="All 2 branches covered.">            if(annotation != null){</span>
<span class="fc bfc" id="L1909" title="All 2 branches covered.">                if(!annotation.serialize()){</span>
<span class="fc" id="L1910">                    continue;</span>
                }
<span class="fc" id="L1912">                ordinal = annotation.ordinal();</span>
<span class="fc" id="L1913">                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span>
<span class="fc" id="L1914">                parserFeatures = Feature.of(annotation.parseFeatures());</span>
<span class="fc bfc" id="L1915" title="All 2 branches covered.">                if(annotation.name().length() != 0){</span>
<span class="fc" id="L1916">                    String propertyName = annotation.name();</span>
<span class="fc bfc" id="L1917" title="All 2 branches covered.">                    if(aliasMap != null){</span>
<span class="fc" id="L1918">                        propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1919" title="1 of 2 branches missed.">                        if(propertyName == null){</span>
<span class="fc" id="L1920">                            continue;</span>
                        }
                    }
<span class="fc" id="L1923">                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</span>
<span class="fc" id="L1924">                            serialzeFeatures, parserFeatures, annotation, null, label);</span>
<span class="fc" id="L1925">                    fieldInfoMap.put(propertyName, fieldInfo);</span>
<span class="fc" id="L1926">                    continue;</span>
                }
<span class="fc bfc" id="L1928" title="All 2 branches covered.">                if(annotation.label().length() != 0){</span>
<span class="fc" id="L1929">                    label = annotation.label();</span>
                }
            }
<span class="fc bfc" id="L1932" title="All 2 branches covered.">            if(methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc bfc" id="L1933" title="All 2 branches covered.">                if(methodName.length() &lt; 4){</span>
<span class="fc" id="L1934">                    continue;</span>
                }
<span class="fc bfc" id="L1936" title="All 2 branches covered.">                if(methodName.equals(&quot;getClass&quot;)){</span>
<span class="fc" id="L1937">                    continue;</span>
                }
<span class="fc bfc" id="L1939" title="All 4 branches covered.">                if(methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()){</span>
<span class="fc" id="L1940">                    continue;</span>
                }
<span class="fc" id="L1942">                char c3 = methodName.charAt(3);</span>
                String propertyName;
<span class="fc" id="L1944">                Field field = null;</span>
<span class="fc bfc" id="L1945" title="All 2 branches covered.">                if(Character.isUpperCase(c3) //</span>
<span class="fc bfc" id="L1946" title="All 2 branches covered.">                        || c3 &gt; 512 // for unicode method name</span>
                        ){
<span class="fc bfc" id="L1948" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1949">                        propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1950">                    } else{</span>
<span class="fc" id="L1951">                        propertyName = Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</span>
                    }
<span class="fc" id="L1953">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</span>
<span class="fc bfc" id="L1954" title="All 2 branches covered.">                } else if(c3 == '_'){</span>
<span class="fc" id="L1955">                    propertyName = methodName.substring(4);</span>
<span class="fc" id="L1956">                    field = fieldCacheMap.get(propertyName);</span>
<span class="fc bfc" id="L1957" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L1958">                        String temp = propertyName;</span>
<span class="fc" id="L1959">                        propertyName = methodName.substring(3);</span>
<span class="fc" id="L1960">                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="pc bpc" id="L1961" title="1 of 2 branches missed.">                        if (field == null) {</span>
<span class="nc" id="L1962">                            propertyName = temp; //减少修改代码带来的影响</span>
                        }
                    }
<span class="pc bfc" id="L1965" title="All 2 branches covered.">                } else if(c3 == 'f'){</span>
<span class="fc" id="L1966">                    propertyName = methodName.substring(3);</span>
<span class="fc bfc" id="L1967" title="All 4 branches covered.">                } else if(methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))){</span>
<span class="fc" id="L1968">                    propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1969">                } else{</span>
<span class="fc" id="L1970">                    propertyName = methodName.substring(3);</span>
<span class="fc" id="L1971">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1972" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L1973">                        continue;</span>
                    }
                }
<span class="fc" id="L1976">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1977" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1978">                    continue;</span>
                }

<span class="fc bfc" id="L1981" title="All 2 branches covered.">                if (field == null) {</span>
                    // 假如bean的field很多的情况一下，轮询时将大大降低效率
<span class="fc" id="L1983">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
                }
                
<span class="fc bfc" id="L1986" title="All 4 branches covered.">                if(field == null &amp;&amp; propertyName.length() &gt; 1){</span>
<span class="fc" id="L1987">                    char ch = propertyName.charAt(1);</span>
<span class="fc bfc" id="L1988" title="All 4 branches covered.">                    if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L1989">                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1990">                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</span>
                    }
                }
<span class="fc" id="L1993">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1994" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1995">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L1996" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1997" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1998">                            continue;</span>
                        }
<span class="fc" id="L2000">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2001">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2002">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2003" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L2004">                            fieldAnnotationAndNameExists = true;</span>
<span class="fc" id="L2005">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L2006" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L2007">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2008" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L2009">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L2013" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L2014">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L2018" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L2019">                    propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L2020" title="All 2 branches covered.">                    if(propertyName == null){</span>
<span class="fc" id="L2021">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L2024" title="All 4 branches covered.">                if(propertyNamingStrategy != null &amp;&amp; !fieldAnnotationAndNameExists){</span>
<span class="fc" id="L2025">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
<span class="fc" id="L2027">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
<span class="fc" id="L2028">                        annotation, fieldAnnotation, label);</span>
<span class="fc" id="L2029">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
<span class="fc bfc" id="L2031" title="All 2 branches covered.">            if(methodName.startsWith(&quot;is&quot;)){</span>
<span class="fc bfc" id="L2032" title="All 2 branches covered.">                if(methodName.length() &lt; 3){</span>
<span class="fc" id="L2033">                    continue;</span>
                }
<span class="fc bfc" id="L2035" title="All 2 branches covered.">                if(method.getReturnType() != Boolean.TYPE</span>
<span class="fc bfc" id="L2036" title="All 2 branches covered.">                        &amp;&amp; method.getReturnType() != Boolean.class){</span>
<span class="fc" id="L2037">                    continue;</span>
                }
<span class="fc" id="L2039">                char c2 = methodName.charAt(2);</span>
                String propertyName;
<span class="fc" id="L2041">                Field field = null;</span>
<span class="fc bfc" id="L2042" title="All 2 branches covered.">                if(Character.isUpperCase(c2)){</span>
<span class="fc bfc" id="L2043" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L2044">                        propertyName = decapitalize(methodName.substring(2));</span>
<span class="fc" id="L2045">                    } else{</span>
<span class="fc" id="L2046">                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</span>
                    }
<span class="fc" id="L2048">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</span>
<span class="fc bfc" id="L2049" title="All 2 branches covered.">                } else if(c2 == '_'){</span>
<span class="fc" id="L2050">                    propertyName = methodName.substring(3);</span>
<span class="fc" id="L2051">                    field = fieldCacheMap.get(propertyName);</span>
<span class="fc bfc" id="L2052" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2053">                        String temp = propertyName;</span>
<span class="fc" id="L2054">                        propertyName = methodName.substring(2);</span>
<span class="fc" id="L2055">                        field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="pc bpc" id="L2056" title="1 of 2 branches missed.">                        if (field == null) {</span>
<span class="nc" id="L2057">                            propertyName = temp;</span>
                        }
                    }
<span class="pc bfc" id="L2060" title="All 2 branches covered.">                } else if(c2 == 'f'){</span>
<span class="fc" id="L2061">                    propertyName = methodName.substring(2);</span>
<span class="fc" id="L2062">                } else{</span>
<span class="fc" id="L2063">                    propertyName = methodName.substring(2);</span>
<span class="fc" id="L2064">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L2065" title="All 2 branches covered.">                    if (field == null) {</span>
<span class="fc" id="L2066">                        continue;</span>
                    }
                }
<span class="fc" id="L2069">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L2070" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L2071">                    continue;</span>
                }
                
<span class="fc bfc" id="L2074" title="All 2 branches covered.">                if(field == null) {</span>
<span class="fc" id="L2075">                    field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
                }
                
<span class="fc bfc" id="L2078" title="All 2 branches covered.">                if(field == null){</span>
<span class="fc" id="L2079">                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</span>
                }
<span class="fc" id="L2081">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L2082" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L2083">                    fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc bfc" id="L2084" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L2085" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L2086">                            continue;</span>
                        }
<span class="fc" id="L2088">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2089">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2090">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2091" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L2092">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L2093" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L2094">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2095" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L2096">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L2100" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L2101">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L2105" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L2106">                    propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L2107" title="1 of 2 branches missed.">                    if(propertyName == null){</span>
<span class="fc" id="L2108">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L2111" title="All 2 branches covered.">                if(propertyNamingStrategy != null){</span>
<span class="fc" id="L2112">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
                //优先选择get
<span class="fc bfc" id="L2115" title="All 2 branches covered.">                if(fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L2116">                    continue;</span>
                }
<span class="fc" id="L2118">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
<span class="fc" id="L2119">                        annotation, fieldAnnotation, label);</span>
<span class="fc" id="L2120">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2123">        Field[] fields = clazz.getFields();</span>
<span class="fc" id="L2124">        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
<span class="fc" id="L2125">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String,FieldInfo&gt; fieldInfoMap){
<span class="fc" id="L2129">        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</span>
<span class="fc" id="L2130">        String[] orders = null;</span>
<span class="fc" id="L2131">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2132" title="All 2 branches covered.">        if(annotation != null){</span>
<span class="fc" id="L2133">            orders = annotation.orders();</span>
        }
<span class="fc bfc" id="L2135" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length &gt; 0){</span>
<span class="fc" id="L2136">            LinkedHashMap&lt;String,FieldInfo&gt; map = new LinkedHashMap&lt;String,FieldInfo&gt;(fieldInfoList.size());</span>
<span class="fc bfc" id="L2137" title="All 2 branches covered.">            for(FieldInfo field : fieldInfoMap.values()){</span>
<span class="fc" id="L2138">                map.put(field.name, field);</span>
            }
<span class="fc" id="L2140">            int i = 0;</span>
<span class="fc bfc" id="L2141" title="All 2 branches covered.">            for(String item : orders){</span>
<span class="fc" id="L2142">                FieldInfo field = map.get(item);</span>
<span class="fc bfc" id="L2143" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L2144">                    fieldInfoList.add(field);</span>
<span class="fc" id="L2145">                    map.remove(item);</span>
                }
            }
<span class="fc bfc" id="L2148" title="All 2 branches covered.">            for(FieldInfo field : map.values()){</span>
<span class="fc" id="L2149">                fieldInfoList.add(field);</span>
            }
<span class="fc" id="L2151">        } else{</span>
<span class="fc bfc" id="L2152" title="All 2 branches covered.">            for(FieldInfo fieldInfo : fieldInfoMap.values()){</span>
<span class="fc" id="L2153">                fieldInfoList.add(fieldInfo);</span>
            }
<span class="fc bfc" id="L2155" title="All 2 branches covered.">            if(sorted){</span>
<span class="fc" id="L2156">                Collections.sort(fieldInfoList);</span>
            }
        }
<span class="fc" id="L2159">        return fieldInfoList;</span>
    }

    private static void computeFields(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            PropertyNamingStrategy propertyNamingStrategy, //
            Map&lt;String,FieldInfo&gt; fieldInfoMap, //
            Field[] fields){
<span class="fc bfc" id="L2168" title="All 2 branches covered.">        for(Field field : fields){</span>
<span class="fc bfc" id="L2169" title="All 2 branches covered.">            if(Modifier.isStatic(field.getModifiers())){</span>
<span class="fc" id="L2170">                continue;</span>
            }
<span class="fc" id="L2172">            JSONField fieldAnnotation = TypeUtils.getAnnotation(field, JSONField.class);</span>
<span class="fc" id="L2173">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L2174">            String propertyName = field.getName();</span>
<span class="fc" id="L2175">            String label = null;</span>
<span class="fc bfc" id="L2176" title="All 2 branches covered.">            if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L2177" title="All 2 branches covered.">                if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L2178">                    continue;</span>
                }
<span class="fc" id="L2180">                ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L2181">                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L2182">                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L2183" title="All 2 branches covered.">                if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L2184">                    propertyName = fieldAnnotation.name();</span>
                }
<span class="pc bpc" id="L2186" title="1 of 2 branches missed.">                if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L2187">                    label = fieldAnnotation.label();</span>
                }
            }
<span class="fc bfc" id="L2190" title="All 2 branches covered.">            if(aliasMap != null){</span>
<span class="fc" id="L2191">                propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L2192" title="All 2 branches covered.">                if(propertyName == null){</span>
<span class="fc" id="L2193">                    continue;</span>
                }
            }
<span class="fc bfc" id="L2196" title="All 2 branches covered.">            if(propertyNamingStrategy != null){</span>
<span class="fc" id="L2197">                propertyName = propertyNamingStrategy.translate(propertyName);</span>
            }
<span class="fc bfc" id="L2199" title="All 2 branches covered.">            if(!fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L2200">                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
<span class="fc" id="L2201">                        null, fieldAnnotation, label);</span>
<span class="fc" id="L2202">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L2205">    }</span>

    private static String getPropertyNameByCompatibleFieldName(Map&lt;String,Field&gt; fieldCacheMap, String methodName,
                                                               String propertyName, int fromIdx){
<span class="pc bpc" id="L2209" title="1 of 2 branches missed.">        if(compatibleWithFieldName){</span>
<span class="nc bnc" id="L2210" title="All 2 branches missed.">            if(!fieldCacheMap.containsKey(propertyName)){</span>
<span class="nc" id="L2211">                String tempPropertyName = methodName.substring(fromIdx);</span>
<span class="nc bnc" id="L2212" title="All 2 branches missed.">                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</span>
            }
        }
<span class="fc" id="L2215">        return propertyName;</span>
    }

    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method){
<span class="fc" id="L2219">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="fc bfc" id="L2220" title="All 2 branches covered.">        if(interfaces.length &gt; 0){</span>
<span class="fc" id="L2221">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2222" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : interfaces){</span>
<span class="fc bfc" id="L2223" title="All 2 branches covered.">                for(Method interfaceMethod : interfaceClass.getMethods()){</span>
<span class="fc" id="L2224">                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2225" title="All 2 branches covered.">                    if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L2226">                        continue;</span>
                    }
<span class="fc bfc" id="L2228" title="All 2 branches covered.">                    if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L2229">                        continue;</span>
                    }
<span class="fc" id="L2231">                    boolean match = true;</span>
<span class="fc bfc" id="L2232" title="All 2 branches covered.">                    for(int i = 0; i &lt; types.length; ++i){</span>
<span class="fc bfc" id="L2233" title="All 2 branches covered.">                        if(!interfaceTypes[i].equals(types[i])){</span>
<span class="fc" id="L2234">                            match = false;</span>
<span class="fc" id="L2235">                            break;</span>
                        }
                    }
<span class="fc bfc" id="L2238" title="All 2 branches covered.">                    if(!match){</span>
<span class="fc" id="L2239">                        continue;</span>
                    }
<span class="fc" id="L2241">                    JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2242" title="All 2 branches covered.">                    if(annotation != null){</span>
<span class="fc" id="L2243">                        return annotation;</span>
                    }
                }
            }
        }
<span class="fc" id="L2248">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2249" title="All 2 branches covered.">        if(superClass == null){</span>
<span class="fc" id="L2250">            return null;</span>
        }
<span class="fc bfc" id="L2252" title="All 2 branches covered.">        if(Modifier.isAbstract(superClass.getModifiers())){</span>
<span class="fc" id="L2253">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L2254" title="All 2 branches covered.">            for(Method interfaceMethod : superClass.getMethods()){</span>
<span class="fc" id="L2255">                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L2256" title="All 2 branches covered.">                if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L2257">                    continue;</span>
                }
<span class="fc bfc" id="L2259" title="All 2 branches covered.">                if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L2260">                    continue;</span>
                }
<span class="fc" id="L2262">                boolean match = true;</span>
<span class="fc bfc" id="L2263" title="All 2 branches covered.">                for(int i = 0; i &lt; types.length; ++i){</span>
<span class="pc bpc" id="L2264" title="1 of 2 branches missed.">                    if(!interfaceTypes[i].equals(types[i])){</span>
<span class="nc" id="L2265">                        match = false;</span>
<span class="nc" id="L2266">                        break;</span>
                    }
                }
<span class="pc bpc" id="L2269" title="1 of 2 branches missed.">                if(!match){</span>
<span class="nc" id="L2270">                    continue;</span>
                }
<span class="fc" id="L2272">                JSONField annotation = TypeUtils.getAnnotation(interfaceMethod, JSONField.class);</span>
<span class="fc bfc" id="L2273" title="All 2 branches covered.">                if(annotation != null){</span>
<span class="fc" id="L2274">                    return annotation;</span>
                }
            }
        }
<span class="fc" id="L2278">        return null;</span>
    }

    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName){
<span class="fc" id="L2282">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2283" title="All 2 branches covered.">        if(jsonType != null){</span>
            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<span class="fc" id="L2287">            String[] fields = jsonType.includes();</span>
<span class="fc bfc" id="L2288" title="All 2 branches covered.">            if(fields.length &gt; 0){</span>
<span class="fc bfc" id="L2289" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L2290" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L2291">                        return false;</span>
                    }
                }
<span class="fc" id="L2294">                return true;</span>
            } else{
<span class="fc" id="L2296">                fields = jsonType.ignores();</span>
<span class="fc bfc" id="L2297" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L2298" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L2299">                        return true;</span>
                    }
                }
            }
        }
<span class="fc bfc" id="L2304" title="All 4 branches covered.">        if(clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null){</span>
<span class="fc" id="L2305">            return isJSONTypeIgnore(clazz.getSuperclass(), propertyName);</span>
        }
<span class="fc" id="L2307">        return false;</span>
    }

    public static boolean isGenericParamType(Type type){
<span class="fc bfc" id="L2311" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2312">            return true;</span>
        }
<span class="fc bfc" id="L2314" title="All 2 branches covered.">        if(type instanceof Class) {</span>
<span class="fc" id="L2315">            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</span>
<span class="fc bfc" id="L2316" title="All 4 branches covered.">            return superType != Object.class &amp;&amp; isGenericParamType(superType);</span>
        }
<span class="fc" id="L2318">        return false;</span>
    }

    public static Type getGenericParamType(Type type){
<span class="fc bfc" id="L2322" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2323">            return type;</span>
        }
<span class="pc bpc" id="L2325" title="1 of 2 branches missed.">        if(type instanceof Class){</span>
<span class="fc" id="L2326">            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</span>
        }
<span class="nc" id="L2328">        return type;</span>
    }

    public static Type unwrapOptional(Type type){
<span class="fc bfc" id="L2332" title="All 2 branches covered.">        if(!optionalClassInited){</span>
            try{
<span class="fc" id="L2334">                optionalClass = Class.forName(&quot;java.util.Optional&quot;);</span>
<span class="pc" id="L2335">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2338">                optionalClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2341" title="1 of 2 branches missed.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2342">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>
<span class="pc bpc" id="L2343" title="1 of 2 branches missed.">            if(parameterizedType.getRawType() == optionalClass){</span>
<span class="fc" id="L2344">                return parameterizedType.getActualTypeArguments()[0];</span>
            }
        }
<span class="nc" id="L2347">        return type;</span>
    }

    public static Class&lt;?&gt; getClass(Type type){
<span class="fc bfc" id="L2351" title="All 2 branches covered.">        if(type.getClass() == Class.class){</span>
<span class="fc" id="L2352">            return (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2355" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2356">            return getClass(((ParameterizedType) type).getRawType());</span>
        }

<span class="fc bfc" id="L2359" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L2360">            Type boundType = ((TypeVariable&lt;?&gt;) type).getBounds()[0];</span>
<span class="pc bpc" id="L2361" title="1 of 2 branches missed.">            if (boundType instanceof Class) {</span>
<span class="fc" id="L2362">                return (Class) boundType;</span>
            }
<span class="nc" id="L2364">            return getClass(boundType);</span>
        }

<span class="pc bpc" id="L2367" title="1 of 2 branches missed.">        if(type instanceof WildcardType){</span>
<span class="fc" id="L2368">            Type[] upperBounds = ((WildcardType) type).getUpperBounds();</span>
<span class="pc bpc" id="L2369" title="1 of 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="fc" id="L2370">                return getClass(upperBounds[0]);</span>
            }
        }

<span class="nc" id="L2374">        return Object.class;</span>
    }

    public static Field getField(Class&lt;?&gt; clazz, String fieldName, Field[] declaredFields){
<span class="fc bfc" id="L2378" title="All 2 branches covered.">        for(Field field : declaredFields){</span>
<span class="fc" id="L2379">            String itemName = field.getName();</span>
<span class="fc bfc" id="L2380" title="All 2 branches covered.">            if(fieldName.equals(itemName)){</span>
<span class="fc" id="L2381">                return field;</span>
            }

            char c0, c1;
<span class="fc bfc" id="L2385" title="All 2 branches covered.">            if (fieldName.length() &gt; 2</span>
<span class="fc bfc" id="L2386" title="All 4 branches covered.">                    &amp;&amp; (c0 = fieldName.charAt(0)) &gt;= 'a' &amp;&amp; c0 &lt;= 'z'</span>
<span class="fc bfc" id="L2387" title="All 4 branches covered.">                    &amp;&amp; (c1 = fieldName.charAt(1)) &gt;= 'A' &amp;&amp; c1 &lt;= 'Z'</span>
<span class="fc bfc" id="L2388" title="All 2 branches covered.">                    &amp;&amp; fieldName.equalsIgnoreCase(itemName)) {</span>
<span class="fc" id="L2389">                return field;</span>
            }
        }
<span class="fc" id="L2392">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2393" title="All 4 branches covered.">        if(superClass != null &amp;&amp; superClass != Object.class){</span>
<span class="fc" id="L2394">            return getField(superClass, fieldName, superClass.getDeclaredFields());</span>
        }
<span class="fc" id="L2396">        return null;</span>
    }

    /**
     * @deprecated
     */
    public static int getSerializeFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2403">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2404" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2405">            return 0;</span>
        }
<span class="fc" id="L2407">        return SerializerFeature.of(annotation.serialzeFeatures());</span>
    }

    public static int getParserFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2411">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2412" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2413">            return 0;</span>
        }
<span class="fc" id="L2415">        return Feature.of(annotation.parseFeatures());</span>
    }

    public static String decapitalize(String name){
<span class="pc bpc" id="L2419" title="2 of 4 branches missed.">        if(name == null || name.length() == 0){</span>
<span class="nc" id="L2420">            return name;</span>
        }
<span class="fc bfc" id="L2422" title="All 6 branches covered.">        if(name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))){</span>
<span class="fc" id="L2423">            return name;</span>
        }
<span class="fc" id="L2425">        char[] chars = name.toCharArray();</span>
<span class="fc" id="L2426">        chars[0] = Character.toLowerCase(chars[0]);</span>
<span class="fc" id="L2427">        return new String(chars);</span>
    }

    static void setAccessible(AccessibleObject obj){
<span class="pc bpc" id="L2431" title="1 of 2 branches missed.">        if(!setAccessibleEnable){</span>
<span class="nc" id="L2432">            return;</span>
        }
<span class="fc bfc" id="L2434" title="All 2 branches covered.">        if(obj.isAccessible()){</span>
<span class="fc" id="L2435">            return;</span>
        }
        try{
<span class="fc" id="L2438">            obj.setAccessible(true);</span>
<span class="pc" id="L2439">        } catch(AccessControlException error){</span>
<span class="nc" id="L2440">            setAccessibleEnable = false;</span>
        }
<span class="fc" id="L2442">    }</span>

    public static Type getCollectionItemType(Type fieldType) {
<span class="fc bfc" id="L2445" title="All 2 branches covered.">        if (fieldType instanceof ParameterizedType) {</span>
<span class="fc" id="L2446">            return getCollectionItemType((ParameterizedType) fieldType);</span>
        }
<span class="fc bfc" id="L2448" title="All 2 branches covered.">        if (fieldType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2449">            return getCollectionItemType((Class&lt;?&gt;) fieldType);</span>
        }
<span class="fc" id="L2451">        return Object.class;</span>
    }

    private static Type getCollectionItemType(Class&lt;?&gt; clazz) {
<span class="fc bfc" id="L2455" title="All 2 branches covered.">        return clazz.getName().startsWith(&quot;java.&quot;)</span>
<span class="fc" id="L2456">                ? Object.class</span>
<span class="fc" id="L2457">                : getCollectionItemType(getCollectionSuperType(clazz));</span>
    }

    private static Type getCollectionItemType(ParameterizedType parameterizedType) {
<span class="fc" id="L2461">        Type rawType = parameterizedType.getRawType();</span>
<span class="fc" id="L2462">        Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span>
<span class="fc bfc" id="L2463" title="All 2 branches covered.">        if (rawType == Collection.class) {</span>
<span class="fc" id="L2464">            return getWildcardTypeUpperBounds(actualTypeArguments[0]);</span>
        }
<span class="fc" id="L2466">        Class&lt;?&gt; rawClass = (Class&lt;?&gt;) rawType;</span>
<span class="fc" id="L2467">        Map&lt;TypeVariable, Type&gt; actualTypeMap = createActualTypeMap(rawClass.getTypeParameters(), actualTypeArguments);</span>
<span class="fc" id="L2468">        Type superType = getCollectionSuperType(rawClass);</span>
<span class="pc bpc" id="L2469" title="1 of 2 branches missed.">        if (superType instanceof ParameterizedType) {</span>
<span class="fc" id="L2470">            Class&lt;?&gt; superClass = getRawClass(superType);</span>
<span class="fc" id="L2471">            Type[] superClassTypeParameters = ((ParameterizedType) superType).getActualTypeArguments();</span>
<span class="pc bpc" id="L2472" title="1 of 2 branches missed.">            return superClassTypeParameters.length &gt; 0</span>
<span class="fc" id="L2473">                    ? getCollectionItemType(makeParameterizedType(superClass, superClassTypeParameters, actualTypeMap))</span>
<span class="nc" id="L2474">                    : getCollectionItemType(superClass);</span>
        }
<span class="nc" id="L2476">        return getCollectionItemType((Class&lt;?&gt;) superType);</span>
    }

    private static Type getCollectionSuperType(Class&lt;?&gt; clazz) {
<span class="fc" id="L2480">        Type assignable = null;</span>
<span class="fc bfc" id="L2481" title="All 2 branches covered.">        for (Type type : clazz.getGenericInterfaces()) {</span>
<span class="fc" id="L2482">            Class&lt;?&gt; rawClass = getRawClass(type);</span>
<span class="fc bfc" id="L2483" title="All 2 branches covered.">            if (rawClass == Collection.class) {</span>
<span class="fc" id="L2484">                return type;</span>
            }
<span class="fc bfc" id="L2486" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(rawClass)) {</span>
<span class="fc" id="L2487">                assignable = type;</span>
            }
        }
<span class="fc bfc" id="L2490" title="All 2 branches covered.">        return assignable == null ? clazz.getGenericSuperclass() : assignable;</span>
    }

    private static Map&lt;TypeVariable, Type&gt; createActualTypeMap(TypeVariable[] typeParameters, Type[] actualTypeArguments) {
<span class="fc" id="L2494">        int length = typeParameters.length;</span>
<span class="fc" id="L2495">        Map&lt;TypeVariable, Type&gt; actualTypeMap = new HashMap&lt;TypeVariable, Type&gt;(length);</span>
<span class="fc bfc" id="L2496" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2497">            actualTypeMap.put(typeParameters[i], actualTypeArguments[i]);</span>
        }
<span class="fc" id="L2499">        return actualTypeMap;</span>
    }

    private static ParameterizedType makeParameterizedType(Class&lt;?&gt; rawClass, Type[] typeParameters, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc" id="L2503">        int length = typeParameters.length;</span>
<span class="fc" id="L2504">        Type[] actualTypeArguments = new Type[length];</span>
<span class="fc bfc" id="L2505" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2506">            actualTypeArguments[i] = getActualType(typeParameters[i], actualTypeMap);</span>
        }
<span class="fc" id="L2508">        return new ParameterizedTypeImpl(actualTypeArguments, null, rawClass);</span>
    }

    private static Type getActualType(Type typeParameter, Map&lt;TypeVariable, Type&gt; actualTypeMap) {
<span class="fc bfc" id="L2512" title="All 2 branches covered.">        if (typeParameter instanceof TypeVariable) {</span>
<span class="fc" id="L2513">            return actualTypeMap.get(typeParameter);</span>
<span class="fc bfc" id="L2514" title="All 2 branches covered.">        } else if (typeParameter instanceof ParameterizedType) {</span>
<span class="fc" id="L2515">            return makeParameterizedType(getRawClass(typeParameter), ((ParameterizedType) typeParameter).getActualTypeArguments(), actualTypeMap);</span>
<span class="fc bfc" id="L2516" title="All 2 branches covered.">        } else if (typeParameter instanceof GenericArrayType) {</span>
<span class="fc" id="L2517">            return new GenericArrayTypeImpl(getActualType(((GenericArrayType) typeParameter).getGenericComponentType(), actualTypeMap));</span>
        }
<span class="fc" id="L2519">        return typeParameter;</span>
    }

    private static Type getWildcardTypeUpperBounds(Type type) {
<span class="fc bfc" id="L2523" title="All 2 branches covered.">        if (type instanceof WildcardType) {</span>
<span class="fc" id="L2524">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="fc" id="L2525">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2526" title="1 of 2 branches missed.">            return upperBounds.length &gt; 0 ? upperBounds[0] : Object.class;</span>
        }
<span class="fc" id="L2528">        return type;</span>
    }

    public static Class&lt;?&gt; getCollectionItemClass(Type fieldType){
<span class="fc bfc" id="L2532" title="All 2 branches covered.">        if(fieldType instanceof ParameterizedType){</span>
            Class&lt;?&gt; itemClass;
<span class="fc" id="L2534">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L2535" title="All 2 branches covered.">            if(actualTypeArgument instanceof WildcardType){</span>
<span class="fc" id="L2536">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L2537">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2538" title="1 of 2 branches missed.">                if(upperBounds.length == 1){</span>
<span class="fc" id="L2539">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc bfc" id="L2542" title="All 2 branches covered.">            if(actualTypeArgument instanceof Class){</span>
<span class="fc" id="L2543">                itemClass = (Class&lt;?&gt;) actualTypeArgument;</span>
<span class="fc bfc" id="L2544" title="All 2 branches covered.">                if(!Modifier.isPublic(itemClass.getModifiers())){</span>
<span class="fc" id="L2545">                    throw new JSONException(&quot;can not create ASMParser&quot;);</span>
                }
            } else{
<span class="fc" id="L2548">                throw new JSONException(&quot;can not create ASMParser&quot;);</span>
            }
<span class="fc" id="L2550">            return itemClass;</span>
        }
<span class="fc" id="L2552">        return Object.class;</span>
    }

    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<span class="fc" id="L2556">        Type clz = genericArrayType;</span>
<span class="fc" id="L2557">        Type genericComponentType  = genericArrayType.getGenericComponentType();</span>

<span class="fc" id="L2559">        String prefix = &quot;[&quot;;</span>
<span class="pc bpc" id="L2560" title="1 of 2 branches missed.">        while (genericComponentType instanceof GenericArrayType) {</span>
<span class="nc" id="L2561">            genericComponentType = ((GenericArrayType) genericComponentType)</span>
<span class="nc" id="L2562">                    .getGenericComponentType();</span>
<span class="nc" id="L2563">            prefix += prefix;</span>
        }

<span class="fc bfc" id="L2566" title="All 2 branches covered.">        if (genericComponentType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2567">            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</span>
<span class="pc bpc" id="L2568" title="1 of 2 branches missed.">            if (ck.isPrimitive()) {</span>
                try {
<span class="fc bfc" id="L2570" title="All 2 branches covered.">                    if (ck == boolean.class) {</span>
<span class="fc" id="L2571">                        clz = Class.forName(prefix + &quot;Z&quot;);</span>
<span class="fc bfc" id="L2572" title="All 2 branches covered.">                    } else if (ck == char.class) {</span>
<span class="fc" id="L2573">                        clz = Class.forName(prefix + &quot;C&quot;);</span>
<span class="fc bfc" id="L2574" title="All 2 branches covered.">                    } else if (ck == byte.class) {</span>
<span class="fc" id="L2575">                        clz = Class.forName(prefix + &quot;B&quot;);</span>
<span class="fc bfc" id="L2576" title="All 2 branches covered.">                    } else if (ck == short.class) {</span>
<span class="fc" id="L2577">                        clz = Class.forName(prefix + &quot;S&quot;);</span>
<span class="fc bfc" id="L2578" title="All 2 branches covered.">                    } else if (ck == int.class) {</span>
<span class="fc" id="L2579">                        clz = Class.forName(prefix + &quot;I&quot;);</span>
<span class="fc bfc" id="L2580" title="All 2 branches covered.">                    } else if (ck == long.class) {</span>
<span class="fc" id="L2581">                        clz = Class.forName(prefix + &quot;J&quot;);</span>
<span class="fc bfc" id="L2582" title="All 2 branches covered.">                    } else if (ck == float.class) {</span>
<span class="fc" id="L2583">                        clz = Class.forName(prefix + &quot;F&quot;);</span>
<span class="pc bpc" id="L2584" title="1 of 2 branches missed.">                    } else if (ck == double.class) {</span>
<span class="fc" id="L2585">                        clz = Class.forName(prefix + &quot;D&quot;);</span>
                    }
<span class="pc" id="L2587">                } catch (ClassNotFoundException e) {</span>
                }
            }
        }

<span class="fc" id="L2592">        return clz;</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static Collection createCollection(Type type) {
<span class="fc" id="L2597">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Collection list;
<span class="pc bpc" id="L2599" title="1 of 2 branches missed.">        if(rawClass == AbstractCollection.class //</span>
<span class="fc bfc" id="L2600" title="All 2 branches covered.">                || rawClass == Collection.class) {</span>
<span class="fc" id="L2601">            list = new ArrayList();</span>
<span class="fc bfc" id="L2602" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L2603">            list = new HashSet();</span>
<span class="fc bfc" id="L2604" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(LinkedHashSet.class)) {</span>
<span class="fc" id="L2605">            list = new LinkedHashSet();</span>
<span class="fc bfc" id="L2606" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(TreeSet.class)) {</span>
<span class="fc" id="L2607">            list = new TreeSet();</span>
<span class="fc bfc" id="L2608" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(ArrayList.class)) {</span>
<span class="fc" id="L2609">            list = new ArrayList();</span>
<span class="fc bfc" id="L2610" title="All 2 branches covered.">        } else if (rawClass.isAssignableFrom(EnumSet.class)) {</span>
            Type itemType;
<span class="pc bpc" id="L2612" title="1 of 2 branches missed.">            if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2613">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
<span class="fc" id="L2614">            } else {</span>
<span class="nc" id="L2615">                itemType = Object.class;</span>
            }
<span class="fc" id="L2617">            list = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="fc bfc" id="L2618" title="All 4 branches covered.">        } else if (rawClass.isAssignableFrom(Queue.class) || rawClass.isAssignableFrom(Deque.class)){</span>
<span class="fc" id="L2619">            list = new LinkedList();</span>
<span class="fc" id="L2620">        } else {</span>
            try {
<span class="fc" id="L2622">                list = (Collection) rawClass.newInstance();</span>
<span class="fc" id="L2623">            } catch(Exception e) {</span>
<span class="fc" id="L2624">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
            }
        }
<span class="fc" id="L2627">        return list;</span>
    }

    public static Class&lt;?&gt; getRawClass(Type type) {
<span class="fc bfc" id="L2631" title="All 2 branches covered.">        if(type instanceof Class&lt;?&gt;){</span>
<span class="fc" id="L2632">            return (Class&lt;?&gt;) type;</span>
<span class="pc bpc" id="L2633" title="1 of 2 branches missed.">        } else if(type instanceof ParameterizedType) {</span>
<span class="fc" id="L2634">            return getRawClass(((ParameterizedType)type).getRawType());</span>
<span class="nc bnc" id="L2635" title="All 2 branches missed.">        } else if(type instanceof WildcardType) {</span>
<span class="nc" id="L2636">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="nc" id="L2637">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="nc bnc" id="L2638" title="All 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="nc" id="L2639">                return getRawClass(upperBounds[0]);</span>
            } else {
<span class="nc" id="L2641">                throw new JSONException(&quot;TODO&quot;);</span>
            }
        } else{
<span class="nc" id="L2644">            throw new JSONException(&quot;TODO&quot;);</span>
        }
    }

    public static boolean isProxy(Class&lt;?&gt; clazz){
<span class="fc bfc" id="L2649" title="All 2 branches covered.">        for(Class&lt;?&gt; item : clazz.getInterfaces()){</span>
<span class="fc" id="L2650">            String interfaceName = item.getName();</span>
<span class="fc bfc" id="L2651" title="All 2 branches covered.">            if(interfaceName.equals(&quot;net.sf.cglib.proxy.Factory&quot;) //</span>
<span class="pc bpc" id="L2652" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.springframework.cglib.proxy.Factory&quot;)){</span>
<span class="fc" id="L2653">                return true;</span>
            }
<span class="fc bfc" id="L2655" title="All 2 branches covered.">            if(interfaceName.equals(&quot;javassist.util.proxy.ProxyObject&quot;) //</span>
<span class="pc bpc" id="L2656" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.apache.ibatis.javassist.util.proxy.ProxyObject&quot;)</span>
                    ){
<span class="fc" id="L2658">                return true;</span>
            }
<span class="pc bpc" id="L2660" title="1 of 2 branches missed.">            if (interfaceName.equals(&quot;org.hibernate.proxy.HibernateProxy&quot;)) {</span>
<span class="nc" id="L2661">                return true;</span>
            }
        }
<span class="fc" id="L2664">        return false;</span>
    }

    public static boolean isTransient(Method method){
<span class="fc bfc" id="L2668" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2669">            return false;</span>
        }
<span class="fc bfc" id="L2671" title="All 2 branches covered.">        if(!transientClassInited){</span>
            try{
<span class="fc" id="L2673">                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</span>
<span class="pc" id="L2674">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2677">                transientClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2680" title="1 of 2 branches missed.">        if(transientClass != null){</span>
<span class="fc" id="L2681">            Annotation annotation = TypeUtils.getAnnotation(method, transientClass);</span>
<span class="fc bfc" id="L2682" title="All 2 branches covered.">            return annotation != null;</span>
        }
<span class="nc" id="L2684">        return false;</span>
    }

    public static boolean isAnnotationPresentOneToMany(Method method) {
<span class="fc bfc" id="L2688" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2689">            return false;</span>
        }

<span class="pc bpc" id="L2692" title="1 of 4 branches missed.">        if (class_OneToMany == null &amp;&amp; !class_OneToMany_error) {</span>
            try {
<span class="fc" id="L2694">                class_OneToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.OneToMany&quot;);</span>
<span class="pc" id="L2695">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2697">                class_OneToMany_error = true;</span>
            }
        }
<span class="pc bpc" id="L2700" title="2 of 4 branches missed.">        return class_OneToMany != null &amp;&amp; method.isAnnotationPresent(class_OneToMany);</span>

    }

    public static boolean isAnnotationPresentManyToMany(Method method) {
<span class="fc bfc" id="L2705" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2706">            return false;</span>
        }

<span class="pc bpc" id="L2709" title="1 of 4 branches missed.">        if (class_ManyToMany == null &amp;&amp; !class_ManyToMany_error) {</span>
            try {
<span class="fc" id="L2711">                class_ManyToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.ManyToMany&quot;);</span>
<span class="pc" id="L2712">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2714">                class_ManyToMany_error = true;</span>
            }
        }
<span class="pc bpc" id="L2717" title="3 of 6 branches missed.">        return class_ManyToMany != null &amp;&amp; (method.isAnnotationPresent(class_OneToMany) || method.isAnnotationPresent(class_ManyToMany));</span>

    }

    public static boolean isHibernateInitialized(Object object){
<span class="pc bpc" id="L2722" title="1 of 2 branches missed.">        if(object == null){</span>
<span class="nc" id="L2723">            return false;</span>
        }
<span class="pc bpc" id="L2725" title="2 of 4 branches missed.">        if(method_HibernateIsInitialized == null &amp;&amp; !method_HibernateIsInitialized_error){</span>
            try{
<span class="fc" id="L2727">                Class&lt;?&gt; class_Hibernate = Class.forName(&quot;org.hibernate.Hibernate&quot;);</span>
<span class="fc" id="L2728">                method_HibernateIsInitialized = class_Hibernate.getMethod(&quot;isInitialized&quot;, Object.class);</span>
<span class="pc" id="L2729">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2731">                method_HibernateIsInitialized_error = true;</span>
            }
        }
<span class="pc bpc" id="L2734" title="1 of 2 branches missed.">        if(method_HibernateIsInitialized != null){</span>
            try{
<span class="fc" id="L2736">                Boolean initialized = (Boolean) method_HibernateIsInitialized.invoke(null, object);</span>
<span class="fc" id="L2737">                return initialized.booleanValue();</span>
<span class="nc" id="L2738">            } catch(Throwable e){</span>
                // skip
            }
        }
<span class="nc" id="L2742">        return true;</span>
    }

    public static double parseDouble(String str) {
<span class="fc" id="L2746">        final int len = str.length();</span>
<span class="fc bfc" id="L2747" title="All 2 branches covered.">        if (len &gt; 10) {</span>
<span class="fc" id="L2748">            return Double.parseDouble(str);</span>
        }

<span class="fc" id="L2751">        boolean negative = false;</span>

<span class="fc" id="L2753">        long longValue = 0;</span>
<span class="fc" id="L2754">        int scale = 0;</span>
<span class="fc bfc" id="L2755" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2756">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2757" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2758">                negative = true;</span>
<span class="fc" id="L2759">                continue;</span>
            }

<span class="fc bfc" id="L2762" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2763" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2764">                    return Double.parseDouble(str);</span>
                }
<span class="fc" id="L2766">                scale = len - i - 1;</span>
<span class="fc" id="L2767">                continue;</span>
            }

<span class="pc bpc" id="L2770" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2771">                int digit = ch - '0';</span>
<span class="fc" id="L2772">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2773">            } else {</span>
<span class="fc" id="L2774">                return Double.parseDouble(str);</span>
            }
        }

<span class="fc bfc" id="L2778" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2779">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2782" title="2 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2784">                return (double) longValue;</span>
            case 1:
<span class="fc" id="L2786">                return ((double) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2788">                return ((double) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2790">                return ((double) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L2792">                return ((double) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L2794">                return ((double) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L2796">                return ((double) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L2798">                return ((double) longValue) / 10000000;</span>
            case 8:
<span class="fc" id="L2800">                return ((double) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L2802">                return ((double) longValue) / 1000000000;</span>
        }

<span class="nc" id="L2805">        return Double.parseDouble(str);</span>
    }

    public static float parseFloat(String str) {
<span class="fc" id="L2809">        final int len = str.length();</span>
<span class="fc bfc" id="L2810" title="All 2 branches covered.">        if (len &gt;= 10) {</span>
<span class="fc" id="L2811">            return Float.parseFloat(str);</span>
        }

<span class="fc" id="L2814">        boolean negative = false;</span>

<span class="fc" id="L2816">        long longValue = 0;</span>
<span class="fc" id="L2817">        int scale = 0;</span>
<span class="fc bfc" id="L2818" title="All 2 branches covered.">        for (int i = 0; i &lt; len; ++i) {</span>
<span class="fc" id="L2819">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L2820" title="1 of 4 branches missed.">            if (ch == '-' &amp;&amp; i == 0) {</span>
<span class="fc" id="L2821">                negative = true;</span>
<span class="fc" id="L2822">                continue;</span>
            }

<span class="fc bfc" id="L2825" title="All 2 branches covered.">            if (ch == '.') {</span>
<span class="pc bpc" id="L2826" title="1 of 2 branches missed.">                if (scale != 0) {</span>
<span class="nc" id="L2827">                    return Float.parseFloat(str);</span>
                }
<span class="fc" id="L2829">                scale = len - i - 1;</span>
<span class="fc" id="L2830">                continue;</span>
            }

<span class="pc bpc" id="L2833" title="1 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L2834">                int digit = ch - '0';</span>
<span class="fc" id="L2835">                longValue = longValue * 10 + digit;</span>
<span class="fc" id="L2836">            } else {</span>
<span class="fc" id="L2837">                return Float.parseFloat(str);</span>
            }
        }

<span class="fc bfc" id="L2841" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L2842">            longValue = -longValue;</span>
        }

<span class="pc bpc" id="L2845" title="3 of 11 branches missed.">        switch (scale) {</span>
            case 0:
<span class="fc" id="L2847">                return (float) longValue;</span>
            case 1:
<span class="fc" id="L2849">                return ((float) longValue) / 10;</span>
            case 2:
<span class="fc" id="L2851">                return ((float) longValue) / 100;</span>
            case 3:
<span class="fc" id="L2853">                return ((float) longValue) / 1000;</span>
            case 4:
<span class="fc" id="L2855">                return ((float) longValue) / 10000;</span>
            case 5:
<span class="fc" id="L2857">                return ((float) longValue) / 100000;</span>
            case 6:
<span class="fc" id="L2859">                return ((float) longValue) / 1000000;</span>
            case 7:
<span class="fc" id="L2861">                return ((float) longValue) / 10000000;</span>
            case 8:
<span class="nc" id="L2863">                return ((float) longValue) / 100000000;</span>
            case 9:
<span class="nc" id="L2865">                return ((float) longValue) / 1000000000;</span>
        }

<span class="nc" id="L2868">        return Float.parseFloat(str);</span>
    }

    public static long fnv1a_64_lower(String key){
<span class="fc" id="L2872">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2873" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2874">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L2875" title="All 4 branches covered.">            if(ch == '_' || ch == '-'){</span>
<span class="fc" id="L2876">                continue;</span>
            }
<span class="fc bfc" id="L2878" title="All 4 branches covered.">            if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L2879">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L2881">            hashCode ^= ch;</span>
<span class="fc" id="L2882">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2884">        return hashCode;</span>
    }

    public static long fnv1a_64(String key){
<span class="fc" id="L2888">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2889" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2890">            char ch = key.charAt(i);</span>
<span class="fc" id="L2891">            hashCode ^= ch;</span>
<span class="fc" id="L2892">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2894">        return hashCode;</span>
    }

    public static boolean isKotlin(Class clazz) {
<span class="pc bpc" id="L2898" title="1 of 4 branches missed.">        if (kotlin_metadata == null &amp;&amp; !kotlin_metadata_error) {</span>
            try {
<span class="fc" id="L2900">                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</span>
<span class="pc" id="L2901">            } catch (Throwable e) {</span>
<span class="nc" id="L2902">                kotlin_metadata_error = true;</span>
            }
        }
<span class="pc bpc" id="L2905" title="1 of 4 branches missed.">        return kotlin_metadata != null &amp;&amp; clazz.isAnnotationPresent(kotlin_metadata);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors){
<span class="fc" id="L2909">        return getKoltinConstructor(constructors, null);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors, String[] paramNames){
<span class="fc" id="L2913">        Constructor creatorConstructor = null;</span>
<span class="fc bfc" id="L2914" title="All 2 branches covered.">        for(Constructor&lt;?&gt; constructor : constructors){</span>
<span class="fc" id="L2915">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
<span class="fc bfc" id="L2916" title="All 4 branches covered.">            if (paramNames != null &amp;&amp; parameterTypes.length != paramNames.length) {</span>
<span class="fc" id="L2917">                continue;</span>
            }

<span class="fc bfc" id="L2920" title="All 4 branches covered.">            if(parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)){</span>
<span class="fc" id="L2921">                continue;</span>
            }
<span class="fc bfc" id="L2923" title="All 4 branches covered.">            if(creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length){</span>
<span class="fc" id="L2924">                continue;</span>
            }
<span class="fc" id="L2926">            creatorConstructor = constructor;</span>
        }
<span class="fc" id="L2928">        return creatorConstructor;</span>
    }

    public static String[] getKoltinConstructorParameters(Class clazz){
<span class="pc bpc" id="L2932" title="1 of 4 branches missed.">        if(kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error){</span>
            try{
<span class="fc" id="L2934">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2935">                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</span>
<span class="pc" id="L2936">            } catch(Throwable e){</span>
<span class="nc" id="L2937">                kotlin_class_klass_error = true;</span>
            }
        }
<span class="pc bpc" id="L2940" title="1 of 2 branches missed.">        if (kotlin_kclass_constructor == null){</span>
<span class="nc" id="L2941">            return null;</span>
        }

<span class="pc bpc" id="L2944" title="1 of 4 branches missed.">        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2946">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2947">                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</span>
<span class="pc" id="L2948">            } catch(Throwable e){</span>
<span class="nc" id="L2949">                kotlin_class_klass_error = true;</span>
            }
        }

<span class="pc bpc" id="L2953" title="1 of 4 branches missed.">        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2955">                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</span>
<span class="fc" id="L2956">                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</span>
<span class="pc" id="L2957">            } catch(Throwable e){</span>
<span class="nc" id="L2958">                kotlin_class_klass_error = true;</span>
            }
        }

<span class="pc bpc" id="L2962" title="1 of 4 branches missed.">        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2964">                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</span>
<span class="fc" id="L2965">                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</span>
<span class="pc" id="L2966">            } catch(Throwable e){</span>
<span class="nc" id="L2967">                kotlin_class_klass_error = true;</span>
            }
        }

<span class="pc bpc" id="L2971" title="1 of 2 branches missed.">        if (kotlin_error){</span>
<span class="nc" id="L2972">            return null;</span>
        }

        try{
<span class="fc" id="L2976">            Object constructor = null;</span>
<span class="fc" id="L2977">            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</span>
<span class="fc" id="L2978">            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</span>
<span class="fc bfc" id="L2979" title="All 2 branches covered.">            for(Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()){</span>
<span class="fc" id="L2980">                Object item = iterator.next();</span>
<span class="fc" id="L2981">                List parameters = (List) kotlin_kfunction_getParameters.invoke(item);</span>
<span class="fc bfc" id="L2982" title="All 4 branches covered.">                if (constructor != null &amp;&amp; parameters.size() == 0) {</span>
<span class="fc" id="L2983">                    continue;</span>
                }
<span class="fc" id="L2985">                constructor = item;</span>
            }

<span class="pc bpc" id="L2988" title="1 of 2 branches missed.">            if (constructor == null) {</span>
<span class="nc" id="L2989">                return null;</span>
            }

<span class="fc" id="L2992">            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</span>
<span class="fc" id="L2993">            String[] names = new String[parameters.size()];</span>
<span class="fc bfc" id="L2994" title="All 2 branches covered.">            for(int i = 0; i &lt; parameters.size(); i++){</span>
<span class="fc" id="L2995">                Object param = parameters.get(i);</span>
<span class="fc" id="L2996">                names[i] = (String) kotlin_kparameter_getName.invoke(param);</span>
            }
<span class="fc" id="L2998">            return names;</span>
<span class="nc" id="L2999">        } catch(Throwable e){</span>
<span class="nc" id="L3000">            e.printStackTrace();</span>
<span class="nc" id="L3001">            kotlin_error = true;</span>
        }
<span class="nc" id="L3003">        return null;</span>
    }

    private static boolean isKotlinIgnore(Class clazz, String methodName) {
<span class="pc bpc" id="L3007" title="1 of 4 branches missed.">        if (kotlinIgnores == null &amp;&amp; !kotlinIgnores_error) {</span>
            try {
<span class="fc" id="L3009">                Map&lt;Class, String[]&gt; map = new HashMap&lt;Class, String[]&gt;();</span>
<span class="fc" id="L3010">                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</span>
<span class="fc" id="L3011">                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3012">                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</span>
<span class="fc" id="L3013">                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3014">                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</span>
<span class="fc" id="L3015">                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3016">                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</span>
<span class="fc" id="L3017">                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3018">                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</span>
<span class="fc" id="L3019">                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L3020">                kotlinIgnores = map;</span>
<span class="pc" id="L3021">            } catch (Throwable error) {</span>
<span class="nc" id="L3022">                kotlinIgnores_error = true;</span>
            }
        }
<span class="pc bpc" id="L3025" title="1 of 2 branches missed.">        if (kotlinIgnores == null) {</span>
<span class="nc" id="L3026">            return false;</span>
        }
<span class="fc" id="L3028">        String[] ignores = kotlinIgnores.get(clazz);</span>
<span class="fc bfc" id="L3029" title="All 4 branches covered.">        return ignores != null &amp;&amp; Arrays.binarySearch(ignores, methodName) &gt;= 0;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; targetClass, Class&lt;A&gt; annotationClass){
<span class="fc" id="L3033">        A targetAnnotation = targetClass.getAnnotation(annotationClass);</span>

<span class="fc" id="L3035">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3036">        Type type = JSON.getMixInAnnotations(targetClass);</span>
<span class="fc bfc" id="L3037" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3038">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3041" title="All 2 branches covered.">        if(mixInClass != null) {</span>
<span class="fc" id="L3042">            A mixInAnnotation = mixInClass.getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L3043" title="1 of 4 branches missed.">            if(mixInAnnotation == null &amp;&amp; mixInClass.getAnnotations().length &gt; 0){</span>
<span class="nc bnc" id="L3044" title="All 2 branches missed.">                for(Annotation annotation : mixInClass.getAnnotations()){</span>
<span class="nc" id="L3045">                    mixInAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="nc bnc" id="L3046" title="All 2 branches missed.">                    if(mixInAnnotation != null){</span>
<span class="nc" id="L3047">                        break;</span>
                    }
                }
            }
<span class="fc bfc" id="L3051" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3052">                return mixInAnnotation;</span>
            }
        }

<span class="fc bfc" id="L3056" title="All 4 branches covered.">        if(targetAnnotation == null &amp;&amp; targetClass.getAnnotations().length &gt; 0){</span>
<span class="fc bfc" id="L3057" title="All 2 branches covered.">            for(Annotation annotation : targetClass.getAnnotations()){</span>
<span class="fc" id="L3058">                targetAnnotation = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L3059" title="1 of 2 branches missed.">                if(targetAnnotation != null){</span>
<span class="nc" id="L3060">                    break;</span>
                }
            }
        }
<span class="fc" id="L3064">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Field field, Class&lt;A&gt; annotationClass){
<span class="fc" id="L3068">        A targetAnnotation = field.getAnnotation(annotationClass);</span>

<span class="fc" id="L3070">        Class&lt;?&gt; clazz = field.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L3072">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3073">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3074" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3075">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3078" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3079">            Field mixInField = null;</span>
<span class="fc" id="L3080">            String fieldName = field.getName();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="pc bpc" id="L3082" title="1 of 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L3083">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L3085">                    mixInField = currClass.getDeclaredField(fieldName);</span>
<span class="fc" id="L3086">                    break;</span>
<span class="fc" id="L3087">                } catch (NoSuchFieldException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L3091" title="All 2 branches covered.">            if (mixInField == null) {</span>
<span class="fc" id="L3092">                return targetAnnotation;</span>
            }
<span class="fc" id="L3094">            mixInAnnotation = mixInField.getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L3095" title="1 of 2 branches missed.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3096">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L3099">        return targetAnnotation;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Method method, Class&lt;A&gt; annotationClass){
<span class="fc" id="L3103">        A targetAnnotation = method.getAnnotation(annotationClass);</span>

<span class="fc" id="L3105">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        A mixInAnnotation;
<span class="fc" id="L3107">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3108">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3109" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3110">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3113" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3114">            Method mixInMethod = null;</span>
<span class="fc" id="L3115">            String methodName = method.getName();</span>
<span class="fc" id="L3116">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="fc bfc" id="L3118" title="All 4 branches covered.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="fc" id="L3119">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="fc" id="L3121">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="fc" id="L3122">                    break;</span>
<span class="fc" id="L3123">                } catch (NoSuchMethodException e) {</span>
                    // skip
                }
            }
<span class="fc bfc" id="L3127" title="All 2 branches covered.">            if (mixInMethod == null) {</span>
<span class="fc" id="L3128">                return targetAnnotation;</span>
            }
<span class="fc" id="L3130">            mixInAnnotation = mixInMethod.getAnnotation(annotationClass);</span>
<span class="fc bfc" id="L3131" title="All 2 branches covered.">            if (mixInAnnotation != null) {</span>
<span class="fc" id="L3132">                return mixInAnnotation;</span>
            }
        }
<span class="fc" id="L3135">        return targetAnnotation;</span>
    }

    public static Annotation[][] getParameterAnnotations(Method method){
<span class="fc" id="L3139">        Annotation[][] targetAnnotations = method.getParameterAnnotations();</span>

<span class="fc" id="L3141">        Class&lt;?&gt; clazz = method.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3143">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3144">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="pc bpc" id="L3145" title="1 of 2 branches missed.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="nc" id="L3146">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="pc bpc" id="L3149" title="1 of 2 branches missed.">        if (mixInClass != null) {</span>
<span class="nc" id="L3150">            Method mixInMethod = null;</span>
<span class="nc" id="L3151">            String methodName = method.getName();</span>
<span class="nc" id="L3152">            Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="nc bnc" id="L3154" title="All 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="nc" id="L3155">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="nc" id="L3157">                    mixInMethod = currClass.getDeclaredMethod(methodName, parameterTypes);</span>
<span class="nc" id="L3158">                    break;</span>
<span class="nc" id="L3159">                } catch (NoSuchMethodException e) {</span>
                    continue;
                }
            }
<span class="nc bnc" id="L3163" title="All 2 branches missed.">            if (mixInMethod == null) {</span>
<span class="nc" id="L3164">                return targetAnnotations;</span>
            }
<span class="nc" id="L3166">            mixInAnnotations = mixInMethod.getParameterAnnotations();</span>
<span class="nc bnc" id="L3167" title="All 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="nc" id="L3168">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3171">        return targetAnnotations;</span>
    }

    public static Annotation[][] getParameterAnnotations(Constructor constructor){
<span class="fc" id="L3175">        Annotation[][] targetAnnotations = constructor.getParameterAnnotations();</span>

<span class="fc" id="L3177">        Class&lt;?&gt; clazz = constructor.getDeclaringClass();</span>
        Annotation[][] mixInAnnotations;
<span class="fc" id="L3179">        Class&lt;?&gt; mixInClass = null;</span>
<span class="fc" id="L3180">        Type type = JSON.getMixInAnnotations(clazz);</span>
<span class="fc bfc" id="L3181" title="All 2 branches covered.">        if (type instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L3182">            mixInClass = (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L3185" title="All 2 branches covered.">        if (mixInClass != null) {</span>
<span class="fc" id="L3186">            Constructor mixInConstructor = null;</span>
<span class="fc" id="L3187">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
            // 构建参数列表，因为内部类的构造函数需要传入外部类的引用
<span class="fc" id="L3189">            List&lt;Class&lt;?&gt;&gt; enclosingClasses = new ArrayList&lt;Class&lt;?&gt;&gt;(2);</span>
<span class="fc bfc" id="L3190" title="All 2 branches covered.">            for (Class&lt;?&gt; enclosingClass = mixInClass.getEnclosingClass(); enclosingClass != null; enclosingClass = enclosingClass.getEnclosingClass()) {</span>
<span class="fc" id="L3191">                enclosingClasses.add(enclosingClass);</span>
            }
<span class="fc" id="L3193">            int level = enclosingClasses.size();</span>
            // 递归从MixIn类的父类中查找注解（如果有父类的话）
<span class="pc bpc" id="L3195" title="2 of 4 branches missed.">            for (Class&lt;?&gt; currClass = mixInClass; currClass != null &amp;&amp; currClass != Object.class;</span>
<span class="nc" id="L3196">                 currClass = currClass.getSuperclass()) {</span>
                try {
<span class="pc bpc" id="L3198" title="1 of 2 branches missed.">                    if (level != 0) {</span>
<span class="fc" id="L3199">                        Class&lt;?&gt;[] outerClassAndParameterTypes = new Class[level + parameterTypes.length];</span>
<span class="fc" id="L3200">                        System.arraycopy(parameterTypes, 0, outerClassAndParameterTypes, level, parameterTypes.length);</span>
<span class="fc bfc" id="L3201" title="All 2 branches covered.">                        for (int i = level; i &gt; 0 ; i--) {</span>
<span class="fc" id="L3202">                            outerClassAndParameterTypes[i - 1] = enclosingClasses.get(i - 1);</span>
                        }
<span class="fc" id="L3204">                        mixInConstructor = mixInClass.getDeclaredConstructor(outerClassAndParameterTypes);</span>
<span class="fc" id="L3205">                    } else {</span>
<span class="nc" id="L3206">                        mixInConstructor = mixInClass.getDeclaredConstructor(parameterTypes);</span>
                    }
<span class="nc" id="L3208">                    break;</span>
<span class="nc" id="L3209">                } catch (NoSuchMethodException e) {</span>
<span class="nc" id="L3210">                    level--;</span>
                }
            }
<span class="pc bpc" id="L3213" title="1 of 2 branches missed.">            if (mixInConstructor == null) {</span>
<span class="nc" id="L3214">                return targetAnnotations;</span>
            }
<span class="fc" id="L3216">            mixInAnnotations = mixInConstructor.getParameterAnnotations();</span>
<span class="pc bpc" id="L3217" title="1 of 2 branches missed.">            if (mixInAnnotations != null) {</span>
<span class="fc" id="L3218">                return mixInAnnotations;</span>
            }
        }
<span class="fc" id="L3221">        return targetAnnotations;</span>
    }

    public static boolean isJacksonCreator(Method method) {
<span class="pc bpc" id="L3225" title="1 of 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L3226">            return false;</span>
        }

<span class="pc bpc" id="L3229" title="1 of 4 branches missed.">        if (class_JacksonCreator == null &amp;&amp; !class_JacksonCreator_error) {</span>
            try {
<span class="fc" id="L3231">                class_JacksonCreator = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;com.fasterxml.jackson.annotation.JsonCreator&quot;);</span>
<span class="pc" id="L3232">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L3234">                class_JacksonCreator_error = true;</span>
            }
        }
<span class="pc bpc" id="L3237" title="1 of 4 branches missed.">        return class_JacksonCreator != null &amp;&amp; method.isAnnotationPresent(class_JacksonCreator);</span>
    }

    public static LocalDateTime castToLocalDateTime(Object value, String format) {
<span class="nc bnc" id="L3241" title="All 2 branches missed.">        if (value == null) {</span>
<span class="nc" id="L3242">            return null;</span>
        }

<span class="nc bnc" id="L3245" title="All 2 branches missed.">        if (format == null) {</span>
<span class="nc" id="L3246">            format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
        }

<span class="nc" id="L3249">        DateTimeFormatter df = DateTimeFormatter.ofPattern(format);</span>
<span class="nc" id="L3250">        return LocalDateTime.parse(value.toString(), df);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>