<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.util</a> &gt; <span class="el_source">TypeUtils.java</span></div><h1>TypeUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.util;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.PropertyNamingStrategy;
import com.alibaba.fastjson.annotation.JSONField;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.parser.DefaultJSONParser;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONScanner;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.deserializer.EnumDeserializer;
import com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer;
import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;
import com.alibaba.fastjson.serializer.CalendarCodec;
import com.alibaba.fastjson.serializer.SerializeBeanInfo;
import com.alibaba.fastjson.serializer.SerializerFeature;

import java.lang.annotation.Annotation;
import java.lang.reflect.AccessibleObject;
import java.lang.reflect.Array;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.GenericArrayType;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Proxy;
import java.lang.reflect.Type;
import java.lang.reflect.TypeVariable;
import java.lang.reflect.WildcardType;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.security.AccessControlException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.*;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

/**
 * @author wenshao[szujobs@hotmail.com]
 */
<span class="fc" id="L60">public class TypeUtils{</span>

<span class="fc" id="L62">    public static boolean compatibleWithJavaBean = false;</span>
    /** 根据field name的大小写输出输入数据 */
<span class="fc" id="L64">    public static boolean compatibleWithFieldName = false;</span>
<span class="fc" id="L65">    private static boolean setAccessibleEnable = true;</span>
<span class="fc" id="L66">    private static boolean oracleTimestampMethodInited = false;</span>
    private static Method oracleTimestampMethod;
<span class="fc" id="L68">    private static boolean oracleDateMethodInited = false;</span>
    private static Method oracleDateMethod;
<span class="fc" id="L70">    private static boolean optionalClassInited = false;</span>
    private static Class&lt;?&gt; optionalClass;
<span class="fc" id="L72">    private static boolean transientClassInited = false;</span>
    private static Class&lt;? extends Annotation&gt; transientClass;

<span class="fc" id="L75">    private static Class&lt;? extends Annotation&gt; class_OneToMany = null;</span>
<span class="fc" id="L76">    private static boolean class_OneToMany_error = false;</span>
<span class="fc" id="L77">    private static Class&lt;? extends Annotation&gt; class_ManyToMany = null;</span>
<span class="fc" id="L78">    private static boolean class_ManyToMany_error = false;</span>

<span class="fc" id="L80">    private static Method method_HibernateIsInitialized = null;</span>
<span class="fc" id="L81">    private static boolean method_HibernateIsInitialized_error = false;</span>
    private static volatile Class kotlin_metadata;
    private static volatile boolean kotlin_metadata_error;
    private static volatile boolean kotlin_class_klass_error;
    private static volatile Constructor kotlin_kclass_constructor;
    private static volatile Method kotlin_kclass_getConstructors;
    private static volatile Method kotlin_kfunction_getParameters;
    private static volatile Method kotlin_kparameter_getName;
    private static volatile boolean kotlin_error;
    private static volatile Map&lt;Class,String[]&gt; kotlinIgnores;
    private static volatile boolean kotlinIgnores_error;
<span class="fc" id="L92">    private static ConcurrentMap&lt;String,Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String,Class&lt;?&gt;&gt;(256, 0.75f, 1);</span>
    private static Class&lt;?&gt; pathClass;
<span class="fc" id="L94">    private static boolean pathClass_error = false;</span>

<span class="fc" id="L96">    private static Class&lt;? extends Annotation&gt; class_JacksonCreator = null;</span>
<span class="fc" id="L97">    private static boolean class_JacksonCreator_error = false;</span>

    static{
        try{
<span class="fc" id="L101">            TypeUtils.compatibleWithJavaBean = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHJAVABEAN));</span>
<span class="fc" id="L102">            TypeUtils.compatibleWithFieldName = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHFIELDNAME));</span>
<span class="nc" id="L103">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L105">        }</span>
    }

    static{
<span class="fc" id="L109">        addBaseClassMappings();</span>
<span class="fc" id="L110">    }</span>

    public static String castToString(Object value){
<span class="fc bfc" id="L113" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L114">            return null;</span>
        }
<span class="fc" id="L116">        return value.toString();</span>
    }

    public static Byte castToByte(Object value){
<span class="fc bfc" id="L120" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L121">            return null;</span>
        }

<span class="pc bpc" id="L124" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L125">            return byteValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L128" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L129">            return ((Number) value).byteValue();</span>
        }

<span class="fc bfc" id="L132" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L133">            String strVal = (String) value;</span>
<span class="fc bfc" id="L134" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L136" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L137">                return null;</span>
            }
<span class="fc" id="L139">            return Byte.parseByte(strVal);</span>
        }
<span class="fc" id="L141">        throw new JSONException(&quot;can not cast to byte, value : &quot; + value);</span>
    }

    public static Character castToChar(Object value){
<span class="fc bfc" id="L145" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L146">            return null;</span>
        }
<span class="fc bfc" id="L148" title="All 2 branches covered.">        if(value instanceof Character){</span>
<span class="fc" id="L149">            return (Character) value;</span>
        }
<span class="fc bfc" id="L151" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L152">            String strVal = (String) value;</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L154">                return null;</span>
            }
<span class="fc bfc" id="L156" title="All 2 branches covered.">            if(strVal.length() != 1){</span>
<span class="fc" id="L157">                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
            }
<span class="fc" id="L159">            return strVal.charAt(0);</span>
        }
<span class="fc" id="L161">        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
    }

    public static Short castToShort(Object value){
<span class="fc bfc" id="L165" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L166">            return null;</span>
        }

<span class="pc bpc" id="L169" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L170">            return shortValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L173" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L174">            return ((Number) value).shortValue();</span>
        }

<span class="fc bfc" id="L177" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L178">            String strVal = (String) value;</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L182">                return null;</span>
            }
<span class="fc" id="L184">            return Short.parseShort(strVal);</span>
        }

<span class="fc" id="L187">        throw new JSONException(&quot;can not cast to short, value : &quot; + value);</span>
    }

    public static BigDecimal castToBigDecimal(Object value){
<span class="fc bfc" id="L191" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L192">            return null;</span>
        }
<span class="fc bfc" id="L194" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L195">            return (BigDecimal) value;</span>
        }
<span class="fc bfc" id="L197" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L198">            return new BigDecimal((BigInteger) value);</span>
        }
<span class="fc" id="L200">        String strVal = value.toString();</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">        if(strVal.length() == 0){</span>
<span class="fc" id="L202">            return null;</span>
        }
<span class="fc bfc" id="L204" title="All 4 branches covered.">        if(value instanceof Map &amp;&amp; ((Map) value).size() == 0){</span>
<span class="fc" id="L205">            return null;</span>
        }
<span class="fc" id="L207">        return new BigDecimal(strVal);</span>
    }

    public static BigInteger castToBigInteger(Object value){
<span class="fc bfc" id="L211" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L212">            return null;</span>
        }
<span class="fc bfc" id="L214" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L215">            return (BigInteger) value;</span>
        }
<span class="fc bfc" id="L217" title="All 4 branches covered.">        if(value instanceof Float || value instanceof Double){</span>
<span class="fc" id="L218">            return BigInteger.valueOf(((Number) value).longValue());</span>
        }
<span class="fc bfc" id="L220" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L221">            BigDecimal decimal = (BigDecimal) value;</span>
<span class="fc" id="L222">            int scale = decimal.scale();</span>
<span class="pc bpc" id="L223" title="1 of 4 branches missed.">            if (scale &gt; -1000 &amp;&amp; scale &lt; 1000) {</span>
<span class="fc" id="L224">                return ((BigDecimal) value).toBigInteger();</span>
            }
        }
<span class="fc" id="L227">        String strVal = value.toString();</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">        if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">                || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L230" title="1 of 2 branches missed.">                || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L231">            return null;</span>
        }
<span class="fc" id="L233">        return new BigInteger(strVal);</span>
    }

    public static Float castToFloat(Object value){
<span class="fc bfc" id="L237" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L238">            return null;</span>
        }
<span class="fc bfc" id="L240" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L241">            return ((Number) value).floatValue();</span>
        }
<span class="fc bfc" id="L243" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L244">            String strVal = value.toString();</span>
<span class="fc bfc" id="L245" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L246" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L248">                return null;</span>
            }
<span class="pc bpc" id="L250" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L251">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L253">            return Float.parseFloat(strVal);</span>
        }
<span class="fc" id="L255">        throw new JSONException(&quot;can not cast to float, value : &quot; + value);</span>
    }

    public static Double castToDouble(Object value){
<span class="fc bfc" id="L259" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L260">            return null;</span>
        }
<span class="fc bfc" id="L262" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L263">            return ((Number) value).doubleValue();</span>
        }
<span class="fc bfc" id="L265" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L266">            String strVal = value.toString();</span>
<span class="fc bfc" id="L267" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L269" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L270">                return null;</span>
            }
<span class="pc bpc" id="L272" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L273">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L275">            return Double.parseDouble(strVal);</span>
        }
<span class="fc" id="L277">        throw new JSONException(&quot;can not cast to double, value : &quot; + value);</span>
    }

    public static Date castToDate(Object value){
<span class="fc" id="L281">        return castToDate(value, null);</span>
    }

    public static Date castToDate(Object value, String format){
<span class="fc bfc" id="L285" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L286">            return null;</span>
        }

<span class="fc bfc" id="L289" title="All 2 branches covered.">        if(value instanceof Date){ // 使用频率最高的，应优先处理</span>
<span class="fc" id="L290">            return (Date) value;</span>
        }

<span class="fc bfc" id="L293" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L294">            return ((Calendar) value).getTime();</span>
        }

<span class="fc" id="L297">        long longValue = -1;</span>

<span class="fc bfc" id="L299" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L300">            longValue = longValue((BigDecimal) value);</span>
<span class="nc" id="L301">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L304" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L305">            longValue = ((Number) value).longValue();</span>
<span class="fc" id="L306">            return new Date(longValue);</span>
        }

<span class="fc bfc" id="L309" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L310">            String strVal = (String) value;</span>
<span class="fc" id="L311">            JSONScanner dateLexer = new JSONScanner(strVal);</span>
            try{
<span class="fc bfc" id="L313" title="All 2 branches covered.">                if(dateLexer.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L314">                    Calendar calendar = dateLexer.getCalendar();</span>
<span class="fc" id="L315">                    return calendar.getTime();</span>
                }
            } finally{
<span class="fc" id="L318">                dateLexer.close();</span>
            }

<span class="pc bpc" id="L321" title="1 of 4 branches missed.">            if (strVal.startsWith(&quot;/Date(&quot;) &amp;&amp; strVal.endsWith(&quot;)/&quot;)) {</span>
<span class="fc" id="L322">                strVal = strVal.substring(6, strVal.length() - 2);</span>
            }

<span class="fc bfc" id="L325" title="All 4 branches covered.">            if (strVal.indexOf('-') &gt; 0 || strVal.indexOf('+') &gt; 0) {</span>
<span class="fc bfc" id="L326" title="All 2 branches covered.">                if (format == null) {</span>
<span class="fc bfc" id="L327" title="All 2 branches covered.">                    if (strVal.length() == JSON.DEFFAULT_DATE_FORMAT.length()</span>
<span class="pc bpc" id="L328" title="1 of 4 branches missed.">                            || (strVal.length() == 22 &amp;&amp; JSON.DEFFAULT_DATE_FORMAT.equals(&quot;yyyyMMddHHmmssSSSZ&quot;))) {</span>
<span class="fc" id="L329">                        format = JSON.DEFFAULT_DATE_FORMAT;</span>
<span class="pc bpc" id="L330" title="1 of 2 branches missed.">                    } else if (strVal.length() == 10) {</span>
<span class="fc" id="L331">                        format = &quot;yyyy-MM-dd&quot;;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">                    } else if (strVal.length() == &quot;yyyy-MM-dd HH:mm:ss&quot;.length()) {</span>
<span class="nc" id="L333">                        format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">                    } else if (strVal.length() == 29</span>
<span class="nc bnc" id="L335" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(26) == ':'</span>
<span class="nc bnc" id="L336" title="All 2 branches missed.">                            &amp;&amp; strVal.charAt(28) == '0') {</span>
<span class="nc" id="L337">                        format = &quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;;</span>
                    } else {
<span class="nc" id="L339">                        format = &quot;yyyy-MM-dd HH:mm:ss.SSS&quot;;</span>
                    }
                }

<span class="fc" id="L343">                SimpleDateFormat dateFormat = new SimpleDateFormat(format, JSON.defaultLocale);</span>
<span class="fc" id="L344">                dateFormat.setTimeZone(JSON.defaultTimeZone);</span>
                try{
<span class="fc" id="L346">                    return dateFormat.parse(strVal);</span>
<span class="fc" id="L347">                } catch(ParseException e){</span>
<span class="fc" id="L348">                    throw new JSONException(&quot;can not cast to Date, value : &quot; + strVal);</span>
                }
            }
<span class="fc bfc" id="L351" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L352">                return null;</span>
            }
<span class="fc" id="L354">            longValue = Long.parseLong(strVal);</span>
        }

<span class="fc bfc" id="L357" title="All 2 branches covered.">        if (longValue == -1) {</span>
<span class="fc" id="L358">            Class&lt;?&gt; clazz = value.getClass();</span>
<span class="fc bfc" id="L359" title="All 2 branches covered.">            if(&quot;oracle.sql.TIMESTAMP&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L360" title="2 of 4 branches missed.">                if(oracleTimestampMethod == null &amp;&amp; !oracleTimestampMethodInited){</span>
                    try{
<span class="fc" id="L362">                        oracleTimestampMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L363">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L366">                        oracleTimestampMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L371">                    result = oracleTimestampMethod.invoke(value);</span>
<span class="nc" id="L372">                } catch(Exception e){</span>
<span class="nc" id="L373">                    throw new JSONException(&quot;can not cast oracle.sql.TIMESTAMP to Date&quot;, e);</span>
<span class="fc" id="L374">                }</span>
<span class="fc" id="L375">                return (Date) result;</span>
            }
<span class="fc bfc" id="L377" title="All 2 branches covered.">            if(&quot;oracle.sql.DATE&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L378" title="2 of 4 branches missed.">                if(oracleDateMethod == null &amp;&amp; !oracleDateMethodInited){</span>
                    try{
<span class="fc" id="L380">                        oracleDateMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L381">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L384">                        oracleDateMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L389">                    result = oracleDateMethod.invoke(value);</span>
<span class="nc" id="L390">                } catch(Exception e){</span>
<span class="nc" id="L391">                    throw new JSONException(&quot;can not cast oracle.sql.DATE to Date&quot;, e);</span>
<span class="fc" id="L392">                }</span>
<span class="fc" id="L393">                return (Date) result;</span>
            }

<span class="fc" id="L396">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value);</span>
        }

<span class="fc" id="L399">        return new Date(longValue);</span>
    }

    public static java.sql.Date castToSqlDate(Object value){
<span class="fc bfc" id="L403" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L404">            return null;</span>
        }
<span class="fc bfc" id="L406" title="All 2 branches covered.">        if(value instanceof java.sql.Date){</span>
<span class="fc" id="L407">            return (java.sql.Date) value;</span>
        }
<span class="fc bfc" id="L409" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L410">            return new java.sql.Date(((java.util.Date) value).getTime());</span>
        }
<span class="fc bfc" id="L412" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L413">            return new java.sql.Date(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L416">        long longValue = 0;</span>
<span class="fc bfc" id="L417" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L418">            longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L419" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L420">            longValue = ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L423" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L424">            String strVal = (String) value;</span>
<span class="fc bfc" id="L425" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L426" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L427" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L428">                return null;</span>
            }
<span class="pc bpc" id="L430" title="1 of 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="fc" id="L431">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="nc" id="L433">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L434" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L435">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L437">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L441" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L442">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L444">        return new java.sql.Date(longValue);</span>
    }

    public static long longExtractValue(Number number) {
<span class="fc bfc" id="L448" title="All 2 branches covered.">        if (number instanceof BigDecimal) {</span>
<span class="fc" id="L449">            return ((BigDecimal) number).longValueExact();</span>
        }

<span class="fc" id="L452">        return number.longValue();</span>
    }

    public static java.sql.Time castToSqlTime(Object value){
<span class="pc bpc" id="L456" title="1 of 2 branches missed.">        if(value == null){</span>
<span class="nc" id="L457">            return null;</span>
        }
<span class="pc bpc" id="L459" title="1 of 2 branches missed.">        if(value instanceof java.sql.Time){</span>
<span class="nc" id="L460">            return (java.sql.Time) value;</span>
        }
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        if(value instanceof java.util.Date){</span>
<span class="nc" id="L463">            return new java.sql.Time(((java.util.Date) value).getTime());</span>
        }
<span class="pc bpc" id="L465" title="1 of 2 branches missed.">        if(value instanceof Calendar){</span>
<span class="nc" id="L466">            return new java.sql.Time(((Calendar) value).getTimeInMillis());</span>
        }

<span class="fc" id="L469">        long longValue = 0;</span>
<span class="fc bfc" id="L470" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L471">            longValue = longValue((BigDecimal) value);</span>
<span class="pc bpc" id="L472" title="1 of 2 branches missed.">        } else if(value instanceof Number){</span>
<span class="fc" id="L473">            longValue = ((Number) value).longValue();</span>
        }

<span class="pc bpc" id="L476" title="1 of 2 branches missed.">        if(value instanceof String){</span>
<span class="nc" id="L477">            String strVal = (String) value;</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">            if(strVal.length() == 0 //</span>
<span class="nc bnc" id="L479" title="All 2 branches missed.">                    || &quot;null&quot;.equalsIgnoreCase(strVal)){</span>
<span class="nc" id="L480">                return null;</span>
            }
<span class="nc bnc" id="L482" title="All 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="nc" id="L483">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="nc" id="L485">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L487">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L489">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="pc bpc" id="L493" title="1 of 2 branches missed.">        if(longValue &lt;= 0){</span>
<span class="nc" id="L494">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L496">        return new java.sql.Time(longValue);</span>
    }

    public static java.sql.Timestamp castToTimestamp(Object value){
<span class="fc bfc" id="L500" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L501">            return null;</span>
        }
<span class="fc bfc" id="L503" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L504">            return new java.sql.Timestamp(((Calendar) value).getTimeInMillis());</span>
        }
<span class="fc bfc" id="L506" title="All 2 branches covered.">        if(value instanceof java.sql.Timestamp){</span>
<span class="fc" id="L507">            return (java.sql.Timestamp) value;</span>
        }
<span class="fc bfc" id="L509" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L510">            return new java.sql.Timestamp(((java.util.Date) value).getTime());</span>
        }
<span class="fc" id="L512">        long longValue = 0;</span>
<span class="fc bfc" id="L513" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L514">            longValue = longValue((BigDecimal) value);</span>
<span class="fc bfc" id="L515" title="All 2 branches covered.">        } else if(value instanceof Number){</span>
<span class="fc" id="L516">            longValue = ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L518" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L519">            String strVal = (String) value;</span>
<span class="fc bfc" id="L520" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L521" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L522" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L523">                return null;</span>
            }
<span class="fc bfc" id="L525" title="All 2 branches covered.">            if(strVal.endsWith(&quot;.000000000&quot;)){</span>
<span class="fc" id="L526">                strVal = strVal.substring(0, strVal.length() - 10);</span>
<span class="fc bfc" id="L527" title="All 2 branches covered.">            } else if(strVal.endsWith(&quot;.000000&quot;)){</span>
<span class="fc" id="L528">                strVal = strVal.substring(0, strVal.length() - 7);</span>
            }
<span class="fc bfc" id="L530" title="All 2 branches covered.">            if(isNumber(strVal)){</span>
<span class="fc" id="L531">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="fc" id="L533">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="pc bpc" id="L534" title="1 of 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L535">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L537">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L541" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L542">            throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + value);</span>
        }
<span class="fc" id="L544">        return new java.sql.Timestamp(longValue);</span>
    }

    public static boolean isNumber(String str){
<span class="fc bfc" id="L548" title="All 2 branches covered.">        for(int i = 0; i &lt; str.length(); ++i){</span>
<span class="fc" id="L549">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L550" title="1 of 4 branches missed.">            if(ch == '+' || ch == '-'){</span>
<span class="fc bfc" id="L551" title="All 2 branches covered.">                if(i != 0){</span>
<span class="fc" id="L552">                    return false;</span>
                } 
<span class="fc bfc" id="L554" title="All 4 branches covered.">            } else if(ch &lt; '0' || ch &gt; '9'){</span>
<span class="fc" id="L555">                return false;</span>
            }
        }
<span class="fc" id="L558">        return true;</span>
    }

    public static Long castToLong(Object value){
<span class="fc bfc" id="L562" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L563">            return null;</span>
        }

<span class="pc bpc" id="L566" title="1 of 2 branches missed.">        if(value instanceof BigDecimal){</span>
<span class="nc" id="L567">            return longValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L570" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L571">            return ((Number) value).longValue();</span>
        }

<span class="fc bfc" id="L574" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L575">            String strVal = (String) value;</span>
<span class="fc bfc" id="L576" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L577" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L578" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L579">                return null;</span>
            }
<span class="pc bpc" id="L581" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L582">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            try{
<span class="fc" id="L585">                return Long.parseLong(strVal);</span>
<span class="fc" id="L586">            } catch(NumberFormatException ex){</span>
                //
            }
<span class="fc" id="L589">            JSONScanner dateParser = new JSONScanner(strVal);</span>
<span class="fc" id="L590">            Calendar calendar = null;</span>
<span class="fc bfc" id="L591" title="All 2 branches covered.">            if(dateParser.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L592">                calendar = dateParser.getCalendar();</span>
            }
<span class="fc" id="L594">            dateParser.close();</span>
<span class="fc bfc" id="L595" title="All 2 branches covered.">            if(calendar != null){</span>
<span class="fc" id="L596">                return calendar.getTimeInMillis();</span>
            }
        }

<span class="fc bfc" id="L600" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L601">            Map map = (Map) value;</span>
<span class="fc bfc" id="L602" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L603" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L604" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L605">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L606">                iter.next();</span>
<span class="fc" id="L607">                Object value2 = iter.next();</span>
<span class="fc" id="L608">                return castToLong(value2);</span>
            }
        }
        
<span class="fc" id="L612">        throw new JSONException(&quot;can not cast to long, value : &quot; + value);</span>
    }

    public static byte byteValue(BigDecimal decimal) {
<span class="pc bpc" id="L616" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L617">            return 0;</span>
        }

<span class="fc" id="L620">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L621" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L622">            return decimal.byteValue();</span>
        }

<span class="nc" id="L625">        return decimal.byteValueExact();</span>
    }

    public static short shortValue(BigDecimal decimal) {
<span class="pc bpc" id="L629" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L630">            return 0;</span>
        }

<span class="fc" id="L633">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L634" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L635">            return decimal.shortValue();</span>
        }

<span class="nc" id="L638">        return decimal.shortValueExact();</span>
    }

    public static int intValue(BigDecimal decimal) {
<span class="pc bpc" id="L642" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L643">            return 0;</span>
        }

<span class="fc" id="L646">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L647" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L648">            return decimal.intValue();</span>
        }

<span class="nc" id="L651">        return decimal.intValueExact();</span>
    }

    public static long longValue(BigDecimal decimal) {
<span class="pc bpc" id="L655" title="1 of 2 branches missed.">        if (decimal == null) {</span>
<span class="nc" id="L656">            return 0;</span>
        }

<span class="fc" id="L659">        int scale = decimal.scale();</span>
<span class="pc bpc" id="L660" title="1 of 4 branches missed.">        if (scale &gt;= -100 &amp;&amp; scale &lt;= 100) {</span>
<span class="fc" id="L661">            return decimal.longValue();</span>
        }

<span class="nc" id="L664">        return decimal.longValueExact();</span>
    }

    public static Integer castToInt(Object value){
<span class="fc bfc" id="L668" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L669">            return null;</span>
        }

<span class="fc bfc" id="L672" title="All 2 branches covered.">        if(value instanceof Integer){</span>
<span class="fc" id="L673">            return (Integer) value;</span>
        }

<span class="fc bfc" id="L676" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L677">            return intValue((BigDecimal) value);</span>
        }

<span class="fc bfc" id="L680" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L681">            return ((Number) value).intValue();</span>
        }

<span class="fc bfc" id="L684" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L685">            String strVal = (String) value;</span>
<span class="fc bfc" id="L686" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L687" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L688" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L689">                return null;</span>
            }
<span class="pc bpc" id="L691" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L692">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L694">            return Integer.parseInt(strVal);</span>
        }

<span class="fc bfc" id="L697" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="pc bpc" id="L698" title="1 of 2 branches missed.">            return ((Boolean) value).booleanValue() ? 1 : 0;</span>
        }
<span class="fc bfc" id="L700" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L701">            Map map = (Map) value;</span>
<span class="fc bfc" id="L702" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L703" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L704" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L705">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L706">                iter.next();</span>
<span class="fc" id="L707">                Object value2 = iter.next();</span>
<span class="fc" id="L708">                return castToInt(value2);</span>
            }
        }
<span class="fc" id="L711">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static byte[] castToBytes(Object value){
<span class="fc bfc" id="L715" title="All 2 branches covered.">        if(value instanceof byte[]){</span>
<span class="fc" id="L716">            return (byte[]) value;</span>
        }
<span class="fc bfc" id="L718" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L719">            return IOUtils.decodeBase64((String) value);</span>
        }
<span class="fc" id="L721">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static Boolean castToBoolean(Object value){
<span class="fc bfc" id="L725" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L726">            return null;</span>
        }
<span class="fc bfc" id="L728" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="fc" id="L729">            return (Boolean) value;</span>
        }

<span class="fc bfc" id="L732" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="nc bnc" id="L733" title="All 2 branches missed.">            return intValue((BigDecimal) value) == 1;</span>
        }

<span class="fc bfc" id="L736" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc bfc" id="L737" title="All 2 branches covered.">            return ((Number) value).intValue() == 1;</span>
        }

<span class="fc bfc" id="L740" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L741">            String strVal = (String) value;</span>
<span class="fc bfc" id="L742" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L743" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L744" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L745">                return null;</span>
            }
<span class="fc bfc" id="L747" title="All 2 branches covered.">            if(&quot;true&quot;.equalsIgnoreCase(strVal) //</span>
<span class="pc bpc" id="L748" title="1 of 2 branches missed.">                    || &quot;1&quot;.equals(strVal)){</span>
<span class="fc" id="L749">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L751" title="All 2 branches covered.">            if(&quot;false&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L752" title="All 2 branches covered.">                    || &quot;0&quot;.equals(strVal)){</span>
<span class="fc" id="L753">                return Boolean.FALSE;</span>
            }
<span class="fc bfc" id="L755" title="All 2 branches covered.">            if(&quot;Y&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L756" title="All 2 branches covered.">                    || &quot;T&quot;.equals(strVal)){</span>
<span class="fc" id="L757">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L759" title="All 2 branches covered.">            if(&quot;F&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L760" title="All 2 branches covered.">                    || &quot;N&quot;.equals(strVal)){</span>
<span class="fc" id="L761">                return Boolean.FALSE;</span>
            }
        }
<span class="fc" id="L764">        throw new JSONException(&quot;can not cast to boolean, value : &quot; + value);</span>
    }

    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz){
<span class="fc" id="L768">        return cast(obj, clazz, ParserConfig.getGlobalInstance());</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T cast(Object obj, Class&lt;T&gt; clazz, ParserConfig config){
<span class="fc bfc" id="L773" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc bfc" id="L774" title="All 2 branches covered.">            if(clazz == int.class){</span>
<span class="fc" id="L775">                return (T) Integer.valueOf(0);</span>
<span class="fc bfc" id="L776" title="All 2 branches covered.">            } else if(clazz == long.class){</span>
<span class="fc" id="L777">                return (T) Long.valueOf(0);</span>
<span class="fc bfc" id="L778" title="All 2 branches covered.">            } else if(clazz == short.class){</span>
<span class="fc" id="L779">                return (T) Short.valueOf((short) 0);</span>
<span class="fc bfc" id="L780" title="All 2 branches covered.">            } else if(clazz == byte.class){</span>
<span class="fc" id="L781">                return (T) Byte.valueOf((byte) 0);</span>
<span class="fc bfc" id="L782" title="All 2 branches covered.">            } else if(clazz == float.class){</span>
<span class="fc" id="L783">                return (T) Float.valueOf(0);</span>
<span class="fc bfc" id="L784" title="All 2 branches covered.">            } else if(clazz == double.class){</span>
<span class="fc" id="L785">                return (T) Double.valueOf(0);</span>
<span class="fc bfc" id="L786" title="All 2 branches covered.">            } else if(clazz == boolean.class){</span>
<span class="fc" id="L787">                return (T) Boolean.FALSE;</span>
            }
<span class="fc" id="L789">            return null;</span>
        }

<span class="fc bfc" id="L792" title="All 2 branches covered.">        if(clazz == null){</span>
<span class="fc" id="L793">            throw new IllegalArgumentException(&quot;clazz is null&quot;);</span>
        }

<span class="fc bfc" id="L796" title="All 2 branches covered.">        if(clazz == obj.getClass()){</span>
<span class="fc" id="L797">            return (T) obj;</span>
        }

<span class="fc bfc" id="L800" title="All 2 branches covered.">        if(obj instanceof Map){</span>
<span class="fc bfc" id="L801" title="All 2 branches covered.">            if(clazz == Map.class){</span>
<span class="fc" id="L802">                return (T) obj;</span>
            }

<span class="fc" id="L805">            Map map = (Map) obj;</span>
<span class="fc bfc" id="L806" title="All 4 branches covered.">            if(clazz == Object.class &amp;&amp; !map.containsKey(JSON.DEFAULT_TYPE_KEY)){</span>
<span class="fc" id="L807">                return (T) obj;</span>
            }
<span class="fc" id="L809">            return castToJavaBean((Map&lt;String,Object&gt;) obj, clazz, config);</span>
        }

<span class="fc bfc" id="L812" title="All 2 branches covered.">        if(clazz.isArray()){</span>
<span class="fc bfc" id="L813" title="All 2 branches covered.">            if(obj instanceof Collection){</span>
<span class="fc" id="L814">                Collection collection = (Collection) obj;</span>
<span class="fc" id="L815">                int index = 0;</span>
<span class="fc" id="L816">                Object array = Array.newInstance(clazz.getComponentType(), collection.size());</span>
<span class="fc bfc" id="L817" title="All 2 branches covered.">                for(Object item : collection){</span>
<span class="fc" id="L818">                    Object value = cast(item, clazz.getComponentType(), config);</span>
<span class="fc" id="L819">                    Array.set(array, index, value);</span>
<span class="fc" id="L820">                    index++;</span>
<span class="fc" id="L821">                }</span>
<span class="fc" id="L822">                return (T) array;</span>
            }
<span class="fc bfc" id="L824" title="All 2 branches covered.">            if(clazz == byte[].class){</span>
<span class="fc" id="L825">                return (T) castToBytes(obj);</span>
            }
        }

<span class="fc bfc" id="L829" title="All 2 branches covered.">        if(clazz.isAssignableFrom(obj.getClass())){</span>
<span class="fc" id="L830">            return (T) obj;</span>
        }

<span class="fc bfc" id="L833" title="All 4 branches covered.">        if(clazz == boolean.class || clazz == Boolean.class){</span>
<span class="fc" id="L834">            return (T) castToBoolean(obj);</span>
        }

<span class="fc bfc" id="L837" title="All 4 branches covered.">        if(clazz == byte.class || clazz == Byte.class){</span>
<span class="fc" id="L838">            return (T) castToByte(obj);</span>
        }

<span class="fc bfc" id="L841" title="All 4 branches covered.">        if(clazz == char.class || clazz == Character.class){</span>
<span class="fc" id="L842">            return (T) castToChar(obj);</span>
        }

<span class="fc bfc" id="L845" title="All 4 branches covered.">        if(clazz == short.class || clazz == Short.class){</span>
<span class="fc" id="L846">            return (T) castToShort(obj);</span>
        }

<span class="fc bfc" id="L849" title="All 4 branches covered.">        if(clazz == int.class || clazz == Integer.class){</span>
<span class="fc" id="L850">            return (T) castToInt(obj);</span>
        }

<span class="fc bfc" id="L853" title="All 4 branches covered.">        if(clazz == long.class || clazz == Long.class){</span>
<span class="fc" id="L854">            return (T) castToLong(obj);</span>
        }

<span class="fc bfc" id="L857" title="All 4 branches covered.">        if(clazz == float.class || clazz == Float.class){</span>
<span class="fc" id="L858">            return (T) castToFloat(obj);</span>
        }

<span class="fc bfc" id="L861" title="All 4 branches covered.">        if(clazz == double.class || clazz == Double.class){</span>
<span class="fc" id="L862">            return (T) castToDouble(obj);</span>
        }

<span class="fc bfc" id="L865" title="All 2 branches covered.">        if(clazz == String.class){</span>
<span class="fc" id="L866">            return (T) castToString(obj);</span>
        }

<span class="fc bfc" id="L869" title="All 2 branches covered.">        if(clazz == BigDecimal.class){</span>
<span class="fc" id="L870">            return (T) castToBigDecimal(obj);</span>
        }

<span class="fc bfc" id="L873" title="All 2 branches covered.">        if(clazz == BigInteger.class){</span>
<span class="fc" id="L874">            return (T) castToBigInteger(obj);</span>
        }

<span class="fc bfc" id="L877" title="All 2 branches covered.">        if(clazz == Date.class){</span>
<span class="fc" id="L878">            return (T) castToDate(obj);</span>
        }

<span class="fc bfc" id="L881" title="All 2 branches covered.">        if(clazz == java.sql.Date.class){</span>
<span class="fc" id="L882">            return (T) castToSqlDate(obj);</span>
        }

<span class="fc bfc" id="L885" title="All 2 branches covered.">        if(clazz == java.sql.Time.class){</span>
<span class="fc" id="L886">            return (T) castToSqlTime(obj);</span>
        }

<span class="fc bfc" id="L889" title="All 2 branches covered.">        if(clazz == java.sql.Timestamp.class){</span>
<span class="fc" id="L890">            return (T) castToTimestamp(obj);</span>
        }

<span class="fc bfc" id="L893" title="All 2 branches covered.">        if(clazz.isEnum()){</span>
<span class="fc" id="L894">            return (T) castToEnum(obj, clazz, config);</span>
        }

<span class="fc bfc" id="L897" title="All 2 branches covered.">        if(Calendar.class.isAssignableFrom(clazz)){</span>
<span class="fc" id="L898">            Date date = castToDate(obj);</span>
            Calendar calendar;
<span class="fc bfc" id="L900" title="All 2 branches covered.">            if(clazz == Calendar.class){</span>
<span class="fc" id="L901">                calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
            } else{
                try{
<span class="fc" id="L904">                    calendar = (Calendar) clazz.newInstance();</span>
<span class="fc" id="L905">                } catch(Exception e){</span>
<span class="fc" id="L906">                    throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), e);</span>
<span class="fc" id="L907">                }</span>
            }
<span class="fc" id="L909">            calendar.setTime(date);</span>
<span class="fc" id="L910">            return (T) calendar;</span>
        }

<span class="fc" id="L913">        String className = clazz.getName();</span>
<span class="fc bfc" id="L914" title="All 2 branches covered.">        if(className.equals(&quot;javax.xml.datatype.XMLGregorianCalendar&quot;)){</span>
<span class="fc" id="L915">            Date date = castToDate(obj);</span>
<span class="fc" id="L916">            Calendar calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L917">            calendar.setTime(date);</span>
<span class="fc" id="L918">            return (T) CalendarCodec.instance.createXMLGregorianCalendar(calendar);</span>
        }

<span class="fc bfc" id="L921" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L922">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L923" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L924" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L925" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L926">                return null;</span>
            }

<span class="fc bfc" id="L929" title="All 2 branches covered.">            if(clazz == java.util.Currency.class){</span>
<span class="fc" id="L930">                return (T) java.util.Currency.getInstance(strVal);</span>
            }

<span class="fc bfc" id="L933" title="All 2 branches covered.">            if(clazz == java.util.Locale.class){</span>
<span class="fc" id="L934">                return (T) toLocale(strVal);</span>
            }

<span class="fc bfc" id="L937" title="All 2 branches covered.">            if (className.startsWith(&quot;java.time.&quot;)) {</span>
<span class="fc" id="L938">                String json = JSON.toJSONString(strVal);</span>
<span class="fc" id="L939">                return JSON.parseObject(json, clazz);</span>
            }
        }

<span class="fc" id="L943">        final ObjectDeserializer objectDeserializer = config.getDeserializers().get(clazz);</span>
<span class="fc bfc" id="L944" title="All 2 branches covered.">        if (objectDeserializer != null) {</span>
<span class="fc" id="L945">            String str = JSON.toJSONString(obj);</span>
<span class="nc" id="L946">            return JSON.parseObject(str, clazz);</span>
        }
<span class="fc" id="L948">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    public static Locale toLocale(String strVal){
<span class="fc" id="L952">        String[] items = strVal.split(&quot;_&quot;);</span>
<span class="fc bfc" id="L953" title="All 2 branches covered.">        if(items.length == 1){</span>
<span class="fc" id="L954">            return new Locale(items[0]);</span>
        }
<span class="fc bfc" id="L956" title="All 2 branches covered.">        if(items.length == 2){</span>
<span class="fc" id="L957">            return new Locale(items[0], items[1]);</span>
        }
<span class="fc" id="L959">        return new Locale(items[0], items[1], items[2]);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T castToEnum(Object obj, Class&lt;T&gt; clazz, ParserConfig mapping){
        try{
<span class="fc bfc" id="L965" title="All 2 branches covered.">            if(obj instanceof String){</span>
<span class="fc" id="L966">                String name = (String) obj;</span>
<span class="fc bfc" id="L967" title="All 2 branches covered.">                if(name.length() == 0){</span>
<span class="fc" id="L968">                    return null;</span>
                }

<span class="fc bfc" id="L971" title="All 2 branches covered.">                if (mapping == null) {</span>
<span class="fc" id="L972">                    mapping = ParserConfig.getGlobalInstance();</span>
                }

<span class="fc" id="L975">                ObjectDeserializer derializer = mapping.getDeserializer(clazz);</span>
<span class="pc bpc" id="L976" title="1 of 2 branches missed.">                if (derializer instanceof EnumDeserializer) {</span>
<span class="fc" id="L977">                    EnumDeserializer enumDeserializer = (EnumDeserializer) derializer;</span>
<span class="fc" id="L978">                    return (T) enumDeserializer.getEnumByHashCode(TypeUtils.fnv1a_64(name));</span>
                }

<span class="nc" id="L981">                return (T) Enum.valueOf((Class&lt;? extends Enum&gt;) clazz, name);</span>
            }

<span class="fc bfc" id="L984" title="All 2 branches covered.">            if(obj instanceof BigDecimal){</span>
<span class="nc" id="L985">                int ordinal = intValue((BigDecimal) obj);</span>
<span class="nc" id="L986">                Object[] values = clazz.getEnumConstants();</span>
<span class="nc bnc" id="L987" title="All 2 branches missed.">                if(ordinal &lt; values.length){</span>
<span class="nc" id="L988">                    return (T) values[ordinal];</span>
                }
            }

<span class="fc bfc" id="L992" title="All 2 branches covered.">            if(obj instanceof Number){</span>
<span class="fc" id="L993">                int ordinal = ((Number) obj).intValue();</span>
<span class="fc" id="L994">                Object[] values = clazz.getEnumConstants();</span>
<span class="fc bfc" id="L995" title="All 2 branches covered.">                if(ordinal &lt; values.length){</span>
<span class="fc" id="L996">                    return (T) values[ordinal];</span>
                }
            }
<span class="fc" id="L999">        } catch(Exception ex){</span>
<span class="fc" id="L1000">            throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), ex);</span>
<span class="fc" id="L1001">        }</span>
<span class="fc" id="L1002">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping){
<span class="fc bfc" id="L1007" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc" id="L1008">            return null;</span>
        }
<span class="fc bfc" id="L1010" title="All 2 branches covered.">        if(type instanceof Class){</span>
<span class="fc" id="L1011">            return (T) cast(obj, (Class&lt;T&gt;) type, mapping);</span>
        }
<span class="fc bfc" id="L1013" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1014">            return (T) cast(obj, (ParameterizedType) type, mapping);</span>
        }
<span class="pc bpc" id="L1016" title="1 of 2 branches missed.">        if(obj instanceof String){</span>
<span class="fc" id="L1017">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1018" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L1019" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L1020" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L1021">                return null;</span>
            }
        }
<span class="fc bfc" id="L1024" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L1025">            return (T) obj;</span>
        }
<span class="fc" id="L1027">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping){
<span class="fc" id="L1032">        Type rawTye = type.getRawType();</span>
<span class="fc bfc" id="L1033" title="All 12 branches covered.">        if(rawTye == Set.class || rawTye == HashSet.class //</span>
                || rawTye == TreeSet.class //
                || rawTye == Collection.class //
                || rawTye == List.class //
                || rawTye == ArrayList.class){
<span class="fc" id="L1038">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1039" title="All 2 branches covered.">            if(obj instanceof Iterable){</span>
                Collection collection;
<span class="fc bfc" id="L1041" title="All 4 branches covered.">                if(rawTye == Set.class || rawTye == HashSet.class){</span>
<span class="fc" id="L1042">                    collection = new HashSet();</span>
<span class="fc bfc" id="L1043" title="All 2 branches covered.">                } else if(rawTye == TreeSet.class){</span>
<span class="fc" id="L1044">                    collection = new TreeSet();</span>
                } else{
<span class="fc" id="L1046">                    collection = new ArrayList();</span>
                }
<span class="fc bfc" id="L1048" title="All 2 branches covered.">                for(Iterator it = ((Iterable) obj).iterator(); it.hasNext(); ){</span>
<span class="fc" id="L1049">                    Object item = it.next();</span>
<span class="fc" id="L1050">                    collection.add(cast(item, itemType, mapping));</span>
<span class="fc" id="L1051">                }</span>
<span class="fc" id="L1052">                return (T) collection;</span>
            }
        }
<span class="fc bfc" id="L1055" title="All 4 branches covered.">        if(rawTye == Map.class || rawTye == HashMap.class){</span>
<span class="fc" id="L1056">            Type keyType = type.getActualTypeArguments()[0];</span>
<span class="fc" id="L1057">            Type valueType = type.getActualTypeArguments()[1];</span>
<span class="fc bfc" id="L1058" title="All 2 branches covered.">            if(obj instanceof Map){</span>
<span class="fc" id="L1059">                Map map = new HashMap();</span>
<span class="fc bfc" id="L1060" title="All 2 branches covered.">                for(Map.Entry entry : ((Map&lt;?,?&gt;) obj).entrySet()){</span>
<span class="fc" id="L1061">                    Object key = cast(entry.getKey(), keyType, mapping);</span>
<span class="fc" id="L1062">                    Object value = cast(entry.getValue(), valueType, mapping);</span>
<span class="fc" id="L1063">                    map.put(key, value);</span>
<span class="fc" id="L1064">                }</span>
<span class="fc" id="L1065">                return (T) map;</span>
            }
        }
<span class="fc bfc" id="L1068" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L1069">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L1070" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L1071">                return null;</span>
            }
        }
<span class="fc bfc" id="L1074" title="All 2 branches covered.">        if(type.getActualTypeArguments().length == 1){</span>
<span class="fc" id="L1075">            Type argType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1076" title="All 2 branches covered.">            if(argType instanceof WildcardType){</span>
<span class="fc" id="L1077">                return (T) cast(obj, rawTye, mapping);</span>
            }
        }

<span class="pc bpc" id="L1081" title="2 of 6 branches missed.">        if (rawTye == Map.Entry.class &amp;&amp; obj instanceof Map &amp;&amp; ((Map) obj).size() == 1) {</span>
<span class="fc" id="L1082">            Map.Entry entry = (Map.Entry) ((Map) obj).entrySet().iterator().next();</span>
<span class="fc" id="L1083">            return (T) entry;</span>
        }

<span class="pc bpc" id="L1086" title="1 of 2 branches missed.">        if (rawTye instanceof Class) {</span>
<span class="fc bfc" id="L1087" title="All 2 branches covered.">            if (mapping == null) {</span>
<span class="fc" id="L1088">                mapping = ParserConfig.global;</span>
            }
<span class="fc" id="L1090">            ObjectDeserializer deserializer = mapping.getDeserializer(rawTye);</span>
<span class="pc bpc" id="L1091" title="1 of 2 branches missed.">            if (deserializer != null) {</span>
<span class="fc" id="L1092">                String str = JSON.toJSONString(obj);</span>
<span class="fc" id="L1093">                DefaultJSONParser parser = new DefaultJSONParser(str, mapping);</span>
<span class="fc" id="L1094">                return (T) deserializer.deserialze(parser, type, null);</span>
            }
        }

<span class="nc" id="L1098">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;})
    public static &lt;T&gt; T castToJavaBean(Map&lt;String,Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config){
        try{
<span class="fc bfc" id="L1104" title="All 2 branches covered.">            if(clazz == StackTraceElement.class){</span>
<span class="fc" id="L1105">                String declaringClass = (String) map.get(&quot;className&quot;);</span>
<span class="fc" id="L1106">                String methodName = (String) map.get(&quot;methodName&quot;);</span>
<span class="fc" id="L1107">                String fileName = (String) map.get(&quot;fileName&quot;);</span>
                int lineNumber;
                {
<span class="fc" id="L1110">                    Number value = (Number) map.get(&quot;lineNumber&quot;);</span>
<span class="fc bfc" id="L1111" title="All 2 branches covered.">                    if(value == null) {</span>
<span class="fc" id="L1112">                        lineNumber = 0;</span>
<span class="fc bfc" id="L1113" title="All 2 branches covered.">                    } else if (value instanceof BigDecimal) {</span>
<span class="nc" id="L1114">                        lineNumber = ((BigDecimal) value).intValueExact();</span>
                    } else{
<span class="fc" id="L1116">                        lineNumber = value.intValue();</span>
                    }
                }
<span class="fc" id="L1119">                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</span>
            }

            {
<span class="fc" id="L1123">                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</span>
<span class="fc bfc" id="L1124" title="All 2 branches covered.">                if(iClassObject instanceof String){</span>
<span class="fc" id="L1125">                    String className = (String) iClassObject;</span>
                    Class&lt;?&gt; loadClazz;
<span class="fc bfc" id="L1127" title="All 2 branches covered.">                    if(config == null){</span>
<span class="fc" id="L1128">                        config = ParserConfig.global;</span>
                    }
<span class="fc" id="L1130">                    loadClazz = config.checkAutoType(className, null);</span>
<span class="pc bpc" id="L1131" title="1 of 2 branches missed.">                    if(loadClazz == null){</span>
<span class="nc" id="L1132">                        throw new ClassNotFoundException(className + &quot; not found&quot;);</span>
                    }
<span class="fc bfc" id="L1134" title="All 2 branches covered.">                    if(!loadClazz.equals(clazz)){</span>
<span class="fc" id="L1135">                        return (T) castToJavaBean(map, loadClazz, config);</span>
                    }
                }
            }

<span class="fc bfc" id="L1140" title="All 2 branches covered.">            if(clazz.isInterface()){</span>
                JSONObject object;
<span class="fc bfc" id="L1142" title="All 2 branches covered.">                if(map instanceof JSONObject){</span>
<span class="fc" id="L1143">                    object = (JSONObject) map;</span>
                } else{
<span class="fc" id="L1145">                    object = new JSONObject(map);</span>
                }
<span class="fc bfc" id="L1147" title="All 2 branches covered.">                if(config == null){</span>
<span class="fc" id="L1148">                    config = ParserConfig.getGlobalInstance();</span>
                }
<span class="fc" id="L1150">                ObjectDeserializer deserializer = config.getDeserializers().get(clazz);</span>
<span class="fc bfc" id="L1151" title="All 2 branches covered.">                if(deserializer != null){</span>
<span class="fc" id="L1152">                    String json = JSON.toJSONString(object);</span>
<span class="fc" id="L1153">                    return (T) JSON.parseObject(json, clazz);</span>
                }
<span class="fc" id="L1155">                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span>
                        new Class&lt;?&gt;[]{clazz}, object);
            }

<span class="fc bfc" id="L1159" title="All 2 branches covered.">            if(clazz == Locale.class){</span>
<span class="fc" id="L1160">                Object arg0 = map.get(&quot;language&quot;);</span>
<span class="fc" id="L1161">                Object arg1 = map.get(&quot;country&quot;);</span>
<span class="pc bpc" id="L1162" title="1 of 2 branches missed.">                if(arg0 instanceof String){</span>
<span class="fc" id="L1163">                    String language = (String) arg0;</span>
<span class="pc bpc" id="L1164" title="1 of 2 branches missed.">                    if(arg1 instanceof String){</span>
<span class="fc" id="L1165">                        String country = (String) arg1;</span>
<span class="fc" id="L1166">                        return (T) new Locale(language, country);</span>
<span class="nc bnc" id="L1167" title="All 2 branches missed.">                    } else if(arg1 == null){</span>
<span class="nc" id="L1168">                        return (T) new Locale(language);</span>
                    }
                }
            }

<span class="pc bpc" id="L1173" title="1 of 4 branches missed.">            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1174">                return (T) map.toString();</span>
            }

<span class="pc bpc" id="L1177" title="1 of 4 branches missed.">            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L1178">                JSONObject jsonObject = (JSONObject) map;</span>
<span class="fc" id="L1179">                Map innerMap = jsonObject.getInnerMap();</span>
<span class="pc bpc" id="L1180" title="1 of 2 branches missed.">                if (innerMap instanceof LinkedHashMap) {</span>
<span class="fc" id="L1181">                    return (T) innerMap;</span>
                } else {
<span class="nc" id="L1183">                    LinkedHashMap linkedHashMap = new LinkedHashMap();</span>
<span class="nc" id="L1184">                    linkedHashMap.putAll(innerMap);</span>
                }
            }

<span class="fc bfc" id="L1188" title="All 2 branches covered.">            if (config == null) {</span>
<span class="fc" id="L1189">                config = ParserConfig.getGlobalInstance();</span>
            }

<span class="fc" id="L1192">            JavaBeanDeserializer javaBeanDeser = null;</span>
<span class="fc" id="L1193">            ObjectDeserializer deserizer = config.getDeserializer(clazz);</span>
<span class="fc bfc" id="L1194" title="All 2 branches covered.">            if (deserizer instanceof JavaBeanDeserializer) {</span>
<span class="fc" id="L1195">                javaBeanDeser = (JavaBeanDeserializer) deserizer;</span>
            }

<span class="fc bfc" id="L1198" title="All 2 branches covered.">            if(javaBeanDeser == null){</span>
<span class="fc" id="L1199">                throw new JSONException(&quot;can not get javaBeanDeserializer. &quot; + clazz.getName());</span>
            }
<span class="fc" id="L1201">            return (T) javaBeanDeser.createInstance(map, config);</span>
<span class="fc" id="L1202">        } catch(Exception e){</span>
<span class="fc" id="L1203">            throw new JSONException(e.getMessage(), e);</span>
        }
    }

    private static void addBaseClassMappings(){
<span class="fc" id="L1208">        mappings.put(&quot;byte&quot;, byte.class);</span>
<span class="fc" id="L1209">        mappings.put(&quot;short&quot;, short.class);</span>
<span class="fc" id="L1210">        mappings.put(&quot;int&quot;, int.class);</span>
<span class="fc" id="L1211">        mappings.put(&quot;long&quot;, long.class);</span>
<span class="fc" id="L1212">        mappings.put(&quot;float&quot;, float.class);</span>
<span class="fc" id="L1213">        mappings.put(&quot;double&quot;, double.class);</span>
<span class="fc" id="L1214">        mappings.put(&quot;boolean&quot;, boolean.class);</span>
<span class="fc" id="L1215">        mappings.put(&quot;char&quot;, char.class);</span>
<span class="fc" id="L1216">        mappings.put(&quot;[byte&quot;, byte[].class);</span>
<span class="fc" id="L1217">        mappings.put(&quot;[short&quot;, short[].class);</span>
<span class="fc" id="L1218">        mappings.put(&quot;[int&quot;, int[].class);</span>
<span class="fc" id="L1219">        mappings.put(&quot;[long&quot;, long[].class);</span>
<span class="fc" id="L1220">        mappings.put(&quot;[float&quot;, float[].class);</span>
<span class="fc" id="L1221">        mappings.put(&quot;[double&quot;, double[].class);</span>
<span class="fc" id="L1222">        mappings.put(&quot;[boolean&quot;, boolean[].class);</span>
<span class="fc" id="L1223">        mappings.put(&quot;[char&quot;, char[].class);</span>
<span class="fc" id="L1224">        mappings.put(&quot;[B&quot;, byte[].class);</span>
<span class="fc" id="L1225">        mappings.put(&quot;[S&quot;, short[].class);</span>
<span class="fc" id="L1226">        mappings.put(&quot;[I&quot;, int[].class);</span>
<span class="fc" id="L1227">        mappings.put(&quot;[J&quot;, long[].class);</span>
<span class="fc" id="L1228">        mappings.put(&quot;[F&quot;, float[].class);</span>
<span class="fc" id="L1229">        mappings.put(&quot;[D&quot;, double[].class);</span>
<span class="fc" id="L1230">        mappings.put(&quot;[C&quot;, char[].class);</span>
<span class="fc" id="L1231">        mappings.put(&quot;[Z&quot;, boolean[].class);</span>
<span class="fc" id="L1232">        Class&lt;?&gt;[] classes = new Class[]{</span>
                Object.class,
                java.lang.Cloneable.class,
<span class="fc" id="L1235">                loadClass(&quot;java.lang.AutoCloseable&quot;),</span>
                java.lang.Exception.class,
                java.lang.RuntimeException.class,
                java.lang.IllegalAccessError.class,
                java.lang.IllegalAccessException.class,
                java.lang.IllegalArgumentException.class,
                java.lang.IllegalMonitorStateException.class,
                java.lang.IllegalStateException.class,
                java.lang.IllegalThreadStateException.class,
                java.lang.IndexOutOfBoundsException.class,
                java.lang.InstantiationError.class,
                java.lang.InstantiationException.class,
                java.lang.InternalError.class,
                java.lang.InterruptedException.class,
                java.lang.LinkageError.class,
                java.lang.NegativeArraySizeException.class,
                java.lang.NoClassDefFoundError.class,
                java.lang.NoSuchFieldError.class,
                java.lang.NoSuchFieldException.class,
                java.lang.NoSuchMethodError.class,
                java.lang.NoSuchMethodException.class,
                java.lang.NullPointerException.class,
                java.lang.NumberFormatException.class,
                java.lang.OutOfMemoryError.class,
                java.lang.SecurityException.class,
                java.lang.StackOverflowError.class,
                java.lang.StringIndexOutOfBoundsException.class,
                java.lang.TypeNotPresentException.class,
                java.lang.VerifyError.class,
                java.lang.StackTraceElement.class,
                java.util.HashMap.class,
                java.util.Hashtable.class,
                java.util.TreeMap.class,
                java.util.IdentityHashMap.class,
                java.util.WeakHashMap.class,
                java.util.LinkedHashMap.class,
                java.util.HashSet.class,
                java.util.LinkedHashSet.class,
                java.util.TreeSet.class,
                java.util.ArrayList.class,
                java.util.concurrent.TimeUnit.class,
                java.util.concurrent.ConcurrentHashMap.class,
<span class="fc" id="L1277">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListMap&quot;),</span>
<span class="fc" id="L1278">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListSet&quot;),</span>
                java.util.concurrent.atomic.AtomicInteger.class,
                java.util.concurrent.atomic.AtomicLong.class,
<span class="fc" id="L1281">                java.util.Collections.EMPTY_MAP.getClass(),</span>
                java.lang.Boolean.class,
                java.lang.Character.class,
                java.lang.Byte.class,
                java.lang.Short.class,
                java.lang.Integer.class,
                java.lang.Long.class,
                java.lang.Float.class,
                java.lang.Double.class,
                java.lang.Number.class,
                java.lang.String.class,
                java.math.BigDecimal.class,
                java.math.BigInteger.class,
                java.util.BitSet.class,
                java.util.Calendar.class,
                java.util.Date.class,
                java.util.Locale.class,
                java.util.UUID.class,
                java.sql.Time.class,
                java.sql.Date.class,
                java.sql.Timestamp.class,
                java.text.SimpleDateFormat.class,
                com.alibaba.fastjson.JSONObject.class,
                com.alibaba.fastjson.JSONPObject.class,
                com.alibaba.fastjson.JSONArray.class,
        };
<span class="fc bfc" id="L1307" title="All 2 branches covered.">        for(Class clazz : classes){</span>
<span class="pc bpc" id="L1308" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1309">                continue;</span>
            }
<span class="fc" id="L1311">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1313">        String[] awt = new String[]{</span>
                &quot;java.awt.Rectangle&quot;,
                &quot;java.awt.Point&quot;,
                &quot;java.awt.Font&quot;,
                &quot;java.awt.Color&quot;};
<span class="fc bfc" id="L1318" title="All 2 branches covered.">        for(String className : awt){</span>
<span class="fc" id="L1319">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1320" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1321">                break;</span>
            }
<span class="fc" id="L1323">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1325">        String[] spring = new String[]{</span>
                &quot;org.springframework.util.LinkedMultiValueMap&quot;,
                &quot;org.springframework.util.LinkedCaseInsensitiveMap&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocation&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocationResult&quot;,
                &quot;org.springframework.security.web.savedrequest.DefaultSavedRequest&quot;,
                &quot;org.springframework.security.web.savedrequest.SavedCookie&quot;,
                &quot;org.springframework.security.web.csrf.DefaultCsrfToken&quot;,
                &quot;org.springframework.security.web.authentication.WebAuthenticationDetails&quot;,
                &quot;org.springframework.security.core.context.SecurityContextImpl&quot;,
                &quot;org.springframework.security.authentication.UsernamePasswordAuthenticationToken&quot;,
                &quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,
                &quot;org.springframework.security.core.userdetails.User&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultExpiringOAuth2RefreshToken&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultOAuth2AccessToken&quot;,
                &quot;org.springframework.security.oauth2.common.DefaultOAuth2RefreshToken&quot;,
        };
<span class="fc bfc" id="L1342" title="All 2 branches covered.">        for(String className : spring){</span>
<span class="fc" id="L1343">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1344" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1345">                continue;</span>
            }
<span class="fc" id="L1347">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1349">    }</span>

    public static void clearClassMapping(){
<span class="fc" id="L1352">        mappings.clear();</span>
<span class="fc" id="L1353">        addBaseClassMappings();</span>
<span class="fc" id="L1354">    }</span>

    public static void addMapping(String className, Class&lt;?&gt; clazz) {
<span class="fc" id="L1357">        mappings.put(className, clazz);</span>
<span class="fc" id="L1358">    }</span>

    public static Class&lt;?&gt; loadClass(String className){
<span class="fc" id="L1361">        return loadClass(className, null);</span>
    }

    public static boolean isPath(Class&lt;?&gt; clazz){
<span class="pc bpc" id="L1365" title="1 of 4 branches missed.">        if(pathClass == null &amp;&amp; !pathClass_error){</span>
            try{
<span class="fc" id="L1367">                pathClass = Class.forName(&quot;java.nio.file.Path&quot;);</span>
<span class="nc" id="L1368">            } catch(Throwable ex){</span>
<span class="nc" id="L1369">                pathClass_error = true;</span>
<span class="fc" id="L1370">            }</span>
        }
<span class="pc bpc" id="L1372" title="1 of 2 branches missed.">        if(pathClass != null){</span>
<span class="fc" id="L1373">            return pathClass.isAssignableFrom(clazz);</span>
        }
<span class="nc" id="L1375">        return false;</span>
    }

    public static Class&lt;?&gt; getClassFromMapping(String className){
<span class="fc" id="L1379">        return mappings.get(className);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader) {
<span class="fc" id="L1383">        return loadClass(className, classLoader, false);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader, boolean cache) {
<span class="pc bpc" id="L1387" title="1 of 6 branches missed.">        if(className == null || className.length() == 0 || className.length() &gt; 128){</span>
<span class="fc" id="L1388">            return null;</span>
        }

<span class="fc" id="L1391">        Class&lt;?&gt; clazz = mappings.get(className);</span>
<span class="fc bfc" id="L1392" title="All 2 branches covered.">        if(clazz != null){</span>
<span class="fc" id="L1393">            return clazz;</span>
        }

<span class="fc bfc" id="L1396" title="All 2 branches covered.">        if(className.charAt(0) == '['){</span>
<span class="fc" id="L1397">            Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);</span>
<span class="fc" id="L1398">            return Array.newInstance(componentType, 0).getClass();</span>
        }

<span class="pc bpc" id="L1401" title="1 of 4 branches missed.">        if(className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)){</span>
<span class="fc" id="L1402">            String newClassName = className.substring(1, className.length() - 1);</span>
<span class="fc" id="L1403">            return loadClass(newClassName, classLoader);</span>
        }

        try{
<span class="fc bfc" id="L1407" title="All 2 branches covered.">            if(classLoader != null){</span>
<span class="fc" id="L1408">                clazz = classLoader.loadClass(className);</span>
<span class="pc bpc" id="L1409" title="1 of 2 branches missed.">                if (cache) {</span>
<span class="nc" id="L1410">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1412">                return clazz;</span>
            }
<span class="fc" id="L1414">        } catch(Throwable e){</span>
<span class="fc" id="L1415">            e.printStackTrace();</span>
            // skip
<span class="fc" id="L1417">        }</span>
        try{
<span class="fc" id="L1419">            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="pc bpc" id="L1420" title="1 of 4 branches missed.">            if(contextClassLoader != null &amp;&amp; contextClassLoader != classLoader){</span>
<span class="fc" id="L1421">                clazz = contextClassLoader.loadClass(className);</span>
<span class="fc bfc" id="L1422" title="All 2 branches covered.">                if (cache) {</span>
<span class="fc" id="L1423">                    mappings.put(className, clazz);</span>
                }
<span class="fc" id="L1425">                return clazz;</span>
            }
<span class="fc" id="L1427">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L1429">        }</span>
        try{
<span class="fc" id="L1431">            clazz = Class.forName(className);</span>
<span class="pc bpc" id="L1432" title="1 of 2 branches missed.">            if (cache) {</span>
<span class="nc" id="L1433">                mappings.put(className, clazz);</span>
            }
<span class="fc" id="L1435">            return clazz;</span>
<span class="fc" id="L1436">        } catch(Throwable e){</span>
            // skip
        }
<span class="fc" id="L1439">        return clazz;</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1445">        return buildBeanInfo(beanType, aliasMap, propertyNamingStrategy, false);</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy //
            , boolean fieldBased //
    ){
<span class="fc" id="L1453">        JSONType jsonType = TypeUtils.getAnnotation(beanType,JSONType.class);</span>
<span class="fc" id="L1454">        String[] orders = null;</span>
        final int features;
<span class="fc" id="L1456">        String typeName = null, typeKey = null;</span>
<span class="fc bfc" id="L1457" title="All 2 branches covered.">        if(jsonType != null){</span>
<span class="fc" id="L1458">            orders = jsonType.orders();</span>

<span class="fc" id="L1460">            typeName = jsonType.typeName();</span>
<span class="fc bfc" id="L1461" title="All 2 branches covered.">            if(typeName.length() == 0){</span>
<span class="fc" id="L1462">                typeName = null;</span>
            }

<span class="fc" id="L1465">            PropertyNamingStrategy jsonTypeNaming = jsonType.naming();</span>
<span class="fc bfc" id="L1466" title="All 2 branches covered.">            if (jsonTypeNaming != PropertyNamingStrategy.CamelCase) {</span>
<span class="fc" id="L1467">                propertyNamingStrategy = jsonTypeNaming;</span>
            }

<span class="fc" id="L1470">            features = SerializerFeature.of(jsonType.serialzeFeatures());</span>
<span class="fc" id="L1471">            for(Class&lt;?&gt; supperClass = beanType.getSuperclass()</span>
<span class="pc bpc" id="L1472" title="1 of 4 branches missed.">                ; supperClass != null &amp;&amp; supperClass != Object.class</span>
<span class="fc" id="L1473">                    ; supperClass = supperClass.getSuperclass()){</span>
<span class="fc" id="L1474">                JSONType superJsonType = TypeUtils.getAnnotation(supperClass,JSONType.class);</span>
<span class="fc bfc" id="L1475" title="All 2 branches covered.">                if(superJsonType == null){</span>
<span class="fc" id="L1476">                    break;</span>
                }
<span class="fc" id="L1478">                typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1479" title="1 of 2 branches missed.">                if(typeKey.length() != 0){</span>
<span class="nc" id="L1480">                    break;</span>
                }
            }

<span class="pc bfc" id="L1484" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : beanType.getInterfaces()){</span>
<span class="fc" id="L1485">                JSONType superJsonType = TypeUtils.getAnnotation(interfaceClass,JSONType.class);</span>
<span class="pc bpc" id="L1486" title="1 of 2 branches missed.">                if(superJsonType != null){</span>
<span class="fc" id="L1487">                    typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1488" title="1 of 2 branches missed.">                    if(typeKey.length() != 0){</span>
<span class="fc" id="L1489">                        break;</span>
                    }
                }
            }

<span class="fc bfc" id="L1494" title="All 4 branches covered.">            if(typeKey != null &amp;&amp; typeKey.length() == 0){</span>
<span class="fc" id="L1495">                typeKey = null;</span>
            }
<span class="fc" id="L1497">        } else{</span>
<span class="fc" id="L1498">            features = 0;</span>
        }
        // fieldName,field ，先生成fieldName的快照，减少之后的findField的轮询
<span class="fc" id="L1501">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1502">        ParserConfig.parserAllFieldToCache(beanType, fieldCacheMap);</span>
<span class="fc bfc" id="L1503" title="All 2 branches covered.">        List&lt;FieldInfo&gt; fieldInfoList = fieldBased</span>
<span class="fc" id="L1504">                ? computeGettersWithFieldBase(beanType, aliasMap, false, propertyNamingStrategy) //</span>
<span class="fc" id="L1505">                : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</span>
<span class="fc" id="L1506">        FieldInfo[] fields = new FieldInfo[fieldInfoList.size()];</span>
<span class="fc" id="L1507">        fieldInfoList.toArray(fields);</span>
        FieldInfo[] sortedFields;
        List&lt;FieldInfo&gt; sortedFieldList;
<span class="fc bfc" id="L1510" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length != 0){</span>
<span class="pc bpc" id="L1511" title="1 of 2 branches missed.">            sortedFieldList = fieldBased</span>
<span class="pc" id="L1512">                    ? computeGettersWithFieldBase(beanType, aliasMap, true, propertyNamingStrategy) //</span>
<span class="fc" id="L1513">                    : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, true, propertyNamingStrategy);</span>
        } else{
<span class="fc" id="L1515">            sortedFieldList = new ArrayList&lt;FieldInfo&gt;(fieldInfoList);</span>
<span class="fc" id="L1516">            Collections.sort(sortedFieldList);</span>
        }
<span class="fc" id="L1518">        sortedFields = new FieldInfo[sortedFieldList.size()];</span>
<span class="fc" id="L1519">        sortedFieldList.toArray(sortedFields);</span>
<span class="fc bfc" id="L1520" title="All 2 branches covered.">        if(Arrays.equals(sortedFields, fields)){</span>
<span class="fc" id="L1521">            sortedFields = fields;</span>
        }
<span class="fc" id="L1523">        return new SerializeBeanInfo(beanType, jsonType, typeName, typeKey, features, fields, sortedFields);</span>
    }

    public static List&lt;FieldInfo&gt; computeGettersWithFieldBase(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            boolean sorted, //
            PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1531">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc bfc" id="L1532" title="All 2 branches covered.">        for(Class&lt;?&gt; currentClass = clazz; currentClass != null; currentClass = currentClass.getSuperclass()){</span>
<span class="fc" id="L1533">            Field[] fields = currentClass.getDeclaredFields();</span>
<span class="fc" id="L1534">            computeFields(currentClass, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
        }
<span class="fc" id="L1536">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap){
<span class="fc" id="L1540">        return computeGetters(clazz, aliasMap, true);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap, boolean sorted){
<span class="fc" id="L1544">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc" id="L1545">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1546">        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</span>
<span class="fc" id="L1547">        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
                                                 JSONType jsonType, //
                                                 Map&lt;String,String&gt; aliasMap, //
                                                 Map&lt;String,Field&gt; fieldCacheMap, //
                                                 boolean sorted, //
                                                 PropertyNamingStrategy propertyNamingStrategy //
    ){
<span class="fc" id="L1557">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc" id="L1558">        boolean kotlin = TypeUtils.isKotlin(clazz);</span>
        // for kotlin
<span class="fc" id="L1560">        Constructor[] constructors = null;</span>
<span class="fc" id="L1561">        Annotation[][] paramAnnotationArrays = null;</span>
<span class="fc" id="L1562">        String[] paramNames = null;</span>
<span class="fc" id="L1563">        short[] paramNameMapping = null;</span>
<span class="fc" id="L1564">        Method[] methods = clazz.getMethods();</span>
<span class="fc bfc" id="L1565" title="All 2 branches covered.">        for(Method method : methods){</span>
<span class="fc" id="L1566">            String methodName = method.getName();</span>
<span class="fc" id="L1567">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1568">            String label = null;</span>
<span class="fc bfc" id="L1569" title="All 2 branches covered.">            if(Modifier.isStatic(method.getModifiers())){</span>
<span class="fc" id="L1570">                continue;</span>
            }
<span class="fc bfc" id="L1572" title="All 2 branches covered.">            if(method.getReturnType().equals(Void.TYPE)){</span>
<span class="fc" id="L1573">                continue;</span>
            }
<span class="fc bfc" id="L1575" title="All 2 branches covered.">            if(method.getParameterTypes().length != 0){</span>
<span class="fc" id="L1576">                continue;</span>
            }
<span class="fc bfc" id="L1578" title="All 2 branches covered.">            if(method.getReturnType() == ClassLoader.class){</span>
<span class="fc" id="L1579">                continue;</span>
            }

<span class="fc bfc" id="L1582" title="All 2 branches covered.">            if(methodName.equals(&quot;getMetaClass&quot;)</span>
<span class="pc bpc" id="L1583" title="1 of 2 branches missed.">                    &amp;&amp; method.getReturnType().getName().equals(&quot;groovy.lang.MetaClass&quot;)){</span>
<span class="fc" id="L1584">                continue;</span>
            }
<span class="fc bfc" id="L1586" title="All 2 branches covered.">            if(methodName.equals(&quot;getSuppressed&quot;)</span>
<span class="pc bpc" id="L1587" title="1 of 2 branches missed.">                    &amp;&amp; method.getDeclaringClass() == Throwable.class){</span>
<span class="fc" id="L1588">                continue;</span>
            }

<span class="fc bfc" id="L1591" title="All 4 branches covered.">            if(kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)){</span>
<span class="fc" id="L1592">                continue;</span>
            }
            /**
             *  如果在属性或者方法上存在JSONField注解，并且定制了name属性，不以类上的propertyNamingStrategy设置为准，以此字段的JSONField的name定制为准。
             */
<span class="fc" id="L1597">            Boolean fieldAnnotationAndNameExists = false;</span>
<span class="fc" id="L1598">            JSONField annotation = method.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1599" title="All 2 branches covered.">            if(annotation == null){</span>
<span class="fc" id="L1600">                annotation = getSuperMethodAnnotation(clazz, method);</span>
            }
<span class="fc bfc" id="L1602" title="All 4 branches covered.">            if(annotation == null &amp;&amp; kotlin){</span>
<span class="fc bfc" id="L1603" title="All 2 branches covered.">                if(constructors == null){</span>
<span class="fc" id="L1604">                    constructors = clazz.getDeclaredConstructors();</span>
<span class="fc" id="L1605">                    Constructor creatorConstructor = TypeUtils.getKoltinConstructor(constructors);</span>
<span class="pc bpc" id="L1606" title="1 of 2 branches missed.">                    if(creatorConstructor != null){</span>
<span class="fc" id="L1607">                        paramAnnotationArrays = creatorConstructor.getParameterAnnotations();</span>
<span class="fc" id="L1608">                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</span>
<span class="pc bpc" id="L1609" title="1 of 2 branches missed.">                        if(paramNames != null){</span>
<span class="fc" id="L1610">                            String[] paramNames_sorted = new String[paramNames.length];</span>
<span class="fc" id="L1611">                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</span>

<span class="fc" id="L1613">                            Arrays.sort(paramNames_sorted);</span>
<span class="fc" id="L1614">                            paramNameMapping = new short[paramNames.length];</span>
<span class="fc bfc" id="L1615" title="All 2 branches covered.">                            for(short p = 0; p &lt; paramNames.length; p++){</span>
<span class="fc" id="L1616">                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</span>
<span class="fc" id="L1617">                                paramNameMapping[index] = p;</span>
                            }
<span class="fc" id="L1619">                            paramNames = paramNames_sorted;</span>
                        }
                    }
                }
<span class="pc bpc" id="L1623" title="2 of 6 branches missed.">                if(paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc" id="L1624">                    String propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1625">                    int p = Arrays.binarySearch(paramNames, propertyName);</span>
<span class="fc bfc" id="L1626" title="All 2 branches covered.">                    if (p &lt; 0) {</span>
<span class="fc bfc" id="L1627" title="All 2 branches covered.">                        for (int i = 0; i &lt; paramNames.length; i++) {</span>
<span class="fc bfc" id="L1628" title="All 2 branches covered.">                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</span>
<span class="fc" id="L1629">                                p = i;</span>
<span class="fc" id="L1630">                                break;</span>
                            }
                        }
                    }
<span class="fc bfc" id="L1634" title="All 2 branches covered.">                    if(p &gt;= 0){</span>
<span class="fc" id="L1635">                        short index = paramNameMapping[p];</span>
<span class="fc" id="L1636">                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</span>
<span class="pc bpc" id="L1637" title="1 of 2 branches missed.">                        if(paramAnnotations != null){</span>
<span class="pc bfc" id="L1638" title="All 2 branches covered.">                            for(Annotation paramAnnotation : paramAnnotations){</span>
<span class="pc bpc" id="L1639" title="1 of 2 branches missed.">                                if(paramAnnotation instanceof JSONField){</span>
<span class="fc" id="L1640">                                    annotation = (JSONField) paramAnnotation;</span>
<span class="fc" id="L1641">                                    break;</span>
                                }
                            }
                        }
<span class="fc bfc" id="L1645" title="All 2 branches covered.">                        if(annotation == null){</span>
<span class="fc" id="L1646">                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1647" title="All 2 branches covered.">                            if(field != null){</span>
<span class="fc" id="L1648">                                annotation = field.getAnnotation(JSONField.class);</span>
                            }
                        }
                    }
                }
            }
<span class="fc bfc" id="L1654" title="All 2 branches covered.">            if(annotation != null){</span>
<span class="fc bfc" id="L1655" title="All 2 branches covered.">                if(!annotation.serialize()){</span>
<span class="fc" id="L1656">                    continue;</span>
                }
<span class="fc" id="L1658">                ordinal = annotation.ordinal();</span>
<span class="fc" id="L1659">                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span>
<span class="fc" id="L1660">                parserFeatures = Feature.of(annotation.parseFeatures());</span>
<span class="fc bfc" id="L1661" title="All 2 branches covered.">                if(annotation.name().length() != 0){</span>
<span class="fc" id="L1662">                    String propertyName = annotation.name();</span>
<span class="fc bfc" id="L1663" title="All 2 branches covered.">                    if(aliasMap != null){</span>
<span class="fc" id="L1664">                        propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1665" title="1 of 2 branches missed.">                        if(propertyName == null){</span>
<span class="fc" id="L1666">                            continue;</span>
                        }
                    }
<span class="fc" id="L1669">                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</span>
                            serialzeFeatures, parserFeatures, annotation, null, label);
<span class="fc" id="L1671">                    fieldInfoMap.put(propertyName, fieldInfo);</span>
<span class="fc" id="L1672">                    continue;</span>
                }
<span class="fc bfc" id="L1674" title="All 2 branches covered.">                if(annotation.label().length() != 0){</span>
<span class="fc" id="L1675">                    label = annotation.label();</span>
                }
            }
<span class="fc bfc" id="L1678" title="All 2 branches covered.">            if(methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc bfc" id="L1679" title="All 2 branches covered.">                if(methodName.length() &lt; 4){</span>
<span class="fc" id="L1680">                    continue;</span>
                }
<span class="fc bfc" id="L1682" title="All 2 branches covered.">                if(methodName.equals(&quot;getClass&quot;)){</span>
<span class="fc" id="L1683">                    continue;</span>
                }
<span class="fc bfc" id="L1685" title="All 4 branches covered.">                if(methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()){</span>
<span class="fc" id="L1686">                    continue;</span>
                }
<span class="fc" id="L1688">                char c3 = methodName.charAt(3);</span>
                String propertyName;
<span class="fc bfc" id="L1690" title="All 4 branches covered.">                if(Character.isUpperCase(c3) //</span>
                        || c3 &gt; 512 // for unicode method name
                        ){
<span class="fc bfc" id="L1693" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1694">                        propertyName = decapitalize(methodName.substring(3));</span>
                    } else{
<span class="fc" id="L1696">                        propertyName = Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</span>
                    }
<span class="fc" id="L1698">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</span>
<span class="fc bfc" id="L1699" title="All 2 branches covered.">                } else if(c3 == '_'){</span>
<span class="fc" id="L1700">                    propertyName = methodName.substring(4);</span>
<span class="fc bfc" id="L1701" title="All 2 branches covered.">                } else if(c3 == 'f'){</span>
<span class="fc" id="L1702">                    propertyName = methodName.substring(3);</span>
<span class="pc bpc" id="L1703" title="1 of 4 branches missed.">                } else if(methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))){</span>
<span class="fc" id="L1704">                    propertyName = decapitalize(methodName.substring(3));</span>
                } else{
                    continue;
                }
<span class="fc" id="L1708">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1709" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1710">                    continue;</span>
                }
                //假如bean的field很多的情况一下，轮询时将大大降低效率
<span class="fc" id="L1713">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1714" title="All 4 branches covered.">                if(field == null &amp;&amp; propertyName.length() &gt; 1){</span>
<span class="fc" id="L1715">                    char ch = propertyName.charAt(1);</span>
<span class="fc bfc" id="L1716" title="All 4 branches covered.">                    if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L1717">                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1718">                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</span>
                    }
                }
<span class="fc" id="L1721">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1722" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1723">                    fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1724" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1725" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1726">                            continue;</span>
                        }
<span class="fc" id="L1728">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1729">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1730">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1731" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1732">                            fieldAnnotationAndNameExists = true;</span>
<span class="fc" id="L1733">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1734" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1735">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1736" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1737">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1741" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1742">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1746" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1747">                    propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L1748" title="All 2 branches covered.">                    if(propertyName == null){</span>
<span class="fc" id="L1749">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L1752" title="All 4 branches covered.">                if(propertyNamingStrategy != null &amp;&amp; !fieldAnnotationAndNameExists){</span>
<span class="fc" id="L1753">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
<span class="fc" id="L1755">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L1757">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
<span class="fc bfc" id="L1759" title="All 2 branches covered.">            if(methodName.startsWith(&quot;is&quot;)){</span>
<span class="fc bfc" id="L1760" title="All 2 branches covered.">                if(methodName.length() &lt; 3){</span>
<span class="fc" id="L1761">                    continue;</span>
                }
<span class="fc bfc" id="L1763" title="All 2 branches covered.">                if(method.getReturnType() != Boolean.TYPE</span>
<span class="fc bfc" id="L1764" title="All 2 branches covered.">                        &amp;&amp; method.getReturnType() != Boolean.class){</span>
<span class="fc" id="L1765">                    continue;</span>
                }
<span class="fc" id="L1767">                char c2 = methodName.charAt(2);</span>
                String propertyName;
<span class="fc bfc" id="L1769" title="All 2 branches covered.">                if(Character.isUpperCase(c2)){</span>
<span class="fc bfc" id="L1770" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1771">                        propertyName = decapitalize(methodName.substring(2));</span>
                    } else{
<span class="fc" id="L1773">                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</span>
                    }
<span class="fc" id="L1775">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</span>
<span class="fc bfc" id="L1776" title="All 2 branches covered.">                } else if(c2 == '_'){</span>
<span class="fc" id="L1777">                    propertyName = methodName.substring(3);</span>
<span class="fc bfc" id="L1778" title="All 2 branches covered.">                } else if(c2 == 'f'){</span>
<span class="fc" id="L1779">                    propertyName = methodName.substring(2);</span>
                } else{
                    continue;
                }
<span class="fc" id="L1783">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1784" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1785">                    continue;</span>
                }
<span class="fc" id="L1787">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1788" title="All 2 branches covered.">                if(field == null){</span>
<span class="fc" id="L1789">                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</span>
                }
<span class="fc" id="L1791">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1792" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1793">                    fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1794" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1795" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1796">                            continue;</span>
                        }
<span class="fc" id="L1798">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1799">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1800">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1801" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1802">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1803" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1804">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1805" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1806">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1810" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1811">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1815" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1816">                    propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1817" title="1 of 2 branches missed.">                    if(propertyName == null){</span>
<span class="fc" id="L1818">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L1821" title="All 2 branches covered.">                if(propertyNamingStrategy != null){</span>
<span class="fc" id="L1822">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
                //优先选择get
<span class="fc bfc" id="L1825" title="All 2 branches covered.">                if(fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L1826">                    continue;</span>
                }
<span class="fc" id="L1828">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L1830">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L1833">        Field[] fields = clazz.getFields();</span>
<span class="fc" id="L1834">        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
<span class="fc" id="L1835">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String,FieldInfo&gt; fieldInfoMap){
<span class="fc" id="L1839">        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</span>
<span class="fc" id="L1840">        String[] orders = null;</span>
<span class="fc" id="L1841">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L1842" title="All 2 branches covered.">        if(annotation != null){</span>
<span class="fc" id="L1843">            orders = annotation.orders();</span>
        }
<span class="fc bfc" id="L1845" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length &gt; 0){</span>
<span class="fc" id="L1846">            LinkedHashMap&lt;String,FieldInfo&gt; map = new LinkedHashMap&lt;String,FieldInfo&gt;(fieldInfoList.size());</span>
<span class="fc bfc" id="L1847" title="All 2 branches covered.">            for(FieldInfo field : fieldInfoMap.values()){</span>
<span class="fc" id="L1848">                map.put(field.name, field);</span>
<span class="fc" id="L1849">            }</span>
<span class="fc" id="L1850">            int i = 0;</span>
<span class="fc bfc" id="L1851" title="All 2 branches covered.">            for(String item : orders){</span>
<span class="fc" id="L1852">                FieldInfo field = map.get(item);</span>
<span class="fc bfc" id="L1853" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1854">                    fieldInfoList.add(field);</span>
<span class="fc" id="L1855">                    map.remove(item);</span>
                }
            }
<span class="fc bfc" id="L1858" title="All 2 branches covered.">            for(FieldInfo field : map.values()){</span>
<span class="fc" id="L1859">                fieldInfoList.add(field);</span>
<span class="fc" id="L1860">            }</span>
<span class="fc" id="L1861">        } else{</span>
<span class="fc bfc" id="L1862" title="All 2 branches covered.">            for(FieldInfo fieldInfo : fieldInfoMap.values()){</span>
<span class="fc" id="L1863">                fieldInfoList.add(fieldInfo);</span>
<span class="fc" id="L1864">            }</span>
<span class="fc bfc" id="L1865" title="All 2 branches covered.">            if(sorted){</span>
<span class="fc" id="L1866">                Collections.sort(fieldInfoList);</span>
            }
        }
<span class="fc" id="L1869">        return fieldInfoList;</span>
    }

    private static void computeFields(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            PropertyNamingStrategy propertyNamingStrategy, //
            Map&lt;String,FieldInfo&gt; fieldInfoMap, //
            Field[] fields){
<span class="fc bfc" id="L1878" title="All 2 branches covered.">        for(Field field : fields){</span>
<span class="fc bfc" id="L1879" title="All 2 branches covered.">            if(Modifier.isStatic(field.getModifiers())){</span>
<span class="fc" id="L1880">                continue;</span>
            }
<span class="fc" id="L1882">            JSONField fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc" id="L1883">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1884">            String propertyName = field.getName();</span>
<span class="fc" id="L1885">            String label = null;</span>
<span class="fc bfc" id="L1886" title="All 2 branches covered.">            if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1887" title="All 2 branches covered.">                if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1888">                    continue;</span>
                }
<span class="fc" id="L1890">                ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1891">                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1892">                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1893" title="All 2 branches covered.">                if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1894">                    propertyName = fieldAnnotation.name();</span>
                }
<span class="pc bpc" id="L1896" title="1 of 2 branches missed.">                if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1897">                    label = fieldAnnotation.label();</span>
                }
            }
<span class="fc bfc" id="L1900" title="All 2 branches covered.">            if(aliasMap != null){</span>
<span class="fc" id="L1901">                propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L1902" title="All 2 branches covered.">                if(propertyName == null){</span>
<span class="fc" id="L1903">                    continue;</span>
                }
            }
<span class="fc bfc" id="L1906" title="All 2 branches covered.">            if(propertyNamingStrategy != null){</span>
<span class="fc" id="L1907">                propertyName = propertyNamingStrategy.translate(propertyName);</span>
            }
<span class="fc bfc" id="L1909" title="All 2 branches covered.">            if(!fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L1910">                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        null, fieldAnnotation, label);
<span class="fc" id="L1912">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L1915">    }</span>

    private static String getPropertyNameByCompatibleFieldName(Map&lt;String,Field&gt; fieldCacheMap, String methodName,
                                                               String propertyName, int fromIdx){
<span class="pc bpc" id="L1919" title="1 of 2 branches missed.">        if(compatibleWithFieldName){</span>
<span class="nc bnc" id="L1920" title="All 2 branches missed.">            if(!fieldCacheMap.containsKey(propertyName)){</span>
<span class="nc" id="L1921">                String tempPropertyName = methodName.substring(fromIdx);</span>
<span class="nc bnc" id="L1922" title="All 2 branches missed.">                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</span>
            }
        }
<span class="fc" id="L1925">        return propertyName;</span>
    }

    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method){
<span class="fc" id="L1929">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="fc bfc" id="L1930" title="All 2 branches covered.">        if(interfaces.length &gt; 0){</span>
<span class="fc" id="L1931">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L1932" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : interfaces){</span>
<span class="fc bfc" id="L1933" title="All 2 branches covered.">                for(Method interfaceMethod : interfaceClass.getMethods()){</span>
<span class="fc" id="L1934">                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L1935" title="All 2 branches covered.">                    if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L1936">                        continue;</span>
                    }
<span class="fc bfc" id="L1938" title="All 2 branches covered.">                    if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L1939">                        continue;</span>
                    }
<span class="fc" id="L1941">                    boolean match = true;</span>
<span class="fc bfc" id="L1942" title="All 2 branches covered.">                    for(int i = 0; i &lt; types.length; ++i){</span>
<span class="fc bfc" id="L1943" title="All 2 branches covered.">                        if(!interfaceTypes[i].equals(types[i])){</span>
<span class="fc" id="L1944">                            match = false;</span>
<span class="fc" id="L1945">                            break;</span>
                        }
                    }
<span class="fc bfc" id="L1948" title="All 2 branches covered.">                    if(!match){</span>
<span class="fc" id="L1949">                        continue;</span>
                    }
<span class="fc" id="L1951">                    JSONField annotation = interfaceMethod.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1952" title="All 2 branches covered.">                    if(annotation != null){</span>
<span class="fc" id="L1953">                        return annotation;</span>
                    }
                }
            }
        }
<span class="fc" id="L1958">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L1959" title="All 2 branches covered.">        if(superClass == null){</span>
<span class="fc" id="L1960">            return null;</span>
        }
<span class="fc bfc" id="L1962" title="All 2 branches covered.">        if(Modifier.isAbstract(superClass.getModifiers())){</span>
<span class="fc" id="L1963">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L1964" title="All 2 branches covered.">            for(Method interfaceMethod : superClass.getMethods()){</span>
<span class="fc" id="L1965">                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L1966" title="All 2 branches covered.">                if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L1967">                    continue;</span>
                }
<span class="fc bfc" id="L1969" title="All 2 branches covered.">                if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L1970">                    continue;</span>
                }
<span class="fc" id="L1972">                boolean match = true;</span>
<span class="fc bfc" id="L1973" title="All 2 branches covered.">                for(int i = 0; i &lt; types.length; ++i){</span>
<span class="pc bpc" id="L1974" title="1 of 2 branches missed.">                    if(!interfaceTypes[i].equals(types[i])){</span>
<span class="nc" id="L1975">                        match = false;</span>
<span class="nc" id="L1976">                        break;</span>
                    }
                }
<span class="pc bpc" id="L1979" title="1 of 2 branches missed.">                if(!match){</span>
<span class="nc" id="L1980">                    continue;</span>
                }
<span class="fc" id="L1982">                JSONField annotation = interfaceMethod.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1983" title="All 2 branches covered.">                if(annotation != null){</span>
<span class="fc" id="L1984">                    return annotation;</span>
                }
            }
        }
<span class="fc" id="L1988">        return null;</span>
    }

    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName){
<span class="fc" id="L1992">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L1993" title="All 2 branches covered.">        if(jsonType != null){</span>
            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<span class="fc" id="L1997">            String[] fields = jsonType.includes();</span>
<span class="pc bpc" id="L1998" title="1 of 2 branches missed.">            if(fields.length &gt; 0){</span>
<span class="nc bnc" id="L1999" title="All 2 branches missed.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="nc bnc" id="L2000" title="All 2 branches missed.">                    if(propertyName.equals(fields[i])){</span>
<span class="nc" id="L2001">                        return false;</span>
                    }
                }
<span class="nc" id="L2004">                return true;</span>
            } else{
<span class="fc" id="L2006">                fields = jsonType.ignores();</span>
<span class="fc bfc" id="L2007" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L2008" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L2009">                        return true;</span>
                    }
                }
            }
        }
<span class="fc bfc" id="L2014" title="All 4 branches covered.">        if(clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null){</span>
<span class="fc bfc" id="L2015" title="All 2 branches covered.">            if(isJSONTypeIgnore(clazz.getSuperclass(), propertyName)){</span>
<span class="fc" id="L2016">                return true;</span>
            }
        }
<span class="fc" id="L2019">        return false;</span>
    }

    public static boolean isGenericParamType(Type type){
<span class="fc bfc" id="L2023" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2024">            return true;</span>
        }
<span class="fc bfc" id="L2026" title="All 2 branches covered.">        if(type instanceof Class) {</span>
<span class="fc" id="L2027">            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</span>
<span class="fc bfc" id="L2028" title="All 4 branches covered.">            return superType != Object.class &amp;&amp; isGenericParamType(superType);</span>
        }
<span class="fc" id="L2030">        return false;</span>
    }

    public static Type getGenericParamType(Type type){
<span class="fc bfc" id="L2034" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2035">            return type;</span>
        }
<span class="pc bpc" id="L2037" title="1 of 2 branches missed.">        if(type instanceof Class){</span>
<span class="fc" id="L2038">            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</span>
        }
<span class="nc" id="L2040">        return type;</span>
    }

    public static Type unwrapOptional(Type type){
<span class="fc bfc" id="L2044" title="All 2 branches covered.">        if(!optionalClassInited){</span>
            try{
<span class="fc" id="L2046">                optionalClass = Class.forName(&quot;java.util.Optional&quot;);</span>
<span class="nc" id="L2047">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2050">                optionalClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2053" title="1 of 2 branches missed.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2054">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>
<span class="pc bpc" id="L2055" title="1 of 2 branches missed.">            if(parameterizedType.getRawType() == optionalClass){</span>
<span class="fc" id="L2056">                return parameterizedType.getActualTypeArguments()[0];</span>
            }
        }
<span class="nc" id="L2059">        return type;</span>
    }

    public static Class&lt;?&gt; getClass(Type type){
<span class="fc bfc" id="L2063" title="All 2 branches covered.">        if(type.getClass() == Class.class){</span>
<span class="fc" id="L2064">            return (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L2067" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2068">            return getClass(((ParameterizedType) type).getRawType());</span>
        }

<span class="fc bfc" id="L2071" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L2072">            Type boundType = ((TypeVariable&lt;?&gt;) type).getBounds()[0];</span>
<span class="pc bpc" id="L2073" title="1 of 2 branches missed.">            if (boundType instanceof Class) {</span>
<span class="fc" id="L2074">                return (Class) boundType;</span>
            }
<span class="nc" id="L2076">            return getClass(boundType);</span>
        }

<span class="pc bpc" id="L2079" title="1 of 2 branches missed.">        if(type instanceof WildcardType){</span>
<span class="fc" id="L2080">            Type[] upperBounds = ((WildcardType) type).getUpperBounds();</span>
<span class="pc bpc" id="L2081" title="1 of 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="fc" id="L2082">                return getClass(upperBounds[0]);</span>
            }
        }

<span class="nc" id="L2086">        return Object.class;</span>
    }

    public static Field getField(Class&lt;?&gt; clazz, String fieldName, Field[] declaredFields){
<span class="fc bfc" id="L2090" title="All 2 branches covered.">        for(Field field : declaredFields){</span>
<span class="fc" id="L2091">            String itemName = field.getName();</span>
<span class="fc bfc" id="L2092" title="All 2 branches covered.">            if(fieldName.equals(itemName)){</span>
<span class="fc" id="L2093">                return field;</span>
            }

            char c0, c1;
<span class="fc bfc" id="L2097" title="All 2 branches covered.">            if (fieldName.length() &gt; 2</span>
<span class="fc bfc" id="L2098" title="All 4 branches covered.">                    &amp;&amp; (c0 = fieldName.charAt(0)) &gt;= 'a' &amp;&amp; c0 &lt;= 'z'</span>
<span class="fc bfc" id="L2099" title="All 4 branches covered.">                    &amp;&amp; (c1 = fieldName.charAt(1)) &gt;= 'A' &amp;&amp; c1 &lt;= 'Z'</span>
<span class="fc bfc" id="L2100" title="All 2 branches covered.">                    &amp;&amp; fieldName.equalsIgnoreCase(itemName)) {</span>
<span class="fc" id="L2101">                return field;</span>
            }
        }
<span class="fc" id="L2104">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L2105" title="All 4 branches covered.">        if(superClass != null &amp;&amp; superClass != Object.class){</span>
<span class="fc" id="L2106">            return getField(superClass, fieldName, superClass.getDeclaredFields());</span>
        }
<span class="fc" id="L2108">        return null;</span>
    }

    /**
     * @deprecated
     */
    public static int getSerializeFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2115">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2116" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2117">            return 0;</span>
        }
<span class="fc" id="L2119">        return SerializerFeature.of(annotation.serialzeFeatures());</span>
    }

    public static int getParserFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L2123">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L2124" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L2125">            return 0;</span>
        }
<span class="fc" id="L2127">        return Feature.of(annotation.parseFeatures());</span>
    }

    public static String decapitalize(String name){
<span class="pc bpc" id="L2131" title="2 of 4 branches missed.">        if(name == null || name.length() == 0){</span>
<span class="nc" id="L2132">            return name;</span>
        }
<span class="fc bfc" id="L2134" title="All 6 branches covered.">        if(name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))){</span>
<span class="fc" id="L2135">            return name;</span>
        }
<span class="fc" id="L2137">        char chars[] = name.toCharArray();</span>
<span class="fc" id="L2138">        chars[0] = Character.toLowerCase(chars[0]);</span>
<span class="fc" id="L2139">        return new String(chars);</span>
    }

    static void setAccessible(AccessibleObject obj){
<span class="pc bpc" id="L2143" title="1 of 2 branches missed.">        if(!setAccessibleEnable){</span>
<span class="nc" id="L2144">            return;</span>
        }
<span class="fc bfc" id="L2146" title="All 2 branches covered.">        if(obj.isAccessible()){</span>
<span class="fc" id="L2147">            return;</span>
        }
        try{
<span class="fc" id="L2150">            obj.setAccessible(true);</span>
<span class="nc" id="L2151">        } catch(AccessControlException error){</span>
<span class="nc" id="L2152">            setAccessibleEnable = false;</span>
<span class="fc" id="L2153">        }</span>
<span class="fc" id="L2154">    }</span>

    public static Type getCollectionItemType(Type fieldType) {
<span class="fc bfc" id="L2157" title="All 2 branches covered.">        if (fieldType instanceof ParameterizedType) {</span>
<span class="fc" id="L2158">            return getCollectionItemType((ParameterizedType) fieldType);</span>
        }
<span class="fc bfc" id="L2160" title="All 2 branches covered.">        if (fieldType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2161">            return getCollectionItemType((Class&lt;?&gt;) fieldType);</span>
        }
<span class="fc" id="L2163">        return Object.class;</span>
    }

    private static Type getCollectionItemType(Class&lt;?&gt; clazz) {
<span class="fc bfc" id="L2167" title="All 2 branches covered.">        return clazz.getName().startsWith(&quot;java.&quot;)</span>
                ? Object.class
<span class="fc" id="L2169">                : getCollectionItemType(getCollectionSuperType(clazz));</span>
    }

    private static Type getCollectionItemType(ParameterizedType parameterizedType) {
<span class="fc" id="L2173">        Type rawType = parameterizedType.getRawType();</span>
<span class="fc" id="L2174">        Type[] actualTypeArguments = parameterizedType.getActualTypeArguments();</span>
<span class="fc bfc" id="L2175" title="All 2 branches covered.">        if (rawType == Collection.class) {</span>
<span class="fc" id="L2176">            return getWildcardTypeUpperBounds(actualTypeArguments[0]);</span>
        }
<span class="fc" id="L2178">        Class&lt;?&gt; rawClass = (Class&lt;?&gt;) rawType;</span>
<span class="fc" id="L2179">        Map&lt;TypeVariable, Type&gt; typeParameterMap = createTypeParameterMap(rawClass.getTypeParameters(), actualTypeArguments);</span>
<span class="fc" id="L2180">        Type superType = getCollectionSuperType(rawClass);</span>
<span class="pc bpc" id="L2181" title="1 of 2 branches missed.">        if (superType instanceof ParameterizedType) {</span>
<span class="fc" id="L2182">            Class&lt;?&gt; superClass = getRawClass(superType);</span>
<span class="fc" id="L2183">            Type[] superClassTypeParameters = ((ParameterizedType) superType).getActualTypeArguments();</span>
<span class="pc bpc" id="L2184" title="1 of 2 branches missed.">            return superClassTypeParameters.length &gt; 0</span>
<span class="pc" id="L2185">                    ? getCollectionItemType(makeParameterizedType(superClass, superClassTypeParameters, typeParameterMap))</span>
<span class="nc" id="L2186">                    : getCollectionItemType(superClass);</span>
        }
<span class="nc" id="L2188">        return getCollectionItemType((Class&lt;?&gt;) superType);</span>
    }

    private static Type getCollectionSuperType(Class&lt;?&gt; clazz) {
<span class="fc" id="L2192">        Type assignable = null;</span>
<span class="fc bfc" id="L2193" title="All 2 branches covered.">        for (Type type : clazz.getGenericInterfaces()) {</span>
<span class="fc" id="L2194">            Class&lt;?&gt; rawClass = getRawClass(type);</span>
<span class="fc bfc" id="L2195" title="All 2 branches covered.">            if (rawClass == Collection.class) {</span>
<span class="fc" id="L2196">                return type;</span>
            }
<span class="fc bfc" id="L2198" title="All 2 branches covered.">            if (Collection.class.isAssignableFrom(rawClass)) {</span>
<span class="fc" id="L2199">                assignable = type;</span>
            }
        }
<span class="fc bfc" id="L2202" title="All 2 branches covered.">        return assignable == null ? clazz.getGenericSuperclass() : assignable;</span>
    }

    private static Map&lt;TypeVariable, Type&gt; createTypeParameterMap(TypeVariable[] typeParameters, Type[] actualTypeArguments) {
<span class="fc" id="L2206">        int length = typeParameters.length;</span>
<span class="fc" id="L2207">        Map&lt;TypeVariable, Type&gt; typeParameterMap = new HashMap&lt;TypeVariable, Type&gt;(length);</span>
<span class="fc bfc" id="L2208" title="All 2 branches covered.">        for (int i = 0; i &lt; length; i++) {</span>
<span class="fc" id="L2209">            typeParameterMap.put(typeParameters[i], actualTypeArguments[i]);</span>
        }
<span class="fc" id="L2211">        return typeParameterMap;</span>
    }

    private static ParameterizedType makeParameterizedType(Class&lt;?&gt; rawClass, Type[] typeParameters, Map&lt;TypeVariable, Type&gt; typeParameterMap) {
<span class="fc" id="L2215">        int length = typeParameters.length;</span>
<span class="fc" id="L2216">        Type[] actualTypeArguments = new Type[length];</span>
<span class="fc" id="L2217">        System.arraycopy(typeParameters, 0, actualTypeArguments, 0, length);</span>
<span class="fc bfc" id="L2218" title="All 2 branches covered.">        for (int i = 0; i &lt; actualTypeArguments.length; i++) {</span>
<span class="fc" id="L2219">            Type actualTypeArgument = actualTypeArguments[i];</span>
<span class="pc bpc" id="L2220" title="1 of 2 branches missed.">            if (actualTypeArgument instanceof TypeVariable) {</span>
<span class="fc" id="L2221">                actualTypeArguments[i] = typeParameterMap.get(actualTypeArgument);</span>
            }
        }
<span class="fc" id="L2224">        return new ParameterizedTypeImpl(actualTypeArguments, null, rawClass);</span>
    }

    private static Type getWildcardTypeUpperBounds(Type type) {
<span class="fc bfc" id="L2228" title="All 2 branches covered.">        if (type instanceof WildcardType) {</span>
<span class="fc" id="L2229">            WildcardType wildcardType = (WildcardType) type;</span>
<span class="fc" id="L2230">            Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2231" title="1 of 2 branches missed.">            return upperBounds.length &gt; 0 ? upperBounds[0] : Object.class;</span>
        }
<span class="fc" id="L2233">        return type;</span>
    }

    public static Class&lt;?&gt; getCollectionItemClass(Type fieldType){
<span class="fc bfc" id="L2237" title="All 2 branches covered.">        if(fieldType instanceof ParameterizedType){</span>
            Class&lt;?&gt; itemClass;
<span class="fc" id="L2239">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L2240" title="All 2 branches covered.">            if(actualTypeArgument instanceof WildcardType){</span>
<span class="fc" id="L2241">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L2242">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L2243" title="1 of 2 branches missed.">                if(upperBounds.length == 1){</span>
<span class="fc" id="L2244">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc bfc" id="L2247" title="All 2 branches covered.">            if(actualTypeArgument instanceof Class){</span>
<span class="fc" id="L2248">                itemClass = (Class&lt;?&gt;) actualTypeArgument;</span>
<span class="fc bfc" id="L2249" title="All 2 branches covered.">                if(!Modifier.isPublic(itemClass.getModifiers())){</span>
<span class="fc" id="L2250">                    throw new JSONException(&quot;can not create ASMParser&quot;);</span>
                }
            } else{
<span class="fc" id="L2253">                throw new JSONException(&quot;can not create ASMParser&quot;);</span>
            }
<span class="fc" id="L2255">            return itemClass;</span>
        }
<span class="fc" id="L2257">        return Object.class;</span>
    }

    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<span class="fc" id="L2261">        Type clz = genericArrayType;</span>
<span class="fc" id="L2262">        Type genericComponentType  = genericArrayType.getGenericComponentType();</span>

<span class="fc" id="L2264">        String prefix = &quot;[&quot;;</span>
<span class="pc bpc" id="L2265" title="1 of 2 branches missed.">        while (genericComponentType instanceof GenericArrayType) {</span>
<span class="nc" id="L2266">            genericComponentType = ((GenericArrayType) genericComponentType)</span>
<span class="nc" id="L2267">                    .getGenericComponentType();</span>
<span class="nc" id="L2268">            prefix += prefix;</span>
        }

<span class="fc bfc" id="L2271" title="All 2 branches covered.">        if (genericComponentType instanceof Class&lt;?&gt;) {</span>
<span class="fc" id="L2272">            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</span>
<span class="pc bpc" id="L2273" title="1 of 2 branches missed.">            if (ck.isPrimitive()) {</span>
                try {
<span class="fc bfc" id="L2275" title="All 2 branches covered.">                    if (ck == boolean.class) {</span>
<span class="fc" id="L2276">                        clz = Class.forName(prefix + &quot;Z&quot;);</span>
<span class="fc bfc" id="L2277" title="All 2 branches covered.">                    } else if (ck == char.class) {</span>
<span class="fc" id="L2278">                        clz = Class.forName(prefix + &quot;C&quot;);</span>
<span class="fc bfc" id="L2279" title="All 2 branches covered.">                    } else if (ck == byte.class) {</span>
<span class="fc" id="L2280">                        clz = Class.forName(prefix + &quot;B&quot;);</span>
<span class="fc bfc" id="L2281" title="All 2 branches covered.">                    } else if (ck == short.class) {</span>
<span class="fc" id="L2282">                        clz = Class.forName(prefix + &quot;S&quot;);</span>
<span class="fc bfc" id="L2283" title="All 2 branches covered.">                    } else if (ck == int.class) {</span>
<span class="fc" id="L2284">                        clz = Class.forName(prefix + &quot;I&quot;);</span>
<span class="fc bfc" id="L2285" title="All 2 branches covered.">                    } else if (ck == long.class) {</span>
<span class="fc" id="L2286">                        clz = Class.forName(prefix + &quot;J&quot;);</span>
<span class="fc bfc" id="L2287" title="All 2 branches covered.">                    } else if (ck == float.class) {</span>
<span class="fc" id="L2288">                        clz = Class.forName(prefix + &quot;F&quot;);</span>
<span class="pc bpc" id="L2289" title="1 of 2 branches missed.">                    } else if (ck == double.class) {</span>
<span class="fc" id="L2290">                        clz = Class.forName(prefix + &quot;D&quot;);</span>
                    }
<span class="nc" id="L2292">                } catch (ClassNotFoundException e) {</span>
<span class="fc" id="L2293">                }</span>
            }
        }

<span class="fc" id="L2297">        return clz;</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static Collection createCollection(Type type) {
<span class="fc" id="L2302">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Collection list;
<span class="pc bpc" id="L2304" title="1 of 4 branches missed.">        if(rawClass == AbstractCollection.class //</span>
                || rawClass == Collection.class){
<span class="fc" id="L2306">            list = new ArrayList();</span>
<span class="fc bfc" id="L2307" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(HashSet.class)){</span>
<span class="fc" id="L2308">            list = new HashSet();</span>
<span class="fc bfc" id="L2309" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(LinkedHashSet.class)){</span>
<span class="fc" id="L2310">            list = new LinkedHashSet();</span>
<span class="fc bfc" id="L2311" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(TreeSet.class)){</span>
<span class="fc" id="L2312">            list = new TreeSet();</span>
<span class="fc bfc" id="L2313" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(ArrayList.class)){</span>
<span class="fc" id="L2314">            list = new ArrayList();</span>
<span class="fc bfc" id="L2315" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(EnumSet.class)){</span>
            Type itemType;
<span class="pc bpc" id="L2317" title="1 of 2 branches missed.">            if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2318">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
            } else{
<span class="nc" id="L2320">                itemType = Object.class;</span>
            }
<span class="fc" id="L2322">            list = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="fc bfc" id="L2323" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(Queue.class)){</span>
<span class="fc" id="L2324">            list = new LinkedList();</span>
        } else{
            try{
<span class="fc" id="L2327">                list = (Collection) rawClass.newInstance();</span>
<span class="fc" id="L2328">            } catch(Exception e){</span>
<span class="fc" id="L2329">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
<span class="fc" id="L2330">            }</span>
        }
<span class="fc" id="L2332">        return list;</span>
    }

    public static Class&lt;?&gt; getRawClass(Type type){
<span class="fc bfc" id="L2336" title="All 2 branches covered.">        if(type instanceof Class&lt;?&gt;){</span>
<span class="fc" id="L2337">            return (Class&lt;?&gt;) type;</span>
<span class="pc bpc" id="L2338" title="1 of 2 branches missed.">        } else if(type instanceof ParameterizedType){</span>
<span class="fc" id="L2339">            return getRawClass(((ParameterizedType) type).getRawType());</span>
        } else{
<span class="nc" id="L2341">            throw new JSONException(&quot;TODO&quot;);</span>
        }
    }

    public static boolean isProxy(Class&lt;?&gt; clazz){
<span class="fc bfc" id="L2346" title="All 2 branches covered.">        for(Class&lt;?&gt; item : clazz.getInterfaces()){</span>
<span class="fc" id="L2347">            String interfaceName = item.getName();</span>
<span class="fc bfc" id="L2348" title="All 2 branches covered.">            if(interfaceName.equals(&quot;net.sf.cglib.proxy.Factory&quot;) //</span>
<span class="pc bpc" id="L2349" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.springframework.cglib.proxy.Factory&quot;)){</span>
<span class="fc" id="L2350">                return true;</span>
            }
<span class="fc bfc" id="L2352" title="All 2 branches covered.">            if(interfaceName.equals(&quot;javassist.util.proxy.ProxyObject&quot;) //</span>
<span class="pc bpc" id="L2353" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.apache.ibatis.javassist.util.proxy.ProxyObject&quot;)</span>
                    ){
<span class="fc" id="L2355">                return true;</span>
            }
<span class="pc bpc" id="L2357" title="1 of 2 branches missed.">            if (interfaceName.equals(&quot;org.hibernate.proxy.HibernateProxy&quot;)) {</span>
<span class="nc" id="L2358">                return true;</span>
            }
        }
<span class="fc" id="L2361">        return false;</span>
    }

    public static boolean isTransient(Method method){
<span class="fc bfc" id="L2365" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2366">            return false;</span>
        }
<span class="fc bfc" id="L2368" title="All 2 branches covered.">        if(!transientClassInited){</span>
            try{
<span class="fc" id="L2370">                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</span>
<span class="nc" id="L2371">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2374">                transientClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2377" title="1 of 2 branches missed.">        if(transientClass != null){</span>
<span class="fc" id="L2378">            Annotation annotation = method.getAnnotation(transientClass);</span>
<span class="fc bfc" id="L2379" title="All 2 branches covered.">            return annotation != null;</span>
        }
<span class="nc" id="L2381">        return false;</span>
    }

    public static boolean isAnnotationPresentOneToMany(Method method) {
<span class="fc bfc" id="L2385" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2386">            return false;</span>
        }

<span class="pc bpc" id="L2389" title="1 of 4 branches missed.">        if (class_OneToMany == null &amp;&amp; !class_OneToMany_error) {</span>
            try {
<span class="fc" id="L2391">                class_OneToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.OneToMany&quot;);</span>
<span class="nc" id="L2392">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2394">                class_OneToMany_error = true;</span>
<span class="fc" id="L2395">            }</span>
        }
<span class="pc bpc" id="L2397" title="2 of 4 branches missed.">        return class_OneToMany != null &amp;&amp; method.isAnnotationPresent(class_OneToMany);</span>

    }

    public static boolean isAnnotationPresentManyToMany(Method method) {
<span class="fc bfc" id="L2402" title="All 2 branches covered.">        if (method == null) {</span>
<span class="fc" id="L2403">            return false;</span>
        }

<span class="pc bpc" id="L2406" title="1 of 4 branches missed.">        if (class_ManyToMany == null &amp;&amp; !class_ManyToMany_error) {</span>
            try {
<span class="fc" id="L2408">                class_ManyToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.ManyToMany&quot;);</span>
<span class="nc" id="L2409">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2411">                class_ManyToMany_error = true;</span>
<span class="fc" id="L2412">            }</span>
        }
<span class="pc bpc" id="L2414" title="3 of 6 branches missed.">        return class_ManyToMany != null &amp;&amp; (method.isAnnotationPresent(class_OneToMany) || method.isAnnotationPresent(class_ManyToMany));</span>

    }

    public static boolean isHibernateInitialized(Object object){
<span class="pc bpc" id="L2419" title="1 of 2 branches missed.">        if(object == null){</span>
<span class="nc" id="L2420">            return false;</span>
        }
<span class="pc bpc" id="L2422" title="2 of 4 branches missed.">        if(method_HibernateIsInitialized == null &amp;&amp; !method_HibernateIsInitialized_error){</span>
            try{
<span class="fc" id="L2424">                Class&lt;?&gt; class_Hibernate = Class.forName(&quot;org.hibernate.Hibernate&quot;);</span>
<span class="fc" id="L2425">                method_HibernateIsInitialized = class_Hibernate.getMethod(&quot;isInitialized&quot;, Object.class);</span>
<span class="nc" id="L2426">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2428">                method_HibernateIsInitialized_error = true;</span>
<span class="fc" id="L2429">            }</span>
        }
<span class="pc bpc" id="L2431" title="1 of 2 branches missed.">        if(method_HibernateIsInitialized != null){</span>
            try{
<span class="fc" id="L2433">                Boolean initialized = (Boolean) method_HibernateIsInitialized.invoke(null, object);</span>
<span class="fc" id="L2434">                return initialized.booleanValue();</span>
<span class="nc" id="L2435">            } catch(Throwable e){</span>
                // skip
            }
        }
<span class="nc" id="L2439">        return true;</span>
    }

    public static long fnv1a_64_lower(String key){
<span class="fc" id="L2443">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2444" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2445">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L2446" title="All 4 branches covered.">            if(ch == '_' || ch == '-'){</span>
<span class="fc" id="L2447">                continue;</span>
            }
<span class="fc bfc" id="L2449" title="All 4 branches covered.">            if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L2450">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L2452">            hashCode ^= ch;</span>
<span class="fc" id="L2453">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2455">        return hashCode;</span>
    }

    public static long fnv1a_64(String key){
<span class="fc" id="L2459">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2460" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2461">            char ch = key.charAt(i);</span>
<span class="fc" id="L2462">            hashCode ^= ch;</span>
<span class="fc" id="L2463">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2465">        return hashCode;</span>
    }

    public static boolean isKotlin(Class clazz) {
<span class="pc bpc" id="L2469" title="1 of 4 branches missed.">        if (kotlin_metadata == null &amp;&amp; !kotlin_metadata_error) {</span>
            try {
<span class="fc" id="L2471">                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</span>
<span class="nc" id="L2472">            } catch (Throwable e) {</span>
<span class="nc" id="L2473">                kotlin_metadata_error = true;</span>
<span class="fc" id="L2474">            }</span>
        }
<span class="pc bpc" id="L2476" title="1 of 4 branches missed.">        return kotlin_metadata != null &amp;&amp; clazz.isAnnotationPresent(kotlin_metadata);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors){
<span class="fc" id="L2480">        return getKoltinConstructor(constructors, null);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors, String[] paramNames){
<span class="fc" id="L2484">        Constructor creatorConstructor = null;</span>
<span class="fc bfc" id="L2485" title="All 2 branches covered.">        for(Constructor&lt;?&gt; constructor : constructors){</span>
<span class="fc" id="L2486">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
<span class="fc bfc" id="L2487" title="All 4 branches covered.">            if (paramNames != null &amp;&amp; parameterTypes.length != paramNames.length) {</span>
<span class="fc" id="L2488">                continue;</span>
            }

<span class="fc bfc" id="L2491" title="All 4 branches covered.">            if(parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)){</span>
<span class="fc" id="L2492">                continue;</span>
            }
<span class="fc bfc" id="L2494" title="All 4 branches covered.">            if(creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length){</span>
<span class="fc" id="L2495">                continue;</span>
            }
<span class="fc" id="L2497">            creatorConstructor = constructor;</span>
        }
<span class="fc" id="L2499">        return creatorConstructor;</span>
    }

    public static String[] getKoltinConstructorParameters(Class clazz){
<span class="pc bpc" id="L2503" title="1 of 4 branches missed.">        if(kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error){</span>
            try{
<span class="fc" id="L2505">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2506">                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</span>
<span class="nc" id="L2507">            } catch(Throwable e){</span>
<span class="nc" id="L2508">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2509">            }</span>
        }
<span class="pc bpc" id="L2511" title="1 of 2 branches missed.">        if (kotlin_kclass_constructor == null){</span>
<span class="nc" id="L2512">            return null;</span>
        }

<span class="pc bpc" id="L2515" title="1 of 4 branches missed.">        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2517">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2518">                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</span>
<span class="nc" id="L2519">            } catch(Throwable e){</span>
<span class="nc" id="L2520">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2521">            }</span>
        }

<span class="pc bpc" id="L2524" title="1 of 4 branches missed.">        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2526">                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</span>
<span class="fc" id="L2527">                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</span>
<span class="nc" id="L2528">            } catch(Throwable e){</span>
<span class="nc" id="L2529">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2530">            }</span>
        }

<span class="pc bpc" id="L2533" title="1 of 4 branches missed.">        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2535">                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</span>
<span class="fc" id="L2536">                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</span>
<span class="nc" id="L2537">            } catch(Throwable e){</span>
<span class="nc" id="L2538">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2539">            }</span>
        }

<span class="pc bpc" id="L2542" title="1 of 2 branches missed.">        if (kotlin_error){</span>
<span class="nc" id="L2543">            return null;</span>
        }

        try{
<span class="fc" id="L2547">            Object constructor = null;</span>
<span class="fc" id="L2548">            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</span>
<span class="fc" id="L2549">            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</span>
<span class="fc bfc" id="L2550" title="All 2 branches covered.">            for(Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()){</span>
<span class="fc" id="L2551">                Object item = iterator.next();</span>
<span class="fc" id="L2552">                List parameters = (List) kotlin_kfunction_getParameters.invoke(item);</span>
<span class="fc bfc" id="L2553" title="All 4 branches covered.">                if (constructor != null &amp;&amp; parameters.size() == 0) {</span>
<span class="fc" id="L2554">                    continue;</span>
                }
<span class="fc" id="L2556">                constructor = item;</span>
            }
<span class="fc" id="L2558">            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</span>
<span class="fc" id="L2559">            String[] names = new String[parameters.size()];</span>
<span class="fc bfc" id="L2560" title="All 2 branches covered.">            for(int i = 0; i &lt; parameters.size(); i++){</span>
<span class="fc" id="L2561">                Object param = parameters.get(i);</span>
<span class="fc" id="L2562">                names[i] = (String) kotlin_kparameter_getName.invoke(param);</span>
            }
<span class="fc" id="L2564">            return names;</span>
<span class="nc" id="L2565">        } catch(Throwable e){</span>
<span class="nc" id="L2566">            e.printStackTrace();</span>
<span class="nc" id="L2567">            kotlin_error = true;</span>
        }
<span class="nc" id="L2569">        return null;</span>
    }

    private static boolean isKotlinIgnore(Class clazz, String methodName) {
<span class="pc bpc" id="L2573" title="1 of 4 branches missed.">        if (kotlinIgnores == null &amp;&amp; !kotlinIgnores_error) {</span>
            try {
<span class="fc" id="L2575">                Map&lt;Class, String[]&gt; map = new HashMap&lt;Class, String[]&gt;();</span>
<span class="fc" id="L2576">                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</span>
<span class="fc" id="L2577">                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2578">                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</span>
<span class="fc" id="L2579">                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2580">                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</span>
<span class="fc" id="L2581">                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2582">                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</span>
<span class="fc" id="L2583">                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2584">                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</span>
<span class="fc" id="L2585">                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2586">                kotlinIgnores = map;</span>
<span class="nc" id="L2587">            } catch (Throwable error) {</span>
<span class="nc" id="L2588">                kotlinIgnores_error = true;</span>
<span class="fc" id="L2589">            }</span>
        }
<span class="pc bpc" id="L2591" title="1 of 2 branches missed.">        if (kotlinIgnores == null) {</span>
<span class="nc" id="L2592">            return false;</span>
        }
<span class="fc" id="L2594">        String[] ignores = kotlinIgnores.get(clazz);</span>
<span class="fc bfc" id="L2595" title="All 4 branches covered.">        return ignores != null &amp;&amp; Arrays.binarySearch(ignores, methodName) &gt;= 0;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; clazz, Class&lt;A&gt; annotationClass){
<span class="fc" id="L2599">        A a = clazz.getAnnotation(annotationClass);</span>
<span class="fc bfc" id="L2600" title="All 2 branches covered.">        if (a != null){</span>
<span class="fc" id="L2601">            return a;</span>
        }

<span class="fc bfc" id="L2604" title="All 2 branches covered.">        if(clazz.getAnnotations().length &gt; 0){</span>
<span class="fc bfc" id="L2605" title="All 2 branches covered.">            for(Annotation annotation : clazz.getAnnotations()){</span>
<span class="fc" id="L2606">                a = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L2607" title="1 of 2 branches missed.">                if(a != null){</span>
<span class="nc" id="L2608">                    return a;</span>
                }
            }
        }
<span class="fc" id="L2612">        return null;</span>
    }

    public static boolean isJacksonCreator(Method method) {
<span class="pc bpc" id="L2616" title="1 of 2 branches missed.">        if (method == null) {</span>
<span class="nc" id="L2617">            return false;</span>
        }

<span class="pc bpc" id="L2620" title="1 of 4 branches missed.">        if (class_JacksonCreator == null &amp;&amp; !class_JacksonCreator_error) {</span>
            try {
<span class="fc" id="L2622">                class_JacksonCreator = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;com.fasterxml.jackson.annotation.JsonCreator&quot;);</span>
<span class="nc" id="L2623">            } catch (Throwable e) {</span>
                // skip
<span class="nc" id="L2625">                class_JacksonCreator_error = true;</span>
<span class="fc" id="L2626">            }</span>
        }
<span class="pc bpc" id="L2628" title="1 of 4 branches missed.">        return class_JacksonCreator != null &amp;&amp; method.isAnnotationPresent(class_JacksonCreator);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>