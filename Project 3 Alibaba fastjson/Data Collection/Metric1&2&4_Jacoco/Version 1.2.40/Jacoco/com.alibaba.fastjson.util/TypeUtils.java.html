<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>TypeUtils.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.util</a> &gt; <span class="el_source">TypeUtils.java</span></div><h1>TypeUtils.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.util;

import java.lang.annotation.Annotation;
import java.lang.reflect.AccessibleObject;
import java.lang.reflect.Array;
import java.lang.reflect.Constructor;
import java.lang.reflect.Field;
import java.lang.reflect.GenericArrayType;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Proxy;
import java.lang.reflect.Type;
import java.lang.reflect.TypeVariable;
import java.lang.reflect.WildcardType;
import java.math.BigDecimal;
import java.math.BigInteger;
import java.security.AccessControlException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.AbstractCollection;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.Calendar;
import java.util.Collection;
import java.util.Collections;
import java.util.Date;
import java.util.EnumSet;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.LinkedHashSet;
import java.util.List;
import java.util.Locale;
import java.util.Map;
import java.util.Set;
import java.util.TreeSet;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.JSONObject;
import com.alibaba.fastjson.PropertyNamingStrategy;
import com.alibaba.fastjson.annotation.JSONField;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.parser.Feature;
import com.alibaba.fastjson.parser.JSONScanner;
import com.alibaba.fastjson.parser.ParserConfig;
import com.alibaba.fastjson.parser.deserializer.JavaBeanDeserializer;
import com.alibaba.fastjson.parser.deserializer.ObjectDeserializer;
import com.alibaba.fastjson.serializer.CalendarCodec;
import com.alibaba.fastjson.serializer.SerializeBeanInfo;
import com.alibaba.fastjson.serializer.SerializerFeature;

/**
 * @author wenshao[szujobs@hotmail.com]
 */
<span class="fc" id="L75">public class TypeUtils{</span>

<span class="fc" id="L77">    public static boolean compatibleWithJavaBean = false;</span>
    /** 根据field name的大小写输出输入数据 */
<span class="fc" id="L79">    public static boolean compatibleWithFieldName = false;</span>
<span class="fc" id="L80">    private static boolean setAccessibleEnable = true;</span>
<span class="fc" id="L81">    private static boolean oracleTimestampMethodInited = false;</span>
    private static Method oracleTimestampMethod;
<span class="fc" id="L83">    private static boolean oracleDateMethodInited = false;</span>
    private static Method oracleDateMethod;
<span class="fc" id="L85">    private static boolean optionalClassInited = false;</span>
    private static Class&lt;?&gt; optionalClass;
<span class="fc" id="L87">    private static boolean transientClassInited = false;</span>
    private static Class&lt;? extends Annotation&gt; transientClass;

<span class="fc" id="L90">    private static Class&lt;? extends Annotation&gt; class_OneToMany = null;</span>
<span class="fc" id="L91">    private static boolean class_OneToMany_error = false;</span>
<span class="fc" id="L92">    private static Class&lt;? extends Annotation&gt; class_ManyToMany = null;</span>
<span class="fc" id="L93">    private static boolean class_ManyToMany_error = false;</span>

<span class="fc" id="L95">    private static Method method_HibernateIsInitialized = null;</span>
<span class="fc" id="L96">    private static boolean method_HibernateIsInitialized_error = false;</span>
    private static volatile Class kotlin_metadata;
    private static volatile boolean kotlin_metadata_error;
    private static volatile boolean kotlin_class_klass_error;
    private static volatile Constructor kotlin_kclass_constructor;
    private static volatile Method kotlin_kclass_getConstructors;
    private static volatile Method kotlin_kfunction_getParameters;
    private static volatile Method kotlin_kparameter_getName;
    private static volatile boolean kotlin_error;
    private static volatile Map&lt;Class,String[]&gt; kotlinIgnores;
    private static volatile boolean kotlinIgnores_error;
<span class="fc" id="L107">    private static ConcurrentMap&lt;String,Class&lt;?&gt;&gt; mappings = new ConcurrentHashMap&lt;String,Class&lt;?&gt;&gt;(16, 0.75f, 1);</span>
    private static Class&lt;?&gt; pathClass;
<span class="fc" id="L109">    private static boolean pathClass_error = false;</span>

    static{
        try{
<span class="fc" id="L113">            TypeUtils.compatibleWithJavaBean = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHJAVABEAN));</span>
<span class="fc" id="L114">            TypeUtils.compatibleWithFieldName = &quot;true&quot;.equals(IOUtils.getStringProperty(IOUtils.FASTJSON_COMPATIBLEWITHFIELDNAME));</span>
<span class="nc" id="L115">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L117">        }</span>
    }

    static{
<span class="fc" id="L121">        addBaseClassMappings();</span>
<span class="fc" id="L122">    }</span>

    public static String castToString(Object value){
<span class="fc bfc" id="L125" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L126">            return null;</span>
        }
<span class="fc" id="L128">        return value.toString();</span>
    }

    public static Byte castToByte(Object value){
<span class="fc bfc" id="L132" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L133">            return null;</span>
        }
<span class="fc bfc" id="L135" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L136">            return ((Number) value).byteValue();</span>
        }
<span class="fc bfc" id="L138" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L139">            String strVal = (String) value;</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L142" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L143">                return null;</span>
            }
<span class="fc" id="L145">            return Byte.parseByte(strVal);</span>
        }
<span class="fc" id="L147">        throw new JSONException(&quot;can not cast to byte, value : &quot; + value);</span>
    }

    public static Character castToChar(Object value){
<span class="fc bfc" id="L151" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L152">            return null;</span>
        }
<span class="fc bfc" id="L154" title="All 2 branches covered.">        if(value instanceof Character){</span>
<span class="fc" id="L155">            return (Character) value;</span>
        }
<span class="fc bfc" id="L157" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L158">            String strVal = (String) value;</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L160">                return null;</span>
            }
<span class="fc bfc" id="L162" title="All 2 branches covered.">            if(strVal.length() != 1){</span>
<span class="fc" id="L163">                throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
            }
<span class="fc" id="L165">            return strVal.charAt(0);</span>
        }
<span class="fc" id="L167">        throw new JSONException(&quot;can not cast to char, value : &quot; + value);</span>
    }

    public static Short castToShort(Object value){
<span class="fc bfc" id="L171" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L172">            return null;</span>
        }
<span class="fc bfc" id="L174" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L175">            return ((Number) value).shortValue();</span>
        }
<span class="fc bfc" id="L177" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L178">            String strVal = (String) value;</span>
<span class="fc bfc" id="L179" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L180" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L181" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L182">                return null;</span>
            }
<span class="fc" id="L184">            return Short.parseShort(strVal);</span>
        }
<span class="fc" id="L186">        throw new JSONException(&quot;can not cast to short, value : &quot; + value);</span>
    }

    public static BigDecimal castToBigDecimal(Object value){
<span class="fc bfc" id="L190" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L191">            return null;</span>
        }
<span class="fc bfc" id="L193" title="All 2 branches covered.">        if(value instanceof BigDecimal){</span>
<span class="fc" id="L194">            return (BigDecimal) value;</span>
        }
<span class="fc bfc" id="L196" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L197">            return new BigDecimal((BigInteger) value);</span>
        }
<span class="fc" id="L199">        String strVal = value.toString();</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">        if(strVal.length() == 0){</span>
<span class="fc" id="L201">            return null;</span>
        }
<span class="fc bfc" id="L203" title="All 4 branches covered.">        if(value instanceof Map &amp;&amp; ((Map) value).size() == 0){</span>
<span class="fc" id="L204">            return null;</span>
        }
<span class="fc" id="L206">        return new BigDecimal(strVal);</span>
    }

    public static BigInteger castToBigInteger(Object value){
<span class="fc bfc" id="L210" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L211">            return null;</span>
        }
<span class="fc bfc" id="L213" title="All 2 branches covered.">        if(value instanceof BigInteger){</span>
<span class="fc" id="L214">            return (BigInteger) value;</span>
        }
<span class="fc bfc" id="L216" title="All 4 branches covered.">        if(value instanceof Float || value instanceof Double){</span>
<span class="fc" id="L217">            return BigInteger.valueOf(((Number) value).longValue());</span>
        }
<span class="fc" id="L219">        String strVal = value.toString();</span>
<span class="fc bfc" id="L220" title="All 2 branches covered.">        if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">                || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">                || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L223">            return null;</span>
        }
<span class="fc" id="L225">        return new BigInteger(strVal);</span>
    }

    public static Float castToFloat(Object value){
<span class="fc bfc" id="L229" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L230">            return null;</span>
        }
<span class="fc bfc" id="L232" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L233">            return ((Number) value).floatValue();</span>
        }
<span class="fc bfc" id="L235" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L236">            String strVal = value.toString();</span>
<span class="fc bfc" id="L237" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L240">                return null;</span>
            }
<span class="pc bpc" id="L242" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L243">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L245">            return Float.parseFloat(strVal);</span>
        }
<span class="fc" id="L247">        throw new JSONException(&quot;can not cast to float, value : &quot; + value);</span>
    }

    public static Double castToDouble(Object value){
<span class="fc bfc" id="L251" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L252">            return null;</span>
        }
<span class="fc bfc" id="L254" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L255">            return ((Number) value).doubleValue();</span>
        }
<span class="fc bfc" id="L257" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L258">            String strVal = value.toString();</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L262">                return null;</span>
            }
<span class="pc bpc" id="L264" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L265">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L267">            return Double.parseDouble(strVal);</span>
        }
<span class="fc" id="L269">        throw new JSONException(&quot;can not cast to double, value : &quot; + value);</span>
    }

    public static Date castToDate(Object value){
<span class="fc bfc" id="L273" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L274">            return null;</span>
        }
<span class="fc bfc" id="L276" title="All 2 branches covered.">        if(value instanceof Date){ // 使用频率最高的，应优先处理</span>
<span class="fc" id="L277">            return (Date) value;</span>
        }
<span class="fc bfc" id="L279" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L280">            return ((Calendar) value).getTime();</span>
        }
<span class="fc" id="L282">        long longValue = -1;</span>
<span class="fc bfc" id="L283" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L284">            longValue = ((Number) value).longValue();</span>
<span class="fc" id="L285">            return new Date(longValue);</span>
        }
<span class="fc bfc" id="L287" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L288">            String strVal = (String) value;</span>
<span class="fc" id="L289">            JSONScanner dateLexer = new JSONScanner(strVal);</span>
            try{
<span class="fc bfc" id="L291" title="All 2 branches covered.">                if(dateLexer.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L292">                    Calendar calendar = dateLexer.getCalendar();</span>
<span class="fc" id="L293">                    return calendar.getTime();</span>
                }
            } finally{
<span class="fc" id="L296">                dateLexer.close();</span>
            }
<span class="pc bpc" id="L298" title="1 of 4 branches missed.">            if(strVal.startsWith(&quot;/Date(&quot;) &amp;&amp; strVal.endsWith(&quot;)/&quot;)){</span>
<span class="fc" id="L299">                String dotnetDateStr = strVal.substring(6, strVal.length() - 2);</span>
<span class="fc" id="L300">                strVal = dotnetDateStr;</span>
            }
<span class="fc bfc" id="L302" title="All 2 branches covered.">            if(strVal.indexOf('-') != -1){</span>
                String format;

<span class="fc bfc" id="L305" title="All 2 branches covered.">                if(strVal.length() == JSON.DEFFAULT_DATE_FORMAT.length()</span>
<span class="pc bpc" id="L306" title="1 of 4 branches missed.">                        || (strVal.length() == 22 &amp;&amp; JSON.DEFFAULT_DATE_FORMAT.equals(&quot;yyyyMMddHHmmssSSSZ&quot;))){</span>
<span class="fc" id="L307">                    format = JSON.DEFFAULT_DATE_FORMAT;</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">                } else if(strVal.length() == 10){</span>
<span class="fc" id="L309">                    format = &quot;yyyy-MM-dd&quot;;</span>
<span class="nc bnc" id="L310" title="All 2 branches missed.">                } else if(strVal.length() == &quot;yyyy-MM-dd HH:mm:ss&quot;.length()){</span>
<span class="nc" id="L311">                    format = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">                } else if(strVal.length() == 29</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                        &amp;&amp; strVal.charAt(26) == ':'</span>
<span class="nc bnc" id="L314" title="All 2 branches missed.">                        &amp;&amp; strVal.charAt(28) == '0'){</span>
<span class="nc" id="L315">                    format = &quot;yyyy-MM-dd'T'HH:mm:ss.SSSXXX&quot;;</span>
                } else{
<span class="nc" id="L317">                    format = &quot;yyyy-MM-dd HH:mm:ss.SSS&quot;;</span>
                }
<span class="fc" id="L319">                SimpleDateFormat dateFormat = new SimpleDateFormat(format, JSON.defaultLocale);</span>
<span class="fc" id="L320">                dateFormat.setTimeZone(JSON.defaultTimeZone);</span>
                try{
<span class="fc" id="L322">                    return (Date) dateFormat.parse(strVal);</span>
<span class="fc" id="L323">                } catch(ParseException e){</span>
<span class="fc" id="L324">                    throw new JSONException(&quot;can not cast to Date, value : &quot; + strVal);</span>
                }
            }
<span class="fc bfc" id="L327" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L328">                return null;</span>
            }
<span class="fc" id="L330">            longValue = Long.parseLong(strVal);</span>
        }
<span class="fc bfc" id="L332" title="All 2 branches covered.">        if(longValue &lt; 0){</span>
<span class="fc" id="L333">            Class&lt;?&gt; clazz = value.getClass();</span>
<span class="fc bfc" id="L334" title="All 2 branches covered.">            if(&quot;oracle.sql.TIMESTAMP&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L335" title="2 of 4 branches missed.">                if(oracleTimestampMethod == null &amp;&amp; !oracleTimestampMethodInited){</span>
                    try{
<span class="fc" id="L337">                        oracleTimestampMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L338">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L341">                        oracleTimestampMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L346">                    result = oracleTimestampMethod.invoke(value);</span>
<span class="nc" id="L347">                } catch(Exception e){</span>
<span class="nc" id="L348">                    throw new JSONException(&quot;can not cast oracle.sql.TIMESTAMP to Date&quot;, e);</span>
<span class="fc" id="L349">                }</span>
<span class="fc" id="L350">                return (Date) result;</span>
            }
<span class="fc bfc" id="L352" title="All 2 branches covered.">            if(&quot;oracle.sql.DATE&quot;.equals(clazz.getName())){</span>
<span class="pc bpc" id="L353" title="2 of 4 branches missed.">                if(oracleDateMethod == null &amp;&amp; !oracleDateMethodInited){</span>
                    try{
<span class="fc" id="L355">                        oracleDateMethod = clazz.getMethod(&quot;toJdbc&quot;);</span>
<span class="nc" id="L356">                    } catch(NoSuchMethodException e){</span>
                        // skip
                    } finally{
<span class="fc" id="L359">                        oracleDateMethodInited = true;</span>
                    }
                }
                Object result;
                try{
<span class="fc" id="L364">                    result = oracleDateMethod.invoke(value);</span>
<span class="nc" id="L365">                } catch(Exception e){</span>
<span class="nc" id="L366">                    throw new JSONException(&quot;can not cast oracle.sql.DATE to Date&quot;, e);</span>
<span class="fc" id="L367">                }</span>
<span class="fc" id="L368">                return (Date) result;</span>
            }
<span class="fc" id="L370">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value);</span>
        }
<span class="fc" id="L372">        return new Date(longValue);</span>
    }

    public static java.sql.Date castToSqlDate(Object value){
<span class="fc bfc" id="L376" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L377">            return null;</span>
        }
<span class="fc bfc" id="L379" title="All 2 branches covered.">        if(value instanceof java.sql.Date){</span>
<span class="fc" id="L380">            return (java.sql.Date) value;</span>
        }
<span class="fc bfc" id="L382" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L383">            return new java.sql.Date(((java.util.Date) value).getTime());</span>
        }
<span class="fc bfc" id="L385" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L386">            return new java.sql.Date(((Calendar) value).getTimeInMillis());</span>
        }
<span class="fc" id="L388">        long longValue = 0;</span>
<span class="fc bfc" id="L389" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L390">            longValue = ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L392" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L393">            String strVal = (String) value;</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L396" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L397">                return null;</span>
            }
<span class="pc bpc" id="L399" title="1 of 2 branches missed.">            if(isNumber(strVal)){</span>
<span class="fc" id="L400">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="nc" id="L402">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="nc bnc" id="L403" title="All 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="nc" id="L404">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L406">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L410" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L411">            throw new JSONException(&quot;can not cast to Date, value : &quot; + value); // TODO 忽略 1970-01-01 之前的时间处理？</span>
        }
<span class="fc" id="L413">        return new java.sql.Date(longValue);</span>
    }

    public static java.sql.Timestamp castToTimestamp(Object value){
<span class="fc bfc" id="L417" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L418">            return null;</span>
        }
<span class="fc bfc" id="L420" title="All 2 branches covered.">        if(value instanceof Calendar){</span>
<span class="fc" id="L421">            return new java.sql.Timestamp(((Calendar) value).getTimeInMillis());</span>
        }
<span class="fc bfc" id="L423" title="All 2 branches covered.">        if(value instanceof java.sql.Timestamp){</span>
<span class="fc" id="L424">            return (java.sql.Timestamp) value;</span>
        }
<span class="fc bfc" id="L426" title="All 2 branches covered.">        if(value instanceof java.util.Date){</span>
<span class="fc" id="L427">            return new java.sql.Timestamp(((java.util.Date) value).getTime());</span>
        }
<span class="fc" id="L429">        long longValue = 0;</span>
<span class="fc bfc" id="L430" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L431">            longValue = ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L433" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L434">            String strVal = (String) value;</span>
<span class="fc bfc" id="L435" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="pc bpc" id="L436" title="1 of 2 branches missed.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L437" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L438">                return null;</span>
            }
<span class="fc bfc" id="L440" title="All 2 branches covered.">            if(strVal.endsWith(&quot;.000000000&quot;)){</span>
<span class="fc" id="L441">                strVal = strVal.substring(0, strVal.length() - 10);</span>
<span class="fc bfc" id="L442" title="All 2 branches covered.">            } else if(strVal.endsWith(&quot;.000000&quot;)){</span>
<span class="fc" id="L443">                strVal = strVal.substring(0, strVal.length() - 7);</span>
            }
<span class="fc bfc" id="L445" title="All 2 branches covered.">            if(isNumber(strVal)){</span>
<span class="fc" id="L446">                longValue = Long.parseLong(strVal);</span>
            } else{
<span class="fc" id="L448">                JSONScanner scanner = new JSONScanner(strVal);</span>
<span class="pc bpc" id="L449" title="1 of 2 branches missed.">                if(scanner.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L450">                    longValue = scanner.getCalendar().getTime().getTime();</span>
                } else{
<span class="nc" id="L452">                    throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + strVal);</span>
                }
            }
        }
<span class="fc bfc" id="L456" title="All 2 branches covered.">        if(longValue &lt;= 0){</span>
<span class="fc" id="L457">            throw new JSONException(&quot;can not cast to Timestamp, value : &quot; + value);</span>
        }
<span class="fc" id="L459">        return new java.sql.Timestamp(longValue);</span>
    }

    public static boolean isNumber(String str){
<span class="fc bfc" id="L463" title="All 2 branches covered.">        for(int i = 0; i &lt; str.length(); ++i){</span>
<span class="fc" id="L464">            char ch = str.charAt(i);</span>
<span class="pc bpc" id="L465" title="1 of 4 branches missed.">            if(ch == '+' || ch == '-'){</span>
<span class="fc bfc" id="L466" title="All 2 branches covered.">                if(i != 0){</span>
<span class="fc" id="L467">                    return false;</span>
                } else{
                    continue;
                }
<span class="pc bpc" id="L471" title="1 of 4 branches missed.">            } else if(ch &lt; '0' || ch &gt; '9'){</span>
<span class="fc" id="L472">                return false;</span>
            }
        }
<span class="fc" id="L475">        return true;</span>
    }

    public static Long castToLong(Object value){
<span class="fc bfc" id="L479" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L480">            return null;</span>
        }
<span class="fc bfc" id="L482" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L483">            return ((Number) value).longValue();</span>
        }
<span class="fc bfc" id="L485" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L486">            String strVal = (String) value;</span>
<span class="fc bfc" id="L487" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L488" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L489" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L490">                return null;</span>
            }
<span class="pc bpc" id="L492" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L493">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
            try{
<span class="fc" id="L496">                return Long.parseLong(strVal);</span>
<span class="fc" id="L497">            } catch(NumberFormatException ex){</span>
                //
            }
<span class="fc" id="L500">            JSONScanner dateParser = new JSONScanner(strVal);</span>
<span class="fc" id="L501">            Calendar calendar = null;</span>
<span class="fc bfc" id="L502" title="All 2 branches covered.">            if(dateParser.scanISO8601DateIfMatch(false)){</span>
<span class="fc" id="L503">                calendar = dateParser.getCalendar();</span>
            }
<span class="fc" id="L505">            dateParser.close();</span>
<span class="fc bfc" id="L506" title="All 2 branches covered.">            if(calendar != null){</span>
<span class="fc" id="L507">                return calendar.getTimeInMillis();</span>
            }
        }
<span class="fc bfc" id="L510" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L511">            Map map = (Map) value;</span>
<span class="fc bfc" id="L512" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L513" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L514" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L515">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L516">                iter.next();</span>
<span class="fc" id="L517">                Object value2 = iter.next();</span>
<span class="fc" id="L518">                return castToLong(value2);</span>
            }
        }
<span class="fc" id="L521">        throw new JSONException(&quot;can not cast to long, value : &quot; + value);</span>
    }

    public static Integer castToInt(Object value){
<span class="fc bfc" id="L525" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L526">            return null;</span>
        }
<span class="fc bfc" id="L528" title="All 2 branches covered.">        if(value instanceof Integer){</span>
<span class="fc" id="L529">            return (Integer) value;</span>
        }
<span class="fc bfc" id="L531" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc" id="L532">            return ((Number) value).intValue();</span>
        }
<span class="fc bfc" id="L534" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L535">            String strVal = (String) value;</span>
<span class="fc bfc" id="L536" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L537" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L538" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L539">                return null;</span>
            }
<span class="pc bpc" id="L541" title="1 of 2 branches missed.">            if(strVal.indexOf(',') != 0){</span>
<span class="fc" id="L542">                strVal = strVal.replaceAll(&quot;,&quot;, &quot;&quot;);</span>
            }
<span class="fc" id="L544">            return Integer.parseInt(strVal);</span>
        }
<span class="fc bfc" id="L546" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="pc bpc" id="L547" title="1 of 2 branches missed.">            return ((Boolean) value).booleanValue() ? 1 : 0;</span>
        }
<span class="fc bfc" id="L549" title="All 2 branches covered.">        if(value instanceof Map){</span>
<span class="fc" id="L550">            Map map = (Map) value;</span>
<span class="fc bfc" id="L551" title="All 2 branches covered.">            if(map.size() == 2</span>
<span class="pc bpc" id="L552" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andIncrement&quot;)</span>
<span class="pc bpc" id="L553" title="1 of 2 branches missed.">                    &amp;&amp; map.containsKey(&quot;andDecrement&quot;)){</span>
<span class="fc" id="L554">                Iterator iter = map.values().iterator();</span>
<span class="fc" id="L555">                iter.next();</span>
<span class="fc" id="L556">                Object value2 = iter.next();</span>
<span class="fc" id="L557">                return castToInt(value2);</span>
            }
        }
<span class="fc" id="L560">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static byte[] castToBytes(Object value){
<span class="fc bfc" id="L564" title="All 2 branches covered.">        if(value instanceof byte[]){</span>
<span class="fc" id="L565">            return (byte[]) value;</span>
        }
<span class="fc bfc" id="L567" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L568">            return IOUtils.decodeBase64((String) value);</span>
        }
<span class="fc" id="L570">        throw new JSONException(&quot;can not cast to int, value : &quot; + value);</span>
    }

    public static Boolean castToBoolean(Object value){
<span class="fc bfc" id="L574" title="All 2 branches covered.">        if(value == null){</span>
<span class="fc" id="L575">            return null;</span>
        }
<span class="fc bfc" id="L577" title="All 2 branches covered.">        if(value instanceof Boolean){</span>
<span class="fc" id="L578">            return (Boolean) value;</span>
        }
<span class="fc bfc" id="L580" title="All 2 branches covered.">        if(value instanceof Number){</span>
<span class="fc bfc" id="L581" title="All 2 branches covered.">            return ((Number) value).intValue() == 1;</span>
        }
<span class="fc bfc" id="L583" title="All 2 branches covered.">        if(value instanceof String){</span>
<span class="fc" id="L584">            String strVal = (String) value;</span>
<span class="fc bfc" id="L585" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L586" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="fc bfc" id="L587" title="All 2 branches covered.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L588">                return null;</span>
            }
<span class="fc bfc" id="L590" title="All 2 branches covered.">            if(&quot;true&quot;.equalsIgnoreCase(strVal) //</span>
<span class="pc bpc" id="L591" title="1 of 2 branches missed.">                    || &quot;1&quot;.equals(strVal)){</span>
<span class="fc" id="L592">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L594" title="All 2 branches covered.">            if(&quot;false&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L595" title="All 2 branches covered.">                    || &quot;0&quot;.equals(strVal)){</span>
<span class="fc" id="L596">                return Boolean.FALSE;</span>
            }
<span class="fc bfc" id="L598" title="All 2 branches covered.">            if(&quot;Y&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L599" title="All 2 branches covered.">                    || &quot;T&quot;.equals(strVal)){</span>
<span class="fc" id="L600">                return Boolean.TRUE;</span>
            }
<span class="fc bfc" id="L602" title="All 2 branches covered.">            if(&quot;F&quot;.equalsIgnoreCase(strVal) //</span>
<span class="fc bfc" id="L603" title="All 2 branches covered.">                    || &quot;N&quot;.equals(strVal)){</span>
<span class="fc" id="L604">                return Boolean.FALSE;</span>
            }
        }
<span class="fc" id="L607">        throw new JSONException(&quot;can not cast to boolean, value : &quot; + value);</span>
    }

    public static &lt;T&gt; T castToJavaBean(Object obj, Class&lt;T&gt; clazz){
<span class="fc" id="L611">        return cast(obj, clazz, ParserConfig.getGlobalInstance());</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T cast(Object obj, Class&lt;T&gt; clazz, ParserConfig config){
<span class="fc bfc" id="L616" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc bfc" id="L617" title="All 2 branches covered.">            if(clazz == int.class){</span>
<span class="fc" id="L618">                return (T) Integer.valueOf(0);</span>
<span class="fc bfc" id="L619" title="All 2 branches covered.">            } else if(clazz == long.class){</span>
<span class="fc" id="L620">                return (T) Long.valueOf(0);</span>
<span class="fc bfc" id="L621" title="All 2 branches covered.">            } else if(clazz == short.class){</span>
<span class="fc" id="L622">                return (T) Short.valueOf((short) 0);</span>
<span class="fc bfc" id="L623" title="All 2 branches covered.">            } else if(clazz == byte.class){</span>
<span class="fc" id="L624">                return (T) Byte.valueOf((byte) 0);</span>
<span class="fc bfc" id="L625" title="All 2 branches covered.">            } else if(clazz == float.class){</span>
<span class="fc" id="L626">                return (T) Float.valueOf(0);</span>
<span class="fc bfc" id="L627" title="All 2 branches covered.">            } else if(clazz == double.class){</span>
<span class="fc" id="L628">                return (T) Double.valueOf(0);</span>
<span class="fc bfc" id="L629" title="All 2 branches covered.">            } else if(clazz == boolean.class){</span>
<span class="fc" id="L630">                return (T) Boolean.FALSE;</span>
            }
<span class="fc" id="L632">            return null;</span>
        }
<span class="fc bfc" id="L634" title="All 2 branches covered.">        if(clazz == null){</span>
<span class="fc" id="L635">            throw new IllegalArgumentException(&quot;clazz is null&quot;);</span>
        }
<span class="fc bfc" id="L637" title="All 2 branches covered.">        if(clazz == obj.getClass()){</span>
<span class="fc" id="L638">            return (T) obj;</span>
        }
<span class="fc bfc" id="L640" title="All 2 branches covered.">        if(obj instanceof Map){</span>
<span class="fc bfc" id="L641" title="All 2 branches covered.">            if(clazz == Map.class){</span>
<span class="fc" id="L642">                return (T) obj;</span>
            }
<span class="fc" id="L644">            Map map = (Map) obj;</span>
<span class="fc bfc" id="L645" title="All 4 branches covered.">            if(clazz == Object.class &amp;&amp; !map.containsKey(JSON.DEFAULT_TYPE_KEY)){</span>
<span class="fc" id="L646">                return (T) obj;</span>
            }
<span class="fc" id="L648">            return castToJavaBean((Map&lt;String,Object&gt;) obj, clazz, config);</span>
        }
<span class="fc bfc" id="L650" title="All 2 branches covered.">        if(clazz.isArray()){</span>
<span class="fc bfc" id="L651" title="All 2 branches covered.">            if(obj instanceof Collection){</span>
<span class="fc" id="L652">                Collection collection = (Collection) obj;</span>
<span class="fc" id="L653">                int index = 0;</span>
<span class="fc" id="L654">                Object array = Array.newInstance(clazz.getComponentType(), collection.size());</span>
<span class="fc bfc" id="L655" title="All 2 branches covered.">                for(Object item : collection){</span>
<span class="fc" id="L656">                    Object value = cast(item, clazz.getComponentType(), config);</span>
<span class="fc" id="L657">                    Array.set(array, index, value);</span>
<span class="fc" id="L658">                    index++;</span>
<span class="fc" id="L659">                }</span>
<span class="fc" id="L660">                return (T) array;</span>
            }
<span class="fc bfc" id="L662" title="All 2 branches covered.">            if(clazz == byte[].class){</span>
<span class="fc" id="L663">                return (T) castToBytes(obj);</span>
            }
        }
<span class="fc bfc" id="L666" title="All 2 branches covered.">        if(clazz.isAssignableFrom(obj.getClass())){</span>
<span class="fc" id="L667">            return (T) obj;</span>
        }
<span class="fc bfc" id="L669" title="All 4 branches covered.">        if(clazz == boolean.class || clazz == Boolean.class){</span>
<span class="fc" id="L670">            return (T) castToBoolean(obj);</span>
        }
<span class="fc bfc" id="L672" title="All 4 branches covered.">        if(clazz == byte.class || clazz == Byte.class){</span>
<span class="fc" id="L673">            return (T) castToByte(obj);</span>
        }
<span class="fc bfc" id="L675" title="All 4 branches covered.">        if(clazz == char.class || clazz == Character.class){</span>
<span class="fc" id="L676">            return (T) castToChar(obj);</span>
        }
<span class="fc bfc" id="L678" title="All 4 branches covered.">        if(clazz == short.class || clazz == Short.class){</span>
<span class="fc" id="L679">            return (T) castToShort(obj);</span>
        }
<span class="fc bfc" id="L681" title="All 4 branches covered.">        if(clazz == int.class || clazz == Integer.class){</span>
<span class="fc" id="L682">            return (T) castToInt(obj);</span>
        }
<span class="fc bfc" id="L684" title="All 4 branches covered.">        if(clazz == long.class || clazz == Long.class){</span>
<span class="fc" id="L685">            return (T) castToLong(obj);</span>
        }
<span class="fc bfc" id="L687" title="All 4 branches covered.">        if(clazz == float.class || clazz == Float.class){</span>
<span class="fc" id="L688">            return (T) castToFloat(obj);</span>
        }
<span class="fc bfc" id="L690" title="All 4 branches covered.">        if(clazz == double.class || clazz == Double.class){</span>
<span class="fc" id="L691">            return (T) castToDouble(obj);</span>
        }
<span class="fc bfc" id="L693" title="All 2 branches covered.">        if(clazz == String.class){</span>
<span class="fc" id="L694">            return (T) castToString(obj);</span>
        }
<span class="fc bfc" id="L696" title="All 2 branches covered.">        if(clazz == BigDecimal.class){</span>
<span class="fc" id="L697">            return (T) castToBigDecimal(obj);</span>
        }
<span class="fc bfc" id="L699" title="All 2 branches covered.">        if(clazz == BigInteger.class){</span>
<span class="fc" id="L700">            return (T) castToBigInteger(obj);</span>
        }
<span class="fc bfc" id="L702" title="All 2 branches covered.">        if(clazz == Date.class){</span>
<span class="fc" id="L703">            return (T) castToDate(obj);</span>
        }
<span class="fc bfc" id="L705" title="All 2 branches covered.">        if(clazz == java.sql.Date.class){</span>
<span class="fc" id="L706">            return (T) castToSqlDate(obj);</span>
        }
<span class="fc bfc" id="L708" title="All 2 branches covered.">        if(clazz == java.sql.Timestamp.class){</span>
<span class="fc" id="L709">            return (T) castToTimestamp(obj);</span>
        }
<span class="fc bfc" id="L711" title="All 2 branches covered.">        if(clazz.isEnum()){</span>
<span class="fc" id="L712">            return (T) castToEnum(obj, clazz, config);</span>
        }
<span class="fc bfc" id="L714" title="All 2 branches covered.">        if(Calendar.class.isAssignableFrom(clazz)){</span>
<span class="fc" id="L715">            Date date = castToDate(obj);</span>
            Calendar calendar;
<span class="fc bfc" id="L717" title="All 2 branches covered.">            if(clazz == Calendar.class){</span>
<span class="fc" id="L718">                calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
            } else{
                try{
<span class="fc" id="L721">                    calendar = (Calendar) clazz.newInstance();</span>
<span class="fc" id="L722">                } catch(Exception e){</span>
<span class="fc" id="L723">                    throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), e);</span>
<span class="fc" id="L724">                }</span>
            }
<span class="fc" id="L726">            calendar.setTime(date);</span>
<span class="fc" id="L727">            return (T) calendar;</span>
        }
<span class="fc bfc" id="L729" title="All 2 branches covered.">        if(clazz.getName().equals(&quot;javax.xml.datatype.XMLGregorianCalendar&quot;)){</span>
<span class="fc" id="L730">            Date date = castToDate(obj);</span>
<span class="fc" id="L731">            Calendar calendar = Calendar.getInstance(JSON.defaultTimeZone, JSON.defaultLocale);</span>
<span class="fc" id="L732">            calendar.setTime(date);</span>
<span class="fc" id="L733">            return (T) CalendarCodec.instance.createXMLGregorianCalendar(calendar);</span>
        }
<span class="fc bfc" id="L735" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L736">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L737" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L738" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L739" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L740">                return null;</span>
            }
<span class="fc bfc" id="L742" title="All 2 branches covered.">            if(clazz == java.util.Currency.class){</span>
<span class="fc" id="L743">                return (T) java.util.Currency.getInstance(strVal);</span>
            }
<span class="fc bfc" id="L745" title="All 2 branches covered.">            if(clazz == java.util.Locale.class){</span>
<span class="fc" id="L746">                return (T) toLocale(strVal);</span>
            }
        }
<span class="fc" id="L749">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    public static Locale toLocale(String strVal){
<span class="fc" id="L753">        String[] items = strVal.split(&quot;_&quot;);</span>
<span class="fc bfc" id="L754" title="All 2 branches covered.">        if(items.length == 1){</span>
<span class="fc" id="L755">            return new Locale(items[0]);</span>
        }
<span class="fc bfc" id="L757" title="All 2 branches covered.">        if(items.length == 2){</span>
<span class="fc" id="L758">            return new Locale(items[0], items[1]);</span>
        }
<span class="fc" id="L760">        return new Locale(items[0], items[1], items[2]);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;})
    public static &lt;T&gt; T castToEnum(Object obj, Class&lt;T&gt; clazz, ParserConfig mapping){
        try{
<span class="fc bfc" id="L766" title="All 2 branches covered.">            if(obj instanceof String){</span>
<span class="fc" id="L767">                String name = (String) obj;</span>
<span class="fc bfc" id="L768" title="All 2 branches covered.">                if(name.length() == 0){</span>
<span class="fc" id="L769">                    return null;</span>
                }
<span class="fc" id="L771">                return (T) Enum.valueOf((Class&lt;? extends Enum&gt;) clazz, name);</span>
            }
<span class="fc bfc" id="L773" title="All 2 branches covered.">            if(obj instanceof Number){</span>
<span class="fc" id="L774">                int ordinal = ((Number) obj).intValue();</span>
<span class="fc" id="L775">                Object[] values = clazz.getEnumConstants();</span>
<span class="fc bfc" id="L776" title="All 2 branches covered.">                if(ordinal &lt; values.length){</span>
<span class="fc" id="L777">                    return (T) values[ordinal];</span>
                }
            }
<span class="fc" id="L780">        } catch(Exception ex){</span>
<span class="fc" id="L781">            throw new JSONException(&quot;can not cast to : &quot; + clazz.getName(), ex);</span>
<span class="fc" id="L782">        }</span>
<span class="fc" id="L783">        throw new JSONException(&quot;can not cast to : &quot; + clazz.getName());</span>
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public static &lt;T&gt; T cast(Object obj, Type type, ParserConfig mapping){
<span class="fc bfc" id="L788" title="All 2 branches covered.">        if(obj == null){</span>
<span class="fc" id="L789">            return null;</span>
        }
<span class="fc bfc" id="L791" title="All 2 branches covered.">        if(type instanceof Class){</span>
<span class="fc" id="L792">            return (T) cast(obj, (Class&lt;T&gt;) type, mapping);</span>
        }
<span class="fc bfc" id="L794" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L795">            return (T) cast(obj, (ParameterizedType) type, mapping);</span>
        }
<span class="pc bpc" id="L797" title="1 of 2 branches missed.">        if(obj instanceof String){</span>
<span class="fc" id="L798">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L799" title="All 2 branches covered.">            if(strVal.length() == 0 //</span>
<span class="fc bfc" id="L800" title="All 2 branches covered.">                    || &quot;null&quot;.equals(strVal) //</span>
<span class="pc bpc" id="L801" title="1 of 2 branches missed.">                    || &quot;NULL&quot;.equals(strVal)){</span>
<span class="fc" id="L802">                return null;</span>
            }
        }
<span class="fc bfc" id="L805" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L806">            return (T) obj;</span>
        }
<span class="fc" id="L808">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static &lt;T&gt; T cast(Object obj, ParameterizedType type, ParserConfig mapping){
<span class="fc" id="L813">        Type rawTye = type.getRawType();</span>
<span class="fc bfc" id="L814" title="All 10 branches covered.">        if(rawTye == Set.class || rawTye == HashSet.class //</span>
                || rawTye == TreeSet.class //
                || rawTye == List.class //
                || rawTye == ArrayList.class){
<span class="fc" id="L818">            Type itemType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L819" title="All 2 branches covered.">            if(obj instanceof Iterable){</span>
                Collection collection;
<span class="fc bfc" id="L821" title="All 4 branches covered.">                if(rawTye == Set.class || rawTye == HashSet.class){</span>
<span class="fc" id="L822">                    collection = new HashSet();</span>
<span class="fc bfc" id="L823" title="All 2 branches covered.">                } else if(rawTye == TreeSet.class){</span>
<span class="fc" id="L824">                    collection = new TreeSet();</span>
                } else{
<span class="fc" id="L826">                    collection = new ArrayList();</span>
                }
<span class="fc bfc" id="L828" title="All 2 branches covered.">                for(Iterator it = ((Iterable) obj).iterator(); it.hasNext(); ){</span>
<span class="fc" id="L829">                    Object item = it.next();</span>
<span class="fc" id="L830">                    collection.add(cast(item, itemType, mapping));</span>
<span class="fc" id="L831">                }</span>
<span class="fc" id="L832">                return (T) collection;</span>
            }
        }
<span class="fc bfc" id="L835" title="All 4 branches covered.">        if(rawTye == Map.class || rawTye == HashMap.class){</span>
<span class="fc" id="L836">            Type keyType = type.getActualTypeArguments()[0];</span>
<span class="fc" id="L837">            Type valueType = type.getActualTypeArguments()[1];</span>
<span class="fc bfc" id="L838" title="All 2 branches covered.">            if(obj instanceof Map){</span>
<span class="fc" id="L839">                Map map = new HashMap();</span>
<span class="fc bfc" id="L840" title="All 2 branches covered.">                for(Map.Entry entry : ((Map&lt;?,?&gt;) obj).entrySet()){</span>
<span class="fc" id="L841">                    Object key = cast(entry.getKey(), keyType, mapping);</span>
<span class="fc" id="L842">                    Object value = cast(entry.getValue(), valueType, mapping);</span>
<span class="fc" id="L843">                    map.put(key, value);</span>
<span class="fc" id="L844">                }</span>
<span class="fc" id="L845">                return (T) map;</span>
            }
        }
<span class="fc bfc" id="L848" title="All 2 branches covered.">        if(obj instanceof String){</span>
<span class="fc" id="L849">            String strVal = (String) obj;</span>
<span class="fc bfc" id="L850" title="All 2 branches covered.">            if(strVal.length() == 0){</span>
<span class="fc" id="L851">                return null;</span>
            }
        }
<span class="fc bfc" id="L854" title="All 2 branches covered.">        if(type.getActualTypeArguments().length == 1){</span>
<span class="fc" id="L855">            Type argType = type.getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L856" title="All 2 branches covered.">            if(argType instanceof WildcardType){</span>
<span class="fc" id="L857">                return (T) cast(obj, rawTye, mapping);</span>
            }
        }
<span class="fc" id="L860">        throw new JSONException(&quot;can not cast to : &quot; + type);</span>
    }

    @SuppressWarnings({&quot;unchecked&quot;})
    public static &lt;T&gt; T castToJavaBean(Map&lt;String,Object&gt; map, Class&lt;T&gt; clazz, ParserConfig config){
        try{
<span class="fc bfc" id="L866" title="All 2 branches covered.">            if(clazz == StackTraceElement.class){</span>
<span class="fc" id="L867">                String declaringClass = (String) map.get(&quot;className&quot;);</span>
<span class="fc" id="L868">                String methodName = (String) map.get(&quot;methodName&quot;);</span>
<span class="fc" id="L869">                String fileName = (String) map.get(&quot;fileName&quot;);</span>
                int lineNumber;
                {
<span class="fc" id="L872">                    Number value = (Number) map.get(&quot;lineNumber&quot;);</span>
<span class="fc bfc" id="L873" title="All 2 branches covered.">                    if(value == null){</span>
<span class="fc" id="L874">                        lineNumber = 0;</span>
                    } else{
<span class="fc" id="L876">                        lineNumber = value.intValue();</span>
                    }
                }
<span class="fc" id="L879">                return (T) new StackTraceElement(declaringClass, methodName, fileName, lineNumber);</span>
            }

            {
<span class="fc" id="L883">                Object iClassObject = map.get(JSON.DEFAULT_TYPE_KEY);</span>
<span class="fc bfc" id="L884" title="All 2 branches covered.">                if(iClassObject instanceof String){</span>
<span class="fc" id="L885">                    String className = (String) iClassObject;</span>
                    Class&lt;?&gt; loadClazz;
<span class="fc bfc" id="L887" title="All 2 branches covered.">                    if(config == null){</span>
<span class="fc" id="L888">                        config = ParserConfig.global;</span>
                    }
<span class="fc" id="L890">                    loadClazz = config.checkAutoType(className, null);</span>
<span class="fc bfc" id="L891" title="All 2 branches covered.">                    if(loadClazz == null){</span>
<span class="fc" id="L892">                        throw new ClassNotFoundException(className + &quot; not found&quot;);</span>
                    }
<span class="fc bfc" id="L894" title="All 2 branches covered.">                    if(!loadClazz.equals(clazz)){</span>
<span class="fc" id="L895">                        return (T) castToJavaBean(map, loadClazz, config);</span>
                    }
                }
            }

<span class="fc bfc" id="L900" title="All 2 branches covered.">            if(clazz.isInterface()){</span>
                JSONObject object;
<span class="fc bfc" id="L902" title="All 2 branches covered.">                if(map instanceof JSONObject){</span>
<span class="fc" id="L903">                    object = (JSONObject) map;</span>
                } else{
<span class="fc" id="L905">                    object = new JSONObject(map);</span>
                }
<span class="fc bfc" id="L907" title="All 2 branches covered.">                if(config == null){</span>
<span class="fc" id="L908">                    config = ParserConfig.getGlobalInstance();</span>
                }
<span class="fc" id="L910">                ObjectDeserializer deserializer = config.getDeserializers().get(clazz);</span>
<span class="fc bfc" id="L911" title="All 2 branches covered.">                if(deserializer != null){</span>
<span class="fc" id="L912">                    String json = JSON.toJSONString(object);</span>
<span class="fc" id="L913">                    return (T) JSON.parseObject(json, clazz);</span>
                }
<span class="fc" id="L915">                return (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</span>
                        new Class&lt;?&gt;[]{clazz}, object);
            }

<span class="fc bfc" id="L919" title="All 2 branches covered.">            if(clazz == Locale.class){</span>
<span class="fc" id="L920">                Object arg0 = map.get(&quot;language&quot;);</span>
<span class="fc" id="L921">                Object arg1 = map.get(&quot;country&quot;);</span>
<span class="pc bpc" id="L922" title="1 of 2 branches missed.">                if(arg0 instanceof String){</span>
<span class="fc" id="L923">                    String language = (String) arg0;</span>
<span class="pc bpc" id="L924" title="1 of 2 branches missed.">                    if(arg1 instanceof String){</span>
<span class="fc" id="L925">                        String country = (String) arg1;</span>
<span class="fc" id="L926">                        return (T) new Locale(language, country);</span>
<span class="nc bnc" id="L927" title="All 2 branches missed.">                    } else if(arg1 == null){</span>
<span class="nc" id="L928">                        return (T) new Locale(language);</span>
                    }
                }
            }

<span class="pc bpc" id="L933" title="1 of 4 branches missed.">            if (clazz == String.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L934">                return (T) map.toString();</span>
            }

<span class="pc bpc" id="L937" title="1 of 4 branches missed.">            if (clazz == LinkedHashMap.class &amp;&amp; map instanceof JSONObject) {</span>
<span class="fc" id="L938">                JSONObject jsonObject = (JSONObject) map;</span>
<span class="fc" id="L939">                Map innerMap = jsonObject.getInnerMap();</span>
<span class="pc bpc" id="L940" title="1 of 2 branches missed.">                if (innerMap instanceof LinkedHashMap) {</span>
<span class="fc" id="L941">                    return (T) innerMap;</span>
                } else {
<span class="nc" id="L943">                    LinkedHashMap linkedHashMap = new LinkedHashMap();</span>
<span class="nc" id="L944">                    linkedHashMap.putAll(innerMap);</span>
                }
            }

<span class="fc bfc" id="L948" title="All 2 branches covered.">            if (config == null) {</span>
<span class="fc" id="L949">                config = ParserConfig.getGlobalInstance();</span>
            }

<span class="fc" id="L952">            JavaBeanDeserializer javaBeanDeser = null;</span>
<span class="fc" id="L953">            ObjectDeserializer deserizer = config.getDeserializer(clazz);</span>
<span class="pc bpc" id="L954" title="1 of 2 branches missed.">            if (deserizer instanceof JavaBeanDeserializer) {</span>
<span class="fc" id="L955">                javaBeanDeser = (JavaBeanDeserializer) deserizer;</span>
            }

<span class="pc bpc" id="L958" title="1 of 2 branches missed.">            if(javaBeanDeser == null){</span>
<span class="nc" id="L959">                throw new JSONException(&quot;can not get javaBeanDeserializer. &quot; + clazz.getName());</span>
            }
<span class="fc" id="L961">            return (T) javaBeanDeser.createInstance(map, config);</span>
<span class="fc" id="L962">        } catch(Exception e){</span>
<span class="fc" id="L963">            throw new JSONException(e.getMessage(), e);</span>
        }
    }

    private static void addBaseClassMappings(){
<span class="fc" id="L968">        mappings.put(&quot;byte&quot;, byte.class);</span>
<span class="fc" id="L969">        mappings.put(&quot;short&quot;, short.class);</span>
<span class="fc" id="L970">        mappings.put(&quot;int&quot;, int.class);</span>
<span class="fc" id="L971">        mappings.put(&quot;long&quot;, long.class);</span>
<span class="fc" id="L972">        mappings.put(&quot;float&quot;, float.class);</span>
<span class="fc" id="L973">        mappings.put(&quot;double&quot;, double.class);</span>
<span class="fc" id="L974">        mappings.put(&quot;boolean&quot;, boolean.class);</span>
<span class="fc" id="L975">        mappings.put(&quot;char&quot;, char.class);</span>
<span class="fc" id="L976">        mappings.put(&quot;[byte&quot;, byte[].class);</span>
<span class="fc" id="L977">        mappings.put(&quot;[short&quot;, short[].class);</span>
<span class="fc" id="L978">        mappings.put(&quot;[int&quot;, int[].class);</span>
<span class="fc" id="L979">        mappings.put(&quot;[long&quot;, long[].class);</span>
<span class="fc" id="L980">        mappings.put(&quot;[float&quot;, float[].class);</span>
<span class="fc" id="L981">        mappings.put(&quot;[double&quot;, double[].class);</span>
<span class="fc" id="L982">        mappings.put(&quot;[boolean&quot;, boolean[].class);</span>
<span class="fc" id="L983">        mappings.put(&quot;[char&quot;, char[].class);</span>
<span class="fc" id="L984">        mappings.put(&quot;[B&quot;, byte[].class);</span>
<span class="fc" id="L985">        mappings.put(&quot;[S&quot;, short[].class);</span>
<span class="fc" id="L986">        mappings.put(&quot;[I&quot;, int[].class);</span>
<span class="fc" id="L987">        mappings.put(&quot;[J&quot;, long[].class);</span>
<span class="fc" id="L988">        mappings.put(&quot;[F&quot;, float[].class);</span>
<span class="fc" id="L989">        mappings.put(&quot;[D&quot;, double[].class);</span>
<span class="fc" id="L990">        mappings.put(&quot;[C&quot;, char[].class);</span>
<span class="fc" id="L991">        mappings.put(&quot;[Z&quot;, boolean[].class);</span>
<span class="fc" id="L992">        Class&lt;?&gt;[] classes = new Class[]{</span>
                Object.class,
                java.lang.Cloneable.class,
<span class="fc" id="L995">                loadClass(&quot;java.lang.AutoCloseable&quot;),</span>
                java.lang.Exception.class,
                java.lang.RuntimeException.class,
                java.lang.IllegalAccessError.class,
                java.lang.IllegalAccessException.class,
                java.lang.IllegalArgumentException.class,
                java.lang.IllegalMonitorStateException.class,
                java.lang.IllegalStateException.class,
                java.lang.IllegalThreadStateException.class,
                java.lang.IndexOutOfBoundsException.class,
                java.lang.InstantiationError.class,
                java.lang.InstantiationException.class,
                java.lang.InternalError.class,
                java.lang.InterruptedException.class,
                java.lang.LinkageError.class,
                java.lang.NegativeArraySizeException.class,
                java.lang.NoClassDefFoundError.class,
                java.lang.NoSuchFieldError.class,
                java.lang.NoSuchFieldException.class,
                java.lang.NoSuchMethodError.class,
                java.lang.NoSuchMethodException.class,
                java.lang.NullPointerException.class,
                java.lang.NumberFormatException.class,
                java.lang.OutOfMemoryError.class,
                java.lang.SecurityException.class,
                java.lang.StackOverflowError.class,
                java.lang.StringIndexOutOfBoundsException.class,
                java.lang.TypeNotPresentException.class,
                java.lang.VerifyError.class,
                java.lang.StackTraceElement.class,
                java.util.HashMap.class,
                java.util.Hashtable.class,
                java.util.TreeMap.class,
                java.util.IdentityHashMap.class,
                java.util.WeakHashMap.class,
                java.util.LinkedHashMap.class,
                java.util.HashSet.class,
                java.util.LinkedHashSet.class,
                java.util.TreeSet.class,
                java.util.concurrent.TimeUnit.class,
                java.util.concurrent.ConcurrentHashMap.class,
<span class="fc" id="L1036">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListMap&quot;),</span>
<span class="fc" id="L1037">                loadClass(&quot;java.util.concurrent.ConcurrentSkipListSet&quot;),</span>
                java.util.concurrent.atomic.AtomicInteger.class,
                java.util.concurrent.atomic.AtomicLong.class,
<span class="fc" id="L1040">                java.util.Collections.EMPTY_MAP.getClass(),</span>
                java.util.BitSet.class,
                java.util.Calendar.class,
                java.util.Date.class,
                java.util.Locale.class,
                java.util.UUID.class,
                java.sql.Time.class,
                java.sql.Date.class,
                java.sql.Timestamp.class,
                java.text.SimpleDateFormat.class,
                com.alibaba.fastjson.JSONObject.class,
        };
<span class="fc bfc" id="L1052" title="All 2 branches covered.">        for(Class clazz : classes){</span>
<span class="pc bpc" id="L1053" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1054">                continue;</span>
            }
<span class="fc" id="L1056">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1058">        String[] awt = new String[]{</span>
                &quot;java.awt.Rectangle&quot;,
                &quot;java.awt.Point&quot;,
                &quot;java.awt.Font&quot;,
                &quot;java.awt.Color&quot;};
<span class="fc bfc" id="L1063" title="All 2 branches covered.">        for(String className : awt){</span>
<span class="fc" id="L1064">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1065" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1066">                break;</span>
            }
<span class="fc" id="L1068">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1070">        String[] spring = new String[]{</span>
                &quot;org.springframework.util.LinkedMultiValueMap&quot;,
                &quot;org.springframework.util.LinkedCaseInsensitiveMap&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocation&quot;,
                &quot;org.springframework.remoting.support.RemoteInvocationResult&quot;,
                &quot;org.springframework.security.web.savedrequest.DefaultSavedRequest&quot;,
                &quot;org.springframework.security.web.savedrequest.SavedCookie&quot;,
                &quot;org.springframework.security.web.csrf.DefaultCsrfToken&quot;,
                &quot;org.springframework.security.web.authentication.WebAuthenticationDetails&quot;,
                &quot;org.springframework.security.core.context.SecurityContextImpl&quot;,
                &quot;org.springframework.security.authentication.UsernamePasswordAuthenticationToken&quot;,
                &quot;org.springframework.security.core.authority.SimpleGrantedAuthority&quot;,
                &quot;org.springframework.security.core.userdetails.User&quot;
        };
<span class="fc bfc" id="L1084" title="All 2 branches covered.">        for(String className : spring){</span>
<span class="fc" id="L1085">            Class&lt;?&gt; clazz = loadClass(className);</span>
<span class="pc bpc" id="L1086" title="1 of 2 branches missed.">            if(clazz == null){</span>
<span class="nc" id="L1087">                break;</span>
            }
<span class="fc" id="L1089">            mappings.put(clazz.getName(), clazz);</span>
        }
<span class="fc" id="L1091">    }</span>

    public static void clearClassMapping(){
<span class="fc" id="L1094">        mappings.clear();</span>
<span class="fc" id="L1095">        addBaseClassMappings();</span>
<span class="fc" id="L1096">    }</span>

    public static Class&lt;?&gt; loadClass(String className){
<span class="fc" id="L1099">        return loadClass(className, null);</span>
    }

    public static boolean isPath(Class&lt;?&gt; clazz){
<span class="pc bpc" id="L1103" title="1 of 4 branches missed.">        if(pathClass == null &amp;&amp; !pathClass_error){</span>
            try{
<span class="fc" id="L1105">                pathClass = Class.forName(&quot;java.nio.file.Path&quot;);</span>
<span class="nc" id="L1106">            } catch(Throwable ex){</span>
<span class="nc" id="L1107">                pathClass_error = true;</span>
<span class="fc" id="L1108">            }</span>
        }
<span class="pc bpc" id="L1110" title="1 of 2 branches missed.">        if(pathClass != null){</span>
<span class="fc" id="L1111">            return pathClass.isAssignableFrom(clazz);</span>
        }
<span class="nc" id="L1113">        return false;</span>
    }

    public static Class&lt;?&gt; getClassFromMapping(String className){
<span class="fc" id="L1117">        return mappings.get(className);</span>
    }

    public static Class&lt;?&gt; loadClass(String className, ClassLoader classLoader){
<span class="fc bfc" id="L1121" title="All 4 branches covered.">        if(className == null || className.length() == 0){</span>
<span class="fc" id="L1122">            return null;</span>
        }
<span class="fc" id="L1124">        Class&lt;?&gt; clazz = mappings.get(className);</span>
<span class="fc bfc" id="L1125" title="All 2 branches covered.">        if(clazz != null){</span>
<span class="fc" id="L1126">            return clazz;</span>
        }
<span class="fc bfc" id="L1128" title="All 2 branches covered.">        if(className.charAt(0) == '['){</span>
<span class="fc" id="L1129">            Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);</span>
<span class="fc" id="L1130">            return Array.newInstance(componentType, 0).getClass();</span>
        }
<span class="pc bpc" id="L1132" title="1 of 4 branches missed.">        if(className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)){</span>
<span class="fc" id="L1133">            String newClassName = className.substring(1, className.length() - 1);</span>
<span class="fc" id="L1134">            return loadClass(newClassName, classLoader);</span>
        }
        try{
<span class="fc bfc" id="L1137" title="All 2 branches covered.">            if(classLoader != null){</span>
<span class="fc" id="L1138">                clazz = classLoader.loadClass(className);</span>
<span class="fc" id="L1139">                mappings.put(className, clazz);</span>
<span class="fc" id="L1140">                return clazz;</span>
            }
<span class="fc" id="L1142">        } catch(Throwable e){</span>
<span class="fc" id="L1143">            e.printStackTrace();</span>
            // skip
<span class="fc" id="L1145">        }</span>
        try{
<span class="fc" id="L1147">            ClassLoader contextClassLoader = Thread.currentThread().getContextClassLoader();</span>
<span class="pc bpc" id="L1148" title="1 of 4 branches missed.">            if(contextClassLoader != null &amp;&amp; contextClassLoader != classLoader){</span>
<span class="fc" id="L1149">                clazz = contextClassLoader.loadClass(className);</span>
<span class="fc" id="L1150">                mappings.put(className, clazz);</span>
<span class="fc" id="L1151">                return clazz;</span>
            }
<span class="fc" id="L1153">        } catch(Throwable e){</span>
            // skip
<span class="fc" id="L1155">        }</span>
        try{
<span class="fc" id="L1157">            clazz = Class.forName(className);</span>
<span class="fc" id="L1158">            mappings.put(className, clazz);</span>
<span class="fc" id="L1159">            return clazz;</span>
<span class="fc" id="L1160">        } catch(Throwable e){</span>
            // skip
        }
<span class="fc" id="L1163">        return clazz;</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1169">        return buildBeanInfo(beanType, aliasMap, propertyNamingStrategy, false);</span>
    }

    public static SerializeBeanInfo buildBeanInfo(Class&lt;?&gt; beanType //
            , Map&lt;String,String&gt; aliasMap //
            , PropertyNamingStrategy propertyNamingStrategy //
            , boolean fieldBased //
    ){
<span class="fc" id="L1177">        JSONType jsonType = TypeUtils.getAnnotation(beanType,JSONType.class);</span>
<span class="fc" id="L1178">        String[] orders = null;</span>
        final int features;
<span class="fc" id="L1180">        String typeName = null, typeKey = null;</span>
<span class="fc bfc" id="L1181" title="All 2 branches covered.">        if(jsonType != null){</span>
<span class="fc" id="L1182">            orders = jsonType.orders();</span>

<span class="fc" id="L1184">            typeName = jsonType.typeName();</span>
<span class="fc bfc" id="L1185" title="All 2 branches covered.">            if(typeName.length() == 0){</span>
<span class="fc" id="L1186">                typeName = null;</span>
            }

<span class="fc" id="L1189">            PropertyNamingStrategy jsonTypeNaming = jsonType.naming();</span>
<span class="pc bpc" id="L1190" title="1 of 4 branches missed.">            if (jsonTypeNaming != null &amp;&amp; jsonTypeNaming != PropertyNamingStrategy.CamelCase) {</span>
<span class="fc" id="L1191">                propertyNamingStrategy = jsonTypeNaming;</span>
            }

<span class="fc" id="L1194">            features = SerializerFeature.of(jsonType.serialzeFeatures());</span>
<span class="fc" id="L1195">            for(Class&lt;?&gt; supperClass = beanType.getSuperclass()</span>
<span class="pc bpc" id="L1196" title="1 of 4 branches missed.">                ; supperClass != null &amp;&amp; supperClass != Object.class</span>
<span class="fc" id="L1197">                    ; supperClass = supperClass.getSuperclass()){</span>
<span class="fc" id="L1198">                JSONType superJsonType = TypeUtils.getAnnotation(supperClass,JSONType.class);</span>
<span class="fc bfc" id="L1199" title="All 2 branches covered.">                if(superJsonType == null){</span>
<span class="fc" id="L1200">                    break;</span>
                }
<span class="fc" id="L1202">                typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1203" title="1 of 2 branches missed.">                if(typeKey.length() != 0){</span>
<span class="nc" id="L1204">                    break;</span>
                }
            }

<span class="pc bfc" id="L1208" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : beanType.getInterfaces()){</span>
<span class="fc" id="L1209">                JSONType superJsonType = TypeUtils.getAnnotation(interfaceClass,JSONType.class);</span>
<span class="pc bpc" id="L1210" title="1 of 2 branches missed.">                if(superJsonType != null){</span>
<span class="fc" id="L1211">                    typeKey = superJsonType.typeKey();</span>
<span class="pc bpc" id="L1212" title="1 of 2 branches missed.">                    if(typeKey.length() != 0){</span>
<span class="fc" id="L1213">                        break;</span>
                    }
                }
            }

<span class="fc bfc" id="L1218" title="All 4 branches covered.">            if(typeKey != null &amp;&amp; typeKey.length() == 0){</span>
<span class="fc" id="L1219">                typeKey = null;</span>
            }
<span class="fc" id="L1221">        } else{</span>
<span class="fc" id="L1222">            features = 0;</span>
        }
        // fieldName,field ，先生成fieldName的快照，减少之后的findField的轮询
<span class="fc" id="L1225">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1226">        ParserConfig.parserAllFieldToCache(beanType, fieldCacheMap);</span>
<span class="fc bfc" id="L1227" title="All 2 branches covered.">        List&lt;FieldInfo&gt; fieldInfoList = fieldBased</span>
<span class="fc" id="L1228">                ? computeGettersWithFieldBase(beanType, aliasMap, false, propertyNamingStrategy) //</span>
<span class="fc" id="L1229">                : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, false, propertyNamingStrategy);</span>
<span class="fc" id="L1230">        FieldInfo[] fields = new FieldInfo[fieldInfoList.size()];</span>
<span class="fc" id="L1231">        fieldInfoList.toArray(fields);</span>
        FieldInfo[] sortedFields;
        List&lt;FieldInfo&gt; sortedFieldList;
<span class="fc bfc" id="L1234" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length != 0){</span>
<span class="pc bpc" id="L1235" title="1 of 2 branches missed.">            sortedFieldList = fieldBased</span>
<span class="pc" id="L1236">                    ? computeGettersWithFieldBase(beanType, aliasMap, true, propertyNamingStrategy) //</span>
<span class="fc" id="L1237">                    : computeGetters(beanType, jsonType, aliasMap, fieldCacheMap, true, propertyNamingStrategy);</span>
        } else{
<span class="fc" id="L1239">            sortedFieldList = new ArrayList&lt;FieldInfo&gt;(fieldInfoList);</span>
<span class="fc" id="L1240">            Collections.sort(sortedFieldList);</span>
        }
<span class="fc" id="L1242">        sortedFields = new FieldInfo[sortedFieldList.size()];</span>
<span class="fc" id="L1243">        sortedFieldList.toArray(sortedFields);</span>
<span class="fc bfc" id="L1244" title="All 2 branches covered.">        if(Arrays.equals(sortedFields, fields)){</span>
<span class="fc" id="L1245">            sortedFields = fields;</span>
        }
<span class="fc" id="L1247">        return new SerializeBeanInfo(beanType, jsonType, typeName, typeKey, features, fields, sortedFields);</span>
    }

    public static List&lt;FieldInfo&gt; computeGettersWithFieldBase(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            boolean sorted, //
            PropertyNamingStrategy propertyNamingStrategy){
<span class="fc" id="L1255">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc bfc" id="L1256" title="All 2 branches covered.">        for(Class&lt;?&gt; currentClass = clazz; currentClass != null; currentClass = currentClass.getSuperclass()){</span>
<span class="fc" id="L1257">            Field[] fields = currentClass.getDeclaredFields();</span>
<span class="fc" id="L1258">            computeFields(currentClass, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
        }
<span class="fc" id="L1260">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap){
<span class="fc" id="L1264">        return computeGetters(clazz, aliasMap, true);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, Map&lt;String,String&gt; aliasMap, boolean sorted){
<span class="fc" id="L1268">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc" id="L1269">        Map&lt;String,Field&gt; fieldCacheMap = new HashMap&lt;String,Field&gt;();</span>
<span class="fc" id="L1270">        ParserConfig.parserAllFieldToCache(clazz, fieldCacheMap);</span>
<span class="fc" id="L1271">        return computeGetters(clazz, jsonType, aliasMap, fieldCacheMap, sorted, PropertyNamingStrategy.CamelCase);</span>
    }

    public static List&lt;FieldInfo&gt; computeGetters(Class&lt;?&gt; clazz, //
                                                 JSONType jsonType, //
                                                 Map&lt;String,String&gt; aliasMap, //
                                                 Map&lt;String,Field&gt; fieldCacheMap, //
                                                 boolean sorted, //
                                                 PropertyNamingStrategy propertyNamingStrategy //
    ){
<span class="fc" id="L1281">        Map&lt;String,FieldInfo&gt; fieldInfoMap = new LinkedHashMap&lt;String,FieldInfo&gt;();</span>
<span class="fc" id="L1282">        boolean kotlin = TypeUtils.isKotlin(clazz);</span>
        // for kotlin
<span class="fc" id="L1284">        Constructor[] constructors = null;</span>
<span class="fc" id="L1285">        Annotation[][] paramAnnotationArrays = null;</span>
<span class="fc" id="L1286">        String[] paramNames = null;</span>
<span class="fc" id="L1287">        short[] paramNameMapping = null;</span>
<span class="fc" id="L1288">        Method[] methods = clazz.getMethods();</span>
<span class="fc bfc" id="L1289" title="All 2 branches covered.">        for(Method method : methods){</span>
<span class="fc" id="L1290">            String methodName = method.getName();</span>
<span class="fc" id="L1291">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1292">            String label = null;</span>
<span class="fc bfc" id="L1293" title="All 2 branches covered.">            if(Modifier.isStatic(method.getModifiers())){</span>
<span class="fc" id="L1294">                continue;</span>
            }
<span class="fc bfc" id="L1296" title="All 2 branches covered.">            if(method.getReturnType().equals(Void.TYPE)){</span>
<span class="fc" id="L1297">                continue;</span>
            }
<span class="fc bfc" id="L1299" title="All 2 branches covered.">            if(method.getParameterTypes().length != 0){</span>
<span class="fc" id="L1300">                continue;</span>
            }
<span class="fc bfc" id="L1302" title="All 2 branches covered.">            if(method.getReturnType() == ClassLoader.class){</span>
<span class="fc" id="L1303">                continue;</span>
            }

<span class="fc bfc" id="L1306" title="All 2 branches covered.">            if(methodName.equals(&quot;getMetaClass&quot;)</span>
<span class="pc bpc" id="L1307" title="1 of 2 branches missed.">                    &amp;&amp; method.getReturnType().getName().equals(&quot;groovy.lang.MetaClass&quot;)){</span>
<span class="fc" id="L1308">                continue;</span>
            }
<span class="fc bfc" id="L1310" title="All 2 branches covered.">            if(methodName.equals(&quot;getSuppressed&quot;)</span>
<span class="pc bpc" id="L1311" title="1 of 2 branches missed.">                    &amp;&amp; method.getDeclaringClass() == Throwable.class){</span>
<span class="fc" id="L1312">                continue;</span>
            }

<span class="fc bfc" id="L1315" title="All 4 branches covered.">            if(kotlin &amp;&amp; isKotlinIgnore(clazz, methodName)){</span>
<span class="fc" id="L1316">                continue;</span>
            }
<span class="fc" id="L1318">            JSONField annotation = method.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1319" title="All 2 branches covered.">            if(annotation == null){</span>
<span class="fc" id="L1320">                annotation = getSuperMethodAnnotation(clazz, method);</span>
            }
<span class="fc bfc" id="L1322" title="All 4 branches covered.">            if(annotation == null &amp;&amp; kotlin){</span>
<span class="fc bfc" id="L1323" title="All 2 branches covered.">                if(constructors == null){</span>
<span class="fc" id="L1324">                    constructors = clazz.getDeclaredConstructors();</span>
<span class="fc" id="L1325">                    Constructor creatorConstructor = TypeUtils.getKoltinConstructor(constructors);</span>
<span class="pc bpc" id="L1326" title="1 of 2 branches missed.">                    if(creatorConstructor != null){</span>
<span class="fc" id="L1327">                        paramAnnotationArrays = creatorConstructor.getParameterAnnotations();</span>
<span class="fc" id="L1328">                        paramNames = TypeUtils.getKoltinConstructorParameters(clazz);</span>
<span class="pc bpc" id="L1329" title="1 of 2 branches missed.">                        if(paramNames != null){</span>
<span class="fc" id="L1330">                            String[] paramNames_sorted = new String[paramNames.length];</span>
<span class="fc" id="L1331">                            System.arraycopy(paramNames, 0, paramNames_sorted, 0, paramNames.length);</span>

<span class="fc" id="L1333">                            Arrays.sort(paramNames_sorted);</span>
<span class="fc" id="L1334">                            paramNameMapping = new short[paramNames.length];</span>
<span class="fc bfc" id="L1335" title="All 2 branches covered.">                            for(short p = 0; p &lt; paramNames.length; p++){</span>
<span class="fc" id="L1336">                                int index = Arrays.binarySearch(paramNames_sorted, paramNames[p]);</span>
<span class="fc" id="L1337">                                paramNameMapping[index] = p;</span>
                            }
<span class="fc" id="L1339">                            paramNames = paramNames_sorted;</span>
                        }
                    }
                }
<span class="pc bpc" id="L1343" title="2 of 6 branches missed.">                if(paramNames != null &amp;&amp; paramNameMapping != null &amp;&amp; methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc" id="L1344">                    String propertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1345">                    int p = Arrays.binarySearch(paramNames, propertyName);</span>
<span class="fc bfc" id="L1346" title="All 2 branches covered.">                    if (p &lt; 0) {</span>
<span class="fc bfc" id="L1347" title="All 2 branches covered.">                        for (int i = 0; i &lt; paramNames.length; i++) {</span>
<span class="fc bfc" id="L1348" title="All 2 branches covered.">                            if (propertyName.equalsIgnoreCase(paramNames[i])) {</span>
<span class="fc" id="L1349">                                p = i;</span>
<span class="fc" id="L1350">                                break;</span>
                            }
                        }
                    }
<span class="fc bfc" id="L1354" title="All 2 branches covered.">                    if(p &gt;= 0){</span>
<span class="fc" id="L1355">                        short index = paramNameMapping[p];</span>
<span class="fc" id="L1356">                        Annotation[] paramAnnotations = paramAnnotationArrays[index];</span>
<span class="pc bpc" id="L1357" title="1 of 2 branches missed.">                        if(paramAnnotations != null){</span>
<span class="pc bfc" id="L1358" title="All 2 branches covered.">                            for(Annotation paramAnnotation : paramAnnotations){</span>
<span class="pc bpc" id="L1359" title="1 of 2 branches missed.">                                if(paramAnnotation instanceof JSONField){</span>
<span class="fc" id="L1360">                                    annotation = (JSONField) paramAnnotation;</span>
<span class="fc" id="L1361">                                    break;</span>
                                }
                            }
                        }
<span class="fc bfc" id="L1365" title="All 2 branches covered.">                        if(annotation == null){</span>
<span class="fc" id="L1366">                            Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1367" title="All 2 branches covered.">                            if(field != null){</span>
<span class="fc" id="L1368">                                annotation = field.getAnnotation(JSONField.class);</span>
                            }
                        }
                    }
                }
            }
<span class="fc bfc" id="L1374" title="All 2 branches covered.">            if(annotation != null){</span>
<span class="fc bfc" id="L1375" title="All 2 branches covered.">                if(!annotation.serialize()){</span>
<span class="fc" id="L1376">                    continue;</span>
                }
<span class="fc" id="L1378">                ordinal = annotation.ordinal();</span>
<span class="fc" id="L1379">                serialzeFeatures = SerializerFeature.of(annotation.serialzeFeatures());</span>
<span class="fc" id="L1380">                parserFeatures = Feature.of(annotation.parseFeatures());</span>
<span class="fc bfc" id="L1381" title="All 2 branches covered.">                if(annotation.name().length() != 0){</span>
<span class="fc" id="L1382">                    String propertyName = annotation.name();</span>
<span class="fc bfc" id="L1383" title="All 2 branches covered.">                    if(aliasMap != null){</span>
<span class="fc" id="L1384">                        propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1385" title="1 of 2 branches missed.">                        if(propertyName == null){</span>
<span class="fc" id="L1386">                            continue;</span>
                        }
                    }
<span class="fc" id="L1389">                    FieldInfo fieldInfo = new FieldInfo(propertyName, method, null, clazz, null, ordinal,</span>
                            serialzeFeatures, parserFeatures, annotation, null, label);
<span class="fc" id="L1391">                    fieldInfoMap.put(propertyName, fieldInfo);</span>
<span class="fc" id="L1392">                    continue;</span>
                }
<span class="fc bfc" id="L1394" title="All 2 branches covered.">                if(annotation.label().length() != 0){</span>
<span class="fc" id="L1395">                    label = annotation.label();</span>
                }
            }
<span class="fc bfc" id="L1398" title="All 2 branches covered.">            if(methodName.startsWith(&quot;get&quot;)){</span>
<span class="fc bfc" id="L1399" title="All 2 branches covered.">                if(methodName.length() &lt; 4){</span>
<span class="fc" id="L1400">                    continue;</span>
                }
<span class="fc bfc" id="L1402" title="All 2 branches covered.">                if(methodName.equals(&quot;getClass&quot;)){</span>
<span class="fc" id="L1403">                    continue;</span>
                }
<span class="fc bfc" id="L1405" title="All 4 branches covered.">                if(methodName.equals(&quot;getDeclaringClass&quot;) &amp;&amp; clazz.isEnum()){</span>
<span class="fc" id="L1406">                    continue;</span>
                }
<span class="fc" id="L1408">                char c3 = methodName.charAt(3);</span>
                String propertyName;
<span class="fc bfc" id="L1410" title="All 4 branches covered.">                if(Character.isUpperCase(c3) //</span>
                        || c3 &gt; 512 // for unicode method name
                        ){
<span class="fc bfc" id="L1413" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1414">                        propertyName = decapitalize(methodName.substring(3));</span>
                    } else{
<span class="fc" id="L1416">                        propertyName = Character.toLowerCase(methodName.charAt(3)) + methodName.substring(4);</span>
                    }
<span class="fc" id="L1418">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 3);</span>
<span class="fc bfc" id="L1419" title="All 2 branches covered.">                } else if(c3 == '_'){</span>
<span class="fc" id="L1420">                    propertyName = methodName.substring(4);</span>
<span class="fc bfc" id="L1421" title="All 2 branches covered.">                } else if(c3 == 'f'){</span>
<span class="fc" id="L1422">                    propertyName = methodName.substring(3);</span>
<span class="pc bpc" id="L1423" title="1 of 4 branches missed.">                } else if(methodName.length() &gt;= 5 &amp;&amp; Character.isUpperCase(methodName.charAt(4))){</span>
<span class="fc" id="L1424">                    propertyName = decapitalize(methodName.substring(3));</span>
                } else{
                    continue;
                }
<span class="fc" id="L1428">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1429" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1430">                    continue;</span>
                }
                //假如bean的field很多的情况一下，轮询时将大大降低效率
<span class="fc" id="L1433">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1434" title="All 4 branches covered.">                if(field == null &amp;&amp; propertyName.length() &gt; 1){</span>
<span class="fc" id="L1435">                    char ch = propertyName.charAt(1);</span>
<span class="fc bfc" id="L1436" title="All 4 branches covered.">                    if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L1437">                        String javaBeanCompatiblePropertyName = decapitalize(methodName.substring(3));</span>
<span class="fc" id="L1438">                        field = ParserConfig.getFieldFromCache(javaBeanCompatiblePropertyName, fieldCacheMap);</span>
                    }
                }
<span class="fc" id="L1441">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1442" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1443">                    fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1444" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1445" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1446">                            continue;</span>
                        }
<span class="fc" id="L1448">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1449">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1450">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1451" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1452">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1453" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1454">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1455" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1456">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1460" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1461">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1465" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1466">                    propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L1467" title="All 2 branches covered.">                    if(propertyName == null){</span>
<span class="fc" id="L1468">                        continue;</span>
                    }
                }
<span class="fc bfc" id="L1471" title="All 2 branches covered.">                if(propertyNamingStrategy != null){</span>
<span class="fc" id="L1472">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
<span class="fc" id="L1474">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L1476">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
<span class="fc bfc" id="L1478" title="All 2 branches covered.">            if(methodName.startsWith(&quot;is&quot;)){</span>
<span class="fc bfc" id="L1479" title="All 2 branches covered.">                if(methodName.length() &lt; 3){</span>
<span class="fc" id="L1480">                    continue;</span>
                }
<span class="fc bfc" id="L1482" title="All 2 branches covered.">                if(method.getReturnType() != Boolean.TYPE</span>
<span class="fc bfc" id="L1483" title="All 2 branches covered.">                        &amp;&amp; method.getReturnType() != Boolean.class){</span>
<span class="fc" id="L1484">                    continue;</span>
                }
<span class="fc" id="L1486">                char c2 = methodName.charAt(2);</span>
                String propertyName;
<span class="fc bfc" id="L1488" title="All 2 branches covered.">                if(Character.isUpperCase(c2)){</span>
<span class="fc bfc" id="L1489" title="All 2 branches covered.">                    if(compatibleWithJavaBean){</span>
<span class="fc" id="L1490">                        propertyName = decapitalize(methodName.substring(2));</span>
                    } else{
<span class="fc" id="L1492">                        propertyName = Character.toLowerCase(methodName.charAt(2)) + methodName.substring(3);</span>
                    }
<span class="fc" id="L1494">                    propertyName = getPropertyNameByCompatibleFieldName(fieldCacheMap, methodName, propertyName, 2);</span>
<span class="fc bfc" id="L1495" title="All 2 branches covered.">                } else if(c2 == '_'){</span>
<span class="fc" id="L1496">                    propertyName = methodName.substring(3);</span>
<span class="fc bfc" id="L1497" title="All 2 branches covered.">                } else if(c2 == 'f'){</span>
<span class="fc" id="L1498">                    propertyName = methodName.substring(2);</span>
                } else{
                    continue;
                }
<span class="fc" id="L1502">                boolean ignore = isJSONTypeIgnore(clazz, propertyName);</span>
<span class="fc bfc" id="L1503" title="All 2 branches covered.">                if(ignore){</span>
<span class="fc" id="L1504">                    continue;</span>
                }
<span class="fc" id="L1506">                Field field = ParserConfig.getFieldFromCache(propertyName, fieldCacheMap);</span>
<span class="fc bfc" id="L1507" title="All 2 branches covered.">                if(field == null){</span>
<span class="fc" id="L1508">                    field = ParserConfig.getFieldFromCache(methodName, fieldCacheMap);</span>
                }
<span class="fc" id="L1510">                JSONField fieldAnnotation = null;</span>
<span class="fc bfc" id="L1511" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1512">                    fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1513" title="All 2 branches covered.">                    if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1514" title="All 2 branches covered.">                        if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1515">                            continue;</span>
                        }
<span class="fc" id="L1517">                        ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1518">                        serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1519">                        parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1520" title="All 2 branches covered.">                        if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1521">                            propertyName = fieldAnnotation.name();</span>
<span class="fc bfc" id="L1522" title="All 2 branches covered.">                            if(aliasMap != null){</span>
<span class="fc" id="L1523">                                propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1524" title="1 of 2 branches missed.">                                if(propertyName == null){</span>
<span class="fc" id="L1525">                                    continue;</span>
                                }
                            }
                        }
<span class="pc bpc" id="L1529" title="1 of 2 branches missed.">                        if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1530">                            label = fieldAnnotation.label();</span>
                        }
                    }
                }
<span class="fc bfc" id="L1534" title="All 2 branches covered.">                if(aliasMap != null){</span>
<span class="fc" id="L1535">                    propertyName = aliasMap.get(propertyName);</span>
<span class="pc bpc" id="L1536" title="1 of 2 branches missed.">                    if(propertyName == null){</span>
<span class="fc" id="L1537">                        continue;</span>
                    }
                }
<span class="pc bpc" id="L1540" title="1 of 2 branches missed.">                if(propertyNamingStrategy != null){</span>
<span class="nc" id="L1541">                    propertyName = propertyNamingStrategy.translate(propertyName);</span>
                }
                //优先选择get
<span class="fc bfc" id="L1544" title="All 2 branches covered.">                if(fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L1545">                    continue;</span>
                }
<span class="fc" id="L1547">                FieldInfo fieldInfo = new FieldInfo(propertyName, method, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        annotation, fieldAnnotation, label);
<span class="fc" id="L1549">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L1552">        Field[] fields = clazz.getFields();</span>
<span class="fc" id="L1553">        computeFields(clazz, aliasMap, propertyNamingStrategy, fieldInfoMap, fields);</span>
<span class="fc" id="L1554">        return getFieldInfos(clazz, sorted, fieldInfoMap);</span>
    }

    private static List&lt;FieldInfo&gt; getFieldInfos(Class&lt;?&gt; clazz, boolean sorted, Map&lt;String,FieldInfo&gt; fieldInfoMap){
<span class="fc" id="L1558">        List&lt;FieldInfo&gt; fieldInfoList = new ArrayList&lt;FieldInfo&gt;();</span>
<span class="fc" id="L1559">        String[] orders = null;</span>
<span class="fc" id="L1560">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L1561" title="All 2 branches covered.">        if(annotation != null){</span>
<span class="fc" id="L1562">            orders = annotation.orders();</span>
        }
<span class="fc bfc" id="L1564" title="All 4 branches covered.">        if(orders != null &amp;&amp; orders.length &gt; 0){</span>
<span class="fc" id="L1565">            LinkedHashMap&lt;String,FieldInfo&gt; map = new LinkedHashMap&lt;String,FieldInfo&gt;(fieldInfoList.size());</span>
<span class="fc bfc" id="L1566" title="All 2 branches covered.">            for(FieldInfo field : fieldInfoMap.values()){</span>
<span class="fc" id="L1567">                map.put(field.name, field);</span>
<span class="fc" id="L1568">            }</span>
<span class="fc" id="L1569">            int i = 0;</span>
<span class="fc bfc" id="L1570" title="All 2 branches covered.">            for(String item : orders){</span>
<span class="fc" id="L1571">                FieldInfo field = map.get(item);</span>
<span class="fc bfc" id="L1572" title="All 2 branches covered.">                if(field != null){</span>
<span class="fc" id="L1573">                    fieldInfoList.add(field);</span>
<span class="fc" id="L1574">                    map.remove(item);</span>
                }
            }
<span class="fc bfc" id="L1577" title="All 2 branches covered.">            for(FieldInfo field : map.values()){</span>
<span class="fc" id="L1578">                fieldInfoList.add(field);</span>
<span class="fc" id="L1579">            }</span>
<span class="fc" id="L1580">        } else{</span>
<span class="fc bfc" id="L1581" title="All 2 branches covered.">            for(FieldInfo fieldInfo : fieldInfoMap.values()){</span>
<span class="fc" id="L1582">                fieldInfoList.add(fieldInfo);</span>
<span class="fc" id="L1583">            }</span>
<span class="fc bfc" id="L1584" title="All 2 branches covered.">            if(sorted){</span>
<span class="fc" id="L1585">                Collections.sort(fieldInfoList);</span>
            }
        }
<span class="fc" id="L1588">        return fieldInfoList;</span>
    }

    private static void computeFields(
            Class&lt;?&gt; clazz, //
            Map&lt;String,String&gt; aliasMap, //
            PropertyNamingStrategy propertyNamingStrategy, //
            Map&lt;String,FieldInfo&gt; fieldInfoMap, //
            Field[] fields){
<span class="fc bfc" id="L1597" title="All 2 branches covered.">        for(Field field : fields){</span>
<span class="fc bfc" id="L1598" title="All 2 branches covered.">            if(Modifier.isStatic(field.getModifiers())){</span>
<span class="fc" id="L1599">                continue;</span>
            }
<span class="fc" id="L1601">            JSONField fieldAnnotation = field.getAnnotation(JSONField.class);</span>
<span class="fc" id="L1602">            int ordinal = 0, serialzeFeatures = 0, parserFeatures = 0;</span>
<span class="fc" id="L1603">            String propertyName = field.getName();</span>
<span class="fc" id="L1604">            String label = null;</span>
<span class="fc bfc" id="L1605" title="All 2 branches covered.">            if(fieldAnnotation != null){</span>
<span class="fc bfc" id="L1606" title="All 2 branches covered.">                if(!fieldAnnotation.serialize()){</span>
<span class="fc" id="L1607">                    continue;</span>
                }
<span class="fc" id="L1609">                ordinal = fieldAnnotation.ordinal();</span>
<span class="fc" id="L1610">                serialzeFeatures = SerializerFeature.of(fieldAnnotation.serialzeFeatures());</span>
<span class="fc" id="L1611">                parserFeatures = Feature.of(fieldAnnotation.parseFeatures());</span>
<span class="fc bfc" id="L1612" title="All 2 branches covered.">                if(fieldAnnotation.name().length() != 0){</span>
<span class="fc" id="L1613">                    propertyName = fieldAnnotation.name();</span>
                }
<span class="pc bpc" id="L1615" title="1 of 2 branches missed.">                if(fieldAnnotation.label().length() != 0){</span>
<span class="nc" id="L1616">                    label = fieldAnnotation.label();</span>
                }
            }
<span class="fc bfc" id="L1619" title="All 2 branches covered.">            if(aliasMap != null){</span>
<span class="fc" id="L1620">                propertyName = aliasMap.get(propertyName);</span>
<span class="fc bfc" id="L1621" title="All 2 branches covered.">                if(propertyName == null){</span>
<span class="fc" id="L1622">                    continue;</span>
                }
            }
<span class="fc bfc" id="L1625" title="All 2 branches covered.">            if(propertyNamingStrategy != null){</span>
<span class="fc" id="L1626">                propertyName = propertyNamingStrategy.translate(propertyName);</span>
            }
<span class="fc bfc" id="L1628" title="All 2 branches covered.">            if(!fieldInfoMap.containsKey(propertyName)){</span>
<span class="fc" id="L1629">                FieldInfo fieldInfo = new FieldInfo(propertyName, null, field, clazz, null, ordinal, serialzeFeatures, parserFeatures,</span>
                        null, fieldAnnotation, label);
<span class="fc" id="L1631">                fieldInfoMap.put(propertyName, fieldInfo);</span>
            }
        }
<span class="fc" id="L1634">    }</span>

    private static String getPropertyNameByCompatibleFieldName(Map&lt;String,Field&gt; fieldCacheMap, String methodName,
                                                               String propertyName, int fromIdx){
<span class="pc bpc" id="L1638" title="1 of 2 branches missed.">        if(compatibleWithFieldName){</span>
<span class="nc bnc" id="L1639" title="All 2 branches missed.">            if(!fieldCacheMap.containsKey(propertyName)){</span>
<span class="nc" id="L1640">                String tempPropertyName = methodName.substring(fromIdx);</span>
<span class="nc bnc" id="L1641" title="All 2 branches missed.">                return fieldCacheMap.containsKey(tempPropertyName) ? tempPropertyName : propertyName;</span>
            }
        }
<span class="fc" id="L1644">        return propertyName;</span>
    }

    public static JSONField getSuperMethodAnnotation(final Class&lt;?&gt; clazz, final Method method){
<span class="fc" id="L1648">        Class&lt;?&gt;[] interfaces = clazz.getInterfaces();</span>
<span class="fc bfc" id="L1649" title="All 2 branches covered.">        if(interfaces.length &gt; 0){</span>
<span class="fc" id="L1650">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L1651" title="All 2 branches covered.">            for(Class&lt;?&gt; interfaceClass : interfaces){</span>
<span class="fc bfc" id="L1652" title="All 2 branches covered.">                for(Method interfaceMethod : interfaceClass.getMethods()){</span>
<span class="fc" id="L1653">                    Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L1654" title="All 2 branches covered.">                    if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L1655">                        continue;</span>
                    }
<span class="fc bfc" id="L1657" title="All 2 branches covered.">                    if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L1658">                        continue;</span>
                    }
<span class="fc" id="L1660">                    boolean match = true;</span>
<span class="fc bfc" id="L1661" title="All 2 branches covered.">                    for(int i = 0; i &lt; types.length; ++i){</span>
<span class="fc bfc" id="L1662" title="All 2 branches covered.">                        if(!interfaceTypes[i].equals(types[i])){</span>
<span class="fc" id="L1663">                            match = false;</span>
<span class="fc" id="L1664">                            break;</span>
                        }
                    }
<span class="fc bfc" id="L1667" title="All 2 branches covered.">                    if(!match){</span>
<span class="fc" id="L1668">                        continue;</span>
                    }
<span class="fc" id="L1670">                    JSONField annotation = interfaceMethod.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1671" title="All 2 branches covered.">                    if(annotation != null){</span>
<span class="fc" id="L1672">                        return annotation;</span>
                    }
                }
            }
        }
<span class="fc" id="L1677">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L1678" title="All 2 branches covered.">        if(superClass == null){</span>
<span class="fc" id="L1679">            return null;</span>
        }
<span class="fc bfc" id="L1681" title="All 2 branches covered.">        if(Modifier.isAbstract(superClass.getModifiers())){</span>
<span class="fc" id="L1682">            Class&lt;?&gt;[] types = method.getParameterTypes();</span>
<span class="fc bfc" id="L1683" title="All 2 branches covered.">            for(Method interfaceMethod : superClass.getMethods()){</span>
<span class="fc" id="L1684">                Class&lt;?&gt;[] interfaceTypes = interfaceMethod.getParameterTypes();</span>
<span class="fc bfc" id="L1685" title="All 2 branches covered.">                if(interfaceTypes.length != types.length){</span>
<span class="fc" id="L1686">                    continue;</span>
                }
<span class="fc bfc" id="L1688" title="All 2 branches covered.">                if(!interfaceMethod.getName().equals(method.getName())){</span>
<span class="fc" id="L1689">                    continue;</span>
                }
<span class="fc" id="L1691">                boolean match = true;</span>
<span class="fc bfc" id="L1692" title="All 2 branches covered.">                for(int i = 0; i &lt; types.length; ++i){</span>
<span class="pc bpc" id="L1693" title="1 of 2 branches missed.">                    if(!interfaceTypes[i].equals(types[i])){</span>
<span class="nc" id="L1694">                        match = false;</span>
<span class="nc" id="L1695">                        break;</span>
                    }
                }
<span class="pc bpc" id="L1698" title="1 of 2 branches missed.">                if(!match){</span>
<span class="nc" id="L1699">                    continue;</span>
                }
<span class="fc" id="L1701">                JSONField annotation = interfaceMethod.getAnnotation(JSONField.class);</span>
<span class="fc bfc" id="L1702" title="All 2 branches covered.">                if(annotation != null){</span>
<span class="fc" id="L1703">                    return annotation;</span>
                }
            }
        }
<span class="fc" id="L1707">        return null;</span>
    }

    private static boolean isJSONTypeIgnore(Class&lt;?&gt; clazz, String propertyName){
<span class="fc" id="L1711">        JSONType jsonType = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L1712" title="All 2 branches covered.">        if(jsonType != null){</span>
            // 1、新增 includes 支持，如果 JSONType 同时设置了includes 和 ignores 属性，则以includes为准。
            // 2、个人认为对于大小写敏感的Java和JS而言，使用 equals() 比 equalsIgnoreCase() 更好，改动的唯一风险就是向后兼容性的问题
            // 不过，相信开发者应该都是严格按照大小写敏感的方式进行属性设置的
<span class="fc" id="L1716">            String[] fields = jsonType.includes();</span>
<span class="pc bpc" id="L1717" title="1 of 2 branches missed.">            if(fields.length &gt; 0){</span>
<span class="nc bnc" id="L1718" title="All 2 branches missed.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="nc bnc" id="L1719" title="All 2 branches missed.">                    if(propertyName.equals(fields[i])){</span>
<span class="nc" id="L1720">                        return false;</span>
                    }
                }
<span class="nc" id="L1723">                return true;</span>
            } else{
<span class="fc" id="L1725">                fields = jsonType.ignores();</span>
<span class="fc bfc" id="L1726" title="All 2 branches covered.">                for(int i = 0; i &lt; fields.length; i++){</span>
<span class="fc bfc" id="L1727" title="All 2 branches covered.">                    if(propertyName.equals(fields[i])){</span>
<span class="fc" id="L1728">                        return true;</span>
                    }
                }
            }
        }
<span class="fc bfc" id="L1733" title="All 4 branches covered.">        if(clazz.getSuperclass() != Object.class &amp;&amp; clazz.getSuperclass() != null){</span>
<span class="fc bfc" id="L1734" title="All 2 branches covered.">            if(isJSONTypeIgnore(clazz.getSuperclass(), propertyName)){</span>
<span class="fc" id="L1735">                return true;</span>
            }
        }
<span class="fc" id="L1738">        return false;</span>
    }

    public static boolean isGenericParamType(Type type){
<span class="fc bfc" id="L1742" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1743">            return true;</span>
        }
<span class="fc bfc" id="L1745" title="All 2 branches covered.">        if(type instanceof Class){</span>
<span class="fc" id="L1746">            Type superType = ((Class&lt;?&gt;) type).getGenericSuperclass();</span>
<span class="fc bfc" id="L1747" title="All 2 branches covered.">            if(superType == Object.class){</span>
<span class="fc" id="L1748">                return false;</span>
            }
<span class="fc" id="L1750">            return isGenericParamType(superType);</span>
        }
<span class="fc" id="L1752">        return false;</span>
    }

    public static Type getGenericParamType(Type type){
<span class="fc bfc" id="L1756" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1757">            return type;</span>
        }
<span class="pc bpc" id="L1759" title="1 of 2 branches missed.">        if(type instanceof Class){</span>
<span class="fc" id="L1760">            return getGenericParamType(((Class&lt;?&gt;) type).getGenericSuperclass());</span>
        }
<span class="nc" id="L1762">        return type;</span>
    }

    public static Type unwrapOptional(Type type){
<span class="fc bfc" id="L1766" title="All 2 branches covered.">        if(!optionalClassInited){</span>
            try{
<span class="fc" id="L1768">                optionalClass = Class.forName(&quot;java.util.Optional&quot;);</span>
<span class="nc" id="L1769">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L1772">                optionalClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L1775" title="1 of 2 branches missed.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1776">            ParameterizedType parameterizedType = (ParameterizedType) type;</span>
<span class="pc bpc" id="L1777" title="1 of 2 branches missed.">            if(parameterizedType.getRawType() == optionalClass){</span>
<span class="fc" id="L1778">                return parameterizedType.getActualTypeArguments()[0];</span>
            }
        }
<span class="nc" id="L1781">        return type;</span>
    }

    public static Class&lt;?&gt; getClass(Type type){
<span class="fc bfc" id="L1785" title="All 2 branches covered.">        if(type.getClass() == Class.class){</span>
<span class="fc" id="L1786">            return (Class&lt;?&gt;) type;</span>
        }

<span class="fc bfc" id="L1789" title="All 2 branches covered.">        if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1790">            return getClass(((ParameterizedType) type).getRawType());</span>
        }

<span class="fc bfc" id="L1793" title="All 2 branches covered.">        if(type instanceof TypeVariable){</span>
<span class="fc" id="L1794">            Type boundType = ((TypeVariable&lt;?&gt;) type).getBounds()[0];</span>
<span class="fc" id="L1795">            return (Class&lt;?&gt;) boundType;</span>
        }

<span class="pc bpc" id="L1798" title="1 of 2 branches missed.">        if(type instanceof WildcardType){</span>
<span class="fc" id="L1799">            Type[] upperBounds = ((WildcardType) type).getUpperBounds();</span>
<span class="pc bpc" id="L1800" title="1 of 2 branches missed.">            if (upperBounds.length == 1) {</span>
<span class="fc" id="L1801">                return getClass(upperBounds[0]);</span>
            }
        }

<span class="nc" id="L1805">        return Object.class;</span>
    }

    public static Field getField(Class&lt;?&gt; clazz, String fieldName, Field[] declaredFields){
<span class="fc bfc" id="L1809" title="All 2 branches covered.">        for(Field field : declaredFields){</span>
<span class="fc" id="L1810">            String itemName = field.getName();</span>
<span class="fc bfc" id="L1811" title="All 2 branches covered.">            if(fieldName.equals(itemName)){</span>
<span class="fc" id="L1812">                return field;</span>
            }

            char c0, c1;
<span class="fc bfc" id="L1816" title="All 2 branches covered.">            if (fieldName.length() &gt; 2</span>
<span class="fc bfc" id="L1817" title="All 4 branches covered.">                    &amp;&amp; (c0 = fieldName.charAt(0)) &gt;= 'a' &amp;&amp; c0 &lt;= 'z'</span>
<span class="fc bfc" id="L1818" title="All 4 branches covered.">                    &amp;&amp; (c1 = fieldName.charAt(1)) &gt;= 'A' &amp;&amp; c1 &lt;= 'Z'</span>
<span class="fc bfc" id="L1819" title="All 2 branches covered.">                    &amp;&amp; fieldName.equalsIgnoreCase(itemName)) {</span>
<span class="fc" id="L1820">                return field;</span>
            }
        }
<span class="fc" id="L1823">        Class&lt;?&gt; superClass = clazz.getSuperclass();</span>
<span class="fc bfc" id="L1824" title="All 4 branches covered.">        if(superClass != null &amp;&amp; superClass != Object.class){</span>
<span class="fc" id="L1825">            return getField(superClass, fieldName, superClass.getDeclaredFields());</span>
        }
<span class="fc" id="L1827">        return null;</span>
    }

    public static int getSerializeFeatures(Class&lt;?&gt; clazz){
<span class="nc" id="L1831">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="nc bnc" id="L1832" title="All 2 branches missed.">        if(annotation == null){</span>
<span class="nc" id="L1833">            return 0;</span>
        }
<span class="nc" id="L1835">        return SerializerFeature.of(annotation.serialzeFeatures());</span>
    }

    public static int getParserFeatures(Class&lt;?&gt; clazz){
<span class="fc" id="L1839">        JSONType annotation = TypeUtils.getAnnotation(clazz,JSONType.class);</span>
<span class="fc bfc" id="L1840" title="All 2 branches covered.">        if(annotation == null){</span>
<span class="fc" id="L1841">            return 0;</span>
        }
<span class="fc" id="L1843">        return Feature.of(annotation.parseFeatures());</span>
    }

    public static String decapitalize(String name){
<span class="pc bpc" id="L1847" title="2 of 4 branches missed.">        if(name == null || name.length() == 0){</span>
<span class="nc" id="L1848">            return name;</span>
        }
<span class="fc bfc" id="L1850" title="All 6 branches covered.">        if(name.length() &gt; 1 &amp;&amp; Character.isUpperCase(name.charAt(1)) &amp;&amp; Character.isUpperCase(name.charAt(0))){</span>
<span class="fc" id="L1851">            return name;</span>
        }
<span class="fc" id="L1853">        char chars[] = name.toCharArray();</span>
<span class="fc" id="L1854">        chars[0] = Character.toLowerCase(chars[0]);</span>
<span class="fc" id="L1855">        return new String(chars);</span>
    }

    static void setAccessible(AccessibleObject obj){
<span class="pc bpc" id="L1859" title="1 of 2 branches missed.">        if(!setAccessibleEnable){</span>
<span class="nc" id="L1860">            return;</span>
        }
<span class="fc bfc" id="L1862" title="All 2 branches covered.">        if(obj.isAccessible()){</span>
<span class="fc" id="L1863">            return;</span>
        }
        try{
<span class="fc" id="L1866">            obj.setAccessible(true);</span>
<span class="nc" id="L1867">        } catch(AccessControlException error){</span>
<span class="nc" id="L1868">            setAccessibleEnable = false;</span>
<span class="fc" id="L1869">        }</span>
<span class="fc" id="L1870">    }</span>

    public static Type getCollectionItemType(Type fieldType){
<span class="fc" id="L1873">        Type itemType = null;</span>
<span class="fc" id="L1874">        Class&lt;?&gt; clazz = null;</span>
<span class="fc bfc" id="L1875" title="All 2 branches covered.">        if(fieldType instanceof ParameterizedType){</span>
<span class="fc" id="L1876">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1877" title="All 2 branches covered.">            if(actualTypeArgument instanceof WildcardType){</span>
<span class="fc" id="L1878">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L1879">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L1880" title="1 of 2 branches missed.">                if(upperBounds.length == 1){</span>
<span class="fc" id="L1881">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc" id="L1884">            itemType = actualTypeArgument;</span>
<span class="fc bfc" id="L1885" title="All 2 branches covered.">        } else if(fieldType instanceof Class&lt;?&gt; //</span>
<span class="fc bfc" id="L1886" title="All 2 branches covered.">                &amp;&amp; !(clazz = (Class&lt;?&gt;) fieldType).getName().startsWith(&quot;java.&quot;)){</span>
<span class="fc" id="L1887">            Type superClass = clazz.getGenericSuperclass();</span>
<span class="fc" id="L1888">            itemType = TypeUtils.getCollectionItemType(superClass);</span>
        }
<span class="fc bfc" id="L1890" title="All 2 branches covered.">        if(itemType == null){</span>
<span class="fc" id="L1891">            itemType = Object.class;</span>
        }
<span class="fc" id="L1893">        return itemType;</span>
    }

    public static Class&lt;?&gt; getCollectionItemClass(Type fieldType){
<span class="fc bfc" id="L1897" title="All 2 branches covered.">        if(fieldType instanceof ParameterizedType){</span>
            Class&lt;?&gt; itemClass;
<span class="fc" id="L1899">            Type actualTypeArgument = ((ParameterizedType) fieldType).getActualTypeArguments()[0];</span>
<span class="fc bfc" id="L1900" title="All 2 branches covered.">            if(actualTypeArgument instanceof WildcardType){</span>
<span class="fc" id="L1901">                WildcardType wildcardType = (WildcardType) actualTypeArgument;</span>
<span class="fc" id="L1902">                Type[] upperBounds = wildcardType.getUpperBounds();</span>
<span class="pc bpc" id="L1903" title="1 of 2 branches missed.">                if(upperBounds.length == 1){</span>
<span class="fc" id="L1904">                    actualTypeArgument = upperBounds[0];</span>
                }
            }
<span class="fc bfc" id="L1907" title="All 2 branches covered.">            if(actualTypeArgument instanceof Class){</span>
<span class="fc" id="L1908">                itemClass = (Class&lt;?&gt;) actualTypeArgument;</span>
<span class="fc bfc" id="L1909" title="All 2 branches covered.">                if(!Modifier.isPublic(itemClass.getModifiers())){</span>
<span class="fc" id="L1910">                    throw new JSONException(&quot;can not create ASMParser&quot;);</span>
                }
            } else{
<span class="fc" id="L1913">                throw new JSONException(&quot;can not create ASMParser&quot;);</span>
            }
<span class="fc" id="L1915">            return itemClass;</span>
        }
<span class="fc" id="L1917">        return Object.class;</span>
    }

    public static Type checkPrimitiveArray(GenericArrayType genericArrayType) {
<span class="nc" id="L1921">        Type clz = genericArrayType;</span>
<span class="nc" id="L1922">        Type genericComponentType  = genericArrayType.getGenericComponentType();</span>

<span class="nc" id="L1924">        String prefix = &quot;[&quot;;</span>
<span class="nc bnc" id="L1925" title="All 2 branches missed.">        while (genericComponentType instanceof GenericArrayType) {</span>
<span class="nc" id="L1926">            genericComponentType = ((GenericArrayType) genericComponentType)</span>
<span class="nc" id="L1927">                    .getGenericComponentType();</span>
<span class="nc" id="L1928">            prefix += prefix;</span>
        }

<span class="nc bnc" id="L1931" title="All 2 branches missed.">        if (genericComponentType instanceof Class&lt;?&gt;) {</span>
<span class="nc" id="L1932">            Class&lt;?&gt; ck = (Class&lt;?&gt;) genericComponentType;</span>
<span class="nc bnc" id="L1933" title="All 2 branches missed.">            if (ck.isPrimitive()) {</span>
                try {
<span class="nc bnc" id="L1935" title="All 2 branches missed.">                    if (ck == boolean.class) {</span>
<span class="nc" id="L1936">                        clz = Class.forName(prefix + &quot;Z&quot;);</span>
<span class="nc bnc" id="L1937" title="All 2 branches missed.">                    } else if (ck == char.class) {</span>
<span class="nc" id="L1938">                        clz = Class.forName(prefix + &quot;C&quot;);</span>
<span class="nc bnc" id="L1939" title="All 2 branches missed.">                    } else if (ck == byte.class) {</span>
<span class="nc" id="L1940">                        clz = Class.forName(prefix + &quot;B&quot;);</span>
<span class="nc bnc" id="L1941" title="All 2 branches missed.">                    } else if (ck == short.class) {</span>
<span class="nc" id="L1942">                        clz = Class.forName(prefix + &quot;S&quot;);</span>
<span class="nc bnc" id="L1943" title="All 2 branches missed.">                    } else if (ck == int.class) {</span>
<span class="nc" id="L1944">                        clz = Class.forName(prefix + &quot;I&quot;);</span>
<span class="nc bnc" id="L1945" title="All 2 branches missed.">                    } else if (ck == long.class) {</span>
<span class="nc" id="L1946">                        clz = Class.forName(prefix + &quot;J&quot;);</span>
<span class="nc bnc" id="L1947" title="All 2 branches missed.">                    } else if (ck == float.class) {</span>
<span class="nc" id="L1948">                        clz = Class.forName(prefix + &quot;F&quot;);</span>
<span class="nc bnc" id="L1949" title="All 2 branches missed.">                    } else if (ck == double.class) {</span>
<span class="nc" id="L1950">                        clz = Class.forName(prefix + &quot;D&quot;);</span>
                    }
<span class="nc" id="L1952">                } catch (ClassNotFoundException e) {</span>
<span class="nc" id="L1953">                }</span>
            }
        }

<span class="nc" id="L1957">        return clz;</span>
    }

    @SuppressWarnings({&quot;rawtypes&quot;, &quot;unchecked&quot;})
    public static Collection createCollection(Type type) {
<span class="fc" id="L1962">        Class&lt;?&gt; rawClass = getRawClass(type);</span>
        Collection list;
<span class="pc bpc" id="L1964" title="1 of 4 branches missed.">        if(rawClass == AbstractCollection.class //</span>
                || rawClass == Collection.class){
<span class="fc" id="L1966">            list = new ArrayList();</span>
<span class="fc bfc" id="L1967" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(HashSet.class)){</span>
<span class="fc" id="L1968">            list = new HashSet();</span>
<span class="fc bfc" id="L1969" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(LinkedHashSet.class)){</span>
<span class="fc" id="L1970">            list = new LinkedHashSet();</span>
<span class="fc bfc" id="L1971" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(TreeSet.class)){</span>
<span class="fc" id="L1972">            list = new TreeSet();</span>
<span class="fc bfc" id="L1973" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(ArrayList.class)){</span>
<span class="fc" id="L1974">            list = new ArrayList();</span>
<span class="fc bfc" id="L1975" title="All 2 branches covered.">        } else if(rawClass.isAssignableFrom(EnumSet.class)){</span>
            Type itemType;
<span class="pc bpc" id="L1977" title="1 of 2 branches missed.">            if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1978">                itemType = ((ParameterizedType) type).getActualTypeArguments()[0];</span>
            } else{
<span class="nc" id="L1980">                itemType = Object.class;</span>
            }
<span class="fc" id="L1982">            list = EnumSet.noneOf((Class&lt;Enum&gt;) itemType);</span>
<span class="fc" id="L1983">        } else{</span>
            try{
<span class="fc" id="L1985">                list = (Collection) rawClass.newInstance();</span>
<span class="fc" id="L1986">            } catch(Exception e){</span>
<span class="fc" id="L1987">                throw new JSONException(&quot;create instance error, class &quot; + rawClass.getName());</span>
<span class="fc" id="L1988">            }</span>
        }
<span class="fc" id="L1990">        return list;</span>
    }

    public static Class&lt;?&gt; getRawClass(Type type){
<span class="fc bfc" id="L1994" title="All 2 branches covered.">        if(type instanceof Class&lt;?&gt;){</span>
<span class="fc" id="L1995">            return (Class&lt;?&gt;) type;</span>
<span class="pc bpc" id="L1996" title="1 of 2 branches missed.">        } else if(type instanceof ParameterizedType){</span>
<span class="fc" id="L1997">            return getRawClass(((ParameterizedType) type).getRawType());</span>
        } else{
<span class="nc" id="L1999">            throw new JSONException(&quot;TODO&quot;);</span>
        }
    }

    public static boolean isProxy(Class&lt;?&gt; clazz){
<span class="fc bfc" id="L2004" title="All 2 branches covered.">        for(Class&lt;?&gt; item : clazz.getInterfaces()){</span>
<span class="fc" id="L2005">            String interfaceName = item.getName();</span>
<span class="fc bfc" id="L2006" title="All 2 branches covered.">            if(interfaceName.equals(&quot;net.sf.cglib.proxy.Factory&quot;) //</span>
<span class="pc bpc" id="L2007" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.springframework.cglib.proxy.Factory&quot;)){</span>
<span class="fc" id="L2008">                return true;</span>
            }
<span class="fc bfc" id="L2010" title="All 2 branches covered.">            if(interfaceName.equals(&quot;javassist.util.proxy.ProxyObject&quot;) //</span>
<span class="pc bpc" id="L2011" title="1 of 2 branches missed.">                    || interfaceName.equals(&quot;org.apache.ibatis.javassist.util.proxy.ProxyObject&quot;)</span>
                    ){
<span class="fc" id="L2013">                return true;</span>
            }
        }
<span class="fc" id="L2016">        return false;</span>
    }

    public static boolean isTransient(Method method){
<span class="fc bfc" id="L2020" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2021">            return false;</span>
        }
<span class="fc bfc" id="L2023" title="All 2 branches covered.">        if(!transientClassInited){</span>
            try{
<span class="fc" id="L2025">                transientClass = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;java.beans.Transient&quot;);</span>
<span class="nc" id="L2026">            } catch(Exception e){</span>
                // skip
            } finally{
<span class="fc" id="L2029">                transientClassInited = true;</span>
            }
        }
<span class="pc bpc" id="L2032" title="1 of 2 branches missed.">        if(transientClass != null){</span>
<span class="fc" id="L2033">            Annotation annotation = method.getAnnotation(transientClass);</span>
<span class="fc bfc" id="L2034" title="All 2 branches covered.">            return annotation != null;</span>
        }
<span class="nc" id="L2036">        return false;</span>
    }

    public static boolean isAnnotationPresentOneToMany(Method method){
<span class="fc bfc" id="L2040" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2041">            return false;</span>
        }

<span class="pc bpc" id="L2044" title="1 of 4 branches missed.">        if(class_OneToMany == null &amp;&amp; !class_OneToMany_error){</span>
            try{
<span class="fc" id="L2046">                class_OneToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.OneToMany&quot;);</span>
<span class="nc" id="L2047">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2049">                class_OneToMany_error = true;</span>
<span class="fc" id="L2050">            }</span>
        }
<span class="pc bpc" id="L2052" title="1 of 2 branches missed.">        if(class_OneToMany == null){</span>
<span class="nc" id="L2053">            return false;</span>
        }

<span class="fc" id="L2056">        return method.isAnnotationPresent(class_OneToMany);</span>
    }

    public static boolean isAnnotationPresentManyToMany(Method method){
<span class="fc bfc" id="L2060" title="All 2 branches covered.">        if(method == null){</span>
<span class="fc" id="L2061">            return false;</span>
        }

<span class="pc bpc" id="L2064" title="1 of 4 branches missed.">        if(class_ManyToMany == null &amp;&amp; !class_ManyToMany_error){</span>
            try{
<span class="fc" id="L2066">                class_ManyToMany = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;javax.persistence.ManyToMany&quot;);</span>
<span class="nc" id="L2067">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2069">                class_ManyToMany_error = true;</span>
<span class="fc" id="L2070">            }</span>
        }
<span class="pc bpc" id="L2072" title="1 of 2 branches missed.">        if(class_ManyToMany == null){</span>
<span class="nc" id="L2073">            return false;</span>
        }

<span class="pc bpc" id="L2076" title="2 of 4 branches missed.">        return method.isAnnotationPresent(class_OneToMany) || method.isAnnotationPresent(class_ManyToMany);</span>
    }

    public static boolean isHibernateInitialized(Object object){
<span class="nc bnc" id="L2080" title="All 2 branches missed.">        if(object == null){</span>
<span class="nc" id="L2081">            return false;</span>
        }
<span class="nc bnc" id="L2083" title="All 4 branches missed.">        if(method_HibernateIsInitialized == null &amp;&amp; !method_HibernateIsInitialized_error){</span>
            try{
<span class="nc" id="L2085">                Class&lt;?&gt; class_Hibernate = (Class&lt;? extends Annotation&gt;) Class.forName(&quot;org.hibernate.Hibernate&quot;);</span>
<span class="nc" id="L2086">                method_HibernateIsInitialized = class_Hibernate.getMethod(&quot;isInitialized&quot;, Object.class);</span>
<span class="nc" id="L2087">            } catch(Throwable e){</span>
                // skip
<span class="nc" id="L2089">                method_HibernateIsInitialized_error = true;</span>
<span class="nc" id="L2090">            }</span>
        }
<span class="nc bnc" id="L2092" title="All 2 branches missed.">        if(method_HibernateIsInitialized != null){</span>
            try{
<span class="nc" id="L2094">                Boolean initialized = (Boolean) method_HibernateIsInitialized.invoke(null, object);</span>
<span class="nc" id="L2095">                return initialized.booleanValue();</span>
<span class="nc" id="L2096">            } catch(Throwable e){</span>
                // skip
            }
        }
<span class="nc" id="L2100">        return true;</span>
    }

    public static long fnv1a_64_lower(String key){
<span class="fc" id="L2104">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2105" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2106">            char ch = key.charAt(i);</span>
<span class="fc bfc" id="L2107" title="All 4 branches covered.">            if(ch == '_' || ch == '-'){</span>
<span class="fc" id="L2108">                continue;</span>
            }
<span class="fc bfc" id="L2110" title="All 4 branches covered.">            if(ch &gt;= 'A' &amp;&amp; ch &lt;= 'Z'){</span>
<span class="fc" id="L2111">                ch = (char) (ch + 32);</span>
            }
<span class="fc" id="L2113">            hashCode ^= ch;</span>
<span class="fc" id="L2114">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2116">        return hashCode;</span>
    }

    public static long fnv1a_64(String key){
<span class="fc" id="L2120">        long hashCode = 0xcbf29ce484222325L;</span>
<span class="fc bfc" id="L2121" title="All 2 branches covered.">        for(int i = 0; i &lt; key.length(); ++i){</span>
<span class="fc" id="L2122">            char ch = key.charAt(i);</span>
<span class="fc" id="L2123">            hashCode ^= ch;</span>
<span class="fc" id="L2124">            hashCode *= 0x100000001b3L;</span>
        }
<span class="fc" id="L2126">        return hashCode;</span>
    }

    public static boolean isKotlin(Class clazz){
<span class="pc bpc" id="L2130" title="1 of 4 branches missed.">        if(kotlin_metadata == null &amp;&amp; !kotlin_metadata_error){</span>
            try{
<span class="fc" id="L2132">                kotlin_metadata = Class.forName(&quot;kotlin.Metadata&quot;);</span>
<span class="nc" id="L2133">            } catch(Throwable e){</span>
<span class="nc" id="L2134">                kotlin_metadata_error = true;</span>
<span class="fc" id="L2135">            }</span>
        }
<span class="pc bpc" id="L2137" title="1 of 2 branches missed.">        if(kotlin_metadata == null){</span>
<span class="nc" id="L2138">            return false;</span>
        }
<span class="fc" id="L2140">        return clazz.isAnnotationPresent(kotlin_metadata);</span>
    }

    public static Constructor getKoltinConstructor(Constructor[] constructors){
<span class="fc" id="L2144">        Constructor creatorConstructor = null;</span>
<span class="fc bfc" id="L2145" title="All 2 branches covered.">        for(Constructor&lt;?&gt; constructor : constructors){</span>
<span class="fc" id="L2146">            Class&lt;?&gt;[] parameterTypes = constructor.getParameterTypes();</span>
<span class="fc bfc" id="L2147" title="All 4 branches covered.">            if(parameterTypes.length &gt; 0 &amp;&amp; parameterTypes[parameterTypes.length - 1].getName().equals(&quot;kotlin.jvm.internal.DefaultConstructorMarker&quot;)){</span>
<span class="fc" id="L2148">                continue;</span>
            }
<span class="fc bfc" id="L2150" title="All 4 branches covered.">            if(creatorConstructor != null &amp;&amp; creatorConstructor.getParameterTypes().length &gt;= parameterTypes.length){</span>
<span class="fc" id="L2151">                continue;</span>
            }
<span class="fc" id="L2153">            creatorConstructor = constructor;</span>
        }
<span class="fc" id="L2155">        return creatorConstructor;</span>
    }

    public static String[] getKoltinConstructorParameters(Class clazz){
<span class="pc bpc" id="L2159" title="1 of 4 branches missed.">        if(kotlin_kclass_constructor == null &amp;&amp; !kotlin_class_klass_error){</span>
            try{
<span class="fc" id="L2161">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2162">                kotlin_kclass_constructor = class_kotlin_kclass.getConstructor(Class.class);</span>
<span class="nc" id="L2163">            } catch(Throwable e){</span>
<span class="nc" id="L2164">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2165">            }</span>
        }
<span class="pc bpc" id="L2167" title="1 of 2 branches missed.">        if (kotlin_kclass_constructor == null){</span>
<span class="nc" id="L2168">            return null;</span>
        }

<span class="pc bpc" id="L2171" title="1 of 4 branches missed.">        if (kotlin_kclass_getConstructors == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2173">                Class class_kotlin_kclass = Class.forName(&quot;kotlin.reflect.jvm.internal.KClassImpl&quot;);</span>
<span class="fc" id="L2174">                kotlin_kclass_getConstructors = class_kotlin_kclass.getMethod(&quot;getConstructors&quot;);</span>
<span class="nc" id="L2175">            } catch(Throwable e){</span>
<span class="nc" id="L2176">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2177">            }</span>
        }

<span class="pc bpc" id="L2180" title="1 of 4 branches missed.">        if (kotlin_kfunction_getParameters == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2182">                Class class_kotlin_kfunction = Class.forName(&quot;kotlin.reflect.KFunction&quot;);</span>
<span class="fc" id="L2183">                kotlin_kfunction_getParameters = class_kotlin_kfunction.getMethod(&quot;getParameters&quot;);</span>
<span class="nc" id="L2184">            } catch(Throwable e){</span>
<span class="nc" id="L2185">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2186">            }</span>
        }

<span class="pc bpc" id="L2189" title="1 of 4 branches missed.">        if (kotlin_kparameter_getName == null &amp;&amp; !kotlin_class_klass_error) {</span>
            try{
<span class="fc" id="L2191">                Class class_kotlinn_kparameter = Class.forName(&quot;kotlin.reflect.KParameter&quot;);</span>
<span class="fc" id="L2192">                kotlin_kparameter_getName = class_kotlinn_kparameter.getMethod(&quot;getName&quot;);</span>
<span class="nc" id="L2193">            } catch(Throwable e){</span>
<span class="nc" id="L2194">                kotlin_class_klass_error = true;</span>
<span class="fc" id="L2195">            }</span>
        }

<span class="pc bpc" id="L2198" title="1 of 2 branches missed.">        if (kotlin_error){</span>
<span class="nc" id="L2199">            return null;</span>
        }

        try{
<span class="fc" id="L2203">            Object constructor = null;</span>
<span class="fc" id="L2204">            Object kclassImpl = kotlin_kclass_constructor.newInstance(clazz);</span>
<span class="fc" id="L2205">            Iterable it = (Iterable) kotlin_kclass_getConstructors.invoke(kclassImpl);</span>
<span class="fc bfc" id="L2206" title="All 2 branches covered.">            for(Iterator iterator = it.iterator(); iterator.hasNext(); iterator.hasNext()){</span>
<span class="fc" id="L2207">                constructor = iterator.next();</span>
            }
<span class="fc" id="L2209">            List parameters = (List) kotlin_kfunction_getParameters.invoke(constructor);</span>
<span class="fc" id="L2210">            String[] names = new String[parameters.size()];</span>
<span class="fc bfc" id="L2211" title="All 2 branches covered.">            for(int i = 0; i &lt; parameters.size(); i++){</span>
<span class="fc" id="L2212">                Object param = parameters.get(i);</span>
<span class="fc" id="L2213">                names[i] = (String) kotlin_kparameter_getName.invoke(param);</span>
            }
<span class="fc" id="L2215">            return names;</span>
<span class="nc" id="L2216">        } catch(Throwable e){</span>
<span class="nc" id="L2217">            e.printStackTrace();</span>
<span class="nc" id="L2218">            kotlin_error = true;</span>
        }
<span class="nc" id="L2220">        return null;</span>
    }

    private static boolean isKotlinIgnore(Class clazz, String methodName){
<span class="pc bpc" id="L2224" title="1 of 4 branches missed.">        if(kotlinIgnores == null &amp;&amp; !kotlinIgnores_error){</span>
            try{
<span class="fc" id="L2226">                Map&lt;Class,String[]&gt; map = new HashMap&lt;Class,String[]&gt;();</span>
<span class="fc" id="L2227">                Class charRangeClass = Class.forName(&quot;kotlin.ranges.CharRange&quot;);</span>
<span class="fc" id="L2228">                map.put(charRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2229">                Class intRangeClass = Class.forName(&quot;kotlin.ranges.IntRange&quot;);</span>
<span class="fc" id="L2230">                map.put(intRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2231">                Class longRangeClass = Class.forName(&quot;kotlin.ranges.LongRange&quot;);</span>
<span class="fc" id="L2232">                map.put(longRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2233">                Class floatRangeClass = Class.forName(&quot;kotlin.ranges.ClosedFloatRange&quot;);</span>
<span class="fc" id="L2234">                map.put(floatRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2235">                Class doubleRangeClass = Class.forName(&quot;kotlin.ranges.ClosedDoubleRange&quot;);</span>
<span class="fc" id="L2236">                map.put(doubleRangeClass, new String[]{&quot;getEndInclusive&quot;, &quot;isEmpty&quot;});</span>
<span class="fc" id="L2237">                kotlinIgnores = map;</span>
<span class="nc" id="L2238">            } catch(Throwable error){</span>
<span class="nc" id="L2239">                kotlinIgnores_error = true;</span>
<span class="fc" id="L2240">            }</span>
        }
<span class="pc bpc" id="L2242" title="1 of 2 branches missed.">        if(kotlinIgnores == null){</span>
<span class="nc" id="L2243">            return false;</span>
        }
<span class="fc" id="L2245">        String[] ignores = kotlinIgnores.get(clazz);</span>
<span class="fc bfc" id="L2246" title="All 2 branches covered.">        if(ignores == null){</span>
<span class="fc" id="L2247">            return false;</span>
        }
<span class="fc bfc" id="L2249" title="All 2 branches covered.">        return Arrays.binarySearch(ignores, methodName) &gt;= 0;</span>
    }

    public static &lt;A extends Annotation&gt; A getAnnotation(Class&lt;?&gt; clazz, Class&lt;A&gt; annotationClass){
<span class="fc" id="L2253">        A a = clazz.getAnnotation(annotationClass);</span>
<span class="fc bfc" id="L2254" title="All 2 branches covered.">        if (a != null){</span>
<span class="fc" id="L2255">            return a;</span>
        }

<span class="fc bfc" id="L2258" title="All 2 branches covered.">        if(clazz.getAnnotations().length &gt; 0){</span>
<span class="fc bfc" id="L2259" title="All 2 branches covered.">            for(Annotation annotation : clazz.getAnnotations()){</span>
<span class="fc" id="L2260">                a = annotation.annotationType().getAnnotation(annotationClass);</span>
<span class="pc bpc" id="L2261" title="1 of 2 branches missed.">                if(a != null){</span>
<span class="nc" id="L2262">                    return a;</span>
                }
            }
        }
<span class="fc" id="L2266">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>