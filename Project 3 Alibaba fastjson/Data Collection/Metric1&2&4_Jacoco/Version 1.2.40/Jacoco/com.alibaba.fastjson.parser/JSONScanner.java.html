<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JSONScanner.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">fastjson</a> &gt; <a href="index.source.html" class="el_package">com.alibaba.fastjson.parser</a> &gt; <span class="el_source">JSONScanner.java</span></div><h1>JSONScanner.java</h1><pre class="source lang-java linenums">/*
 * Copyright 1999-2017 Alibaba Group.
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.alibaba.fastjson.parser;

import java.lang.reflect.Type;
import java.math.BigDecimal;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Collection;
import java.util.HashSet;
import java.util.TimeZone;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONException;
import com.alibaba.fastjson.annotation.JSONType;
import com.alibaba.fastjson.util.ASMUtils;
import com.alibaba.fastjson.util.IOUtils;
import com.alibaba.fastjson.util.TypeUtils;

//这个类，为了性能优化做了很多特别处理，一切都是为了性能！！！

/**
 * @author wenshao[szujobs@hotmail.com]
 */
public final class JSONScanner extends JSONLexerBase {

    private final String text;
    private final int    len;

    public JSONScanner(String input){
<span class="fc" id="L44">        this(input, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L45">    }</span>

    public JSONScanner(String input, int features){
<span class="fc" id="L48">        super(features);</span>

<span class="fc" id="L50">        text = input;</span>
<span class="fc" id="L51">        len = text.length();</span>
<span class="fc" id="L52">        bp = -1;</span>

<span class="fc" id="L54">        next();</span>
<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (ch == 65279) { // utf-8 bom</span>
<span class="fc" id="L56">            next();</span>
        }
<span class="fc" id="L58">    }</span>

    public final char charAt(int index) {
<span class="fc bfc" id="L61" title="All 2 branches covered.">        if (index &gt;= len) {</span>
<span class="fc" id="L62">            return EOI;</span>
        }

<span class="fc" id="L65">        return text.charAt(index);</span>
    }

    public final char next() {
<span class="fc" id="L69">        int index = ++bp;</span>
<span class="fc bfc" id="L70" title="All 2 branches covered.">        return ch = (index &gt;= this.len ? //</span>
                EOI //
<span class="fc" id="L72">                : text.charAt(index));</span>
    }

    public JSONScanner(char[] input, int inputLength){
<span class="fc" id="L76">        this(input, inputLength, JSON.DEFAULT_PARSER_FEATURE);</span>
<span class="fc" id="L77">    }</span>

    public JSONScanner(char[] input, int inputLength, int features){
<span class="fc" id="L80">        this(new String(input, 0, inputLength), features);</span>
<span class="fc" id="L81">    }</span>

    protected final void copyTo(int offset, int count, char[] dest) {
<span class="fc" id="L84">        text.getChars(offset, offset + count, dest, 0);</span>
<span class="fc" id="L85">    }</span>

    static boolean charArrayCompare(String src, int offset, char[] dest) {
<span class="fc" id="L88">        final int destLen = dest.length;</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (destLen + offset &gt; src.length()) {</span>
<span class="fc" id="L90">            return false;</span>
        }

<span class="fc bfc" id="L93" title="All 2 branches covered.">        for (int i = 0; i &lt; destLen; ++i) {</span>
<span class="fc bfc" id="L94" title="All 2 branches covered.">            if (dest[i] != src.charAt(offset + i)) {</span>
<span class="fc" id="L95">                return false;</span>
            }
        }

<span class="fc" id="L99">        return true;</span>
    }

    public final boolean charArrayCompare(char[] chars) {
<span class="fc" id="L103">        return charArrayCompare(text, bp, chars);</span>
    }

    public final int indexOf(char ch, int startIndex) {
<span class="fc" id="L107">        return text.indexOf(ch, startIndex);</span>
    }

    public final String addSymbol(int offset, int len, int hash, final SymbolTable symbolTable) {
<span class="fc" id="L111">        return symbolTable.addSymbol(text, offset, len, hash);</span>
    }

    public byte[] bytesValue() {
<span class="fc bfc" id="L115" title="All 2 branches covered.">        if (token == JSONToken.HEX) {</span>
<span class="fc" id="L116">            int start = np + 1, len = sp;</span>
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">            if (len % 2 != 0) {</span>
<span class="nc" id="L118">                throw new JSONException(&quot;illegal state. &quot; + len);</span>
            }

<span class="fc" id="L121">            byte[] bytes = new byte[len / 2];</span>
<span class="fc bfc" id="L122" title="All 2 branches covered.">            for (int i = 0; i &lt; bytes.length; ++i) {</span>
<span class="fc" id="L123">                char c0 = text.charAt(start + i * 2);</span>
<span class="fc" id="L124">                char c1 = text.charAt(start + i * 2 + 1);</span>

<span class="fc bfc" id="L126" title="All 2 branches covered.">                int b0 = c0 - (c0 &lt;= 57 ? 48 : 55);</span>
<span class="fc bfc" id="L127" title="All 2 branches covered.">                int b1 = c1 - (c1 &lt;= 57 ? 48 : 55);</span>
<span class="fc" id="L128">                bytes[i] = (byte) ((b0 &lt;&lt; 4) | b1);</span>
            }

<span class="fc" id="L131">            return bytes;</span>
        }

<span class="fc" id="L134">        return IOUtils.decodeBase64(text, np + 1, sp);</span>
    }

    /**
     * The value of a literal token, recorded as a string. For integers, leading 0x and 'l' suffixes are suppressed.
     */
    public final String stringVal() {
<span class="fc bfc" id="L141" title="All 2 branches covered.">        if (!hasSpecial) {</span>
<span class="fc" id="L142">            return this.subString(np + 1, sp);</span>
        } else {
<span class="fc" id="L144">            return new String(sbuf, 0, sp);</span>
        }
    }

    public final String subString(int offset, int count) {
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        if (ASMUtils.IS_ANDROID) {</span>
<span class="nc bnc" id="L150" title="All 2 branches missed.">            if (count &lt; sbuf.length) {</span>
<span class="nc" id="L151">                text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L152">                return new String(sbuf, 0, count);</span>
            } else {
<span class="nc" id="L154">                char[] chars = new char[count];</span>
<span class="nc" id="L155">                text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L156">                return new String(chars);</span>
            }
        } else {
<span class="fc" id="L159">            return text.substring(offset, offset + count);</span>
        }
    }

    public final char[] sub_chars(int offset, int count) {
<span class="pc bpc" id="L164" title="3 of 4 branches missed.">        if (ASMUtils.IS_ANDROID &amp;&amp; count &lt; sbuf.length) {</span>
<span class="nc" id="L165">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="nc" id="L166">            return sbuf;</span>
        } else {
<span class="fc" id="L168">            char[] chars = new char[count];</span>
<span class="fc" id="L169">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="fc" id="L170">            return chars;</span>
        }
    }

    public final String numberString() {
<span class="fc" id="L175">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L177">        int sp = this.sp;</span>
<span class="fc bfc" id="L178" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L179">            sp--;</span>
        }

<span class="fc" id="L182">        return this.subString(np, sp);</span>
    }

    public final BigDecimal decimalValue() {
<span class="fc" id="L186">        char chLocal = charAt(np + sp - 1);</span>

<span class="fc" id="L188">        int sp = this.sp;</span>
<span class="fc bfc" id="L189" title="All 10 branches covered.">        if (chLocal == 'L' || chLocal == 'S' || chLocal == 'B' || chLocal == 'F' || chLocal == 'D') {</span>
<span class="fc" id="L190">            sp--;</span>
        }

<span class="fc" id="L193">        int offset = np, count = sp;</span>
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">        if (count &lt; sbuf.length) {</span>
<span class="fc" id="L195">            text.getChars(offset, offset + count, sbuf, 0);</span>
<span class="fc" id="L196">            return new BigDecimal(sbuf, 0, count);</span>
        } else {
<span class="nc" id="L198">            char[] chars = new char[count];</span>
<span class="nc" id="L199">            text.getChars(offset, offset + count, chars, 0);</span>
<span class="nc" id="L200">            return new BigDecimal(chars);</span>
        }
    }

    public boolean scanISO8601DateIfMatch() {
<span class="fc" id="L205">        return scanISO8601DateIfMatch(true);</span>
    }

    public boolean scanISO8601DateIfMatch(boolean strict) {
<span class="fc" id="L209">        int rest = len - bp;</span>
<span class="fc" id="L210">        return scanISO8601DateIfMatch(strict, rest);</span>
    }

    private boolean scanISO8601DateIfMatch(boolean strict, int rest) {
<span class="fc bfc" id="L214" title="All 2 branches covered.">        if (rest &lt; 8) {</span>
<span class="fc" id="L215">            return false;</span>
        }

<span class="fc" id="L218">        char c0 = charAt(bp);</span>
<span class="fc" id="L219">        char c1 = charAt(bp + 1);</span>
<span class="fc" id="L220">        char c2 = charAt(bp + 2);</span>
<span class="fc" id="L221">        char c3 = charAt(bp + 3);</span>
<span class="fc" id="L222">        char c4 = charAt(bp + 4);</span>
<span class="fc" id="L223">        char c5 = charAt(bp + 5);</span>
<span class="fc" id="L224">        char c6 = charAt(bp + 6);</span>
<span class="fc" id="L225">        char c7 = charAt(bp + 7);</span>

<span class="fc bfc" id="L227" title="All 4 branches covered.">        if ((!strict) &amp;&amp; rest &gt; 13) {</span>
<span class="fc" id="L228">            char c_r0 = charAt(bp + rest - 1);</span>
<span class="fc" id="L229">            char c_r1 = charAt(bp + rest - 2);</span>
<span class="pc bpc" id="L230" title="7 of 16 branches missed.">            if (c0 == '/' &amp;&amp; c1 == 'D' &amp;&amp; c2 == 'a' &amp;&amp; c3 == 't' &amp;&amp; c4 == 'e' &amp;&amp; c5 == '(' &amp;&amp; c_r0 == '/'</span>
                    &amp;&amp; c_r1 == ')') {
<span class="fc" id="L232">                int plusIndex = -1;</span>
<span class="pc bpc" id="L233" title="1 of 2 branches missed.">                for (int i = 6; i &lt; rest; ++i) {</span>
<span class="fc" id="L234">                    char c = charAt(bp + i);</span>
<span class="fc bfc" id="L235" title="All 2 branches covered.">                    if (c == '+') {</span>
<span class="fc" id="L236">                        plusIndex = i;</span>
<span class="fc bfc" id="L237" title="All 4 branches covered.">                    } else if (c &lt; '0' || c &gt; '9') {</span>
<span class="fc" id="L238">                        break;</span>
                    }
                }
<span class="fc bfc" id="L241" title="All 2 branches covered.">                if (plusIndex == -1) {</span>
<span class="fc" id="L242">                    return false;</span>
                }
<span class="fc" id="L244">                int offset = bp + 6;</span>
<span class="fc" id="L245">                String numberText = this.subString(offset, bp + plusIndex - offset);</span>
<span class="fc" id="L246">                long millis = Long.parseLong(numberText);</span>

<span class="fc" id="L248">                calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L249">                calendar.setTimeInMillis(millis);</span>

<span class="fc" id="L251">                token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L252">                return true;</span>
            }
        }

        char c10;
<span class="fc bfc" id="L257" title="All 6 branches covered.">        if (rest == 8</span>
                || rest == 14
<span class="fc bfc" id="L259" title="All 6 branches covered.">                || (rest == 16 &amp;&amp; ((c10 = charAt(bp + 10)) == 'T' || c10 == ' '))</span>
<span class="fc bfc" id="L260" title="All 2 branches covered.">                || (rest == 17 &amp;&amp; charAt(bp + 6) != '-')) {</span>
<span class="fc bfc" id="L261" title="All 2 branches covered.">            if (strict) {</span>
<span class="fc" id="L262">                return false;</span>
            }

            char y0, y1, y2, y3, M0, M1, d0, d1;



<span class="fc" id="L269">            char c8 = charAt(bp + 8);</span>

<span class="pc bpc" id="L271" title="1 of 4 branches missed.">            final boolean c_47 = c4 == '-' &amp;&amp; c7 == '-';</span>
<span class="fc bfc" id="L272" title="All 4 branches covered.">            final boolean sperate16 = c_47 &amp;&amp; rest == 16;</span>
<span class="fc bfc" id="L273" title="All 4 branches covered.">            final boolean sperate17 = c_47 &amp;&amp; rest == 17;</span>
<span class="fc bfc" id="L274" title="All 4 branches covered.">            if (sperate17 || sperate16) {</span>
<span class="fc" id="L275">                y0 = c0;</span>
<span class="fc" id="L276">                y1 = c1;</span>
<span class="fc" id="L277">                y2 = c2;</span>
<span class="fc" id="L278">                y3 = c3;</span>
<span class="fc" id="L279">                M0 = c5;</span>
<span class="fc" id="L280">                M1 = c6;</span>
<span class="fc" id="L281">                d0 = c8;</span>
<span class="fc" id="L282">                d1 = charAt(bp + 9);</span>
            } else {
<span class="fc" id="L284">                y0 = c0;</span>
<span class="fc" id="L285">                y1 = c1;</span>
<span class="fc" id="L286">                y2 = c2;</span>
<span class="fc" id="L287">                y3 = c3;</span>
<span class="fc" id="L288">                M0 = c4;</span>
<span class="fc" id="L289">                M1 = c5;</span>
<span class="fc" id="L290">                d0 = c6;</span>
<span class="fc" id="L291">                d1 = c7;</span>
            }


<span class="fc bfc" id="L295" title="All 2 branches covered.">            if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L296">                return false;</span>
            }

<span class="fc" id="L299">            setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

            int hour, minute, seconds, millis;
<span class="fc bfc" id="L302" title="All 2 branches covered.">            if (rest != 8) {</span>
<span class="fc" id="L303">                char c9 = charAt(bp + 9);</span>
<span class="fc" id="L304">                c10 = charAt(bp + 10);</span>
<span class="fc" id="L305">                char c11 = charAt(bp + 11);</span>
<span class="fc" id="L306">                char c12 = charAt(bp + 12);</span>
<span class="fc" id="L307">                char c13 = charAt(bp + 13);</span>

                char h0, h1, m0, m1, s0, s1;

<span class="pc bpc" id="L311" title="5 of 16 branches missed.">                if ((sperate17 &amp;&amp; c10 == 'T' &amp;&amp; c13 == ':' &amp;&amp; charAt(bp + 16) == 'Z')</span>
                        || (sperate16 &amp;&amp; (c10 == ' ' || c10 == 'T') &amp;&amp; c13 == ':')) {
<span class="fc" id="L313">                    h0 = c11;</span>
<span class="fc" id="L314">                    h1 = c12;</span>
<span class="fc" id="L315">                    m0 = charAt(bp + 14);</span>
<span class="fc" id="L316">                    m1 = charAt(bp + 15);</span>
<span class="fc" id="L317">                    s0 = '0';</span>
<span class="fc" id="L318">                    s1 = '0';</span>
                } else {
<span class="fc" id="L320">                    h0 = c8;</span>
<span class="fc" id="L321">                    h1 = c9;</span>
<span class="fc" id="L322">                    m0 = c10;</span>
<span class="fc" id="L323">                    m1 = c11;</span>
<span class="fc" id="L324">                    s0 = c12;</span>
<span class="fc" id="L325">                    s1 = c13;</span>
                }

<span class="fc bfc" id="L328" title="All 2 branches covered.">                if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L329">                    return false;</span>
                }

<span class="fc bfc" id="L332" title="All 4 branches covered.">                if (rest == 17 &amp;&amp; !sperate17) {</span>
<span class="fc" id="L333">                    char S0 = charAt(bp + 14);</span>
<span class="fc" id="L334">                    char S1 = charAt(bp + 15);</span>
<span class="fc" id="L335">                    char S2 = charAt(bp + 16);</span>
<span class="fc bfc" id="L336" title="All 4 branches covered.">                    if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L337">                        return false;</span>
                    }
<span class="fc bfc" id="L339" title="All 4 branches covered.">                    if (S1 &lt; '0' || S1 &gt; '9') {</span>
<span class="fc" id="L340">                        return false;</span>
                    }
<span class="fc bfc" id="L342" title="All 4 branches covered.">                    if (S2 &lt; '0' || S2 &gt; '9') {</span>
<span class="fc" id="L343">                        return false;</span>
                    }

<span class="fc" id="L346">                    millis = (S0 - '0') * 100 + (S1 - '0') * 10 + (S2 - '0');</span>
<span class="fc" id="L347">                } else {</span>
<span class="fc" id="L348">                    millis = 0;</span>
                }

<span class="fc" id="L351">                hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L352">                minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L353">                seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L354">            } else {</span>
<span class="fc" id="L355">                hour = 0;</span>
<span class="fc" id="L356">                minute = 0;</span>
<span class="fc" id="L357">                seconds = 0;</span>
<span class="fc" id="L358">                millis = 0;</span>
            }

<span class="fc" id="L361">            calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L362">            calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L363">            calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L364">            calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L366">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L367">            return true;</span>
        }

<span class="pc bpc" id="L370" title="1 of 2 branches missed.">        if (rest &lt; 9) {</span>
<span class="nc" id="L371">            return false;</span>
        }

<span class="fc" id="L374">        char c8 = charAt(bp + 8);</span>
<span class="fc" id="L375">        char c9 = charAt(bp + 9);</span>

<span class="fc" id="L377">        int date_len = 10;</span>
        char y0, y1, y2, y3, M0, M1, d0, d1;
<span class="fc bfc" id="L379" title="All 8 branches covered.">        if ((c4 == '-' &amp;&amp; c7 == '-') // cn</span>
                ||  (c4 == '/' &amp;&amp; c7 == '/') // tw yyyy/mm/dd
                ) {
<span class="fc" id="L382">            y0 = c0;</span>
<span class="fc" id="L383">            y1 = c1;</span>
<span class="fc" id="L384">            y2 = c2;</span>
<span class="fc" id="L385">            y3 = c3;</span>
<span class="fc" id="L386">            M0 = c5;</span>
<span class="fc" id="L387">            M1 = c6;</span>
<span class="fc" id="L388">            d0 = c8;</span>
<span class="fc" id="L389">            d1 = c9;</span>
<span class="fc bfc" id="L390" title="All 4 branches covered.">        } else if ((c4 == '-' &amp;&amp; c6 == '-') // cn yyyy-m-dd</span>
                ) {
<span class="fc" id="L392">            y0 = c0;</span>
<span class="fc" id="L393">            y1 = c1;</span>
<span class="fc" id="L394">            y2 = c2;</span>
<span class="fc" id="L395">            y3 = c3;</span>
<span class="fc" id="L396">            M0 = '0';</span>
<span class="fc" id="L397">            M1 = c5;</span>

<span class="fc bfc" id="L399" title="All 2 branches covered.">            if (c8 == ' ') {</span>
<span class="fc" id="L400">                d0 = '0';</span>
<span class="fc" id="L401">                d1 = c7;</span>
<span class="fc" id="L402">                date_len = 8;</span>
            } else {
<span class="fc" id="L404">                d0 = c7;</span>
<span class="fc" id="L405">                d1 = c8;</span>
<span class="fc" id="L406">                date_len = 9;</span>
            }
<span class="pc bpc" id="L408" title="2 of 8 branches missed.">        } else if ((c2 == '.' &amp;&amp; c5 == '.') // de dd.mm.yyyy</span>
                || (c2 == '-' &amp;&amp; c5 == '-') // in dd-mm-yyyy
                ) {
<span class="fc" id="L411">            d0 = c0;</span>
<span class="fc" id="L412">            d1 = c1;</span>
<span class="fc" id="L413">            M0 = c3;</span>
<span class="fc" id="L414">            M1 = c4;</span>
<span class="fc" id="L415">            y0 = c6;</span>
<span class="fc" id="L416">            y1 = c7;</span>
<span class="fc" id="L417">            y2 = c8;</span>
<span class="fc" id="L418">            y3 = c9;</span>
        } else {
<span class="fc bfc" id="L420" title="All 4 branches covered.">            if (c4 == '年' || c4 == '년') {</span>
<span class="fc" id="L421">                y0 = c0;</span>
<span class="fc" id="L422">                y1 = c1;</span>
<span class="fc" id="L423">                y2 = c2;</span>
<span class="fc" id="L424">                y3 = c3;</span>

<span class="fc bfc" id="L426" title="All 4 branches covered.">                if (c7 == '月' || c7 == '월') {</span>
<span class="fc" id="L427">                    M0 = c5;</span>
<span class="fc" id="L428">                    M1 = c6;</span>
<span class="fc bfc" id="L429" title="All 4 branches covered.">                    if (c9 == '日' || c9 == '일') {</span>
<span class="fc" id="L430">                        d0 = '0';</span>
<span class="fc" id="L431">                        d1 = c8;</span>
<span class="pc bpc" id="L432" title="1 of 4 branches missed.">                    } else if (charAt(bp + 10) == '日' || charAt(bp + 10) == '일'){</span>
<span class="fc" id="L433">                        d0 = c8;</span>
<span class="fc" id="L434">                        d1 = c9;</span>
<span class="fc" id="L435">                        date_len = 11;</span>
                    } else {
<span class="nc" id="L437">                        return false;</span>
                    }
<span class="pc bpc" id="L439" title="1 of 4 branches missed.">                } else if (c6 == '月' || c6 == '월') {</span>
<span class="fc" id="L440">                    M0 = '0';</span>
<span class="fc" id="L441">                    M1 = c5;</span>
<span class="fc bfc" id="L442" title="All 4 branches covered.">                    if (c8 == '日' || c8 == '일') {</span>
<span class="fc" id="L443">                        d0 = '0';</span>
<span class="fc" id="L444">                        d1 = c7;</span>
<span class="pc bpc" id="L445" title="1 of 4 branches missed.">                    } else if (c9 == '日' || c9 == '일'){</span>
<span class="fc" id="L446">                        d0 = c7;</span>
<span class="fc" id="L447">                        d1 = c8;</span>
                    } else {
<span class="nc" id="L449">                        return false;</span>
                    }
                } else {
<span class="nc" id="L452">                    return false;</span>
                }
            } else {
<span class="fc" id="L455">                return false;</span>
            }
        }

<span class="fc bfc" id="L459" title="All 2 branches covered.">        if (!checkDate(y0, y1, y2, y3, M0, M1, d0, d1)) {</span>
<span class="fc" id="L460">            return false;</span>
        }

<span class="fc" id="L463">        setCalendar(y0, y1, y2, y3, M0, M1, d0, d1);</span>

<span class="fc" id="L465">        char t = charAt(bp + date_len);</span>
<span class="fc bfc" id="L466" title="All 6 branches covered.">        if (t == 'T' || (t == ' ' &amp;&amp; !strict)) {</span>
<span class="fc bfc" id="L467" title="All 2 branches covered.">            if (rest &lt; date_len + 9) { // &quot;0000-00-00T00:00:00&quot;.length()</span>
<span class="fc" id="L468">                return false;</span>
            }
<span class="pc bpc" id="L470" title="2 of 8 branches missed.">        } else if (t == '&quot;' || t == EOI || t == '日' || t == '일') {</span>
<span class="fc" id="L471">            calendar.set(Calendar.HOUR_OF_DAY, 0);</span>
<span class="fc" id="L472">            calendar.set(Calendar.MINUTE, 0);</span>
<span class="fc" id="L473">            calendar.set(Calendar.SECOND, 0);</span>
<span class="fc" id="L474">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="fc" id="L476">            ch = charAt(bp += date_len);</span>

<span class="fc" id="L478">            token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L479">            return true;</span>
<span class="pc bpc" id="L480" title="1 of 4 branches missed.">        } else if (t == '+' || t == '-') {</span>
<span class="fc bfc" id="L481" title="All 2 branches covered.">            if (len == date_len + 6) {</span>
<span class="pc bpc" id="L482" title="1 of 2 branches missed.">                if (charAt(bp + date_len + 3) != ':' //</span>
<span class="pc bpc" id="L483" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 4) != '0' //</span>
<span class="pc bpc" id="L484" title="1 of 2 branches missed.">                        || charAt(bp + date_len + 5) != '0') {</span>
<span class="nc" id="L485">                    return false;</span>
                }

<span class="fc" id="L488">                setTime('0', '0', '0', '0', '0', '0');</span>
<span class="fc" id="L489">                calendar.set(Calendar.MILLISECOND, 0);</span>
<span class="fc" id="L490">                setTimeZone(t, charAt(bp + date_len + 1), charAt(bp + date_len + 2));</span>
<span class="fc" id="L491">                return true;</span>
            }
<span class="fc" id="L493">            return false;</span>
        } else {
<span class="fc" id="L495">            return false;</span>
        }

<span class="fc bfc" id="L498" title="All 2 branches covered.">        if (charAt(bp + date_len + 3) != ':') {</span>
<span class="fc" id="L499">            return false;</span>
        }
<span class="fc bfc" id="L501" title="All 2 branches covered.">        if (charAt(bp + date_len + 6) != ':') {</span>
<span class="fc" id="L502">            return false;</span>
        }

<span class="fc" id="L505">        char h0 = charAt(bp + date_len + 1);</span>
<span class="fc" id="L506">        char h1 = charAt(bp + date_len + 2);</span>
<span class="fc" id="L507">        char m0 = charAt(bp + date_len + 4);</span>
<span class="fc" id="L508">        char m1 = charAt(bp + date_len + 5);</span>
<span class="fc" id="L509">        char s0 = charAt(bp + date_len + 7);</span>
<span class="fc" id="L510">        char s1 = charAt(bp + date_len + 8);</span>

<span class="fc bfc" id="L512" title="All 2 branches covered.">        if (!checkTime(h0, h1, m0, m1, s0, s1)) {</span>
<span class="fc" id="L513">            return false;</span>
        }

<span class="fc" id="L516">        setTime(h0, h1, m0, m1, s0, s1);</span>

<span class="fc" id="L518">        char dot = charAt(bp + date_len + 9);</span>
<span class="fc bfc" id="L519" title="All 2 branches covered.">        if (dot == '.') {</span>
<span class="fc bfc" id="L520" title="All 2 branches covered.">            if (rest &lt; date_len + 11) { //  // 0000-00-00T00:00:00.000</span>
<span class="fc" id="L521">                return false;</span>
            }
        } else {
<span class="fc" id="L524">            calendar.set(Calendar.MILLISECOND, 0);</span>

<span class="fc" id="L526">            ch = charAt(bp += (date_len + 9));</span>

<span class="fc" id="L528">            token = JSONToken.LITERAL_ISO8601_DATE;</span>

<span class="fc bfc" id="L530" title="All 2 branches covered.">            if (dot == 'Z') {// UTC</span>
                // bugfix https://github.com/alibaba/fastjson/issues/376
<span class="pc bpc" id="L532" title="1 of 2 branches missed.">                if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L533">                    String[] timeZoneIDs = TimeZone.getAvailableIDs(0);// 没有+ 和 - 默认相对0</span>
<span class="pc bpc" id="L534" title="1 of 2 branches missed.">                    if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L535">                        TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L536">                        calendar.setTimeZone(timeZone);</span>
                    }
                }
            }
<span class="fc" id="L540">            return true;</span>
        }

<span class="fc" id="L543">        char S0 = charAt(bp + date_len + 10);</span>
<span class="fc bfc" id="L544" title="All 4 branches covered.">        if (S0 &lt; '0' || S0 &gt; '9') {</span>
<span class="fc" id="L545">            return false;</span>
        }
<span class="fc" id="L547">        int millis = S0 - '0';</span>
<span class="fc" id="L548">        int millisLen = 1;</span>

<span class="fc bfc" id="L550" title="All 2 branches covered.">        if (rest &gt; date_len + 11) {</span>
<span class="fc" id="L551">            char S1 = charAt(bp + date_len + 11);</span>
<span class="fc bfc" id="L552" title="All 4 branches covered.">            if (S1 &gt;= '0' &amp;&amp; S1 &lt;= '9') {</span>
<span class="fc" id="L553">                millis = millis * 10 + (S1 - '0');</span>
<span class="fc" id="L554">                millisLen = 2;</span>
            }
        }

<span class="fc bfc" id="L558" title="All 2 branches covered.">        if (millisLen == 2) {</span>
<span class="fc" id="L559">            char S2 = charAt(bp + date_len + 12);</span>
<span class="fc bfc" id="L560" title="All 4 branches covered.">            if (S2 &gt;= '0' &amp;&amp; S2 &lt;= '9') {</span>
<span class="fc" id="L561">                millis = millis * 10 + (S2 - '0');</span>
<span class="fc" id="L562">                millisLen = 3;</span>
            }
        }

<span class="fc" id="L566">        calendar.set(Calendar.MILLISECOND, millis);</span>

<span class="fc" id="L568">        int timzeZoneLength = 0;</span>
<span class="fc" id="L569">        char timeZoneFlag = charAt(bp + date_len + 10 + millisLen);</span>
<span class="fc bfc" id="L570" title="All 4 branches covered.">        if (timeZoneFlag == '+' || timeZoneFlag == '-') {</span>
<span class="fc" id="L571">            char t0 = charAt(bp + date_len + 10 + millisLen + 1);</span>
<span class="pc bpc" id="L572" title="2 of 4 branches missed.">            if (t0 &lt; '0' || t0 &gt; '1') {</span>
<span class="nc" id="L573">                return false;</span>
            }

<span class="fc" id="L576">            char t1 = charAt(bp + date_len + 10 + millisLen + 2);</span>
<span class="pc bpc" id="L577" title="2 of 4 branches missed.">            if (t1 &lt; '0' || t1 &gt; '9') {</span>
<span class="nc" id="L578">                return false;</span>
            }

<span class="fc" id="L581">            char t2 = charAt(bp + date_len + 10 + millisLen + 3);</span>
<span class="fc" id="L582">            char t3 = '0', t4 = '0';</span>
<span class="fc bfc" id="L583" title="All 2 branches covered.">            if (t2 == ':') { // ThreeLetterISO8601TimeZone</span>
<span class="fc" id="L584">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="pc bpc" id="L585" title="1 of 4 branches missed.">                if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="nc" id="L586">                    return false;</span>
                }

<span class="fc" id="L589">                t4 = charAt(bp + date_len + 10 + millisLen + 5);</span>
<span class="pc bpc" id="L590" title="1 of 2 branches missed.">                if (t4 != '0') {</span>
<span class="nc" id="L591">                    return false;</span>
                }
<span class="fc" id="L593">                timzeZoneLength = 6;</span>
<span class="fc bfc" id="L594" title="All 2 branches covered.">            } else if (t2 == '0') { // TwoLetterISO8601TimeZone</span>
<span class="fc" id="L595">                t3 = charAt(bp + date_len + 10 + millisLen + 4);</span>
<span class="pc bpc" id="L596" title="3 of 4 branches missed.">                if (t3 != '0' &amp;&amp; t3 != '3') {</span>
<span class="nc" id="L597">                    return false;</span>
                }
<span class="fc" id="L599">                timzeZoneLength = 5;</span>
            } else {
<span class="fc" id="L601">                timzeZoneLength = 3;</span>
            }

<span class="fc" id="L604">            setTimeZone(timeZoneFlag, t0, t1, t3, t4);</span>

<span class="fc bfc" id="L606" title="All 2 branches covered.">        } else if (timeZoneFlag == 'Z') {// UTC</span>
<span class="fc" id="L607">            timzeZoneLength = 1;</span>
<span class="pc bpc" id="L608" title="1 of 2 branches missed.">            if (calendar.getTimeZone().getRawOffset() != 0) {</span>
<span class="fc" id="L609">                String[] timeZoneIDs = TimeZone.getAvailableIDs(0);</span>
<span class="pc bpc" id="L610" title="1 of 2 branches missed.">                if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L611">                    TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L612">                    calendar.setTimeZone(timeZone);</span>
                }
            }
        }

<span class="fc" id="L617">        char end = charAt(bp + (date_len + 10 + millisLen + timzeZoneLength));</span>
<span class="fc bfc" id="L618" title="All 4 branches covered.">        if (end != EOI &amp;&amp; end != '&quot;') {</span>
<span class="fc" id="L619">            return false;</span>
        }
<span class="fc" id="L621">        ch = charAt(bp += (date_len + 10 + millisLen + timzeZoneLength));</span>

<span class="fc" id="L623">        token = JSONToken.LITERAL_ISO8601_DATE;</span>
<span class="fc" id="L624">        return true;</span>
    }

    protected void setTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc" id="L628">        int hour = (h0 - '0') * 10 + (h1 - '0');</span>
<span class="fc" id="L629">        int minute = (m0 - '0') * 10 + (m1 - '0');</span>
<span class="fc" id="L630">        int seconds = (s0 - '0') * 10 + (s1 - '0');</span>
<span class="fc" id="L631">        calendar.set(Calendar.HOUR_OF_DAY, hour);</span>
<span class="fc" id="L632">        calendar.set(Calendar.MINUTE, minute);</span>
<span class="fc" id="L633">        calendar.set(Calendar.SECOND, seconds);</span>
<span class="fc" id="L634">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1) {
<span class="fc" id="L637">        setTimeZone(timeZoneFlag, t0, t1, '0', '0');</span>
<span class="fc" id="L638">    }</span>

    protected void setTimeZone(char timeZoneFlag, char t0, char t1, char t3, char t4) {
<span class="fc" id="L641">        int timeZoneOffset = ((t0 - '0') * 10 + (t1 - '0')) * 3600 * 1000;</span>

<span class="fc" id="L643">        timeZoneOffset += ((t3 - '0') * 10 + (t4 - '0')) * 60 * 1000;</span>

<span class="fc bfc" id="L645" title="All 2 branches covered.">        if (timeZoneFlag == '-') {</span>
<span class="fc" id="L646">            timeZoneOffset = -timeZoneOffset;</span>
        }

<span class="fc bfc" id="L649" title="All 2 branches covered.">        if (calendar.getTimeZone().getRawOffset() != timeZoneOffset) {</span>
<span class="fc" id="L650">            String[] timeZoneIDs = TimeZone.getAvailableIDs(timeZoneOffset);</span>
<span class="pc bpc" id="L651" title="1 of 2 branches missed.">            if (timeZoneIDs.length &gt; 0) {</span>
<span class="fc" id="L652">                TimeZone timeZone = TimeZone.getTimeZone(timeZoneIDs[0]);</span>
<span class="fc" id="L653">                calendar.setTimeZone(timeZone);</span>
            }
        }
<span class="fc" id="L656">    }</span>

    private boolean checkTime(char h0, char h1, char m0, char m1, char s0, char s1) {
<span class="fc bfc" id="L659" title="All 2 branches covered.">        if (h0 == '0') {</span>
<span class="fc bfc" id="L660" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L661">                return false;</span>
            }
<span class="fc bfc" id="L663" title="All 2 branches covered.">        } else if (h0 == '1') {</span>
<span class="fc bfc" id="L664" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '9') {</span>
<span class="fc" id="L665">                return false;</span>
            }
<span class="fc bfc" id="L667" title="All 2 branches covered.">        } else if (h0 == '2') {</span>
<span class="fc bfc" id="L668" title="All 4 branches covered.">            if (h1 &lt; '0' || h1 &gt; '4') {</span>
<span class="fc" id="L669">                return false;</span>
            }
        } else {
<span class="fc" id="L672">            return false;</span>
        }

<span class="fc bfc" id="L675" title="All 4 branches covered.">        if (m0 &gt;= '0' &amp;&amp; m0 &lt;= '5') {</span>
<span class="fc bfc" id="L676" title="All 4 branches covered.">            if (m1 &lt; '0' || m1 &gt; '9') {</span>
<span class="fc" id="L677">                return false;</span>
            }
<span class="fc bfc" id="L679" title="All 2 branches covered.">        } else if (m0 == '6') {</span>
<span class="fc bfc" id="L680" title="All 2 branches covered.">            if (m1 != '0') {</span>
<span class="fc" id="L681">                return false;</span>
            }
        } else {
<span class="fc" id="L684">            return false;</span>
        }

<span class="fc bfc" id="L687" title="All 4 branches covered.">        if (s0 &gt;= '0' &amp;&amp; s0 &lt;= '5') {</span>
<span class="fc bfc" id="L688" title="All 4 branches covered.">            if (s1 &lt; '0' || s1 &gt; '9') {</span>
<span class="fc" id="L689">                return false;</span>
            }
<span class="fc bfc" id="L691" title="All 2 branches covered.">        } else if (s0 == '6') {</span>
<span class="fc bfc" id="L692" title="All 2 branches covered.">            if (s1 != '0') {</span>
<span class="fc" id="L693">                return false;</span>
            }
        } else {
<span class="fc" id="L696">            return false;</span>
        }

<span class="fc" id="L699">        return true;</span>
    }

    private void setCalendar(char y0, char y1, char y2, char y3, char M0, char M1, char d0, char d1) {
<span class="fc" id="L703">        calendar = Calendar.getInstance(timeZone, locale);</span>
<span class="fc" id="L704">        int year = (y0 - '0') * 1000 + (y1 - '0') * 100 + (y2 - '0') * 10 + (y3 - '0');</span>
<span class="fc" id="L705">        int month = (M0 - '0') * 10 + (M1 - '0') - 1;</span>
<span class="fc" id="L706">        int day = (d0 - '0') * 10 + (d1 - '0');</span>
//        calendar.set(year, month, day);
<span class="fc" id="L708">        calendar.set(Calendar.YEAR, year);</span>
<span class="fc" id="L709">        calendar.set(Calendar.MONTH, month);</span>
<span class="fc" id="L710">        calendar.set(Calendar.DAY_OF_MONTH, day);</span>
<span class="fc" id="L711">    }</span>

    static boolean checkDate(char y0, char y1, char y2, char y3, char M0, char M1, int d0, int d1) {
<span class="fc bfc" id="L714" title="All 4 branches covered.">        if (y0 &lt; '1' || y0 &gt; '3') {</span>
<span class="fc" id="L715">            return false;</span>
        }
<span class="fc bfc" id="L717" title="All 4 branches covered.">        if (y1 &lt; '0' || y1 &gt; '9') {</span>
<span class="fc" id="L718">            return false;</span>
        }
<span class="fc bfc" id="L720" title="All 4 branches covered.">        if (y2 &lt; '0' || y2 &gt; '9') {</span>
<span class="fc" id="L721">            return false;</span>
        }
<span class="fc bfc" id="L723" title="All 4 branches covered.">        if (y3 &lt; '0' || y3 &gt; '9') {</span>
<span class="fc" id="L724">            return false;</span>
        }

<span class="fc bfc" id="L727" title="All 2 branches covered.">        if (M0 == '0') {</span>
<span class="fc bfc" id="L728" title="All 4 branches covered.">            if (M1 &lt; '1' || M1 &gt; '9') {</span>
<span class="fc" id="L729">                return false;</span>
            }
<span class="fc bfc" id="L731" title="All 2 branches covered.">        } else if (M0 == '1') {</span>
<span class="fc bfc" id="L732" title="All 6 branches covered.">            if (M1 != '0' &amp;&amp; M1 != '1' &amp;&amp; M1 != '2') {</span>
<span class="fc" id="L733">                return false;</span>
            }
        } else {
<span class="fc" id="L736">            return false;</span>
        }

<span class="fc bfc" id="L739" title="All 2 branches covered.">        if (d0 == '0') {</span>
<span class="fc bfc" id="L740" title="All 4 branches covered.">            if (d1 &lt; '1' || d1 &gt; '9') {</span>
<span class="fc" id="L741">                return false;</span>
            }
<span class="fc bfc" id="L743" title="All 4 branches covered.">        } else if (d0 == '1' || d0 == '2') {</span>
<span class="fc bfc" id="L744" title="All 4 branches covered.">            if (d1 &lt; '0' || d1 &gt; '9') {</span>
<span class="fc" id="L745">                return false;</span>
            }
<span class="fc bfc" id="L747" title="All 2 branches covered.">        } else if (d0 == '3') {</span>
<span class="fc bfc" id="L748" title="All 4 branches covered.">            if (d1 != '0' &amp;&amp; d1 != '1') {</span>
<span class="fc" id="L749">                return false;</span>
            }
        } else {
<span class="fc" id="L752">            return false;</span>
        }

<span class="fc" id="L755">        return true;</span>
    }

    @Override
    public boolean isEOF() {
<span class="pc bpc" id="L760" title="1 of 6 branches missed.">        return bp == len || ch == EOI &amp;&amp; bp + 1 == len;</span>
    }

    public int scanFieldInt(char[] fieldName) {
<span class="fc" id="L764">        matchStat = UNKNOWN;</span>
<span class="fc" id="L765">        int startPos = this.bp;</span>
<span class="fc" id="L766">        char startChar = this.ch;</span>

<span class="fc bfc" id="L768" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L769">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L770">            return 0;</span>
        }

<span class="fc" id="L773">        int index = bp + fieldName.length;</span>

<span class="fc" id="L775">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L777" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>

<span class="fc bfc" id="L779" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L780">            ch = charAt(index++);</span>
        }

<span class="fc bfc" id="L783" title="All 2 branches covered.">        final boolean negative = ch == '-';</span>
<span class="fc bfc" id="L784" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L785">            ch = charAt(index++);</span>
        }

        int value;
<span class="fc bfc" id="L789" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L790">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L792">                ch = charAt(index++);</span>
<span class="fc bfc" id="L793" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L794">                    value = value * 10 + (ch - '0');</span>
<span class="fc bfc" id="L795" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L796">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L797">                    return 0;</span>
                } else {
                    break;
                }
            }

<span class="fc bfc" id="L803" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L804">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L805">                return 0;</span>
            }

<span class="fc bfc" id="L808" title="All 2 branches covered.">            if (quote) {</span>
<span class="fc bfc" id="L809" title="All 2 branches covered.">                if (ch != '&quot;') {</span>
<span class="fc" id="L810">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L811">                    return 0;</span>
                } else {
<span class="fc" id="L813">                    ch = charAt(index++);</span>
                }
            }

            for (;;) {
<span class="fc bfc" id="L818" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L819">                    bp = index - 1;</span>
<span class="fc" id="L820">                    break;</span>
<span class="fc bfc" id="L821" title="All 2 branches covered.">                } else if(isWhitespace(ch)) {</span>
<span class="fc" id="L822">                    ch = charAt(index++);</span>
<span class="fc" id="L823">                    continue;</span>
                } else {
<span class="fc" id="L825">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L826">                    return 0;</span>
                }
            }
        } else {
<span class="fc" id="L830">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L831">            return 0;</span>
        }

<span class="fc bfc" id="L834" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L835">            this.ch = charAt(++bp);</span>
<span class="fc" id="L836">            matchStat = VALUE;</span>
<span class="fc" id="L837">            token = JSONToken.COMMA;</span>
<span class="pc bpc" id="L838" title="1 of 2 branches missed.">            return negative ? -value : value;</span>
        }

<span class="pc bpc" id="L841" title="1 of 2 branches missed.">        if (ch == '}') {</span>
<span class="fc" id="L842">            bp = index - 1;</span>
<span class="fc" id="L843">            ch = charAt(++bp);</span>
            for (; ; ) {
<span class="fc bfc" id="L845" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L846">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L847">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L848">                    break;</span>
<span class="fc bfc" id="L849" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L850">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L851">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L852">                    break;</span>
<span class="fc bfc" id="L853" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L854">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L855">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L856">                    break;</span>
<span class="fc bfc" id="L857" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L858">                    token = JSONToken.EOF;</span>
<span class="fc" id="L859">                    break;</span>
<span class="fc bfc" id="L860" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L861">                    ch = charAt(++bp);</span>
<span class="fc" id="L862">                    continue;</span>
                } else {
<span class="fc" id="L864">                    this.bp = startPos;</span>
<span class="fc" id="L865">                    this.ch = startChar;</span>
<span class="fc" id="L866">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L867">                    return 0;</span>
                }
            }
<span class="fc" id="L870">            matchStat = END;</span>
        }

<span class="pc bpc" id="L873" title="1 of 2 branches missed.">        return negative ? -value : value;</span>
    }

    public String scanFieldString(char[] fieldName) {
<span class="fc" id="L877">        matchStat = UNKNOWN;</span>
<span class="fc" id="L878">        int startPos = this.bp;</span>
<span class="fc" id="L879">        char startChar = this.ch;</span>

        for (;;) {
<span class="fc bfc" id="L882" title="All 2 branches covered.">            if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc bfc" id="L883" title="All 2 branches covered.">                if (isWhitespace(ch)) {</span>
<span class="fc" id="L884">                    next();</span>
<span class="fc" id="L885">                    continue;</span>
                }
<span class="fc" id="L887">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L888">                return stringDefaultValue();</span>
            } else {
                break;
            }
        }

<span class="fc" id="L894">        int index = bp + fieldName.length;</span>

<span class="fc" id="L896">        char ch = charAt(index++);</span>
<span class="fc bfc" id="L897" title="All 2 branches covered.">        if (ch != '&quot;') {</span>
<span class="fc" id="L898">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L900">            return stringDefaultValue();</span>
        }

        final String strVal;
        {
<span class="fc" id="L905">            int startIndex = index;</span>
<span class="fc" id="L906">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L907" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L908">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L911">            String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L912" title="All 2 branches covered.">            if (stringVal.indexOf('\\') != -1) {</span>
                for (;;) {
<span class="fc" id="L914">                    int slashCount = 0;</span>
<span class="pc bpc" id="L915" title="1 of 2 branches missed.">                    for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L916" title="All 2 branches covered.">                        if (charAt(i) == '\\') {</span>
<span class="fc" id="L917">                            slashCount++;</span>
                        } else {
                            break;
                        }
                    }
<span class="fc bfc" id="L922" title="All 2 branches covered.">                    if (slashCount % 2 == 0) {</span>
<span class="fc" id="L923">                        break;</span>
                    }
<span class="fc" id="L925">                    endIndex = indexOf('&quot;', endIndex + 1);</span>
<span class="fc" id="L926">                }</span>

<span class="fc" id="L928">                int chars_len = endIndex - (bp + fieldName.length + 1);</span>
<span class="fc" id="L929">                char[] chars = sub_chars(bp + fieldName.length + 1, chars_len);</span>

<span class="fc" id="L931">                stringVal = readString(chars, chars_len);</span>
            }

<span class="fc" id="L934">            ch = charAt(endIndex + 1);</span>

            for (;;) {
<span class="fc bfc" id="L937" title="All 4 branches covered.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L938">                    bp = endIndex + 1;</span>
<span class="fc" id="L939">                    this.ch = ch;</span>
<span class="fc" id="L940">                    strVal = stringVal;</span>
<span class="fc" id="L941">                    break;</span>
<span class="fc bfc" id="L942" title="All 2 branches covered.">                } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L943">                    endIndex++;</span>
<span class="fc" id="L944">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="fc" id="L946">                    matchStat = NOT_MATCH;</span>

<span class="fc" id="L948">                    return stringDefaultValue();</span>
                }
            }
        }

<span class="fc bfc" id="L953" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L954">            this.ch = charAt(++bp);</span>
<span class="fc" id="L955">            matchStat = VALUE;</span>
<span class="fc" id="L956">            return strVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L959">            ch = charAt(++bp);</span>
<span class="fc bfc" id="L960" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L961">                token = JSONToken.COMMA;</span>
<span class="fc" id="L962">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L963" title="All 2 branches covered.">            } else if (ch == ']') {</span>
<span class="fc" id="L964">                token = JSONToken.RBRACKET;</span>
<span class="fc" id="L965">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L966" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L967">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L968">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L969" title="All 2 branches covered.">            } else if (ch == EOI) {</span>
<span class="fc" id="L970">                token = JSONToken.EOF;</span>
            } else {
<span class="fc" id="L972">                this.bp = startPos;</span>
<span class="fc" id="L973">                this.ch = startChar;</span>
<span class="fc" id="L974">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L975">                return stringDefaultValue();</span>
            }
<span class="fc" id="L977">            matchStat = END;</span>
        }
<span class="fc" id="L979">        return strVal;</span>
    }

    public java.util.Date scanFieldDate(char[] fieldName) {
<span class="fc" id="L983">        matchStat = UNKNOWN;</span>
<span class="fc" id="L984">        int startPos = this.bp;</span>
<span class="fc" id="L985">        char startChar = this.ch;</span>

<span class="fc bfc" id="L987" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L988">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L989">            return null;</span>
        }

<span class="fc" id="L992">        int index = bp + fieldName.length;</span>

<span class="fc" id="L994">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L997" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L998">            int startIndex = index;</span>
<span class="fc" id="L999">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1000" title="All 2 branches covered.">            if (endIndex == -1) {</span>
<span class="fc" id="L1001">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L1004">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L1005">            bp = index;</span>
<span class="fc bfc" id="L1006" title="All 2 branches covered.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L1007">                dateVal = calendar.getTime();</span>
            } else {
<span class="fc" id="L1009">                bp = startPos;</span>
<span class="fc" id="L1010">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1011">                return null;</span>
            }
<span class="fc" id="L1013">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L1014">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L1017" title="1 of 4 branches missed.">                if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1018">                    bp = endIndex + 1;</span>
<span class="fc" id="L1019">                    this.ch = ch;</span>
<span class="fc" id="L1020">                    break;</span>
<span class="nc bnc" id="L1021" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1022">                    endIndex++;</span>
<span class="nc" id="L1023">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="nc" id="L1025">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L1027">                    return null;</span>
                }
            }
<span class="pc bpc" id="L1030" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L1031">            long millis = 0;</span>

<span class="fc" id="L1033">            boolean negative = false;</span>
<span class="pc bpc" id="L1034" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L1035">                ch = charAt(index++);</span>
<span class="nc" id="L1036">                negative = true;</span>
            }

<span class="pc bpc" id="L1039" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1040">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L1042">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1043" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1044">                        millis = millis * 10 + (ch - '0');</span>
                    } else {
<span class="pc bpc" id="L1046" title="1 of 4 branches missed.">                        if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1047">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L1054" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L1055">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1056">                return null;</span>
            }

<span class="pc bpc" id="L1059" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L1060">                millis = -millis;</span>
            }

<span class="fc" id="L1063">            dateVal = new java.util.Date(millis);</span>
<span class="fc" id="L1064">        } else {</span>
<span class="fc" id="L1065">            matchStat = NOT_MATCH;</span>

<span class="fc" id="L1067">            return null;</span>
        }

<span class="fc bfc" id="L1070" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1071">            this.ch = charAt(++bp);</span>
<span class="fc" id="L1072">            matchStat = VALUE;</span>
<span class="fc" id="L1073">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1074">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L1077">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L1078" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L1079">                token = JSONToken.COMMA;</span>
<span class="nc" id="L1080">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L1081" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L1082">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L1083">                this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1084" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1085">                token = JSONToken.RBRACE;</span>
<span class="fc" id="L1086">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L1087" title="1 of 2 branches missed.">            } else if (ch == EOI) {</span>
<span class="fc" id="L1088">                token = JSONToken.EOF;</span>
            } else {
<span class="nc" id="L1090">                this.bp = startPos;</span>
<span class="nc" id="L1091">                this.ch = startChar;</span>
<span class="nc" id="L1092">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1093">                return null;</span>
            }
<span class="fc" id="L1095">            matchStat = END;</span>
        }
<span class="fc" id="L1097">        return dateVal;</span>
    }

    public long scanFieldSymbol(char[] fieldName) {
<span class="fc" id="L1101">        matchStat = UNKNOWN;</span>

<span class="fc bfc" id="L1103" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1104">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1105">            return 0;</span>
        }

<span class="fc" id="L1108">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1110">        char ch = charAt(index++);</span>
<span class="fc bfc" id="L1111" title="All 2 branches covered.">        if (ch != '&quot;') {</span>
<span class="fc" id="L1112">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1113">            return 0;</span>
        }

<span class="fc" id="L1116">        long hash = 0xcbf29ce484222325L;</span>
        for (;;) {
<span class="fc" id="L1118">            ch = charAt(index++);</span>
<span class="fc bfc" id="L1119" title="All 2 branches covered.">            if (ch == '\&quot;') {</span>
<span class="fc" id="L1120">                bp = index;</span>
<span class="fc" id="L1121">                this.ch = ch = charAt(bp);</span>
<span class="fc" id="L1122">                break;</span>
<span class="pc bpc" id="L1123" title="1 of 2 branches missed.">            } else if (index &gt; len) {</span>
<span class="nc" id="L1124">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1125">                return 0;</span>
            }

<span class="fc" id="L1128">            hash ^= ch;</span>
<span class="fc" id="L1129">            hash *= 0x100000001b3L;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1133" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1134">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1135">                matchStat = VALUE;</span>
<span class="fc" id="L1136">                return hash;</span>
<span class="fc bfc" id="L1137" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1138">                next();</span>
<span class="fc" id="L1139">                skipWhitespace();</span>
<span class="fc" id="L1140">                ch = getCurrent();</span>
<span class="fc bfc" id="L1141" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1142">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1143">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1144" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1145">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1146">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1147" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1148">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1149">                    this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1150" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1151">                    token = JSONToken.EOF;</span>
                } else {
<span class="fc" id="L1153">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1154">                    return 0;</span>
                }
<span class="fc" id="L1156">                matchStat = END;</span>
<span class="fc" id="L1157">                break;</span>
<span class="fc bfc" id="L1158" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1159">                ch = charAt(++bp);</span>
<span class="fc" id="L1160">                continue;</span>
            } else {
<span class="fc" id="L1162">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1163">                return 0;</span>
            }
        }

<span class="fc" id="L1167">        return hash;</span>
    }

    public Collection&lt;String&gt; newCollectionByType(Class&lt;?&gt; type){
<span class="fc bfc" id="L1171" title="All 2 branches covered.">        if (type.isAssignableFrom(HashSet.class)) {</span>
<span class="fc" id="L1172">            HashSet&lt;String&gt; list = new HashSet&lt;String&gt;();</span>
<span class="fc" id="L1173">            return list;</span>
<span class="fc bfc" id="L1174" title="All 2 branches covered.">        } else if (type.isAssignableFrom(ArrayList.class)) {</span>
<span class="fc" id="L1175">            ArrayList&lt;String&gt; list2 = new ArrayList&lt;String&gt;();</span>
<span class="fc" id="L1176">            return list2;</span>
        } else {
            try {
<span class="fc" id="L1179">                Collection&lt;String&gt; list = (Collection&lt;String&gt;) type.newInstance();</span>
<span class="fc" id="L1180">                return list;</span>
<span class="fc" id="L1181">            } catch (Exception e) {</span>
<span class="fc" id="L1182">                throw new JSONException(e.getMessage(), e);</span>
            }
        }
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public Collection&lt;String&gt; scanFieldStringArray(char[] fieldName, Class&lt;?&gt; type) {
<span class="fc" id="L1189">        matchStat = UNKNOWN;</span>

<span class="fc bfc" id="L1191" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1192">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1193">            return null;</span>
        }

<span class="fc" id="L1196">        Collection&lt;String&gt; list = newCollectionByType(type);</span>

//        if (type.isAssignableFrom(HashSet.class)) {
//            list = new HashSet&lt;String&gt;();
//        } else if (type.isAssignableFrom(ArrayList.class)) {
//            list = new ArrayList&lt;String&gt;();
//        } else {
//            try {
//                list = (Collection&lt;String&gt;) type.newInstance();
//            } catch (Exception e) {
//                throw new JSONException(e.getMessage(), e);
//            }
//        }

<span class="fc" id="L1210">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1212">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1214" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L1215">            ch = charAt(index++);</span>

            for (;;) {
<span class="fc bfc" id="L1218" title="All 2 branches covered.">                if (ch == '&quot;') {</span>
<span class="fc" id="L1219">                    int startIndex = index;</span>
<span class="fc" id="L1220">                    int endIndex = indexOf('&quot;', startIndex);</span>
<span class="fc bfc" id="L1221" title="All 2 branches covered.">                    if (endIndex == -1) {</span>
<span class="fc" id="L1222">                        throw new JSONException(&quot;unclosed str&quot;);</span>
                    }

<span class="fc" id="L1225">                    String stringVal = subString(startIndex, endIndex - startIndex);</span>
<span class="fc bfc" id="L1226" title="All 2 branches covered.">                    if (stringVal.indexOf('\\') != -1) {</span>
                        for (;;) {
<span class="fc" id="L1228">                            int slashCount = 0;</span>
<span class="pc bpc" id="L1229" title="1 of 2 branches missed.">                            for (int i = endIndex - 1; i &gt;= 0; --i) {</span>
<span class="fc bfc" id="L1230" title="All 2 branches covered.">                                if (charAt(i) == '\\') {</span>
<span class="fc" id="L1231">                                    slashCount++;</span>
                                } else {
                                    break;
                                }
                            }
<span class="fc bfc" id="L1236" title="All 2 branches covered.">                            if (slashCount % 2 == 0) {</span>
<span class="fc" id="L1237">                                break;</span>
                            }
<span class="fc" id="L1239">                            endIndex = indexOf('&quot;', endIndex + 1);</span>
<span class="fc" id="L1240">                        }</span>

<span class="fc" id="L1242">                        int chars_len = endIndex - startIndex;</span>
<span class="fc" id="L1243">                        char[] chars = sub_chars(startIndex, chars_len);</span>

<span class="fc" id="L1245">                        stringVal = readString(chars, chars_len);</span>
                    }

<span class="fc" id="L1248">                    index = endIndex + 1;</span>
<span class="fc" id="L1249">                    ch = charAt(index++);</span>

<span class="fc" id="L1251">                    list.add(stringVal);</span>
<span class="fc bfc" id="L1252" title="All 4 branches covered.">                } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1253">                    index += 3;</span>
<span class="fc" id="L1254">                    ch = charAt(index++);</span>
<span class="fc" id="L1255">                    list.add(null);</span>
<span class="fc bfc" id="L1256" title="All 4 branches covered.">                } else if (ch == ']' &amp;&amp; list.size() == 0) {</span>
<span class="fc" id="L1257">                    ch = charAt(index++);</span>
<span class="fc" id="L1258">                    break;</span>
                } else {
<span class="fc" id="L1260">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1261">                    return null;</span>
                }

<span class="fc bfc" id="L1264" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1265">                    ch = charAt(index++);</span>
<span class="fc" id="L1266">                    continue;</span>
                }

<span class="fc bfc" id="L1269" title="All 2 branches covered.">                if (ch == ']') {</span>
<span class="fc" id="L1270">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1271" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1272">                        ch = charAt(index++);</span>
                    }
                    break;
                }

<span class="fc" id="L1277">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1278">                return null;</span>
            }
<span class="fc bfc" id="L1280" title="All 2 branches covered.">        } else if (text.startsWith(&quot;ull&quot;, index)) {</span>
<span class="fc" id="L1281">            index += 3;</span>
<span class="fc" id="L1282">            ch = charAt(index++);</span>
<span class="fc" id="L1283">            list = null;</span>
        } else {
<span class="fc" id="L1285">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1286">            return null;</span>
        }

<span class="fc" id="L1289">        bp = index;</span>
<span class="fc bfc" id="L1290" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L1291">            this.ch = charAt(bp);</span>
<span class="fc" id="L1292">            matchStat = VALUE;</span>
<span class="fc" id="L1293">            return list;</span>
<span class="fc bfc" id="L1294" title="All 2 branches covered.">        } else if (ch == '}') {</span>
<span class="fc" id="L1295">            ch = charAt(bp);</span>
            for (;;) {
<span class="fc bfc" id="L1297" title="All 2 branches covered.">                if (ch == ',') {</span>
<span class="fc" id="L1298">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1299">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1300">                    break;</span>
<span class="fc bfc" id="L1301" title="All 2 branches covered.">                } else if (ch == ']') {</span>
<span class="fc" id="L1302">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1303">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1304">                    break;</span>
<span class="fc bfc" id="L1305" title="All 2 branches covered.">                } else if (ch == '}') {</span>
<span class="fc" id="L1306">                    token = JSONToken.RBRACE;</span>
<span class="fc" id="L1307">                    this.ch = charAt(++bp);</span>
<span class="fc" id="L1308">                    break;</span>
<span class="fc bfc" id="L1309" title="All 2 branches covered.">                } else if (ch == EOI) {</span>
<span class="fc" id="L1310">                    token = JSONToken.EOF;</span>
<span class="fc" id="L1311">                    this.ch = ch;</span>
<span class="fc" id="L1312">                    break;</span>
                } else {
<span class="fc" id="L1314">                    boolean space = false;</span>
<span class="fc bfc" id="L1315" title="All 2 branches covered.">                    while (isWhitespace(ch)) {</span>
<span class="fc" id="L1316">                        ch = charAt(index++);</span>
<span class="fc" id="L1317">                        bp = index;</span>
<span class="fc" id="L1318">                        space = true;</span>
                    }
<span class="fc bfc" id="L1320" title="All 2 branches covered.">                    if (space) {</span>
<span class="fc" id="L1321">                        continue;</span>
                    }

<span class="fc" id="L1324">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1325">                    return null;</span>
                }
            }

<span class="fc" id="L1329">            matchStat = END;</span>
        } else {
<span class="fc" id="L1331">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1332">            return null;</span>
        }

<span class="fc" id="L1335">        return list;</span>
    }

    public long scanFieldLong(char[] fieldName) {
<span class="fc" id="L1339">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1340">        int startPos = this.bp;</span>
<span class="fc" id="L1341">        char startChar = this.ch;</span>

<span class="fc bfc" id="L1343" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1344">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1345">            return 0;</span>
        }

<span class="fc" id="L1348">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1350">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1352" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1353" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1354">            ch = charAt(index++);</span>
        }

<span class="fc" id="L1357">        boolean negative = false;</span>
<span class="fc bfc" id="L1358" title="All 2 branches covered.">        if (ch == '-') {</span>
<span class="fc" id="L1359">            ch = charAt(index++);</span>
<span class="fc" id="L1360">            negative = true;</span>
        }

        long value;
<span class="fc bfc" id="L1364" title="All 4 branches covered.">        if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1365">            value = ch - '0';</span>
            for (;;) {
<span class="fc" id="L1367">                ch = charAt(index++);</span>
<span class="fc bfc" id="L1368" title="All 4 branches covered.">                if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1369">                    value = value * 10 + (ch - '0');</span>
<span class="fc bfc" id="L1370" title="All 2 branches covered.">                } else if (ch == '.') {</span>
<span class="fc" id="L1371">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1372">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1374" title="All 2 branches covered.">                    if (quote) {</span>
<span class="fc bfc" id="L1375" title="All 2 branches covered.">                        if (ch != '&quot;') {</span>
<span class="fc" id="L1376">                            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1377">                            return 0;</span>
                        } else {
<span class="fc" id="L1379">                            ch = charAt(index++);</span>
                        }
                    }

<span class="fc bfc" id="L1383" title="All 4 branches covered.">                    if (ch == ',' || ch == '}') {</span>
<span class="fc" id="L1384">                        bp = index - 1;</span>
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1390" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1391" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1392">                this.bp = startPos;</span>
<span class="fc" id="L1393">                this.ch = startChar;</span>
<span class="fc" id="L1394">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1395">                return 0;</span>
            }
<span class="fc" id="L1397">        } else {</span>
<span class="fc" id="L1398">            this.bp = startPos;</span>
<span class="fc" id="L1399">            this.ch = startChar;</span>
<span class="fc" id="L1400">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1401">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1405" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1406">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1407">                matchStat = VALUE;</span>
<span class="fc" id="L1408">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1409" title="All 2 branches covered.">                return negative ? -value : value;</span>
<span class="fc bfc" id="L1410" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1411">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1413" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1414">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1415">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1416">                        break;</span>
<span class="fc bfc" id="L1417" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1418">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1419">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1420">                        break;</span>
<span class="fc bfc" id="L1421" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1422">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1423">                        this.ch = charAt(++bp);</span>
<span class="fc" id="L1424">                        break;</span>
<span class="fc bfc" id="L1425" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1426">                        token = JSONToken.EOF;</span>
<span class="fc" id="L1427">                        break;</span>
<span class="fc bfc" id="L1428" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1429">                        ch = charAt(++bp);</span>
                    } else {
<span class="fc" id="L1431">                        this.bp = startPos;</span>
<span class="fc" id="L1432">                        this.ch = startChar;</span>
<span class="fc" id="L1433">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1434">                        return 0;</span>
                    }
                }
<span class="fc" id="L1437">                matchStat = END;</span>
<span class="fc" id="L1438">                break;</span>
<span class="fc bfc" id="L1439" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1440">                bp = index;</span>
<span class="fc" id="L1441">                ch = charAt(index++);</span>
<span class="fc" id="L1442">                continue;</span>
            } else {
<span class="fc" id="L1444">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1445">                return 0;</span>
            }
        }

<span class="fc bfc" id="L1449" title="All 2 branches covered.">        return negative ? -value : value;</span>
    }

    public boolean scanFieldBoolean(char[] fieldName) {
<span class="fc" id="L1453">        matchStat = UNKNOWN;</span>

<span class="fc bfc" id="L1455" title="All 2 branches covered.">        if (!charArrayCompare(text, bp, fieldName)) {</span>
<span class="fc" id="L1456">            matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L1457">            return false;</span>
        }

<span class="fc" id="L1460">        int startPos = bp;</span>
<span class="fc" id="L1461">        int index = bp + fieldName.length;</span>

<span class="fc" id="L1463">        char ch = charAt(index++);</span>

<span class="fc bfc" id="L1465" title="All 2 branches covered.">        final boolean quote = ch == '&quot;';</span>
<span class="fc bfc" id="L1466" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1467">            ch = charAt(index++);</span>
        }

        boolean value;
<span class="fc bfc" id="L1471" title="All 2 branches covered.">        if (ch == 't') {</span>
<span class="fc bfc" id="L1472" title="All 2 branches covered.">            if (charAt(index++) != 'r') {</span>
<span class="fc" id="L1473">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1474">                return false;</span>
            }
<span class="fc bfc" id="L1476" title="All 2 branches covered.">            if (charAt(index++) != 'u') {</span>
<span class="fc" id="L1477">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1478">                return false;</span>
            }
<span class="fc bfc" id="L1480" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1481">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1482">                return false;</span>
            }

<span class="pc bpc" id="L1485" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1486">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1487">                return false;</span>
            }

<span class="fc" id="L1490">            bp = index;</span>
<span class="fc" id="L1491">            ch = charAt(bp);</span>
<span class="fc" id="L1492">            value = true;</span>
<span class="fc bfc" id="L1493" title="All 2 branches covered.">        } else if (ch == 'f') {</span>
<span class="fc bfc" id="L1494" title="All 2 branches covered.">            if (charAt(index++) != 'a') {</span>
<span class="fc" id="L1495">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1496">                return false;</span>
            }
<span class="fc bfc" id="L1498" title="All 2 branches covered.">            if (charAt(index++) != 'l') {</span>
<span class="fc" id="L1499">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1500">                return false;</span>
            }
<span class="fc bfc" id="L1502" title="All 2 branches covered.">            if (charAt(index++) != 's') {</span>
<span class="fc" id="L1503">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1504">                return false;</span>
            }
<span class="fc bfc" id="L1506" title="All 2 branches covered.">            if (charAt(index++) != 'e') {</span>
<span class="fc" id="L1507">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1508">                return false;</span>
            }

<span class="pc bpc" id="L1511" title="1 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1512">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1513">                return false;</span>
            }

<span class="fc" id="L1516">            bp = index;</span>
<span class="fc" id="L1517">            ch = charAt(bp);</span>
<span class="fc" id="L1518">            value = false;</span>
<span class="fc bfc" id="L1519" title="All 2 branches covered.">        } else if (ch == '1') {</span>
<span class="pc bpc" id="L1520" title="1 of 4 branches missed.">                if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1521">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L1522">                    return false;</span>
                }

<span class="fc" id="L1525">                bp = index;</span>
<span class="fc" id="L1526">                ch = charAt(bp);</span>
<span class="fc" id="L1527">                value = true;</span>
<span class="fc bfc" id="L1528" title="All 2 branches covered.">        } else if (ch == '0') {</span>
<span class="pc bpc" id="L1529" title="3 of 4 branches missed.">            if (quote &amp;&amp; charAt(index++) != '&quot;') {</span>
<span class="nc" id="L1530">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1531">                return false;</span>
            }

<span class="fc" id="L1534">            bp = index;</span>
<span class="fc" id="L1535">            ch = charAt(bp);</span>
<span class="fc" id="L1536">            value = false;</span>
        } else {
<span class="fc" id="L1538">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1539">            return false;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1543" title="All 2 branches covered.">            if (ch == ',') {</span>
<span class="fc" id="L1544">                this.ch = charAt(++bp);</span>
<span class="fc" id="L1545">                matchStat = VALUE;</span>
<span class="fc" id="L1546">                token = JSONToken.COMMA;</span>
<span class="fc" id="L1547">                break;</span>
<span class="fc bfc" id="L1548" title="All 2 branches covered.">            } else if (ch == '}') {</span>
<span class="fc" id="L1549">                ch = charAt(++bp);</span>
                for (;;) {
<span class="fc bfc" id="L1551" title="All 2 branches covered.">                    if (ch == ',') {</span>
<span class="fc" id="L1552">                        token = JSONToken.COMMA;</span>
<span class="fc" id="L1553">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1554" title="All 2 branches covered.">                    } else if (ch == ']') {</span>
<span class="fc" id="L1555">                        token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1556">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1557" title="All 2 branches covered.">                    } else if (ch == '}') {</span>
<span class="fc" id="L1558">                        token = JSONToken.RBRACE;</span>
<span class="fc" id="L1559">                        this.ch = charAt(++bp);</span>
<span class="fc bfc" id="L1560" title="All 2 branches covered.">                    } else if (ch == EOI) {</span>
<span class="fc" id="L1561">                        token = JSONToken.EOF;</span>
<span class="fc bfc" id="L1562" title="All 2 branches covered.">                    } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1563">                        ch = charAt(++bp);</span>
<span class="fc" id="L1564">                        continue;</span>
                    } else {
<span class="fc" id="L1566">                        matchStat = NOT_MATCH;</span>
<span class="fc" id="L1567">                        return false;</span>
                    }
                    break;
                }
<span class="fc" id="L1571">                matchStat = END;</span>
<span class="fc" id="L1572">                break;</span>
<span class="fc bfc" id="L1573" title="All 2 branches covered.">            } else if (isWhitespace(ch)) {</span>
<span class="fc" id="L1574">                ch = charAt(++bp);</span>
            } else {
<span class="fc" id="L1576">                bp = startPos;</span>
<span class="fc" id="L1577">                ch = charAt(bp);</span>
<span class="fc" id="L1578">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1579">                return false;</span>
            }
        }

<span class="fc" id="L1583">        return value;</span>
    }

    public final int scanInt(char expectNext) {
<span class="fc" id="L1587">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1589">        int offset = bp;</span>
<span class="fc" id="L1590">        char chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1592" title="1 of 2 branches missed.">        while (isWhitespace(chLocal)) {</span>
<span class="nc" id="L1593">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1596" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1598" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1599">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1602" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1603" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1604">            chLocal = charAt(offset++);</span>
        }

        int value;
<span class="fc bfc" id="L1608" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1609">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1611">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1612" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1613">                    value = value * 10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1614" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1615">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1616">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1618" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1619" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1620">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1621">                            return 0;</span>
                        } else {
<span class="fc" id="L1623">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }
<span class="fc bfc" id="L1629" title="All 2 branches covered.">            if (value &lt; 0) {</span>
<span class="fc" id="L1630">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1631">                return 0;</span>
            }
<span class="fc bfc" id="L1633" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1634" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1635" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1636" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1637">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1638">            value = 0;</span>
<span class="fc" id="L1639">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1641" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1642">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1646" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1647">                    bp = offset;</span>
<span class="fc" id="L1648">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1649">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1650">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1651">                    return value;</span>
<span class="fc bfc" id="L1652" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1653">                    bp = offset;</span>
<span class="fc" id="L1654">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1655">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1656">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1657">                    return value;</span>
<span class="pc bpc" id="L1658" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1659">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1660">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1664">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1665">            return 0;</span>
        } else {
<span class="fc" id="L1667">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1668">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1672" title="All 2 branches covered.">            if (chLocal == expectNext) {</span>
<span class="fc" id="L1673">                bp = offset;</span>
<span class="fc" id="L1674">                this.ch = charAt(bp);</span>
<span class="fc" id="L1675">                matchStat = VALUE;</span>
<span class="fc" id="L1676">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1677" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1679" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1680">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1681">                    continue;</span>
                }
<span class="fc" id="L1683">                matchStat = NOT_MATCH;</span>
<span class="fc bfc" id="L1684" title="All 2 branches covered.">                return negative ? -value : value;</span>
            }
        }
    }

    public  double scanDouble(char seperator) {
<span class="fc" id="L1690">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1692">        int offset = bp;</span>
<span class="fc" id="L1693">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1694" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>
<span class="fc bfc" id="L1695" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1696">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1699" title="All 2 branches covered.">        boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1700" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1701">            chLocal = charAt(offset++);</span>
        }

        double value;
<span class="pc bpc" id="L1705" title="1 of 4 branches missed.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1706">            long intVal = chLocal - '0';</span>
            for (; ; ) {
<span class="fc" id="L1708">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1709" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1710">                    intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1711">                    continue;</span>
                } else {
                    break;
                }
            }

<span class="fc" id="L1717">            long power = 1;</span>
<span class="fc bfc" id="L1718" title="All 2 branches covered.">            boolean small = (chLocal == '.');</span>
<span class="fc bfc" id="L1719" title="All 2 branches covered.">            if (small) {</span>
<span class="fc" id="L1720">                chLocal = charAt(offset++);</span>
<span class="pc bpc" id="L1721" title="1 of 4 branches missed.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1722">                    intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1723">                    power = 10;</span>
                    for (; ; ) {
<span class="fc" id="L1725">                        chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1726" title="All 4 branches covered.">                        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1727">                            intVal = intVal * 10 + (chLocal - '0');</span>
<span class="fc" id="L1728">                            power *= 10;</span>
<span class="fc" id="L1729">                            continue;</span>
                        } else {
                            break;
                        }
                    }
                } else {
<span class="fc" id="L1735">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1736">                    return 0;</span>
                }
            }

<span class="pc bpc" id="L1740" title="2 of 4 branches missed.">            boolean exp = chLocal == 'e' || chLocal == 'E';</span>
<span class="pc bpc" id="L1741" title="1 of 2 branches missed.">            if (exp) {</span>
<span class="nc" id="L1742">                chLocal = charAt(offset++);</span>
<span class="nc bnc" id="L1743" title="All 4 branches missed.">                if (chLocal == '+' || chLocal == '-') {</span>
<span class="nc" id="L1744">                    chLocal = charAt(offset++);</span>
                }
                for (; ; ) {
<span class="nc bnc" id="L1747" title="All 4 branches missed.">                    if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="nc" id="L1748">                        chLocal = charAt(offset++);</span>
                    } else {
                        break;
                    }
                }
            }

            int start, count;
<span class="fc bfc" id="L1756" title="All 2 branches covered.">            if (quote) {</span>
<span class="pc bpc" id="L1757" title="1 of 2 branches missed.">                if (chLocal != '&quot;') {</span>
<span class="nc" id="L1758">                    matchStat = NOT_MATCH;</span>
<span class="nc" id="L1759">                    return 0;</span>
                } else {
<span class="fc" id="L1761">                    chLocal = charAt(offset++);</span>
                }
<span class="fc" id="L1763">                start = bp + 1;</span>
<span class="fc" id="L1764">                count = offset - start - 2;</span>
            } else {
<span class="fc" id="L1766">                start = bp;</span>
<span class="fc" id="L1767">                count = offset - start - 1;</span>
            }

<span class="pc bpc" id="L1770" title="2 of 4 branches missed.">            if (!exp &amp;&amp; count &lt; 20) {</span>
<span class="fc" id="L1771">                value = ((double) intVal) / power;</span>
<span class="fc bfc" id="L1772" title="All 2 branches covered.">                if (negative) {</span>
<span class="fc" id="L1773">                    value = -value;</span>
                }
            } else {
<span class="nc" id="L1776">                String text = this.subString(start, count);</span>
<span class="nc" id="L1777">                value = Double.parseDouble(text);</span>
            }
<span class="fc bfc" id="L1779" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1780" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1781" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1782" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1783">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1784">            value = 0;</span>
<span class="fc" id="L1785">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1787" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1788">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1792" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1793">                    bp = offset;</span>
<span class="fc" id="L1794">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1795">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1796">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1797">                    return value;</span>
<span class="fc bfc" id="L1798" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1799">                    bp = offset;</span>
<span class="fc" id="L1800">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1801">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1802">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1803">                    return value;</span>
<span class="pc bpc" id="L1804" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1805">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1806">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1810">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1811">            return 0;</span>
        } else {
<span class="fc" id="L1813">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1814">            return 0;</span>
        }

<span class="fc bfc" id="L1817" title="All 2 branches covered.">        if (chLocal == seperator) {</span>
<span class="fc" id="L1818">            bp = offset;</span>
<span class="fc" id="L1819">            this.ch = this.charAt(bp);</span>
<span class="fc" id="L1820">            matchStat = VALUE;</span>
<span class="fc" id="L1821">            token = JSONToken.COMMA;</span>
<span class="fc" id="L1822">            return value;</span>
        } else {
<span class="fc" id="L1824">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1825">            return value;</span>
        }
    }

    public long scanLong(char seperator) {
<span class="fc" id="L1830">        matchStat = UNKNOWN;</span>

<span class="fc" id="L1832">        int offset = bp;</span>
<span class="fc" id="L1833">        char chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1834" title="All 2 branches covered.">        final boolean quote = chLocal == '&quot;';</span>

<span class="fc bfc" id="L1836" title="All 2 branches covered.">        if (quote) {</span>
<span class="fc" id="L1837">            chLocal = charAt(offset++);</span>
        }

<span class="fc bfc" id="L1840" title="All 2 branches covered.">        final boolean negative = chLocal == '-';</span>
<span class="fc bfc" id="L1841" title="All 2 branches covered.">        if (negative) {</span>
<span class="fc" id="L1842">            chLocal = charAt(offset++);</span>
        }

        long value;
<span class="fc bfc" id="L1846" title="All 4 branches covered.">        if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1847">            value = chLocal - '0';</span>
            for (;;) {
<span class="fc" id="L1849">                chLocal = charAt(offset++);</span>
<span class="fc bfc" id="L1850" title="All 4 branches covered.">                if (chLocal &gt;= '0' &amp;&amp; chLocal &lt;= '9') {</span>
<span class="fc" id="L1851">                    value = value * 10 + (chLocal - '0');</span>
<span class="fc bfc" id="L1852" title="All 2 branches covered.">                } else if (chLocal == '.') {</span>
<span class="fc" id="L1853">                    matchStat = NOT_MATCH;</span>
<span class="fc" id="L1854">                    return 0;</span>
                } else {
<span class="fc bfc" id="L1856" title="All 2 branches covered.">                    if (quote) {</span>
<span class="pc bpc" id="L1857" title="1 of 2 branches missed.">                        if (chLocal != '&quot;') {</span>
<span class="nc" id="L1858">                            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1859">                            return 0;</span>
                        } else {
<span class="fc" id="L1861">                            chLocal = charAt(offset++);</span>
                        }
                    }
                    break;
                }
            }

<span class="fc bfc" id="L1868" title="All 6 branches covered.">            boolean valid = value &gt;= 0 || (value == -9223372036854775808L &amp;&amp; negative);</span>
<span class="fc bfc" id="L1869" title="All 2 branches covered.">            if (!valid) {</span>
<span class="fc" id="L1870">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1871">                return 0;</span>
            }
<span class="fc bfc" id="L1873" title="All 2 branches covered.">        } else if (chLocal == 'n'</span>
<span class="pc bpc" id="L1874" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'u'</span>
<span class="pc bpc" id="L1875" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l'</span>
<span class="pc bpc" id="L1876" title="1 of 2 branches missed.">                &amp;&amp; charAt(offset++) == 'l') {</span>
<span class="fc" id="L1877">            matchStat = VALUE_NULL;</span>
<span class="fc" id="L1878">            value = 0;</span>
<span class="fc" id="L1879">            chLocal = charAt(offset++);</span>

<span class="pc bpc" id="L1881" title="2 of 4 branches missed.">            if (quote &amp;&amp; chLocal == '&quot;') {</span>
<span class="fc" id="L1882">                chLocal = charAt(offset++);</span>
            }

            for (;;) {
<span class="fc bfc" id="L1886" title="All 2 branches covered.">                if (chLocal == ',') {</span>
<span class="fc" id="L1887">                    bp = offset;</span>
<span class="fc" id="L1888">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1889">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1890">                    token = JSONToken.COMMA;</span>
<span class="fc" id="L1891">                    return value;</span>
<span class="fc bfc" id="L1892" title="All 2 branches covered.">                } else if (chLocal == ']') {</span>
<span class="fc" id="L1893">                    bp = offset;</span>
<span class="fc" id="L1894">                    this.ch = charAt(bp);</span>
<span class="fc" id="L1895">                    matchStat = VALUE_NULL;</span>
<span class="fc" id="L1896">                    token = JSONToken.RBRACKET;</span>
<span class="fc" id="L1897">                    return value;</span>
<span class="pc bpc" id="L1898" title="1 of 2 branches missed.">                } else if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1899">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1900">                    continue;</span>
                }
                break;
            }
<span class="nc" id="L1904">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L1905">            return 0;</span>
        } else {
<span class="fc" id="L1907">            matchStat = NOT_MATCH;</span>
<span class="fc" id="L1908">            return 0;</span>
        }

        for (;;) {
<span class="fc bfc" id="L1912" title="All 2 branches covered.">            if (chLocal == seperator) {</span>
<span class="fc" id="L1913">                bp = offset;</span>
<span class="fc" id="L1914">                this.ch = charAt(bp);</span>
<span class="fc" id="L1915">                matchStat = VALUE;</span>
<span class="fc" id="L1916">                token = JSONToken.COMMA;</span>
<span class="fc bfc" id="L1917" title="All 2 branches covered.">                return negative ? -value : value;</span>
            } else {
<span class="fc bfc" id="L1919" title="All 2 branches covered.">                if (isWhitespace(chLocal)) {</span>
<span class="fc" id="L1920">                    chLocal = charAt(offset++);</span>
<span class="fc" id="L1921">                    continue;</span>
                }

<span class="fc" id="L1924">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L1925">                return value;</span>
            }
        }
    }

    public java.util.Date scanDate(char seperator) {
<span class="fc" id="L1931">        matchStat = UNKNOWN;</span>
<span class="fc" id="L1932">        int startPos = this.bp;</span>
<span class="fc" id="L1933">        char startChar = this.ch;</span>

<span class="fc" id="L1935">        int index = bp;</span>

<span class="fc" id="L1937">        char ch = charAt(index++);</span>

        final java.util.Date dateVal;
<span class="fc bfc" id="L1940" title="All 2 branches covered.">        if (ch == '&quot;') {</span>
<span class="fc" id="L1941">            int startIndex = index;</span>
<span class="fc" id="L1942">            int endIndex = indexOf('&quot;', startIndex);</span>
<span class="pc bpc" id="L1943" title="1 of 2 branches missed.">            if (endIndex == -1) {</span>
<span class="nc" id="L1944">                throw new JSONException(&quot;unclosed str&quot;);</span>
            }

<span class="fc" id="L1947">            int rest = endIndex - startIndex;</span>
<span class="fc" id="L1948">            bp = index;</span>
<span class="pc bpc" id="L1949" title="1 of 2 branches missed.">            if (scanISO8601DateIfMatch(false, rest)) {</span>
<span class="fc" id="L1950">                dateVal = calendar.getTime();</span>
            } else {
<span class="nc" id="L1952">                bp = startPos;</span>
<span class="nc" id="L1953">                this.ch = startChar;</span>
<span class="nc" id="L1954">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L1955">                return null;</span>
            }
<span class="fc" id="L1957">            ch = charAt(endIndex + 1);</span>
<span class="fc" id="L1958">            bp = startPos;</span>

            for (; ; ) {
<span class="pc bpc" id="L1961" title="1 of 4 branches missed.">                if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L1962">                    bp = endIndex + 1;</span>
<span class="fc" id="L1963">                    this.ch = ch;</span>
<span class="fc" id="L1964">                    break;</span>
<span class="nc bnc" id="L1965" title="All 2 branches missed.">                } else if (isWhitespace(ch)) {</span>
<span class="nc" id="L1966">                    endIndex++;</span>
<span class="nc" id="L1967">                    ch = charAt(endIndex + 1);</span>
                } else {
<span class="nc" id="L1969">                    this.bp = startPos;</span>
<span class="nc" id="L1970">                    this.ch = startChar;</span>
<span class="nc" id="L1971">                    matchStat = NOT_MATCH;</span>

<span class="nc" id="L1973">                    return null;</span>
                }
            }
<span class="pc bpc" id="L1976" title="2 of 6 branches missed.">        } else if (ch == '-' || (ch &gt;= '0' &amp;&amp; ch &lt;= '9')) {</span>
<span class="fc" id="L1977">            long millis = 0;</span>

<span class="fc" id="L1979">            boolean negative = false;</span>
<span class="pc bpc" id="L1980" title="1 of 2 branches missed.">            if (ch == '-') {</span>
<span class="nc" id="L1981">                ch = charAt(index++);</span>
<span class="nc" id="L1982">                negative = true;</span>
            }

<span class="pc bpc" id="L1985" title="2 of 4 branches missed.">            if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1986">                millis = ch - '0';</span>
                for (; ; ) {
<span class="fc" id="L1988">                    ch = charAt(index++);</span>
<span class="fc bfc" id="L1989" title="All 4 branches covered.">                    if (ch &gt;= '0' &amp;&amp; ch &lt;= '9') {</span>
<span class="fc" id="L1990">                        millis = millis * 10 + (ch - '0');</span>
                    } else {
<span class="pc bpc" id="L1992" title="1 of 4 branches missed.">                        if (ch == ',' || ch == ']') {</span>
<span class="fc" id="L1993">                            bp = index - 1;</span>
                        }
                        break;
                    }
                }
            }

<span class="pc bpc" id="L2000" title="1 of 2 branches missed.">            if (millis &lt; 0) {</span>
<span class="nc" id="L2001">                this.bp = startPos;</span>
<span class="nc" id="L2002">                this.ch = startChar;</span>
<span class="nc" id="L2003">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2004">                return null;</span>
            }

<span class="pc bpc" id="L2007" title="1 of 2 branches missed.">            if (negative) {</span>
<span class="nc" id="L2008">                millis = -millis;</span>
            }

<span class="fc" id="L2011">            dateVal = new java.util.Date(millis);</span>
<span class="pc bpc" id="L2012" title="1 of 2 branches missed.">        } else if (ch == 'n'</span>
<span class="pc bpc" id="L2013" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'u'</span>
<span class="pc bpc" id="L2014" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l'</span>
<span class="pc bpc" id="L2015" title="1 of 2 branches missed.">                &amp;&amp; charAt(index++) == 'l') {</span>
<span class="fc" id="L2016">            dateVal = null;</span>
<span class="fc" id="L2017">            ch = charAt(index);</span>
<span class="fc" id="L2018">            bp = index;</span>
        } else {
<span class="nc" id="L2020">            this.bp = startPos;</span>
<span class="nc" id="L2021">            this.ch = startChar;</span>
<span class="nc" id="L2022">            matchStat = NOT_MATCH;</span>

<span class="nc" id="L2024">            return null;</span>
        }

<span class="fc bfc" id="L2027" title="All 2 branches covered.">        if (ch == ',') {</span>
<span class="fc" id="L2028">            this.ch = charAt(++bp);</span>
<span class="fc" id="L2029">            matchStat = VALUE;</span>
<span class="fc" id="L2030">            return dateVal;</span>
        } else {
            //condition ch == '}' is always 'true'
<span class="fc" id="L2033">            ch = charAt(++bp);</span>
<span class="pc bpc" id="L2034" title="1 of 2 branches missed.">            if (ch == ',') {</span>
<span class="nc" id="L2035">                token = JSONToken.COMMA;</span>
<span class="nc" id="L2036">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2037" title="1 of 2 branches missed.">            } else if (ch == ']') {</span>
<span class="nc" id="L2038">                token = JSONToken.RBRACKET;</span>
<span class="nc" id="L2039">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2040" title="1 of 2 branches missed.">            } else if (ch == '}') {</span>
<span class="nc" id="L2041">                token = JSONToken.RBRACE;</span>
<span class="nc" id="L2042">                this.ch = charAt(++bp);</span>
<span class="pc bpc" id="L2043" title="1 of 2 branches missed.">            } else if (ch == EOI) {</span>
<span class="fc" id="L2044">                this.ch = EOI;</span>
<span class="fc" id="L2045">                token = JSONToken.EOF;</span>
            } else {
<span class="nc" id="L2047">                this.bp = startPos;</span>
<span class="nc" id="L2048">                this.ch = startChar;</span>
<span class="nc" id="L2049">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2050">                return null;</span>
            }
<span class="fc" id="L2052">            matchStat = END;</span>
        }
<span class="fc" id="L2054">        return dateVal;</span>
    }

    protected final void arrayCopy(int srcPos, char[] dest, int destPos, int length) {
<span class="fc" id="L2058">        text.getChars(srcPos, srcPos + length, dest, destPos);</span>
<span class="fc" id="L2059">    }</span>

    public String info() {
<span class="fc" id="L2062">        return &quot;pos &quot; + bp //</span>
                + &quot;, json : &quot; //
<span class="pc bpc" id="L2064" title="1 of 2 branches missed.">                + (text.length() &lt; 65536 //</span>
                ? text //
<span class="pc" id="L2066">                : text.substring(0, 65536));</span>
    }

    // for hsf support
    public String[] scanFieldStringArray(char[] fieldName, int argTypesCount, SymbolTable typeSymbolTable) {
<span class="fc" id="L2071">        int startPos = bp;</span>
<span class="fc" id="L2072">        char starChar = ch;</span>

<span class="fc bfc" id="L2074" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2075">            next();</span>
        }

        int offset;
        char ch;
<span class="fc bfc" id="L2080" title="All 2 branches covered.">        if (fieldName != null) {</span>
<span class="fc" id="L2081">            matchStat = UNKNOWN;</span>
<span class="fc bfc" id="L2082" title="All 2 branches covered.">            if (!charArrayCompare(fieldName)) {</span>
<span class="fc" id="L2083">                matchStat = NOT_MATCH_NAME;</span>
<span class="fc" id="L2084">                return null;</span>
            }

<span class="fc" id="L2087">            offset = bp + fieldName.length;</span>
<span class="fc" id="L2088">            ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2089" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2090">                ch = text.charAt(offset++);</span>
            }

<span class="pc bpc" id="L2093" title="1 of 2 branches missed.">            if (ch == ':') {</span>
<span class="fc" id="L2094">                ch = text.charAt(offset++);</span>
            } else {
<span class="nc" id="L2096">                matchStat = NOT_MATCH;</span>
<span class="nc" id="L2097">                return null;</span>
            }

<span class="fc bfc" id="L2100" title="All 2 branches covered.">            while (isWhitespace(ch)) {</span>
<span class="fc" id="L2101">                ch = text.charAt(offset++);</span>
            }
        } else {
<span class="fc" id="L2104">            offset = bp + 1;</span>
<span class="fc" id="L2105">            ch = this.ch;</span>
        }

<span class="fc bfc" id="L2108" title="All 2 branches covered.">        if (ch == '[') {</span>
<span class="fc" id="L2109">            bp = offset;</span>
<span class="fc" id="L2110">            this.ch = text.charAt(bp);</span>
<span class="pc bpc" id="L2111" title="2 of 4 branches missed.">        } else if (ch == 'n' &amp;&amp; text.startsWith(&quot;ull&quot;, bp + 1)) {</span>
<span class="fc" id="L2112">            bp += 4;</span>
<span class="fc" id="L2113">            this.ch = text.charAt(bp);</span>
<span class="fc" id="L2114">            return null;</span>
        } else {
<span class="nc" id="L2116">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2117">            return null;</span>
        }

<span class="pc bpc" id="L2120" title="1 of 2 branches missed.">        String[] types = argTypesCount &gt;= 0 ? new String[argTypesCount] : new String[4];</span>
<span class="fc" id="L2121">        int typeIndex = 0;</span>
        for (;;) {
<span class="fc bfc" id="L2123" title="All 2 branches covered.">            while (isWhitespace(this.ch)) {</span>
<span class="fc" id="L2124">                next();</span>
            }

<span class="fc bfc" id="L2127" title="All 2 branches covered.">            if (this.ch != '\&quot;') {</span>
<span class="fc" id="L2128">                this.bp = startPos;</span>
<span class="fc" id="L2129">                this.ch = starChar;</span>
<span class="fc" id="L2130">                matchStat = NOT_MATCH;</span>
<span class="fc" id="L2131">                return null;</span>
            }

<span class="fc" id="L2134">            String type = scanSymbol(typeSymbolTable, '&quot;');</span>
<span class="pc bpc" id="L2135" title="1 of 2 branches missed.">            if (typeIndex == types.length) {</span>
<span class="nc" id="L2136">                int newCapacity = types.length + (types.length &gt;&gt; 1) + 1;</span>
<span class="nc" id="L2137">                String[] array = new String[newCapacity];</span>
<span class="nc" id="L2138">                System.arraycopy(types, 0, array, 0, types.length);</span>
<span class="nc" id="L2139">                types = array;</span>
            }
<span class="fc" id="L2141">            types[typeIndex++] = type;</span>
<span class="pc bpc" id="L2142" title="1 of 2 branches missed.">            while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2143">                next();</span>
            }
<span class="fc bfc" id="L2145" title="All 2 branches covered.">            if (this.ch == ',') {</span>
<span class="fc" id="L2146">                next();</span>
<span class="fc" id="L2147">                continue;</span>
            }
            break;
        }
<span class="pc bpc" id="L2151" title="1 of 2 branches missed.">        if (types.length != typeIndex) {</span>
<span class="fc" id="L2152">            String[] array = new String[typeIndex];</span>
<span class="fc" id="L2153">            System.arraycopy(types, 0, array, 0, typeIndex);</span>
<span class="fc" id="L2154">            types = array;</span>
        }

<span class="pc bpc" id="L2157" title="1 of 2 branches missed.">        while (isWhitespace(this.ch)) {</span>
<span class="nc" id="L2158">            next();</span>
        }

<span class="pc bpc" id="L2161" title="1 of 2 branches missed.">        if (this.ch == ']') {</span>
<span class="fc" id="L2162">            next();</span>
        } else {
<span class="nc" id="L2164">            this.bp = startPos;</span>
<span class="nc" id="L2165">            this.ch = starChar;</span>
<span class="nc" id="L2166">            matchStat = NOT_MATCH;</span>
<span class="nc" id="L2167">            return null;</span>
        }

<span class="fc" id="L2170">        return types;</span>
    }

    public boolean matchField2(char[] fieldName) {
<span class="fc bfc" id="L2174" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2175">            next();</span>
        }

<span class="pc bpc" id="L2178" title="1 of 2 branches missed.">        if (!charArrayCompare(fieldName)) {</span>
<span class="nc" id="L2179">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2180">            return false;</span>
        }

<span class="fc" id="L2183">        int offset = bp + fieldName.length;</span>
<span class="fc" id="L2184">        char ch = text.charAt(offset++);</span>
<span class="fc bfc" id="L2185" title="All 2 branches covered.">        while (isWhitespace(ch)) {</span>
<span class="fc" id="L2186">            ch = text.charAt(offset++);</span>
        }

<span class="pc bpc" id="L2189" title="1 of 2 branches missed.">        if (ch == ':') {</span>
<span class="fc" id="L2190">            this.bp = offset;</span>
<span class="fc" id="L2191">            this.ch = charAt(bp);</span>
<span class="fc" id="L2192">            return true;</span>
        } else {
<span class="nc" id="L2194">            matchStat = NOT_MATCH_NAME;</span>
<span class="nc" id="L2195">            return false;</span>
        }


    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>