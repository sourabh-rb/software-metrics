<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DiffBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Apache Commons Lang</a> &gt; <a href="index.source.html" class="el_package">org.apache.commons.lang3.builder</a> &gt; <span class="el_source">DiffBuilder.java</span></div><h1>DiffBuilder.java</h1><pre class="source lang-java linenums">/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the &quot;License&quot;); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package org.apache.commons.lang3.builder;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.apache.commons.lang3.ArrayUtils;

/**
 * &lt;p&gt;
 * Assists in implementing {@link Diffable#diff(Object)} methods.
 * &lt;/p&gt;
 * 
 * &lt;p&gt;
 * To use this class, write code as follows:
 * &lt;/p&gt;
 * 
 * &lt;pre&gt;
 * public class Person implements Diffable&amp;lt;Person&amp;gt; {
 *   String name;
 *   int age;
 *   boolean smoker;
 *   
 *   ...
 *   
 *   public DiffResult diff(Person obj) {
 *     // No need for null check, as NullPointerException correct if obj is null
 *     return new DiffBuilder(this, obj, ToStringStyle.SHORT_PREFIX_STYLE)
 *       .append(&quot;name&quot;, this.name, obj.name)
 *       .append(&quot;age&quot;, this.age, obj.age)
 *       .append(&quot;smoker&quot;, this.smoker, obj.smoker)
 *       .build();
 *   }
 * }
 * &lt;/pre&gt;
 * 
 * &lt;p&gt;
 * The {@code ToStringStyle} passed to the constructor is embedded in the
 * returned {@code DiffResult} and influences the style of the
 * {@code DiffResult.toString()} method. This style choice can be overridden by
 * calling {@link DiffResult#toString(ToStringStyle)}.
 * &lt;/p&gt;
 * 
 * @since 3.3
 * @see Diffable
 * @see Diff
 * @see DiffResult
 * @see ToStringStyle
 */
public class DiffBuilder implements Builder&lt;DiffResult&gt; {

    private final List&lt;Diff&lt;?&gt;&gt; diffs;
    private final boolean objectsTriviallyEqual;
    private final Object left;
    private final Object right;
    private final ToStringStyle style;

    /**
     * &lt;p&gt;
     * Constructs a builder for the specified objects with the specified style.
     * &lt;/p&gt;
     * 
     * &lt;p&gt;
     * If {@code lhs == rhs} or {@code lhs.equals(rhs)} then the builder will
     * not evaluate any calls to {@code append(...)} and will return an empty
     * {@link DiffResult} when {@link #build()} is executed.
     * &lt;/p&gt;
     * 
     * @param lhs
     *            {@code this} object
     * @param rhs
     *            the object to diff against
     * @param style
     *            the style will use when outputting the objects, {@code null}
     *            uses the default
     * @param testTriviallyEqual
     *            If true, this will test if lhs and rhs are the same or equal.
     *            All of the append(fieldName, lhs, rhs) methods will abort
     *            without creating a field {@link Diff} if the trivially equal
     *            test is enabled and returns true.  The result of this test
     *            is never changed throughout the life of this {@link DiffBuilder}.
     * @throws IllegalArgumentException
     *             if {@code lhs} or {@code rhs} is {@code null}
     * @since 3.4
     */
    public DiffBuilder(final Object lhs, final Object rhs,
<span class="fc" id="L103">            final ToStringStyle style, final boolean testTriviallyEqual) {</span>

<span class="fc bfc" id="L105" title="All 2 branches covered.">        if (lhs == null) {</span>
<span class="fc" id="L106">            throw new IllegalArgumentException(&quot;lhs cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L108" title="All 2 branches covered.">        if (rhs == null) {</span>
<span class="fc" id="L109">            throw new IllegalArgumentException(&quot;rhs cannot be null&quot;);</span>
        }

<span class="fc" id="L112">        this.diffs = new ArrayList&lt;Diff&lt;?&gt;&gt;();</span>
<span class="fc" id="L113">        this.left = lhs;</span>
<span class="fc" id="L114">        this.right = rhs;</span>
<span class="fc" id="L115">        this.style = style;</span>

        // Don't compare any fields if objects equal
<span class="fc bfc" id="L118" title="All 6 branches covered.">        this.objectsTriviallyEqual = testTriviallyEqual &amp;&amp; (lhs == rhs || lhs.equals(rhs));</span>
<span class="fc" id="L119">    }</span>

    /**
     * &lt;p&gt;
     * Constructs a builder for the specified objects with the specified style.
     * &lt;/p&gt;
     * 
     * &lt;p&gt;
     * If {@code lhs == rhs} or {@code lhs.equals(rhs)} then the builder will
     * not evaluate any calls to {@code append(...)} and will return an empty
     * {@link DiffResult} when {@link #build()} is executed.
     * &lt;/p&gt;
     * 
     * &lt;p&gt;
     * This delegates to {@link #DiffBuilder(Object, Object, ToStringStyle, boolean)}
     * with the testTriviallyEqual flag enabled.
     * &lt;/p&gt;
     *
     * @param lhs
     *            {@code this} object
     * @param rhs
     *            the object to diff against
     * @param style
     *            the style will use when outputting the objects, {@code null}
     *            uses the default
     * @throws IllegalArgumentException
     *             if {@code lhs} or {@code rhs} is {@code null}
     */
    public DiffBuilder(final Object lhs, final Object rhs,
            final ToStringStyle style) {

<span class="fc" id="L150">            this(lhs, rhs, style, true);</span>
<span class="fc" id="L151">    }</span>

    /**
     * &lt;p&gt;
     * Test if two {@code boolean}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code boolean}
     * @param rhs
     *            the right hand {@code boolean}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final boolean lhs,
            final boolean rhs) {
<span class="pc bpc" id="L170" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L171">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L174" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L175">            return this;</span>
        }
<span class="fc bfc" id="L177" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L178">            diffs.add(new Diff&lt;Boolean&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Boolean getLeft() {
<span class="fc" id="L183">                    return Boolean.valueOf(lhs);</span>
                }

                @Override
                public Boolean getRight() {
<span class="fc" id="L188">                    return Boolean.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L192">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code boolean[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code boolean[]}
     * @param rhs
     *            the right hand {@code boolean[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final boolean[] lhs,
            final boolean[] rhs) {
<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L213">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L215" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L216">            return this;</span>
        }
<span class="fc bfc" id="L218" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L219">            diffs.add(new Diff&lt;Boolean[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Boolean[] getLeft() {
<span class="fc" id="L224">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Boolean[] getRight() {
<span class="fc" id="L229">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L233">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code byte}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code byte}
     * @param rhs
     *            the right hand {@code byte}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final byte lhs,
            final byte rhs) {
<span class="pc bpc" id="L253" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L254">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L256" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L257">            return this;</span>
        }
<span class="fc bfc" id="L259" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L260">            diffs.add(new Diff&lt;Byte&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Byte getLeft() {
<span class="fc" id="L265">                    return Byte.valueOf(lhs);</span>
                }

                @Override
                public Byte getRight() {
<span class="fc" id="L270">                    return Byte.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L274">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code byte[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code byte[]}
     * @param rhs
     *            the right hand {@code byte[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final byte[] lhs,
            final byte[] rhs) {
<span class="pc bpc" id="L294" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L295">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L298" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L299">            return this;</span>
        }
<span class="fc bfc" id="L301" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L302">            diffs.add(new Diff&lt;Byte[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Byte[] getLeft() {
<span class="fc" id="L307">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Byte[] getRight() {
<span class="fc" id="L312">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L316">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code char}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code char}
     * @param rhs
     *            the right hand {@code char}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final char lhs,
            final char rhs) {
<span class="pc bpc" id="L336" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L337">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L340" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L341">            return this;</span>
        }
<span class="fc bfc" id="L343" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L344">            diffs.add(new Diff&lt;Character&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Character getLeft() {
<span class="fc" id="L349">                    return Character.valueOf(lhs);</span>
                }

                @Override
                public Character getRight() {
<span class="fc" id="L354">                    return Character.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L358">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code char[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code char[]}
     * @param rhs
     *            the right hand {@code char[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final char[] lhs,
            final char[] rhs) {
<span class="pc bpc" id="L378" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L379">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L382" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L383">            return this;</span>
        }
<span class="fc bfc" id="L385" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L386">            diffs.add(new Diff&lt;Character[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Character[] getLeft() {
<span class="fc" id="L391">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Character[] getRight() {
<span class="fc" id="L396">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L400">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code double}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code double}
     * @param rhs
     *            the right hand {@code double}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final double lhs,
            final double rhs) {
<span class="pc bpc" id="L420" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L421">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L424" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L425">            return this;</span>
        }
<span class="fc bfc" id="L427" title="All 2 branches covered.">        if (Double.doubleToLongBits(lhs) != Double.doubleToLongBits(rhs)) {</span>
<span class="fc" id="L428">            diffs.add(new Diff&lt;Double&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Double getLeft() {
<span class="fc" id="L433">                    return Double.valueOf(lhs);</span>
                }

                @Override
                public Double getRight() {
<span class="fc" id="L438">                    return Double.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L442">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code double[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code double[]}
     * @param rhs
     *            the right hand {@code double[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final double[] lhs,
            final double[] rhs) {
<span class="pc bpc" id="L462" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L463">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L466" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L467">            return this;</span>
        }
<span class="fc bfc" id="L469" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L470">            diffs.add(new Diff&lt;Double[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Double[] getLeft() {
<span class="fc" id="L475">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Double[] getRight() {
<span class="fc" id="L480">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L484">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code float}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code float}
     * @param rhs
     *            the right hand {@code float}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final float lhs,
            final float rhs) {
<span class="pc bpc" id="L504" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L505">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L508" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L509">            return this;</span>
        }
<span class="fc bfc" id="L511" title="All 2 branches covered.">        if (Float.floatToIntBits(lhs) != Float.floatToIntBits(rhs)) {</span>
<span class="fc" id="L512">            diffs.add(new Diff&lt;Float&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Float getLeft() {
<span class="fc" id="L517">                    return Float.valueOf(lhs);</span>
                }

                @Override
                public Float getRight() {
<span class="fc" id="L522">                    return Float.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L526">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code float[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code float[]}
     * @param rhs
     *            the right hand {@code float[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final float[] lhs,
            final float[] rhs) {
<span class="pc bpc" id="L546" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L547">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L550" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L551">            return this;</span>
        }
<span class="fc bfc" id="L553" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L554">            diffs.add(new Diff&lt;Float[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Float[] getLeft() {
<span class="fc" id="L559">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Float[] getRight() {
<span class="fc" id="L564">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L568">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code int}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code int}
     * @param rhs
     *            the right hand {@code int}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final int lhs,
            final int rhs) {
<span class="pc bpc" id="L588" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L589">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L592" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L593">            return this;</span>
        }
<span class="fc bfc" id="L595" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L596">            diffs.add(new Diff&lt;Integer&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Integer getLeft() {
<span class="fc" id="L601">                    return Integer.valueOf(lhs);</span>
                }

                @Override
                public Integer getRight() {
<span class="fc" id="L606">                    return Integer.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L610">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code int[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code int[]}
     * @param rhs
     *            the right hand {@code int[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final int[] lhs,
            final int[] rhs) {
<span class="pc bpc" id="L630" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L631">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L634" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L635">            return this;</span>
        }
<span class="fc bfc" id="L637" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L638">            diffs.add(new Diff&lt;Integer[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Integer[] getLeft() {
<span class="fc" id="L643">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Integer[] getRight() {
<span class="fc" id="L648">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L652">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code long}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code long}
     * @param rhs
     *            the right hand {@code long}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final long lhs,
            final long rhs) {
<span class="pc bpc" id="L672" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L673">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L676" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L677">            return this;</span>
        }
<span class="fc bfc" id="L679" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L680">            diffs.add(new Diff&lt;Long&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Long getLeft() {
<span class="fc" id="L685">                    return Long.valueOf(lhs);</span>
                }

                @Override
                public Long getRight() {
<span class="fc" id="L690">                    return Long.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L694">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code long[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code long[]}
     * @param rhs
     *            the right hand {@code long[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final long[] lhs,
            final long[] rhs) {
<span class="pc bpc" id="L714" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L715">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L718" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L719">            return this;</span>
        }
<span class="fc bfc" id="L721" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L722">            diffs.add(new Diff&lt;Long[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Long[] getLeft() {
<span class="fc" id="L727">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Long[] getRight() {
<span class="fc" id="L732">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L736">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code short}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code short}
     * @param rhs
     *            the right hand {@code short}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final short lhs,
            final short rhs) {
<span class="pc bpc" id="L756" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L757">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L760" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L761">            return this;</span>
        }
<span class="fc bfc" id="L763" title="All 2 branches covered.">        if (lhs != rhs) {</span>
<span class="fc" id="L764">            diffs.add(new Diff&lt;Short&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Short getLeft() {
<span class="fc" id="L769">                    return Short.valueOf(lhs);</span>
                }

                @Override
                public Short getRight() {
<span class="fc" id="L774">                    return Short.valueOf(rhs);</span>
                }
            });
        }
<span class="fc" id="L778">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code short[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code short[]}
     * @param rhs
     *            the right hand {@code short[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final short[] lhs,
            final short[] rhs) {
<span class="pc bpc" id="L798" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L799">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }

<span class="fc bfc" id="L802" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L803">            return this;</span>
        }
<span class="fc bfc" id="L805" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L806">            diffs.add(new Diff&lt;Short[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Short[] getLeft() {
<span class="fc" id="L811">                    return ArrayUtils.toObject(lhs);</span>
                }

                @Override
                public Short[] getRight() {
<span class="fc" id="L816">                    return ArrayUtils.toObject(rhs);</span>
                }
            });
        }
<span class="fc" id="L820">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code Objects}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code Object}
     * @param rhs
     *            the right hand {@code Object}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final Object lhs,
            final Object rhs) {
<span class="pc bpc" id="L840" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L841">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L843" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L844">            return this;</span>
        }
<span class="fc bfc" id="L846" title="All 2 branches covered.">        if (lhs == rhs) {</span>
<span class="fc" id="L847">            return this;</span>
        }

        Object objectToTest;
<span class="fc bfc" id="L851" title="All 2 branches covered.">        if (lhs != null) {</span>
<span class="fc" id="L852">            objectToTest = lhs;</span>
        } else {
            // rhs cannot be null, as lhs != rhs
<span class="fc" id="L855">            objectToTest = rhs;</span>
        }

<span class="fc bfc" id="L858" title="All 2 branches covered.">        if (objectToTest.getClass().isArray()) {</span>
<span class="fc bfc" id="L859" title="All 2 branches covered.">            if (objectToTest instanceof boolean[]) {</span>
<span class="fc" id="L860">                return append(fieldName, (boolean[]) lhs, (boolean[]) rhs);</span>
            }
<span class="fc bfc" id="L862" title="All 2 branches covered.">            if (objectToTest instanceof byte[]) {</span>
<span class="fc" id="L863">                return append(fieldName, (byte[]) lhs, (byte[]) rhs);</span>
            }
<span class="fc bfc" id="L865" title="All 2 branches covered.">            if (objectToTest instanceof char[]) {</span>
<span class="fc" id="L866">                return append(fieldName, (char[]) lhs, (char[]) rhs);</span>
            }
<span class="fc bfc" id="L868" title="All 2 branches covered.">            if (objectToTest instanceof double[]) {</span>
<span class="fc" id="L869">                return append(fieldName, (double[]) lhs, (double[]) rhs);</span>
            }
<span class="fc bfc" id="L871" title="All 2 branches covered.">            if (objectToTest instanceof float[]) {</span>
<span class="fc" id="L872">                return append(fieldName, (float[]) lhs, (float[]) rhs);</span>
            }
<span class="fc bfc" id="L874" title="All 2 branches covered.">            if (objectToTest instanceof int[]) {</span>
<span class="fc" id="L875">                return append(fieldName, (int[]) lhs, (int[]) rhs);</span>
            }
<span class="fc bfc" id="L877" title="All 2 branches covered.">            if (objectToTest instanceof long[]) {</span>
<span class="fc" id="L878">                return append(fieldName, (long[]) lhs, (long[]) rhs);</span>
            }
<span class="fc bfc" id="L880" title="All 2 branches covered.">            if (objectToTest instanceof short[]) {</span>
<span class="fc" id="L881">                return append(fieldName, (short[]) lhs, (short[]) rhs);</span>
            }

<span class="fc" id="L884">            return append(fieldName, (Object[]) lhs, (Object[]) rhs);</span>
        }

        // Not array type
<span class="pc bpc" id="L888" title="1 of 4 branches missed.">        if (lhs != null &amp;&amp; lhs.equals(rhs)) {</span>
<span class="nc" id="L889">            return this;</span>
        }

<span class="fc" id="L892">        diffs.add(new Diff&lt;Object&gt;(fieldName) {</span>
            private static final long serialVersionUID = 1L;

            @Override
            public Object getLeft() {
<span class="fc" id="L897">                return lhs;</span>
            }

            @Override
            public Object getRight() {
<span class="fc" id="L902">                return rhs;</span>
            }
        });

<span class="fc" id="L906">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Test if two {@code Object[]}s are equal.
     * &lt;/p&gt;
     * 
     * @param fieldName
     *            the field name
     * @param lhs
     *            the left hand {@code Object[]}
     * @param rhs
     *            the right hand {@code Object[]}
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     */
    public DiffBuilder append(final String fieldName, final Object[] lhs,
            final Object[] rhs) {
<span class="pc bpc" id="L926" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L927">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }
<span class="fc bfc" id="L929" title="All 2 branches covered.">        if (objectsTriviallyEqual) {</span>
<span class="fc" id="L930">            return this;</span>
        }

<span class="fc bfc" id="L933" title="All 2 branches covered.">        if (!Arrays.equals(lhs, rhs)) {</span>
<span class="fc" id="L934">            diffs.add(new Diff&lt;Object[]&gt;(fieldName) {</span>
                private static final long serialVersionUID = 1L;

                @Override
                public Object[] getLeft() {
<span class="fc" id="L939">                    return lhs;</span>
                }

                @Override
                public Object[] getRight() {
<span class="fc" id="L944">                    return rhs;</span>
                }
            });
        }

<span class="fc" id="L949">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Append diffs from another {@code DiffResult}.
     * &lt;/p&gt;
     * 
     * &lt;p&gt;
     * This method is useful if you want to compare properties which are
     * themselves Diffable and would like to know which specific part of
     * it is different.
     * &lt;/p&gt;
     * 
     * &lt;pre&gt;
     * public class Person implements Diffable&amp;lt;Person&amp;gt; {
     *   String name;
     *   Address address; // implements Diffable&amp;lt;Address&amp;gt;
     *   
     *   ...
     *   
     *   public DiffResult diff(Person obj) {
     *     return new DiffBuilder(this, obj, ToStringStyle.SHORT_PREFIX_STYLE)
     *       .append(&quot;name&quot;, this.name, obj.name)
     *       .append(&quot;address&quot;, this.address.diff(obj.address))
     *       .build();
     *   }
     * }
     * &lt;/pre&gt;
     * 
     * @param fieldName
     *            the field name
     * @param diffResult
     *            the {@code DiffResult} to append
     * @return this
     * @throws IllegalArgumentException
     *             if field name is {@code null}
     * @since 3.5
     */
    public DiffBuilder append(final String fieldName,
            final DiffResult diffResult) {
<span class="pc bpc" id="L990" title="1 of 2 branches missed.">        if (fieldName == null) {</span>
<span class="nc" id="L991">            throw new IllegalArgumentException(&quot;Field name cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L993" title="1 of 2 branches missed.">        if (diffResult == null) {</span>
<span class="nc" id="L994">            throw new IllegalArgumentException(&quot;Diff result cannot be null&quot;);</span>
        }
<span class="pc bpc" id="L996" title="1 of 2 branches missed.">        if (objectsTriviallyEqual) {</span>
<span class="nc" id="L997">            return this;</span>
        }

<span class="fc bfc" id="L1000" title="All 2 branches covered.">        for (Diff&lt;?&gt; diff : diffResult.getDiffs()) {</span>
<span class="fc" id="L1001">            append(fieldName + &quot;.&quot; + diff.getFieldName(),</span>
<span class="fc" id="L1002">                   diff.getLeft(), diff.getRight());</span>
<span class="fc" id="L1003">        }</span>

<span class="fc" id="L1005">        return this;</span>
    }

    /**
     * &lt;p&gt;
     * Builds a {@link DiffResult} based on the differences appended to this
     * builder.
     * &lt;/p&gt;
     * 
     * @return a {@code DiffResult} containing the differences between the two
     *         objects.
     */
    @Override
    public DiffResult build() {
<span class="fc" id="L1019">        return new DiffResult(left, right, diffs, style);</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>